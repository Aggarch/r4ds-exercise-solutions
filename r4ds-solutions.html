<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R for Data Science Solutions</title>
  <meta name="description" content="<p>This contains the solutions to the exercises in the book, R for Data Science, by Garrett Grolemund and Hadley Wickham.</p>">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="R for Data Science Solutions" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://jrnold.github.io/r4ds-exercise-solutions" />
  
  <meta property="og:description" content="<p>This contains the solutions to the exercises in the book, R for Data Science, by Garrett Grolemund and Hadley Wickham.</p>" />
  <meta name="github-repo" content="jrnold/r4ds-exercise-solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Data Science Solutions" />
  <meta name="twitter:site" content="@jrnld" />
  <meta name="twitter:description" content="<p>This contains the solutions to the exercises in the book, R for Data Science, by Garrett Grolemund and Hadley Wickham.</p>" />
  

<meta name="author" content="Jeffrey B. Arnold">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/htmlwidgets-1.0/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.2.0/str_view.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
<link rel="stylesheet" href="r4ds-solutions.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">R for Data Science Solutions</h1>
<h4 class="author"><em>Jeffrey B. Arnold</em></h4>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#welcome">Welcome</a></li>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#part-explore">(PART) Explore</a></li>
<li><a href="#explore-intro"><span class="toc-section-number">2</span> Introduction</a></li>
<li><a href="#visualize"><span class="toc-section-number">3</span> Visualize</a><ul>
<li><a href="#introduction-1"><span class="toc-section-number">3.1</span> Introduction</a></li>
<li><a href="#first-steps"><span class="toc-section-number">3.2</span> First Steps</a><ul>
<li><a href="#exercise-1."><span class="toc-section-number">3.2.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2."><span class="toc-section-number">3.2.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3."><span class="toc-section-number">3.2.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4."><span class="toc-section-number">3.2.4</span> Exercise 4.</a></li>
<li><a href="#exercise-5."><span class="toc-section-number">3.2.5</span> Exercise 5.</a></li>
</ul></li>
<li><a href="#aesthetic-mappings"><span class="toc-section-number">3.3</span> Aesthetic mappings</a><ul>
<li><a href="#exercise-1.-1"><span class="toc-section-number">3.3.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-1"><span class="toc-section-number">3.3.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-1"><span class="toc-section-number">3.3.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4.-1"><span class="toc-section-number">3.3.4</span> Exercise 4.</a></li>
<li><a href="#exercise-5.-1"><span class="toc-section-number">3.3.5</span> Exercise 5.</a></li>
<li><a href="#exercise-6."><span class="toc-section-number">3.3.6</span> Exercise 6.</a></li>
</ul></li>
<li><a href="#common-problems"><span class="toc-section-number">3.4</span> Common problems</a></li>
<li><a href="#facets"><span class="toc-section-number">3.5</span> Facets</a><ul>
<li><a href="#exercise-1.-2"><span class="toc-section-number">3.5.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-2"><span class="toc-section-number">3.5.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-2"><span class="toc-section-number">3.5.3</span> Exercise 3.</a></li>
<li><a href="#exercise-5.-2"><span class="toc-section-number">3.5.4</span> Exercise 5.</a></li>
<li><a href="#exercise-6.-1"><span class="toc-section-number">3.5.5</span> Exercise 6.</a></li>
</ul></li>
<li><a href="#geometric-objects"><span class="toc-section-number">3.6</span> Geometric Objects</a><ul>
<li><a href="#exercise-1.-3"><span class="toc-section-number">3.6.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-3"><span class="toc-section-number">3.6.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-3"><span class="toc-section-number">3.6.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4.-2"><span class="toc-section-number">3.6.4</span> Exercise 4.</a></li>
<li><a href="#exercise-5.-3"><span class="toc-section-number">3.6.5</span> Exercise 5.</a></li>
<li><a href="#exercise-6.-2"><span class="toc-section-number">3.6.6</span> Exercise 6.</a></li>
</ul></li>
<li><a href="#statistical-transformations"><span class="toc-section-number">3.7</span> Statistical Transformations</a><ul>
<li><a href="#exercise-1.-4"><span class="toc-section-number">3.7.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-4"><span class="toc-section-number">3.7.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-4"><span class="toc-section-number">3.7.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4.-3"><span class="toc-section-number">3.7.4</span> Exercise 4.</a></li>
<li><a href="#exercise-5.-4"><span class="toc-section-number">3.7.5</span> Exercise 5.</a></li>
</ul></li>
<li><a href="#position-adjustments"><span class="toc-section-number">3.8</span> Position Adjustments</a><ul>
<li><a href="#exercise-1.-5"><span class="toc-section-number">3.8.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-5"><span class="toc-section-number">3.8.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-5"><span class="toc-section-number">3.8.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4.-4"><span class="toc-section-number">3.8.4</span> Exercise 4.</a></li>
</ul></li>
<li><a href="#coordinate-systems"><span class="toc-section-number">3.9</span> Coordinate Systems</a><ul>
<li><a href="#exercise-1.-6"><span class="toc-section-number">3.9.1</span> Exercise 1.</a></li>
<li><a href="#exercise-2.-6"><span class="toc-section-number">3.9.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-6"><span class="toc-section-number">3.9.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4.-5"><span class="toc-section-number">3.9.4</span> Exercise 4.</a></li>
</ul></li>
<li><a href="#the-layered-grammar-of-graphics"><span class="toc-section-number">3.10</span> The Layered Grammar of Graphics</a></li>
</ul></li>
<li><a href="#workflow-basics"><span class="toc-section-number">4</span> Workflow Basics</a><ul>
<li><a href="#coding-basics"><span class="toc-section-number">4.1</span> Coding basics</a></li>
<li><a href="#whats-in-a-name"><span class="toc-section-number">4.2</span> What’s in a name?</a></li>
<li><a href="#calling-functions"><span class="toc-section-number">4.3</span> Calling functions</a></li>
<li><a href="#practice"><span class="toc-section-number">4.4</span> Practice</a><ul>
<li><a href="#exercise-1"><span class="toc-section-number">4.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2"><span class="toc-section-number">4.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3"><span class="toc-section-number">4.4.3</span> Exercise 3</a></li>
</ul></li>
</ul></li>
<li><a href="#data-transformation"><span class="toc-section-number">5</span> Data Transformation</a><ul>
<li><a href="#introduction-2"><span class="toc-section-number">5.1</span> Introduction</a></li>
<li><a href="#filter-rows-with-filter"><span class="toc-section-number">5.2</span> Filter rows with <code>filter()</code></a><ul>
<li><a href="#exercise-1-1"><span class="toc-section-number">5.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-1"><span class="toc-section-number">5.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-1"><span class="toc-section-number">5.2.3</span> Exercise 3</a></li>
<li><a href="#exercise-4"><span class="toc-section-number">5.2.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#arrange-rows-with-arrange"><span class="toc-section-number">5.3</span> Arrange rows with <code>arrange()</code></a><ul>
<li><a href="#exercise-1-2"><span class="toc-section-number">5.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-2"><span class="toc-section-number">5.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-2"><span class="toc-section-number">5.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-1"><span class="toc-section-number">5.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#select-columns-with-select"><span class="toc-section-number">5.4</span> Select columns with <code>select()</code></a><ul>
<li><a href="#exercise-1-3"><span class="toc-section-number">5.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-3"><span class="toc-section-number">5.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-3"><span class="toc-section-number">5.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-2"><span class="toc-section-number">5.4.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#add-new-variables-with-mutate"><span class="toc-section-number">5.5</span> Add new variables with <code>mutate()</code></a><ul>
<li><a href="#exercise-1-4"><span class="toc-section-number">5.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-4"><span class="toc-section-number">5.5.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-4"><span class="toc-section-number">5.5.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-3"><span class="toc-section-number">5.5.4</span> Exercise 4</a></li>
<li><a href="#exercise-5"><span class="toc-section-number">5.5.5</span> Exercise 5</a></li>
<li><a href="#exercise-6"><span class="toc-section-number">5.5.6</span> Exercise 6</a></li>
</ul></li>
<li><a href="#grouped-summaries-with-summarise"><span class="toc-section-number">5.6</span> Grouped summaries with <code>summarise()</code></a><ul>
<li><a href="#exercise-1-5"><span class="toc-section-number">5.6.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-5"><span class="toc-section-number">5.6.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-5"><span class="toc-section-number">5.6.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-4"><span class="toc-section-number">5.6.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-1"><span class="toc-section-number">5.6.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-1"><span class="toc-section-number">5.6.6</span> Exercise 6</a></li>
<li><a href="#exercise-7"><span class="toc-section-number">5.6.7</span> Exercise 7</a></li>
</ul></li>
<li><a href="#grouped-mutates-and-filters"><span class="toc-section-number">5.7</span> Grouped mutates (and filters)</a><ul>
<li><a href="#exercise-1-6"><span class="toc-section-number">5.7.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-6"><span class="toc-section-number">5.7.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-6"><span class="toc-section-number">5.7.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-5"><span class="toc-section-number">5.7.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-2"><span class="toc-section-number">5.7.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-2"><span class="toc-section-number">5.7.6</span> Exercise 6</a></li>
<li><a href="#exercise-7-1"><span class="toc-section-number">5.7.7</span> Exercise 7</a></li>
</ul></li>
</ul></li>
<li><a href="#workflow-scripts"><span class="toc-section-number">6</span> Workflow: scripts</a><ul>
<li><a href="#running-code"><span class="toc-section-number">6.1</span> Running code</a></li>
<li><a href="#rstudio-diagnostics"><span class="toc-section-number">6.2</span> RStudio diagnostics</a></li>
<li><a href="#practice-1"><span class="toc-section-number">6.3</span> Practice</a><ul>
<li><a href="#exercise-1-7"><span class="toc-section-number">6.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-7"><span class="toc-section-number">6.3.2</span> Exercise 2</a></li>
</ul></li>
</ul></li>
<li><a href="#exploratory-data-analysis"><span class="toc-section-number">7</span> Exploratory Data Analysis</a><ul>
<li><a href="#introduction-3"><span class="toc-section-number">7.1</span> Introduction</a></li>
<li><a href="#questions"><span class="toc-section-number">7.2</span> Questions</a></li>
<li><a href="#variation"><span class="toc-section-number">7.3</span> Variation</a><ul>
<li><a href="#exercise-1-8"><span class="toc-section-number">7.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2.-7"><span class="toc-section-number">7.3.2</span> Exercise 2.</a></li>
<li><a href="#exercise-3.-7"><span class="toc-section-number">7.3.3</span> Exercise 3.</a></li>
<li><a href="#exercise-4-6"><span class="toc-section-number">7.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#missing-values"><span class="toc-section-number">7.4</span> Missing Values</a><ul>
<li><a href="#exercise-1-9"><span class="toc-section-number">7.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-8"><span class="toc-section-number">7.4.2</span> Exercise 2</a></li>
</ul></li>
<li><a href="#covariation"><span class="toc-section-number">7.5</span> Covariation</a><ul>
<li><a href="#a-categorical-and-continuous-variable"><span class="toc-section-number">7.5.1</span> A categorical and continuous variable</a></li>
<li><a href="#two-categorical-variables"><span class="toc-section-number">7.5.2</span> Two categorical variables</a></li>
<li><a href="#two-continuous-variables"><span class="toc-section-number">7.5.3</span> Two continuous variables</a></li>
</ul></li>
<li><a href="#patterns-and-models"><span class="toc-section-number">7.6</span> Patterns and models</a></li>
<li><a href="#ggplot2-calls"><span class="toc-section-number">7.7</span> ggplot2 calls</a></li>
<li><a href="#learning-more"><span class="toc-section-number">7.8</span> Learning more</a></li>
</ul></li>
<li><a href="#workflow-projects"><span class="toc-section-number">8</span> Workflow: Projects</a></li>
<li><a href="#part-wrangle">(PART) Wrangle</a></li>
<li><a href="#tibbles"><span class="toc-section-number">9</span> Tibbles</a><ul>
<li><a href="#introduction-4"><span class="toc-section-number">9.1</span> Introduction</a></li>
<li><a href="#creating-tibbles"><span class="toc-section-number">9.2</span> Creating Tibbles</a></li>
<li><a href="#tibbles-vs.data.frame"><span class="toc-section-number">9.3</span> Tibbles vs. data.frame</a></li>
<li><a href="#subsetting"><span class="toc-section-number">9.4</span> Subsetting</a></li>
<li><a href="#interacting-with-older-code"><span class="toc-section-number">9.5</span> Interacting with older code</a></li>
<li><a href="#exercises"><span class="toc-section-number">9.6</span> Exercises</a><ul>
<li><a href="#exercise-1-13"><span class="toc-section-number">9.6.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-12"><span class="toc-section-number">9.6.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-10"><span class="toc-section-number">9.6.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-9"><span class="toc-section-number">9.6.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-5"><span class="toc-section-number">9.6.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-4"><span class="toc-section-number">9.6.6</span> Exercise 6</a></li>
</ul></li>
</ul></li>
<li><a href="#data-import"><span class="toc-section-number">10</span> Data Import</a><ul>
<li><a href="#introduction-5"><span class="toc-section-number">10.1</span> Introduction</a></li>
<li><a href="#getting-started"><span class="toc-section-number">10.2</span> Getting started</a><ul>
<li><a href="#exercise-1-14"><span class="toc-section-number">10.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-13"><span class="toc-section-number">10.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-11"><span class="toc-section-number">10.2.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-10"><span class="toc-section-number">10.2.4</span> Exercise 4</a></li>
<li><a href="#exercise-6-5"><span class="toc-section-number">10.2.5</span> Exercise 6</a></li>
</ul></li>
<li><a href="#parsing-a-vector"><span class="toc-section-number">10.3</span> Parsing a vector</a><ul>
<li><a href="#exercise-1-15"><span class="toc-section-number">10.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-14"><span class="toc-section-number">10.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-12"><span class="toc-section-number">10.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-11"><span class="toc-section-number">10.3.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-6"><span class="toc-section-number">10.3.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-6"><span class="toc-section-number">10.3.6</span> Exercise 6</a></li>
<li><a href="#exercise-7-2"><span class="toc-section-number">10.3.7</span> Exercise 7</a></li>
</ul></li>
<li><a href="#parsing-a-file"><span class="toc-section-number">10.4</span> Parsing a file</a></li>
<li><a href="#writing-to-a-file"><span class="toc-section-number">10.5</span> Writing to a file</a></li>
<li><a href="#other-types-of-data"><span class="toc-section-number">10.6</span> Other Types of Data</a></li>
</ul></li>
<li><a href="#tidy-data"><span class="toc-section-number">11</span> Tidy Data</a><ul>
<li><a href="#introduction-6"><span class="toc-section-number">11.1</span> Introduction</a></li>
<li><a href="#tidy-data-1"><span class="toc-section-number">11.2</span> Tidy Data</a><ul>
<li><a href="#exercise-1-16"><span class="toc-section-number">11.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-15"><span class="toc-section-number">11.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-13"><span class="toc-section-number">11.2.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#spreading-and-gathering"><span class="toc-section-number">11.3</span> Spreading and Gathering</a><ul>
<li><a href="#exercise-1-17"><span class="toc-section-number">11.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-16"><span class="toc-section-number">11.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-14"><span class="toc-section-number">11.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-12"><span class="toc-section-number">11.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#separating-and-uniting"><span class="toc-section-number">11.4</span> Separating and Uniting</a><ul>
<li><a href="#exercise-1-18"><span class="toc-section-number">11.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-17"><span class="toc-section-number">11.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-15"><span class="toc-section-number">11.4.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#missing-values-1"><span class="toc-section-number">11.5</span> Missing Values</a><ul>
<li><a href="#exercise-1-19"><span class="toc-section-number">11.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-18"><span class="toc-section-number">11.5.2</span> Exercise 2</a></li>
</ul></li>
<li><a href="#case-study"><span class="toc-section-number">11.6</span> Case Study</a><ul>
<li><a href="#exercise-1-20"><span class="toc-section-number">11.6.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-19"><span class="toc-section-number">11.6.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-16"><span class="toc-section-number">11.6.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-13"><span class="toc-section-number">11.6.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#non-tidy-data"><span class="toc-section-number">11.7</span> Non-Tidy Data</a></li>
</ul></li>
<li><a href="#relational-data"><span class="toc-section-number">12</span> Relational Data</a><ul>
<li><a href="#introduction-7"><span class="toc-section-number">12.1</span> Introduction</a></li>
<li><a href="#nycflights13"><span class="toc-section-number">12.2</span> nycflights13</a><ul>
<li><a href="#exercise-1-21"><span class="toc-section-number">12.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-20"><span class="toc-section-number">12.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-17"><span class="toc-section-number">12.2.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-14"><span class="toc-section-number">12.2.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#keys"><span class="toc-section-number">12.3</span> Keys</a><ul>
<li><a href="#exercise-1-22"><span class="toc-section-number">12.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-21"><span class="toc-section-number">12.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-4-15"><span class="toc-section-number">12.3.3</span> Exercise 4</a></li>
</ul></li>
<li><a href="#mutating-joins"><span class="toc-section-number">12.4</span> Mutating Joins</a><ul>
<li><a href="#exercise-1-23"><span class="toc-section-number">12.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-22"><span class="toc-section-number">12.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-18"><span class="toc-section-number">12.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-16"><span class="toc-section-number">12.4.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-7"><span class="toc-section-number">12.4.5</span> Exercise 5</a></li>
</ul></li>
<li><a href="#filtering-joins"><span class="toc-section-number">12.5</span> Filtering Joins</a><ul>
<li><a href="#exercise-1-24"><span class="toc-section-number">12.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-23"><span class="toc-section-number">12.5.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-19"><span class="toc-section-number">12.5.3</span> Exercise 3</a></li>
<li><a href="#exercise-3-20"><span class="toc-section-number">12.5.4</span> Exercise 3</a></li>
<li><a href="#exercise-4-17"><span class="toc-section-number">12.5.5</span> Exercise 4</a></li>
<li><a href="#exercise-5-8"><span class="toc-section-number">12.5.6</span> Exercise 5</a></li>
</ul></li>
<li><a href="#join-problems"><span class="toc-section-number">12.6</span> Join problems</a></li>
<li><a href="#set-operations"><span class="toc-section-number">12.7</span> Set operations</a></li>
</ul></li>
<li><a href="#strings"><span class="toc-section-number">13</span> Strings</a><ul>
<li><a href="#introduction-8"><span class="toc-section-number">13.1</span> Introduction</a></li>
<li><a href="#string-basics"><span class="toc-section-number">13.2</span> String Basics</a><ul>
<li><a href="#exercise-1-25"><span class="toc-section-number">13.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-24"><span class="toc-section-number">13.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-21"><span class="toc-section-number">13.2.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-18"><span class="toc-section-number">13.2.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-9"><span class="toc-section-number">13.2.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-7"><span class="toc-section-number">13.2.6</span> Exercise 6</a></li>
</ul></li>
<li><a href="#matching-patterns-and-regular-expressions"><span class="toc-section-number">13.3</span> Matching Patterns and Regular Expressions</a><ul>
<li><a href="#basic-matches"><span class="toc-section-number">13.3.1</span> Basic Matches</a></li>
<li><a href="#anchors"><span class="toc-section-number">13.3.2</span> Anchors</a></li>
<li><a href="#character-classes-and-alternatives"><span class="toc-section-number">13.3.3</span> Character classes and alternatives</a></li>
<li><a href="#repetition"><span class="toc-section-number">13.3.4</span> Repetition</a></li>
<li><a href="#grouping-and-backreferences"><span class="toc-section-number">13.3.5</span> Grouping and backreferences</a></li>
</ul></li>
<li><a href="#tools"><span class="toc-section-number">13.4</span> Tools</a><ul>
<li><a href="#detect-matches"><span class="toc-section-number">13.4.1</span> Detect matches</a></li>
<li><a href="#exercises-1"><span class="toc-section-number">13.4.2</span> Exercises</a></li>
<li><a href="#extract-matches"><span class="toc-section-number">13.4.3</span> Extract Matches</a></li>
<li><a href="#grouped-matches"><span class="toc-section-number">13.4.4</span> Grouped Matches</a></li>
<li><a href="#replacing-matches"><span class="toc-section-number">13.4.5</span> Replacing Matches</a></li>
<li><a href="#splitting"><span class="toc-section-number">13.4.6</span> Splitting</a></li>
<li><a href="#find-matches"><span class="toc-section-number">13.4.7</span> Find matches</a></li>
</ul></li>
<li><a href="#other-types-of-patterns"><span class="toc-section-number">13.5</span> Other types of patterns</a><ul>
<li><a href="#exercise-1-36"><span class="toc-section-number">13.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-35"><span class="toc-section-number">13.5.2</span> Exercise 2</a></li>
</ul></li>
<li><a href="#other-uses-of-regular-expressions"><span class="toc-section-number">13.6</span> Other uses of regular expressions</a></li>
<li><a href="#stringi"><span class="toc-section-number">13.7</span> stringi</a><ul>
<li><a href="#exercise-1-37"><span class="toc-section-number">13.7.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-36"><span class="toc-section-number">13.7.2</span> Exercise 2</a></li>
</ul></li>
</ul></li>
<li><a href="#factors"><span class="toc-section-number">14</span> Factors</a><ul>
<li><a href="#introduction-9"><span class="toc-section-number">14.1</span> Introduction</a></li>
<li><a href="#creating-factors"><span class="toc-section-number">14.2</span> Creating Factors</a></li>
<li><a href="#general-social-survey"><span class="toc-section-number">14.3</span> General Social Survey</a><ul>
<li><a href="#exercise-1-38"><span class="toc-section-number">14.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-37"><span class="toc-section-number">14.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-4-21"><span class="toc-section-number">14.3.3</span> Exercise 4</a></li>
</ul></li>
<li><a href="#modifying-factor-order"><span class="toc-section-number">14.4</span> Modifying factor order</a><ul>
<li><a href="#exercise-1-39"><span class="toc-section-number">14.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-38"><span class="toc-section-number">14.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-27"><span class="toc-section-number">14.4.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#modifying-factor-levels"><span class="toc-section-number">14.5</span> Modifying factor levels</a><ul>
<li><a href="#exercise-1-40"><span class="toc-section-number">14.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-39"><span class="toc-section-number">14.5.2</span> Exercise 2</a></li>
</ul></li>
</ul></li>
<li><a href="#dates-and-times"><span class="toc-section-number">15</span> Dates and Times</a><ul>
<li><a href="#introduction-10"><span class="toc-section-number">15.1</span> Introduction</a></li>
<li><a href="#creating-datetimes"><span class="toc-section-number">15.2</span> Creating date/times</a><ul>
<li><a href="#exercise-1-41"><span class="toc-section-number">15.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-40"><span class="toc-section-number">15.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-28"><span class="toc-section-number">15.2.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#date-time-components"><span class="toc-section-number">15.3</span> Date-Time Components</a><ul>
<li><a href="#exercise-1-42"><span class="toc-section-number">15.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-41"><span class="toc-section-number">15.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-29"><span class="toc-section-number">15.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-22"><span class="toc-section-number">15.3.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-11"><span class="toc-section-number">15.3.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-8"><span class="toc-section-number">15.3.6</span> Exercise 6</a></li>
<li><a href="#exercise-7-3"><span class="toc-section-number">15.3.7</span> Exercise 7</a></li>
</ul></li>
<li><a href="#time-spans"><span class="toc-section-number">15.4</span> Time Spans</a><ul>
<li><a href="#exercise-1-43"><span class="toc-section-number">15.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-42"><span class="toc-section-number">15.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-30"><span class="toc-section-number">15.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-23"><span class="toc-section-number">15.4.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-12"><span class="toc-section-number">15.4.5</span> Exercise 5</a></li>
</ul></li>
<li><a href="#time-zones"><span class="toc-section-number">15.5</span> Time Zones</a></li>
</ul></li>
<li><a href="#part-program">(PART) Program</a></li>
<li><a href="#program-intro"><span class="toc-section-number">16</span> Introduction</a></li>
<li><a href="#pipes"><span class="toc-section-number">17</span> Pipes</a></li>
<li><a href="#functions"><span class="toc-section-number">18</span> Functions</a><ul>
<li><a href="#introduction-11"><span class="toc-section-number">18.1</span> Introduction</a></li>
<li><a href="#when-should-you-write-a-function"><span class="toc-section-number">18.2</span> When should you write a function?</a><ul>
<li><a href="#exercise-1-44"><span class="toc-section-number">18.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-43"><span class="toc-section-number">18.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-31"><span class="toc-section-number">18.2.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-24"><span class="toc-section-number">18.2.4</span> Exercise 4</a></li>
<li><a href="#exercise-6-9"><span class="toc-section-number">18.2.5</span> Exercise 6</a></li>
<li><a href="#exercise-7-4"><span class="toc-section-number">18.2.6</span> Exercise 7</a></li>
</ul></li>
<li><a href="#functions-are-for-humans-and-computers"><span class="toc-section-number">18.3</span> Functions are for humans and computers</a><ul>
<li><a href="#exercise-1-45"><span class="toc-section-number">18.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-44"><span class="toc-section-number">18.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-32"><span class="toc-section-number">18.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-25"><span class="toc-section-number">18.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#conditional-execution"><span class="toc-section-number">18.4</span> Conditional execution</a><ul>
<li><a href="#exercise-1-46"><span class="toc-section-number">18.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-45"><span class="toc-section-number">18.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-33"><span class="toc-section-number">18.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-26"><span class="toc-section-number">18.4.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-14"><span class="toc-section-number">18.4.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-10"><span class="toc-section-number">18.4.6</span> Exercise 6</a></li>
</ul></li>
<li><a href="#function-arguments"><span class="toc-section-number">18.5</span> Function arguments</a><ul>
<li><a href="#exercise-1-47"><span class="toc-section-number">18.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-46"><span class="toc-section-number">18.5.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-34"><span class="toc-section-number">18.5.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-27"><span class="toc-section-number">18.5.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#environment"><span class="toc-section-number">18.6</span> Environment</a></li>
</ul></li>
<li><a href="#vectors"><span class="toc-section-number">19</span> Vectors</a><ul>
<li><a href="#introduction-12"><span class="toc-section-number">19.1</span> Introduction</a></li>
<li><a href="#vector-basics"><span class="toc-section-number">19.2</span> Vector Basics</a></li>
<li><a href="#important-types-of-atomic-vector"><span class="toc-section-number">19.3</span> Important Types of Atomic Vector</a><ul>
<li><a href="#exercise-1-48"><span class="toc-section-number">19.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-47"><span class="toc-section-number">19.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-35"><span class="toc-section-number">19.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-28"><span class="toc-section-number">19.3.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-15"><span class="toc-section-number">19.3.5</span> Exercise 5</a></li>
</ul></li>
<li><a href="#using-atomic-vectors"><span class="toc-section-number">19.4</span> Using atomic vectors</a><ul>
<li><a href="#exercise-1-49"><span class="toc-section-number">19.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-48"><span class="toc-section-number">19.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-36"><span class="toc-section-number">19.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-29"><span class="toc-section-number">19.4.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-16"><span class="toc-section-number">19.4.5</span> Exercise 5</a></li>
<li><a href="#exercise-6-11"><span class="toc-section-number">19.4.6</span> Exercise 6</a></li>
</ul></li>
<li><a href="#recursive-vectors-lists"><span class="toc-section-number">19.5</span> Recursive Vectors (lists)</a><ul>
<li><a href="#exercise-1-50"><span class="toc-section-number">19.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-49"><span class="toc-section-number">19.5.2</span> Exercise 2</a></li>
</ul></li>
<li><a href="#attributes"><span class="toc-section-number">19.6</span> Attributes</a></li>
<li><a href="#augmented-vectors"><span class="toc-section-number">19.7</span> Augmented Vectors</a><ul>
<li><a href="#exercise-1-51"><span class="toc-section-number">19.7.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-50"><span class="toc-section-number">19.7.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-37"><span class="toc-section-number">19.7.3</span> Exercise 3</a></li>
</ul></li>
</ul></li>
<li><a href="#iteration"><span class="toc-section-number">20</span> Iteration</a><ul>
<li><a href="#introduction-13"><span class="toc-section-number">20.1</span> Introduction</a></li>
<li><a href="#for-loops"><span class="toc-section-number">20.2</span> For Loops</a><ul>
<li><a href="#exercise-1-52"><span class="toc-section-number">20.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-51"><span class="toc-section-number">20.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-38"><span class="toc-section-number">20.2.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#for-loop-variations"><span class="toc-section-number">20.3</span> For loop variations</a><ul>
<li><a href="#exercise-1-53"><span class="toc-section-number">20.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-52"><span class="toc-section-number">20.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-39"><span class="toc-section-number">20.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-31"><span class="toc-section-number">20.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#for-loops-vs.functionals"><span class="toc-section-number">20.4</span> For loops vs. functionals</a><ul>
<li><a href="#exercise-1-54"><span class="toc-section-number">20.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-53"><span class="toc-section-number">20.4.2</span> Exercise 2</a></li>
</ul></li>
<li><a href="#the-map-functions"><span class="toc-section-number">20.5</span> The map functions</a><ul>
<li><a href="#exercise-1-55"><span class="toc-section-number">20.5.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-54"><span class="toc-section-number">20.5.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-40"><span class="toc-section-number">20.5.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-32"><span class="toc-section-number">20.5.4</span> Exercise 4</a></li>
<li><a href="#exercise-5-17"><span class="toc-section-number">20.5.5</span> Exercise 5</a></li>
</ul></li>
<li><a href="#dealing-with-failure"><span class="toc-section-number">20.6</span> Dealing with Failure</a></li>
<li><a href="#mapping-over-multiple-arguments"><span class="toc-section-number">20.7</span> Mapping over multiple arguments</a></li>
<li><a href="#walk"><span class="toc-section-number">20.8</span> Walk</a></li>
<li><a href="#other-patterns-of-for-loops"><span class="toc-section-number">20.9</span> Other patterns of for loops</a><ul>
<li><a href="#exercise-1-56"><span class="toc-section-number">20.9.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-55"><span class="toc-section-number">20.9.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-41"><span class="toc-section-number">20.9.3</span> Exercise 3</a></li>
</ul></li>
</ul></li>
<li><a href="#part-model">(PART) Model</a></li>
<li><a href="#model-intro"><span class="toc-section-number">21</span> Introduction</a></li>
<li><a href="#model-basics"><span class="toc-section-number">22</span> Model Basics</a><ul>
<li><a href="#prerequisites"><span class="toc-section-number">22.1</span> Prerequisites</a></li>
<li><a href="#a-simple-model"><span class="toc-section-number">22.2</span> A simple model</a><ul>
<li><a href="#exercise-1-57"><span class="toc-section-number">22.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-56"><span class="toc-section-number">22.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-42"><span class="toc-section-number">22.2.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#visualizing-models"><span class="toc-section-number">22.3</span> Visualizing Models</a><ul>
<li><a href="#exercise-1-58"><span class="toc-section-number">22.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-57"><span class="toc-section-number">22.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-43"><span class="toc-section-number">22.3.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-33"><span class="toc-section-number">22.3.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#formulas-and-model-families"><span class="toc-section-number">22.4</span> Formulas and Model Families</a><ul>
<li><a href="#exercise-1-59"><span class="toc-section-number">22.4.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-58"><span class="toc-section-number">22.4.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-44"><span class="toc-section-number">22.4.3</span> Exercise 3</a></li>
<li><a href="#exercise-4-34"><span class="toc-section-number">22.4.4</span> Exercise 4</a></li>
</ul></li>
<li><a href="#missing-values-2"><span class="toc-section-number">22.5</span> Missing values</a></li>
<li><a href="#other-model-families"><span class="toc-section-number">22.6</span> Other model families</a></li>
</ul></li>
<li><a href="#model-building"><span class="toc-section-number">23</span> Model Building</a><ul>
<li><a href="#introduction-14"><span class="toc-section-number">23.1</span> Introduction</a></li>
<li><a href="#why-are-low-quality-diamonds-more-expensive"><span class="toc-section-number">23.2</span> Why are low quality diamonds more expensive?</a><ul>
<li><a href="#exercises-2"><span class="toc-section-number">23.2.1</span> Exercises</a></li>
<li><a href="#what-affects-the-number-of-daily-flights"><span class="toc-section-number">23.2.2</span> What affects the number of daily flights?</a></li>
<li><a href="#exercises-3"><span class="toc-section-number">23.2.3</span> Exercises</a></li>
</ul></li>
</ul></li>
<li><a href="#many-models"><span class="toc-section-number">24</span> Many Models</a><ul>
<li><a href="#introduction-15"><span class="toc-section-number">24.1</span> Introduction</a></li>
<li><a href="#gapminder"><span class="toc-section-number">24.2</span> Gapminder</a><ul>
<li><a href="#exercise-1-62"><span class="toc-section-number">24.2.1</span> Exercise 1</a></li>
</ul></li>
<li><a href="#creating-list-columns"><span class="toc-section-number">24.3</span> Creating list-columns</a><ul>
<li><a href="#exercises-4"><span class="toc-section-number">24.3.1</span> Exercises</a></li>
</ul></li>
<li><a href="#simplifying-list-columns"><span class="toc-section-number">24.4</span> Simplifying list-columns</a><ul>
<li><a href="#exercises-5"><span class="toc-section-number">24.4.1</span> Exercises</a></li>
</ul></li>
</ul></li>
<li><a href="#part-communicate">(PART) Communicate</a></li>
<li><a href="#communicate-intro"><span class="toc-section-number">25</span> Introduction</a></li>
<li><a href="#r-markdown"><span class="toc-section-number">26</span> R Markdown</a><ul>
<li><a href="#r-markdown-basics"><span class="toc-section-number">26.1</span> R Markdown Basics</a><ul>
<li><a href="#exercises-6"><span class="toc-section-number">26.1.1</span> Exercises</a></li>
</ul></li>
<li><a href="#text-formatting-with-r-markdown"><span class="toc-section-number">26.2</span> Text formatting with R Markdown</a><ul>
<li><a href="#exercise-1-66"><span class="toc-section-number">26.2.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-65"><span class="toc-section-number">26.2.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-49"><span class="toc-section-number">26.2.3</span> Exercise 3</a></li>
</ul></li>
<li><a href="#code-chunks"><span class="toc-section-number">26.3</span> Code Chunks</a><ul>
<li><a href="#exercise-1-67"><span class="toc-section-number">26.3.1</span> Exercise 1</a></li>
<li><a href="#exercise-2-66"><span class="toc-section-number">26.3.2</span> Exercise 2</a></li>
<li><a href="#exercise-3-50"><span class="toc-section-number">26.3.3</span> Exercise 3</a></li>
</ul></li>
</ul></li>
<li><a href="#graphics-for-communication"><span class="toc-section-number">27</span> Graphics for communication</a><ul>
<li><a href="#introduction-16"><span class="toc-section-number">27.1</span> Introduction</a></li>
<li><a href="#label"><span class="toc-section-number">27.2</span> Label</a><ul>
<li><a href="#exercises-7"><span class="toc-section-number">27.2.1</span> Exercises</a></li>
<li><a href="#exercise-3-51"><span class="toc-section-number">27.2.2</span> Exercise 3</a></li>
</ul></li>
<li><a href="#annotations"><span class="toc-section-number">27.3</span> Annotations</a><ul>
<li><a href="#exercises-8"><span class="toc-section-number">27.3.1</span> Exercises</a></li>
</ul></li>
<li><a href="#scales"><span class="toc-section-number">27.4</span> Scales</a><ul>
<li><a href="#exercises-9"><span class="toc-section-number">27.4.1</span> Exercises</a></li>
</ul></li>
</ul></li>
<li><a href="#r-markdown-formats"><span class="toc-section-number">28</span> R Markdown Formats</a></li>
<li><a href="#r-markdown-workflow"><span class="toc-section-number">29</span> R Markdown Workflow</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Science Solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="welcome" class="section level1 unnumbered">
<h1>Welcome</h1>
<p>This contains my exercise solutions for Hadley Wickham and Garret Grolemund, <a href="http://amzn.to/2aHLAQ1">R for Data Science</a>. The original website is at <a href="http://r4ds.had.co.nz/">r4ds.had.co.nz</a>.</p>
<p>The text of this work is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. The R Code in this work is licensed under the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
<!--chapter:end:index.rmd-->
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>No exercises.</p>
<!--chapter:end:intro.Rmd-->
</div>
<div id="part-explore" class="section level1 unnumbered">
<h1>(PART) Explore</h1>
</div>
<div id="explore-intro" class="section level1">
<h1><span class="header-section-number">2</span> Introduction</h1>
<p>No exercises.</p>
<!--chapter:end:explore.Rmd-->
</div>
<div id="visualize" class="section level1">
<h1><span class="header-section-number">3</span> Visualize</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>No exercises.</p>
</div>
<div id="first-steps" class="section level2">
<h2><span class="header-section-number">3.2</span> First Steps</h2>
<div id="exercise-1." class="section level3 exercise">
<h3><span class="header-section-number">3.2.1</span> Exercise 1.</h3>
<div class="question">
<p>Run <code>ggplot(data = mpg)</code> what do you see?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>An empty plot. The background of the plot is created by <code>ggplot()</code>, but nothing else is displayed.</p>
</div>
</div>
<div id="exercise-2." class="section level3 exercise">
<h3><span class="header-section-number">3.2.2</span> Exercise 2.</h3>
<div class="question">
<p>How many rows are in <code>mtcars</code>? How many columns?</p>
</div>
<div class="answer">
<p>There are 32 rows and 11 columns in the the <code>mtcars</code> data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(mtcars)
<span class="co">#&gt; [1] 32</span>
<span class="kw">ncol</span>(mtcars)
<span class="co">#&gt; [1] 11</span></code></pre></div>
<p>The number of rows and columns is also displayed by <code>glimpse()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(mtcars)
<span class="co">#&gt; Observations: 32</span>
<span class="co">#&gt; Variables: 11</span>
<span class="co">#&gt; $ mpg  &lt;dbl&gt; 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19....</span>
<span class="co">#&gt; $ cyl  &lt;dbl&gt; 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, ...</span>
<span class="co">#&gt; $ disp &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 1...</span>
<span class="co">#&gt; $ hp   &lt;dbl&gt; 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, ...</span>
<span class="co">#&gt; $ drat &lt;dbl&gt; 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.9...</span>
<span class="co">#&gt; $ wt   &lt;dbl&gt; 2.62, 2.88, 2.32, 3.21, 3.44, 3.46, 3.57, 3.19, 3.15, 3.4...</span>
<span class="co">#&gt; $ qsec &lt;dbl&gt; 16.5, 17.0, 18.6, 19.4, 17.0, 20.2, 15.8, 20.0, 22.9, 18....</span>
<span class="co">#&gt; $ vs   &lt;dbl&gt; 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, ...</span>
<span class="co">#&gt; $ am   &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, ...</span>
<span class="co">#&gt; $ gear &lt;dbl&gt; 4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, ...</span>
<span class="co">#&gt; $ carb &lt;dbl&gt; 4, 4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, ...</span></code></pre></div>
</div>
</div>
<div id="exercise-3." class="section level3 exercise">
<h3><span class="header-section-number">3.2.3</span> Exercise 3.</h3>
<div class="question">
<p>What does the <code>drv</code> variable describe? Read the help for <code>?mpg</code> to find out.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?mpg</code></pre></div>
<p>The <code>drv</code> variable takes the following values</p>
<table>
<tbody>
<tr class="odd">
<td align="left">- <code>&quot;f&quot;</code></td>
<td align="left">front-wheel drive</td>
</tr>
<tr class="even">
<td align="left">- <code>&quot;r&quot;</code></td>
<td align="left">rear-wheel drive</td>
</tr>
<tr class="odd">
<td align="left">- <code>&quot;4&quot;</code></td>
<td align="left">four-wheel drive</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exercise-4." class="section level3 exercise">
<h3><span class="header-section-number">3.2.4</span> Exercise 4.</h3>
<div class="question">
<p>Make a scatter plot of <code>hwy</code> vs <code>cyl</code>.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5." class="section level3 exercise">
<h3><span class="header-section-number">3.2.5</span> Exercise 5.</h3>
<div class="question">
<p>What happens if you make a scatter plot of <code>class</code> vs <code>drv</code>. Why is the plot not useful?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>A scatter plot is not a useful way to plot these variables, since both <code>drv</code> and <code>class</code> are factor variables taking a limited number of values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(mpg, drv, class)
<span class="co">#&gt; # A tibble: 12 x 3</span>
<span class="co">#&gt;   drv   class          n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 4     compact       12</span>
<span class="co">#&gt; 2 4     midsize        3</span>
<span class="co">#&gt; 3 4     pickup        33</span>
<span class="co">#&gt; 4 4     subcompact     4</span>
<span class="co">#&gt; 5 4     suv           51</span>
<span class="co">#&gt; 6 f     compact       35</span>
<span class="co">#&gt; # ... with 6 more rows</span></code></pre></div>
<p>The scatter plot cannot show which are overlapping or not. Later chapters discuss means to deal with this, including alternative plots and jittering the points so they don’t overlap.</p>
</div>
</div>
</div>
<div id="aesthetic-mappings" class="section level2">
<h2><span class="header-section-number">3.3</span> Aesthetic mappings</h2>
<div id="exercise-1.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.3.1</span> Exercise 1.</h3>
<div class="question">
<p>What’s gone wrong with this code? Why are the points not blue?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>Since <code>colour = &quot;blue&quot;</code> was included within the <code>mapping</code> argument, it was treated as an aesthetic (a mapping between a variable and a value). The expression, <code>color=&quot;blue&quot;</code>, treats <code>&quot;blue&quot;</code> as a variable with only one value: <code>&quot;blue&quot;</code>. If this is confusing, consider how <code>colour = 1:234</code> or <code>colour = 1</code> would be interpreted by <code>aes()</code>.</p>
</div>
<div id="exercise-2.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.3.2</span> Exercise 2.</h3>
<div class="question">
<p>Which variables in <code>mpg</code> are categorical? Which variables are continuous? (Hint: type <code>?mpg</code> to read the documentation for the dataset). How can you see this information when you run <code>mpg</code>?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?mpg</code></pre></div>
<p>When printing the data frame, this information is given at the top of each column within angled brackets. Categorical variables have a class of “character” (<code>&lt;chr&gt;</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg
<span class="co">#&gt; # A tibble: 234 x 11</span>
<span class="co">#&gt;   manufacturer model displ  year   cyl trans drv     cty   hwy fl    class</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 audi         a4     1.80  1999     4 auto… f        18    29 p     comp…</span>
<span class="co">#&gt; 2 audi         a4     1.80  1999     4 manu… f        21    29 p     comp…</span>
<span class="co">#&gt; 3 audi         a4     2.00  2008     4 manu… f        20    31 p     comp…</span>
<span class="co">#&gt; 4 audi         a4     2.00  2008     4 auto… f        21    30 p     comp…</span>
<span class="co">#&gt; 5 audi         a4     2.80  1999     6 auto… f        16    26 p     comp…</span>
<span class="co">#&gt; 6 audi         a4     2.80  1999     6 manu… f        18    26 p     comp…</span>
<span class="co">#&gt; # ... with 228 more rows</span></code></pre></div>
<p>Alternatively, the <code>glimpse</code> function displays the type of each column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(mpg)
<span class="co">#&gt; Observations: 234</span>
<span class="co">#&gt; Variables: 11</span>
<span class="co">#&gt; $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;...</span>
<span class="co">#&gt; $ model        &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 qua...</span>
<span class="co">#&gt; $ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0,...</span>
<span class="co">#&gt; $ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1...</span>
<span class="co">#&gt; $ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6...</span>
<span class="co">#&gt; $ trans        &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)...</span>
<span class="co">#&gt; $ drv          &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;,...</span>
<span class="co">#&gt; $ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 1...</span>
<span class="co">#&gt; $ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 2...</span>
<span class="co">#&gt; $ fl           &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;,...</span>
<span class="co">#&gt; $ class        &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;comp...</span></code></pre></div>
</div>
</div>
<div id="exercise-3.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.3.3</span> Exercise 3.</h3>
<div class="question">
<p>Map a continuous variable to color, size, and shape. How do these aesthetics behave differently for categorical vs. continuous variables?</p>
</div>
<div class="answer">
<p>The variable <code>cty</code>, city highway miles per gallon, is a continuous variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> cty)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Instead of using discrete colors, the continuous variable uses a scale that varies from a light to dark blue color.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">size =</span> cty)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>When mapped to size, the sizes of the points vary continuously with respect to the size (although the legend shows a few representative values)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">shape =</span> cty)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()
<span class="co">#&gt; Error: A continuous variable can not be mapped to shape</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>When a continuous value is mapped to shape, it gives an error. Though we could split a continuous variable into discrete categories and use a shape aesthetic, this would conceptually not make sense. A continuous numeric variable is ordered, but shapes have no natural order. It is clear that smaller points correspond to smaller values, or once the color scale is given, which colors correspond to larger or smaller values. But it is not clear whether a square is greater or less than a circle.</p>
</div>
</div>
<div id="exercise-4.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.3.4</span> Exercise 4.</h3>
<div class="question">
<p>What happens if you map the same variable to multiple aesthetics?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> hwy, <span class="dt">size =</span> displ)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In the above plot, <code>hwy</code> is mapped to both location on the y-axis and color, and <code>displ</code> is mapped to both location on the x-axis and size. The code works and produces a plot, even if it is a bad one. Mapping a single variable to multiple aesthetics is redundant. Because it is redundant information, in most cases avoid mapping a single variable to multiple aesthetics.</p>
</div>
</div>
<div id="exercise-5.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.3.5</span> Exercise 5.</h3>
<div class="question">
<p>What does the stroke aesthetic do? What shapes does it work with? (Hint: use <code>?geom_point</code>)</p>
</div>
<div class="answer">
<p>The following example is given in <code>?geom_point</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(wt, mpg)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">stroke =</span> <span class="dv">5</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/ex.3.3.1.5-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Stroke changes the color of the border for shapes (22-24).</p>
</div>
</div>
<div id="exercise-6." class="section level3 exercise">
<h3><span class="header-section-number">3.3.6</span> Exercise 6.</h3>
<div class="question">
<p>What happens if you map an aesthetic to something other than a variable name, like <code>aes(colour = displ &lt; 5)</code>?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> displ <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/ex.3.3.1.6-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Aesthetics can also be mapped to expressions (code like <code>displ &lt; 5</code>). It will create a temporary variable which takes values from the result of the expression. In this case, it is logical variable which is <code>TRUE</code> or <code>FALSE</code>. This also explains exercise 1, <code>colour = &quot;blue&quot;</code> created a categorical variable that only had one category: “blue”.</p>
</div>
</div>
</div>
<div id="common-problems" class="section level2">
<h2><span class="header-section-number">3.4</span> Common problems</h2>
<p>No exercises</p>
</div>
<div id="facets" class="section level2">
<h2><span class="header-section-number">3.5</span> Facets</h2>
<div id="exercise-1.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.5.1</span> Exercise 1.</h3>
<div class="question">
<p>What happens if you facet on a continuous variable?</p>
</div>
<div class="answer">
<p>Let’s see.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cty)</code></pre></div>
<p><img src="visualize_files/figure-html/ex.3.5.1.1-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>It converts the continuous variable to a factor and creates facets for <strong>all</strong> unique values of it.</p>
</div>
</div>
<div id="exercise-2.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.5.2</span> Exercise 2.</h3>
<div class="question">
<p>What do the empty cells in plot with <code>facet_grid(drv ~ cyl)</code> mean? How do they relate to this plot?</p>
</div>
<div class="answer">
<p>They are cells in which there are no values of the combination of <code>drv</code> and <code>cyl</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> cyl))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The locations in the above plot without points are the same cells in <code>facet_grid(drv ~ cyl)</code> that have no points.</p>
</div>
</div>
<div id="exercise-3.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.5.3</span> Exercise 3.</h3>
<div class="question">
<p>What plots does the following code make? What does <code>.</code> do?</p>
</div>
<div class="answer">
<p>The symbol <code>.</code> ignores that dimension for faceting.</p>
<p>This plot facets by values of <code>drv</code> on the y-axis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="visualize_files/figure-html/ex.3.5.1.4.a-1.png" width="70%" style="display: block; margin: auto;" /> This plot facets by values of <code>cyl</code> on the x-axis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cyl)</code></pre></div>
<p><img src="visualize_files/figure-html/ex.3.5.1.4.b-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.5.4</span> Exercise 5.</h3>
<div class="question">
<p>Read <code>?facet_wrap</code>. What does <code>nrow</code> do? What does <code>ncol</code> do? What other options control the layout of the individual panels? Why doesn’t <code>facet_grid()</code> have <code>nrow</code> and <code>ncol</code> variables?</p>
</div>
<div class="answer">
<p>The arguments <code>nrow</code> (<code>ncol</code>) determines the number of rows (columns) to use when laying out the facets. It is necessary since <code>facet_wrap</code> only facets on one variable. These arguments are unnecessary for <code>facet_grid</code> since the number of rows and columns are determined by the number of unique values of the variables specified.</p>
</div>
</div>
<div id="exercise-6.-1" class="section level3 exercise">
<h3><span class="header-section-number">3.5.5</span> Exercise 6.</h3>
<div class="question">
<p>When using <code>facet_grid()</code> you should usually put the variable with more unique levels in the columns. Why?</p>
</div>
<div class="answer">
<p>You should put the variable with more unique levels in the columns if the plot is laid out landscape. It is easier to compare relative levels of y by scanning horizontally, so it may be easier to visually compare these levels. <em>I’m actually not sure about the correct answer to this</em>.</p>
</div>
</div>
</div>
<div id="geometric-objects" class="section level2">
<h2><span class="header-section-number">3.6</span> Geometric Objects</h2>
<div id="exercise-1.-3" class="section level3 exercise">
<h3><span class="header-section-number">3.6.1</span> Exercise 1.</h3>
<div class="question">
<p>What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?</p>
</div>
<div class="answer">
<ul>
<li>line chart: <code>geom_line</code></li>
<li>boxplot: <code>geom_boxplot</code></li>
<li>histogram: <code>geom_hist</code></li>
</ul>
</div>
</div>
<div id="exercise-2.-3" class="section level3 exercise">
<h3><span class="header-section-number">3.6.2</span> Exercise 2.</h3>
<div class="question">
<p>Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>This will produce a scatter plot with <code>displ</code> on the x-axis, <code>hwy</code> on the y-axis. The points will be colored by <code>drv</code>. There will be a smooth line, without standard errors, fit through each <code>drv</code> group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3.-3" class="section level3 exercise">
<h3><span class="header-section-number">3.6.3</span> Exercise 3.</h3>
<div class="question">
<p>What does <code>show.legend = FALSE</code> do? What happens if you remove it? Why do you think I used it earlier in the chapter?</p>
</div>
<div class="answer">
<p>Show legend hides the legend box. In this code, without show legend, there is a legend.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv),
  )
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /> But there is no legend in this code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv),
    <span class="dt">show.legend =</span> <span class="ot">FALSE</span>
  )
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In the example earlier in the chapter,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span>
              
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">group =</span> drv))
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span>
    
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv),
    <span class="dt">show.legend =</span> <span class="ot">FALSE</span>
  )
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /><img src="visualize_files/figure-html/unnamed-chunk-23-2.png" width="70%" style="display: block; margin: auto;" /><img src="visualize_files/figure-html/unnamed-chunk-23-3.png" width="70%" style="display: block; margin: auto;" /> the legend is suppressed because there are three plots, and adding a legend that only appears in the last one would make the presentation asymmetric. Additionally, the purpose of this plot is to illustrate the difference between not grouping, using a <code>group</code> aesthetic, and using a <code>color</code> aesthetic (with implicit grouping). In that example, the legend isn’t necessary since looking up the values associated with each color isn’t necessary to make that point.</p>
</div>
</div>
<div id="exercise-4.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.6.4</span> Exercise 4.</h3>
<div class="question">
<p>What does the <code>se</code> argument to <code>geom_smooth()</code> do?</p>
</div>
<div class="answer">
<p>It adds standard error bands to the lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>By default <code>se = TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5.-3" class="section level3 exercise">
<h3><span class="header-section-number">3.6.5</span> Exercise 5.</h3>
<div class="question">
<p>Will these two graphs look different? Why/why not?</p>
</div>
<div class="answer">
<p>No. Because both <code>geom_point</code> and <code>geom_smooth</code> use the same data and mappings. They will inherit those options from the <code>ggplot</code> object, and thus don’t need to specified again (or twice).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-6.-2" class="section level3 exercise">
<h3><span class="header-section-number">3.6.6</span> Exercise 6.</h3>
<div class="question">
<p>Recreate the R code necessary to generate the following graphs.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">group =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">linetype =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-32-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="statistical-transformations" class="section level2">
<h2><span class="header-section-number">3.7</span> Statistical Transformations</h2>
<div id="exercise-1.-4" class="section level3 exercise">
<h3><span class="header-section-number">3.7.1</span> Exercise 1.</h3>
<div class="question">
<p>What is the default geom associated with <code>stat_summary()</code>? How could you rewrite the previous plot to use that geom function instead of the stat function?</p>
</div>
<div class="answer">
<p>The default geom for <a href="http://docs.ggplot2.org/current/stat_summary.html"><code>stat_summary</code></a> is <code>geom_pointrange</code> (see the <code>stat</code>) argument.</p>
<p>But, the default <code>stat</code> for <a href="http://docs.ggplot2.org/current/geom_linerange.html"><code>geom_pointrange</code></a> is <code>identity</code>, so use <code>geom_pointrange(stat = &quot;summary&quot;)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),
    <span class="dt">stat =</span> <span class="st">&quot;summary&quot;</span>,
  )
<span class="co">#&gt; No summary function supplied, defaulting to `mean_se()</span></code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-34-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The default message says that <code>stat_summary</code> uses the <code>mean</code> and <code>sd</code> to calculate the point, and range of the line. So lets use the previous values of <code>fun.ymin</code>, <code>fun.ymax</code>, and <code>fun.y</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),
    <span class="dt">stat =</span> <span class="st">&quot;summary&quot;</span>,
    <span class="dt">fun.ymin =</span> min,
    <span class="dt">fun.ymax =</span> max,
    <span class="dt">fun.y =</span> median
  )</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2.-4" class="section level3 exercise">
<h3><span class="header-section-number">3.7.2</span> Exercise 2.</h3>
<div class="question">
<p>What does <code>geom_col()</code> do? How is it different to <code>geom_bar()</code>?</p>
</div>
<div class="answer">
<p><code>geom_col</code> differs from <code>geom_bar</code> in its default stat. <code>geom_col</code> has uses the <code>identity</code> stat. So it expects that a variable already exists for the height of the bars. <code>geom_bar</code> uses the <code>count</code> stat, and so will count observations in groups in order to generate the variable to use for the height of the bars.</p>
</div>
</div>
<div id="exercise-3.-4" class="section level3 exercise">
<h3><span class="header-section-number">3.7.3</span> Exercise 3.</h3>
<div class="question">
<p>Most geoms and stats come in pairs that are almost always used in concert. Read through the documentation and make a list of all the pairs. What do they have in common?</p>
</div>
<div class="answer">
<p>See the <a href="http://docs.ggplot2.org/current/">ggplot2 documentation</a></p>
</div>
</div>
<div id="exercise-4.-3" class="section level3 exercise">
<h3><span class="header-section-number">3.7.4</span> Exercise 4.</h3>
<div class="question">
<p>What variables does <code>stat_smooth()</code> compute? What parameters control its behavior?</p>
</div>
<div class="answer">
<p><code>stat_smooth</code> calculates</p>
<ul>
<li><code>y</code>: predicted value</li>
<li><code>ymin</code>: lower value of the confidence interval</li>
<li><code>ymax</code>: upper value of the confidence interval</li>
<li><code>se</code>: standard error</li>
</ul>
<p>There’s parameters such as <code>method</code> which determines which method is used to calculate the predictions and confidence interval, and some other arguments that are passed to that.</p>
</div>
</div>
<div id="exercise-5.-4" class="section level3 exercise">
<h3><span class="header-section-number">3.7.5</span> Exercise 5.</h3>
<div class="question">
<p>In our proportion bar chart, we need to set <code>group = 1</code> Why? In other words what is the problem with these two graphs?</p>
</div>
<div class="answer">
<p>If <code>group</code> is not set to 1, then all the bars have <code>prop == 1</code>. The function <code>geom_bar</code> assumes that the groups are equal to the <code>x</code> values, since the stat computes the counts within the group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-36-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The problem with these two plots is that the proportions are calculated within the groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))

<span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop..))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-37-1.png" width="70%" style="display: block; margin: auto;" /><img src="visualize_files/figure-html/unnamed-chunk-37-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This is more likely what was intended:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> <span class="dv">1</span>))

<span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> color))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /><img src="visualize_files/figure-html/unnamed-chunk-38-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="position-adjustments" class="section level2">
<h2><span class="header-section-number">3.8</span> Position Adjustments</h2>
<div id="exercise-1.-5" class="section level3 exercise">
<h3><span class="header-section-number">3.8.1</span> Exercise 1.</h3>
<div class="question">
<p>What is the problem with this plot? How could you improve it?</p>
</div>
<div class="answer">
<p>There is overplotting because there are multiple observations for each combination of <code>cty</code> and <code>hwy</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;" /> I’d fix it by using a jitter position adjustment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2.-5" class="section level3 exercise">
<h3><span class="header-section-number">3.8.2</span> Exercise 2.</h3>
<div class="question">
<p>What parameters to <code>geom_jitter()</code> control the amount of jittering?</p>
</div>
<div class="answer">
<p>From the <a href="http://docs.ggplot2.org/current/position_jitter.html">position_jitter</a> documentation, there are two arguments to jitter: <code>width</code> and <code>height</code>, which control the amount of vertical and horizontal jitter.</p>
<p>No horizontal jitter</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-41-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Way too much vertical jitter</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="dv">0</span>, <span class="dt">height =</span> <span class="dv">15</span>))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-42-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Only horizontal jitter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">height =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-43-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Way too much horizontal jitter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">height =</span> <span class="dv">0</span>, <span class="dt">width =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-44-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3.-5" class="section level3 exercise">
<h3><span class="header-section-number">3.8.3</span> Exercise 3.</h3>
<div class="question">
<p>Compare and contrast <code>geom_jitter()</code> with <code>geom_count()</code>.</p>
</div>
<div class="answer">
<p><strong>TODO</strong></p>
</div>
</div>
<div id="exercise-4.-4" class="section level3 exercise">
<h3><span class="header-section-number">3.8.4</span> Exercise 4.</h3>
<div class="question">
<p>What’s the default position adjustment for <code>geom_boxplot()</code>? Create a visualization of the mpg dataset that demonstrates it.</p>
</div>
<div class="answer">
<p>The default position for <code>geom_boxplot</code> is <code>position_dodge</code> (see its <a href="http://docs.ggplot2.org/current/geom_boxplot.html">docs</a>).</p>
<p>When we add <code>colour = class</code> to the box plot, the different classes within <code>drv</code> are placed side by side, i.e. dodged. If it was <code>position_identity</code>, they would be overlapping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-45-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-46-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="coordinate-systems" class="section level2">
<h2><span class="header-section-number">3.9</span> Coordinate Systems</h2>
<div id="exercise-1.-6" class="section level3 exercise">
<h3><span class="header-section-number">3.9.1</span> Exercise 1.</h3>
<div class="question">
<p>Turn a stacked bar chart into a pie chart using <code>coord_polar()</code>.</p>
</div>
<div class="answer">
<p>This is a stacked bar chart with a single category</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-47-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>See the documentation for <a href="http://docs.ggplot2.org/current/coord_polar.html">coord_polar</a> for an example of making a pie chart. In particular, <code>theta = &quot;y&quot;</code>, meaning that the angle of the chart is the <code>y</code> variable has to be specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">width =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-48-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If <code>theta = &quot;y&quot;</code> is not specified, then you get a bull’s-eye chart</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">width =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-49-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If you had a multiple stacked bar chart,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity), <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-50-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>and apply polar coordinates to it, you end up with a multi-doughnut chart,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity), <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-51-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2.-6" class="section level3 exercise">
<h3><span class="header-section-number">3.9.2</span> Exercise 2.</h3>
<div class="question">
<p>What does <code>labs()</code> do? Read the documentation.</p>
</div>
<div class="answer">
<p>The <code>labs</code> function adds labels for different scales and the title of the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Highway MPG&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Highway MPG by car class&quot;</span>)</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-52-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3.-6" class="section level3 exercise">
<h3><span class="header-section-number">3.9.3</span> Exercise 3.</h3>
<div class="question">
<p>What’s the difference between <code>coord_quickmap()</code> and <code>coord_map()</code>?</p>
</div>
<div class="answer">
<p>See the <a href="http://docs.ggplot2.org/current/coord_quickmap.html">docs</a>:</p>
<ul>
<li><code>coord_map</code> uses a 2D projection: by default the Mercator project of the sphere to the plot. But this requires transforming all geoms.</li>
<li><code>coord_quickmap</code> uses a approximate, but faster, map projection using the lat/long ratio as an approximation. This is “quick” because the shapes don’t need to be transformed.</li>
</ul>
</div>
</div>
<div id="exercise-4.-5" class="section level3 exercise">
<h3><span class="header-section-number">3.9.4</span> Exercise 4.</h3>
<div class="question">
<p>What does the plot below tell you about the relationship between city and highway mpg? Why is <code>coord_fixed()</code> important? What does <code>geom_abline()</code> do?</p>
</div>
<div class="answer">
<p>The coordinates <code>coord_fixed</code> ensures that the <code>abline</code> is at a 45 degree angle, which makes it easy to compare the highway and city mileage against what it would be if they were exactly the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-53-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If we didn’t include geom_point, then the line is no longer at 45 degrees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>()</code></pre></div>
<p><img src="visualize_files/figure-html/unnamed-chunk-54-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="the-layered-grammar-of-graphics" class="section level2">
<h2><span class="header-section-number">3.10</span> The Layered Grammar of Graphics</h2>
<p>No exercises</p>
<!--chapter:end:visualize.Rmd-->
</div>
</div>
<div id="workflow-basics" class="section level1">
<h1><span class="header-section-number">4</span> Workflow Basics</h1>
<div id="coding-basics" class="section level2">
<h2><span class="header-section-number">4.1</span> Coding basics</h2>
<p>No exercises</p>
</div>
<div id="whats-in-a-name" class="section level2">
<h2><span class="header-section-number">4.2</span> What’s in a name?</h2>
<p>No exercises</p>
</div>
<div id="calling-functions" class="section level2">
<h2><span class="header-section-number">4.3</span> Calling functions</h2>
<p>No exercises</p>
</div>
<div id="practice" class="section level2">
<h2><span class="header-section-number">4.4</span> Practice</h2>
<div id="exercise-1" class="section level3 exercise">
<h3><span class="header-section-number">4.4.1</span> Exercise 1</h3>
<div class="question">
<p>Why does this code not work?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_variable &lt;-<span class="st"> </span><span class="dv">10</span>
my_varıable
<span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;my_varıable&#39; not found</span></code></pre></div>
</div>
<p>The variable being printed is <code>my_varıable</code>, not <code>my_variable</code>: the seventh character is “ı” (“LATIN SMALL LETTER DOTLESS I”), not “i”.</p>
<p>While it wouldn’t have helped much in this case, the importance of distinguishing characters in code is reasons why fonts which clearly distinguish similar characters are preferred in programming: especially important are distinguishing between zero (0), Latin small letter O (o), and Latin capital letter O (O); and the numeral one (1), Latin small letter I (i), Latin capital letter I (i), and Latin small letter L (l). In these fonts, zero and the Latin letter O are often distinguished by using a glyph for zero that uses either a dot in the interior or a slash through it.</p>
<p>Also note that the error messages of the form “object ‘…’ not found”, means what it says: R cannot find an object with that name. Unfortunately, the error does not tell you why that object cannot be found. This is usually because you either (1) forgot to define the function (or had an error that prevented it from being defined earlier), (2) didn’t load a package with the object, or (3) made a typo in the object’s name (either when using it or when you originally defined it).</p>
</div>
<div id="exercise-2" class="section level3 exercise">
<h3><span class="header-section-number">4.4.2</span> Exercise 2</h3>
<div class="question">
<p>Tweak each of the following R commands so that they run correctly:</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</span>
<span class="co">#&gt; ✔ ggplot2 2.2.1          ✔ purrr   0.2.4     </span>
<span class="co">#&gt; ✔ tibble  1.4.2          ✔ dplyr   0.7.4.9000</span>
<span class="co">#&gt; ✔ tidyr   0.8.0          ✔ stringr 1.2.0     </span>
<span class="co">#&gt; ✔ readr   1.1.1          ✔ forcats 0.3.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span>

<span class="kw">ggplot</span>(<span class="dt">dota =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))
<span class="co">#&gt; Error in structure(list(data = data, layers = list(), scales = scales_list(), : argument &quot;data&quot; is missing, with no default</span></code></pre></div>
<p>The error message is <code>argument &quot;data&quot; is missing, with no default</code>.</p>
<p>It looks like a typo, <code>dota</code> instead of <code>data</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="workflow-basics_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fliter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)
<span class="co">#&gt; Error in fliter(mpg, cyl = 8): could not find function &quot;fliter&quot;</span></code></pre></div>
<p>R could not find the function <code>fliter</code> because we made a typo: <code>fliter</code> instead of <code>filter</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)
<span class="co">#&gt; Error: `cyl` (`cyl = 8`) must not be named, do you need `==`?</span></code></pre></div>
<p>We aren’t done yet. But the error message gives a suggestion. Let’s follow it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(mpg, cyl <span class="op">==</span><span class="st"> </span><span class="dv">8</span>)
<span class="co">#&gt; # A tibble: 70 x 11</span>
<span class="co">#&gt;   manufacturer model displ  year   cyl trans drv     cty   hwy fl    class</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 audi         a6 q…  4.20  2008     8 auto… 4        16    23 p     mids…</span>
<span class="co">#&gt; 2 chevrolet    c150…  5.30  2008     8 auto… r        14    20 r     suv  </span>
<span class="co">#&gt; 3 chevrolet    c150…  5.30  2008     8 auto… r        11    15 e     suv  </span>
<span class="co">#&gt; 4 chevrolet    c150…  5.30  2008     8 auto… r        14    20 r     suv  </span>
<span class="co">#&gt; 5 chevrolet    c150…  5.70  1999     8 auto… r        13    17 r     suv  </span>
<span class="co">#&gt; 6 chevrolet    c150…  6.00  2008     8 auto… r        12    17 r     suv  </span>
<span class="co">#&gt; # ... with 64 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(diamond, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)
<span class="co">#&gt; Error in filter(diamond, carat &gt; 3): object &#39;diamond&#39; not found</span></code></pre></div>
<p>R says it can’t find the object <code>diamond</code>. This is a typo; the data frame is named <code>diamonds</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(diamonds, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)
<span class="co">#&gt; # A tibble: 32 x 10</span>
<span class="co">#&gt;   carat cut     color clarity depth table price     x     y     z</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  3.01 Premium I     I1       62.7  58.0  8040  9.10  8.97  5.67</span>
<span class="co">#&gt; 2  3.11 Fair    J     I1       65.9  57.0  9823  9.15  9.02  5.98</span>
<span class="co">#&gt; 3  3.01 Premium F     I1       62.2  56.0  9925  9.24  9.13  5.73</span>
<span class="co">#&gt; 4  3.05 Premium E     I1       60.9  58.0 10453  9.26  9.25  5.66</span>
<span class="co">#&gt; 5  3.02 Fair    I     I1       65.2  56.0 10577  9.11  9.02  5.91</span>
<span class="co">#&gt; 6  3.01 Fair    H     I1       56.1  62.0 10761  9.54  9.38  5.31</span>
<span class="co">#&gt; # ... with 26 more rows</span></code></pre></div>
<p>How did I know? I started typing in <code>diamond</code> and RStudio completed it to <code>diamonds</code>. Since <code>diamonds</code> includes the variable <code>carat</code> and the code works, that appears to have been the problem.</p>
</div>
<div id="exercise-3" class="section level3 exercise">
<h3><span class="header-section-number">4.4.3</span> Exercise 3</h3>
<div class="question">
<p>Press <em>Alt + Shift + K</em>. What happens? How can you get to the same place using the menus?</p>
</div>
<p>This gives a menu with keyboard shortcuts. This can be found in the menu under <code>Tools -&gt; Keyboard Shortcuts Help</code>.</p>
<!--chapter:end:workflow-basics.Rmd-->
</div>
</div>
</div>
<div id="data-transformation" class="section level1">
<h1><span class="header-section-number">5</span> Data Transformation</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
</div>
<div id="filter-rows-with-filter" class="section level2">
<h2><span class="header-section-number">5.2</span> Filter rows with <code>filter()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(flights)
<span class="co">#&gt; Observations: 336,776</span>
<span class="co">#&gt; Variables: 19</span>
<span class="co">#&gt; $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,...</span>
<span class="co">#&gt; $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span>
<span class="co">#&gt; $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span>
<span class="co">#&gt; $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 55...</span>
<span class="co">#&gt; $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 60...</span>
<span class="co">#&gt; $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2...</span>
<span class="co">#&gt; $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 7...</span>
<span class="co">#&gt; $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 7...</span>
<span class="co">#&gt; $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -...</span>
<span class="co">#&gt; $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;,...</span>
<span class="co">#&gt; $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79...</span>
<span class="co">#&gt; $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN...</span>
<span class="co">#&gt; $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;...</span>
<span class="co">#&gt; $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;...</span>
<span class="co">#&gt; $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138...</span>
<span class="co">#&gt; $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 94...</span>
<span class="co">#&gt; $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5,...</span>
<span class="co">#&gt; $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, ...</span>
<span class="co">#&gt; $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...</span></code></pre></div>
<div id="exercise-1-1" class="section level3 exercise">
<h3><span class="header-section-number">5.2.1</span> Exercise 1</h3>
<div class="question">
<p>Find all flights that</p>
<ol style="list-style-type: decimal">
<li>Had an arrival delay of two or more hours</li>
<li>Flew to Houston (IAH or HOU)</li>
<li>Were operated by United, American, or Delta</li>
<li>Departed in summer (July, August, and September)</li>
<li>Arrived more than two hours late, but didn’t leave late</li>
<li>Were delayed by at least an hour, but made up over 30 minutes in flight</li>
<li>Departed between midnight and 6am (inclusive)</li>
</ol>
</div>
<div class="answer">
<p><em>Had an arrival delay of two or more hours</em> Since delay is in minutes, we are looking for flights where <code>arr_delay &gt; 120</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 10,034 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      811            630       101     1047</span>
<span class="co">#&gt; 2  2013     1     1      848           1835       853     1001</span>
<span class="co">#&gt; 3  2013     1     1      957            733       144     1056</span>
<span class="co">#&gt; 4  2013     1     1     1114            900       134     1447</span>
<span class="co">#&gt; 5  2013     1     1     1505           1310       115     1638</span>
<span class="co">#&gt; 6  2013     1     1     1525           1340       105     1831</span>
<span class="co">#&gt; # ... with 1.003e+04 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Flew to Houston (IAH or HOU)</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;IAH&quot;</span>, <span class="st">&quot;HOU&quot;</span>))
<span class="co">#&gt; # A tibble: 9,313 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      623            627     -4.00      933</span>
<span class="co">#&gt; 4  2013     1     1      728            732     -4.00     1041</span>
<span class="co">#&gt; 5  2013     1     1      739            739      0        1104</span>
<span class="co">#&gt; 6  2013     1     1      908            908      0        1228</span>
<span class="co">#&gt; # ... with 9,307 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Were operated by United, American, or Delta</em> The variable <code>carrier</code> has the airline, but it is in two-digit carrier codes. However, we can look it up in the <code>airlines</code> dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airlines
<span class="co">#&gt; # A tibble: 16 x 2</span>
<span class="co">#&gt;   carrier name                    </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                   </span>
<span class="co">#&gt; 1 9E      Endeavor Air Inc.       </span>
<span class="co">#&gt; 2 AA      American Airlines Inc.  </span>
<span class="co">#&gt; 3 AS      Alaska Airlines Inc.    </span>
<span class="co">#&gt; 4 B6      JetBlue Airways         </span>
<span class="co">#&gt; 5 DL      Delta Air Lines Inc.    </span>
<span class="co">#&gt; 6 EV      ExpressJet Airlines Inc.</span>
<span class="co">#&gt; # ... with 10 more rows</span></code></pre></div>
<p>Since there are only 16 rows, its not even worth filtering. Delta is <code>DL</code>, American is <code>AA</code>, and United is <code>UA</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AA&quot;</span>, <span class="st">&quot;DL&quot;</span>, <span class="st">&quot;UA&quot;</span>))
<span class="co">#&gt; # A tibble: 139,504 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      542            540      2.00      923</span>
<span class="co">#&gt; 4  2013     1     1      554            600     -6.00      812</span>
<span class="co">#&gt; 5  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; 6  2013     1     1      558            600     -2.00      753</span>
<span class="co">#&gt; # ... with 1.395e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Departed in summer (July, August, and September)</em> The variable <code>month</code> has the month, and it is numeric.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="kw">between</span>(month, <span class="dv">7</span>, <span class="dv">9</span>))
<span class="co">#&gt; # A tibble: 86,326 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     7     1        1           2029    212         236</span>
<span class="co">#&gt; 2  2013     7     1        2           2359      3.00      344</span>
<span class="co">#&gt; 3  2013     7     1       29           2245    104         151</span>
<span class="co">#&gt; 4  2013     7     1       43           2130    193         322</span>
<span class="co">#&gt; 5  2013     7     1       44           2150    174         300</span>
<span class="co">#&gt; 6  2013     7     1       46           2051    235         304</span>
<span class="co">#&gt; # ... with 8.632e+04 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Arrived more than two hours late, but didn’t leave late</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span><span class="kw">is.na</span>(dep_delay), dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>, arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 29 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1    27     1419           1420     -1.00     1754</span>
<span class="co">#&gt; 2  2013    10     7     1350           1350      0        1736</span>
<span class="co">#&gt; 3  2013    10     7     1357           1359     -2.00     1858</span>
<span class="co">#&gt; 4  2013    10    16      657            700     -3.00     1258</span>
<span class="co">#&gt; 5  2013    11     1      658            700     -2.00     1329</span>
<span class="co">#&gt; 6  2013     3    18     1844           1847     -3.00       39</span>
<span class="co">#&gt; # ... with 23 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Were delayed by at least an hour, but made up over 30 minutes in flight</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span><span class="kw">is.na</span>(dep_delay), 
       dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">60</span>, dep_delay <span class="op">-</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>)
<span class="co">#&gt; # A tibble: 1,844 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1     2205           1720     285         46</span>
<span class="co">#&gt; 2  2013     1     1     2326           2130     116        131</span>
<span class="co">#&gt; 3  2013     1     3     1503           1221     162       1803</span>
<span class="co">#&gt; 4  2013     1     3     1839           1700      99.0     2056</span>
<span class="co">#&gt; 5  2013     1     3     1850           1745      65.0     2148</span>
<span class="co">#&gt; 6  2013     1     3     1941           1759     102       2246</span>
<span class="co">#&gt; # ... with 1,838 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p><em>Departed between midnight and 6am (inclusive)</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, dep_time <span class="op">&lt;=</span><span class="st"> </span><span class="dv">600</span> <span class="op">|</span><span class="st"> </span>dep_time <span class="op">==</span><span class="st"> </span><span class="dv">2400</span>)
<span class="co">#&gt; # A tibble: 9,373 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      542            540      2.00      923</span>
<span class="co">#&gt; 4  2013     1     1      544            545     -1.00     1004</span>
<span class="co">#&gt; 5  2013     1     1      554            600     -6.00      812</span>
<span class="co">#&gt; 6  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; # ... with 9,367 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-1" class="section level3 exercise">
<h3><span class="header-section-number">5.2.2</span> Exercise 2</h3>
<div class="question">
<p>Another useful <strong>dplyr</strong> filtering helper is <code>between()</code>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</p>
</div>
<div class="answer">
<p><code>between(x, left, right)</code> is equivalent to <code>x &gt;= left &amp; x &lt;= right</code>.</p>
</div>
</div>
<div id="exercise-3-1" class="section level3 exercise">
<h3><span class="header-section-number">5.2.3</span> Exercise 3</h3>
<div class="question">
<p>How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_time))
<span class="co">#&gt; # A tibble: 8,255 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1       NA           1630        NA       NA</span>
<span class="co">#&gt; 2  2013     1     1       NA           1935        NA       NA</span>
<span class="co">#&gt; 3  2013     1     1       NA           1500        NA       NA</span>
<span class="co">#&gt; 4  2013     1     1       NA            600        NA       NA</span>
<span class="co">#&gt; 5  2013     1     2       NA           1540        NA       NA</span>
<span class="co">#&gt; 6  2013     1     2       NA           1620        NA       NA</span>
<span class="co">#&gt; # ... with 8,249 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p>Since <code>arr_time</code> is also missing, these are canceled flights.</p>
</div>
</div>
<div id="exercise-4" class="section level3 exercise">
<h3><span class="header-section-number">5.2.4</span> Exercise 4</h3>
<div class="question">
<p>Why is <code>NA ^ 0</code> not missing? Why is <code>NA | TRUE</code> not missing? Why is <code>FALSE &amp; NA</code> not missing? Can you figure out the general rule? (<code>NA * 0</code> is a tricky counterexample!)</p>
</div>
<div class="answer">
<p><code>NA ^ 0 == 1</code> since for all numeric values <span class="math inline">\(x ^ 0 = 1\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">^</span><span class="st"> </span><span class="dv">0</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p><code>NA | TRUE</code> is <code>TRUE</code> because the it doesn’t matter whether the missing value is <code>TRUE</code> or <code>FALSE</code>, <code>x \lor T = T</code> for all values of <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">|</span><span class="st"> </span><span class="ot">TRUE</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Likewise, anything and <code>FALSE</code> is always <code>FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">FALSE</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Because the value of the missing element matters in <code>NA | FALSE</code> and <code>NA &amp; TRUE</code>, these are missing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">|</span><span class="st"> </span><span class="ot">FALSE</span>
<span class="co">#&gt; [1] NA</span>
<span class="ot">NA</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">TRUE</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>Wut?? Since <code>x * 0 = 0</code> for all <span class="math inline">\(x\)</span> (except <code>Inf</code>) we might expect <code>NA * 0 = 0</code>, but that’s not the case.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>The reason that <code>NA * 0</code> is not equal to <code>0</code> is that <code>x * 0 = NaN</code> is undefined when <code>x = Inf</code> or <code>x = -Inf</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">Inf</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span>
<span class="co">#&gt; [1] NaN</span>
<span class="op">-</span><span class="ot">Inf</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span>
<span class="co">#&gt; [1] NaN</span></code></pre></div>
</div>
</div>
</div>
<div id="arrange-rows-with-arrange" class="section level2">
<h2><span class="header-section-number">5.3</span> Arrange rows with <code>arrange()</code></h2>
<div id="exercise-1-2" class="section level3 exercise">
<h3><span class="header-section-number">5.3.1</span> Exercise 1</h3>
<div class="question">
<p>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>).</p>
</div>
<div class="answer">
<p>This sorts by increasing <code>dep_time</code>, but with all missing values put first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(<span class="kw">is.na</span>(dep_time)), dep_time)
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1       NA           1630        NA       NA</span>
<span class="co">#&gt; 2  2013     1     1       NA           1935        NA       NA</span>
<span class="co">#&gt; 3  2013     1     1       NA           1500        NA       NA</span>
<span class="co">#&gt; 4  2013     1     1       NA            600        NA       NA</span>
<span class="co">#&gt; 5  2013     1     2       NA           1540        NA       NA</span>
<span class="co">#&gt; 6  2013     1     2       NA           1620        NA       NA</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-2" class="section level3 exercise">
<h3><span class="header-section-number">5.3.2</span> Exercise 2</h3>
<div class="question">
<p>Sort flights to find the most delayed flights. Find the flights that left earliest.</p>
</div>
<div class="answer">
<p>The most delayed flights are found by sorting by <code>dep_delay</code> in descending order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     9      641            900      1301     1242</span>
<span class="co">#&gt; 2  2013     6    15     1432           1935      1137     1607</span>
<span class="co">#&gt; 3  2013     1    10     1121           1635      1126     1239</span>
<span class="co">#&gt; 4  2013     9    20     1139           1845      1014     1457</span>
<span class="co">#&gt; 5  2013     7    22      845           1600      1005     1044</span>
<span class="co">#&gt; 6  2013     4    10     1100           1900       960     1342</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p>If we sort <code>dep_delay</code> in ascending order, we get those that left earliest. There was a flight that left 43 minutes early.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, dep_delay)
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013    12     7     2040           2123     -43.0       40</span>
<span class="co">#&gt; 2  2013     2     3     2022           2055     -33.0     2240</span>
<span class="co">#&gt; 3  2013    11    10     1408           1440     -32.0     1549</span>
<span class="co">#&gt; 4  2013     1    11     1900           1930     -30.0     2233</span>
<span class="co">#&gt; 5  2013     1    29     1703           1730     -27.0     1947</span>
<span class="co">#&gt; 6  2013     8     9      729            755     -26.0     1002</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-2" class="section level3 exercise">
<h3><span class="header-section-number">5.3.3</span> Exercise 3</h3>
<div class="question">
<p>Sort flights to find the fastest flights.</p>
</div>
<div class="answer">
<p>I assume that by by “fastest flights” it means the flights with the minimum air time. So I sort by <code>air_time</code>. The fastest flights. The fastest flights area couple of flights between EWR and BDL with an air time of 20 minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, air_time)
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1    16     1355           1315     40.0      1442</span>
<span class="co">#&gt; 2  2013     4    13      537            527     10.0       622</span>
<span class="co">#&gt; 3  2013    12     6      922            851     31.0      1021</span>
<span class="co">#&gt; 4  2013     2     3     2153           2129     24.0      2247</span>
<span class="co">#&gt; 5  2013     2     5     1303           1315    -12.0      1342</span>
<span class="co">#&gt; 6  2013     2    12     2123           2130    - 7.00     2211</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-4-1" class="section level3 exercise">
<h3><span class="header-section-number">5.3.4</span> Exercise 4</h3>
<div class="question">
<p>Which flights traveled the longest? Which traveled the shortest?</p>
</div>
<div class="answer">
<p>I’ll assume hat traveled the longest or shortest refers to distance, rather than air-time.</p>
<p>The longest flights are the Hawaii Air (HA 51) between JFK and HNL (Honolulu) at 4,983 miles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      857            900    - 3.00     1516</span>
<span class="co">#&gt; 2  2013     1     2      909            900      9.00     1525</span>
<span class="co">#&gt; 3  2013     1     3      914            900     14.0      1504</span>
<span class="co">#&gt; 4  2013     1     4      900            900      0        1516</span>
<span class="co">#&gt; 5  2013     1     5      858            900    - 2.00     1519</span>
<span class="co">#&gt; 6  2013     1     6     1019            900     79.0      1558</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p>Apart from an EWR to LGA flight that was canceled, the shortest flights are the Envoy Air Flights between EWR and PHL at 80 miles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, distance)
<span class="co">#&gt; # A tibble: 336,776 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     7    27       NA            106     NA          NA</span>
<span class="co">#&gt; 2  2013     1     3     2127           2129   -  2.00     2222</span>
<span class="co">#&gt; 3  2013     1     4     1240           1200     40.0      1333</span>
<span class="co">#&gt; 4  2013     1     4     1829           1615    134        1937</span>
<span class="co">#&gt; 5  2013     1     4     2128           2129   -  1.00     2218</span>
<span class="co">#&gt; 6  2013     1     5     1155           1200   -  5.00     1241</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
</div>
<div id="select-columns-with-select" class="section level2">
<h2><span class="header-section-number">5.4</span> Select columns with <code>select()</code></h2>
<div id="exercise-1-3" class="section level3 exercise">
<h3><span class="header-section-number">5.4.1</span> Exercise 1</h3>
<div class="question">
<p>Brainstorm as many ways as possible to select <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> from flights.</p>
</div>
<div class="answer">
<p>A few ways include:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay)
<span class="co">#&gt; # A tibble: 336,776 x 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517      2.00      830      11.0</span>
<span class="co">#&gt; 2      533      4.00      850      20.0</span>
<span class="co">#&gt; 3      542      2.00      923      33.0</span>
<span class="co">#&gt; 4      544     -1.00     1004     -18.0</span>
<span class="co">#&gt; 5      554     -6.00      812     -25.0</span>
<span class="co">#&gt; 6      554     -4.00      740      12.0</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span>
<span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;dep_&quot;</span>), <span class="kw">starts_with</span>(<span class="st">&quot;arr_&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 x 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517      2.00      830      11.0</span>
<span class="co">#&gt; 2      533      4.00      850      20.0</span>
<span class="co">#&gt; 3      542      2.00      923      33.0</span>
<span class="co">#&gt; 4      544     -1.00     1004     -18.0</span>
<span class="co">#&gt; 5      554     -6.00      812     -25.0</span>
<span class="co">#&gt; 6      554     -4.00      740      12.0</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span>
<span class="kw">select</span>(flights, <span class="kw">matches</span>(<span class="st">&quot;^(dep|arr)_(time|delay)$&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 x 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517      2.00      830      11.0</span>
<span class="co">#&gt; 2      533      4.00      850      20.0</span>
<span class="co">#&gt; 3      542      2.00      923      33.0</span>
<span class="co">#&gt; 4      544     -1.00     1004     -18.0</span>
<span class="co">#&gt; 5      554     -6.00      812     -25.0</span>
<span class="co">#&gt; 6      554     -4.00      740      12.0</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<p>using <code>ends_with()</code> doesn’t work well since it would return both <code>sched_arr_time</code> and <code>sched_dep_time</code>.</p>
</div>
</div>
<div id="exercise-2-3" class="section level3 exercise">
<h3><span class="header-section-number">5.4.2</span> Exercise 2</h3>
<div class="question">
<p>What happens if you include the name of a variable multiple times in a select() call?</p>
</div>
<div class="answer">
<p>It ignores the duplicates, and that variable is only included once. No error, warning, or message is emitted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, year, month, day, year, year)
<span class="co">#&gt; # A tibble: 336,776 x 3</span>
<span class="co">#&gt;    year month   day</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1</span>
<span class="co">#&gt; 2  2013     1     1</span>
<span class="co">#&gt; 3  2013     1     1</span>
<span class="co">#&gt; 4  2013     1     1</span>
<span class="co">#&gt; 5  2013     1     1</span>
<span class="co">#&gt; 6  2013     1     1</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-3-3" class="section level3 exercise">
<h3><span class="header-section-number">5.4.3</span> Exercise 3</h3>
<div class="question">
<p>What does the <code>one_of()</code> function do? Why might it be helpful in conjunction with this vector?</p>
</div>
<div class="answer">
<p>The <code>one_of</code> vector allows you to select variables with a character vector rather than as unquoted variable names. It’s useful because then you can easily pass vectors to <code>select()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)
<span class="kw">select</span>(flights, <span class="kw">one_of</span>(vars))
<span class="co">#&gt; # A tibble: 336,776 x 5</span>
<span class="co">#&gt;    year month   day dep_delay arr_delay</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2013     1     1      2.00      11.0</span>
<span class="co">#&gt; 2  2013     1     1      4.00      20.0</span>
<span class="co">#&gt; 3  2013     1     1      2.00      33.0</span>
<span class="co">#&gt; 4  2013     1     1     -1.00     -18.0</span>
<span class="co">#&gt; 5  2013     1     1     -6.00     -25.0</span>
<span class="co">#&gt; 6  2013     1     1     -4.00      12.0</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-4-2" class="section level3 exercise">
<h3><span class="header-section-number">5.4.4</span> Exercise 4</h3>
<div class="question">
<p>Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 x 6</span>
<span class="co">#&gt;   dep_time sched_dep_time arr_time sched_arr_time air_time</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517            515      830            819      227</span>
<span class="co">#&gt; 2      533            529      850            830      227</span>
<span class="co">#&gt; 3      542            540      923            850      160</span>
<span class="co">#&gt; 4      544            545     1004           1022      183</span>
<span class="co">#&gt; 5      554            600      812            837      116</span>
<span class="co">#&gt; 6      554            558      740            728      150</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 1 more variable: time_hour &lt;dttm&gt;</span></code></pre></div>
<p>The default behavior for contains is to ignore case. Yes, it surprises me. Upon reflection, I realized that this is likely the default behavior because <code>dplyr</code> is designed to deal with a variety of data backends, and some database engines don’t differentiate case.</p>
<p>To change the behavior add the argument <code>ignore.case = FALSE</code>. Now no variables are selected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>))
<span class="co">#&gt; # A tibble: 336,776 x 0</span></code></pre></div>
</div>
</div>
</div>
<div id="add-new-variables-with-mutate" class="section level2">
<h2><span class="header-section-number">5.5</span> Add new variables with <code>mutate()</code></h2>
<div id="exercise-1-4" class="section level3 exercise">
<h3><span class="header-section-number">5.5.1</span> Exercise 1</h3>
<div class="question">
<p>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</p>
</div>
<div class="answer">
<p>To get the departure times in the number of minutes, (integer) divide <code>dep_time</code> by 100 to get the hours since midnight and multiply by 60 and add the remainder of <code>dep_time</code> divided by 100.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_time_mins =</span> dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,
       <span class="dt">sched_dep_time_mins =</span> sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time, dep_time_mins, sched_dep_time, sched_dep_time_mins)
<span class="co">#&gt; # A tibble: 336,776 x 4</span>
<span class="co">#&gt;   dep_time dep_time_mins sched_dep_time sched_dep_time_mins</span>
<span class="co">#&gt;      &lt;int&gt;         &lt;dbl&gt;          &lt;int&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517           317            515                 315</span>
<span class="co">#&gt; 2      533           333            529                 329</span>
<span class="co">#&gt; 3      542           342            540                 340</span>
<span class="co">#&gt; 4      544           344            545                 345</span>
<span class="co">#&gt; 5      554           354            600                 360</span>
<span class="co">#&gt; 6      554           354            558                 358</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<p>This would be more cleanly done by first defining a function and reusing that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time2mins &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>
}
<span class="kw">mutate</span>(flights,
       <span class="dt">dep_time_mins =</span> <span class="kw">time2mins</span>(dep_time),
       <span class="dt">sched_dep_time_mins =</span> <span class="kw">time2mins</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time, dep_time_mins, sched_dep_time, sched_dep_time_mins)
<span class="co">#&gt; # A tibble: 336,776 x 4</span>
<span class="co">#&gt;   dep_time dep_time_mins sched_dep_time sched_dep_time_mins</span>
<span class="co">#&gt;      &lt;int&gt;         &lt;dbl&gt;          &lt;int&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517           317            515                 315</span>
<span class="co">#&gt; 2      533           333            529                 329</span>
<span class="co">#&gt; 3      542           342            540                 340</span>
<span class="co">#&gt; 4      544           344            545                 345</span>
<span class="co">#&gt; 5      554           354            600                 360</span>
<span class="co">#&gt; 6      554           354            558                 358</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-2-4" class="section level3 exercise">
<h3><span class="header-section-number">5.5.2</span> Exercise 2</h3>
<div class="question">
<p>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</p>
</div>
<div class="answer">
<p>Since <code>arr_time</code> and <code>dep_time</code> may be in different time zones, the <code>air_time</code> doesn’t equal the difference. We would need to account for time-zones in these calculations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">air_time2 =</span> arr_time <span class="op">-</span><span class="st"> </span>dep_time,
       <span class="dt">air_time_diff =</span> air_time2 <span class="op">-</span><span class="st"> </span>air_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(air_time_diff <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(air_time, air_time2, dep_time, arr_time, dest)
<span class="co">#&gt; # A tibble: 326,128 x 5</span>
<span class="co">#&gt;   air_time air_time2 dep_time arr_time dest </span>
<span class="co">#&gt;      &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1      227       313      517      830 IAH  </span>
<span class="co">#&gt; 2      227       317      533      850 IAH  </span>
<span class="co">#&gt; 3      160       381      542      923 MIA  </span>
<span class="co">#&gt; 4      183       460      544     1004 BQN  </span>
<span class="co">#&gt; 5      116       258      554      812 ATL  </span>
<span class="co">#&gt; 6      150       186      554      740 ORD  </span>
<span class="co">#&gt; # ... with 3.261e+05 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-3-4" class="section level3 exercise">
<h3><span class="header-section-number">5.5.3</span> Exercise 3</h3>
<div class="question">
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</p>
</div>
<div class="answer">
<p>I’d expect <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code> to be related so that <code>dep_time - sched_dep_time = dep_delay</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay2 =</span> dep_time <span class="op">-</span><span class="st"> </span>sched_dep_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(dep_delay2 <span class="op">!=</span><span class="st"> </span>dep_delay) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time, sched_dep_time, dep_delay, dep_delay2)
<span class="co">#&gt; # A tibble: 99,777 x 4</span>
<span class="co">#&gt;   dep_time sched_dep_time dep_delay dep_delay2</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1      554            600     -6.00        -46</span>
<span class="co">#&gt; 2      555            600     -5.00        -45</span>
<span class="co">#&gt; 3      557            600     -3.00        -43</span>
<span class="co">#&gt; 4      557            600     -3.00        -43</span>
<span class="co">#&gt; 5      558            600     -2.00        -42</span>
<span class="co">#&gt; 6      558            600     -2.00        -42</span>
<span class="co">#&gt; # ... with 9.977e+04 more rows</span></code></pre></div>
<p>Oops, I forgot to convert to minutes. I’ll reuse the <code>time2mins</code> function I wrote earlier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay2 =</span> <span class="kw">time2mins</span>(dep_time) <span class="op">-</span><span class="st"> </span><span class="kw">time2mins</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(dep_delay2 <span class="op">!=</span><span class="st"> </span>dep_delay) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time, sched_dep_time, dep_delay, dep_delay2)
<span class="co">#&gt; # A tibble: 1,207 x 4</span>
<span class="co">#&gt;   dep_time sched_dep_time dep_delay dep_delay2</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1      848           1835     853        - 587</span>
<span class="co">#&gt; 2       42           2359      43.0      -1397</span>
<span class="co">#&gt; 3      126           2250     156        -1284</span>
<span class="co">#&gt; 4       32           2359      33.0      -1407</span>
<span class="co">#&gt; 5       50           2145     185        -1255</span>
<span class="co">#&gt; 6      235           2359     156        -1284</span>
<span class="co">#&gt; # ... with 1,201 more rows</span></code></pre></div>
<p>Well, that solved most of the problems, but these two numbers don’t match because we aren’t accounting for flights where the departure time is the next day from the scheduled departure time.</p>
</div>
</div>
<div id="exercise-4-3" class="section level3 exercise">
<h3><span class="header-section-number">5.5.4</span> Exercise 4</h3>
<div class="question">
<p>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for <code>min_rank()</code>.</p>
</div>
<div class="answer">
<p>I’d want to handle ties by taking the minimum of tied values. If three flights are have the same value and are the most delayed, we would say they are tied for first, not tied for third or second.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(<span class="op">-</span>dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(dep_delay_rank) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(dep_delay_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)
<span class="co">#&gt; # A tibble: 10 x 20</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     9      641            900      1301     1242</span>
<span class="co">#&gt; 2  2013     6    15     1432           1935      1137     1607</span>
<span class="co">#&gt; 3  2013     1    10     1121           1635      1126     1239</span>
<span class="co">#&gt; 4  2013     9    20     1139           1845      1014     1457</span>
<span class="co">#&gt; 5  2013     7    22      845           1600      1005     1044</span>
<span class="co">#&gt; 6  2013     4    10     1100           1900       960     1342</span>
<span class="co">#&gt; # ... with 4 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-5" class="section level3 exercise">
<h3><span class="header-section-number">5.5.5</span> Exercise 5</h3>
<div class="question">
<p>What does <code>1:3 + 1:10</code> return? Why?</p>
</div>
<div class="answer">
<p>It returns <code>c(1 + 1, 2 + 2, 3 + 3, 1 + 4, 2 + 5, 3 + 6, 1 + 7, 2 + 8, 3 + 9, 1 + 10)</code>. When adding two vectors recycles the shorter vector’s values to get vectors of the same length. We get a warning vector since the shorter vector is not a multiple of the longer one (this often, but not necessarily, means we made an error somewhere).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
<span class="co">#&gt; Warning in 1:3 + 1:10: longer object length is not a multiple of shorter</span>
<span class="co">#&gt; object length</span>
<span class="co">#&gt;  [1]  2  4  6  5  7  9  8 10 12 11</span></code></pre></div>
</div>
</div>
<div id="exercise-6" class="section level3 exercise">
<h3><span class="header-section-number">5.5.6</span> Exercise 6</h3>
<div class="question">
<p>What trigonometric functions does R provide?</p>
</div>
<div class="answer">
<p>These are all described in the same help page,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(<span class="st">&quot;Trig&quot;</span>)</code></pre></div>
<p>Cosine (<code>cos</code>), sine (<code>sin</code>), tangent (<code>tan</code>) are provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">by =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),
  <span class="dt">cosx =</span> <span class="kw">cos</span>(pi <span class="op">*</span><span class="st"> </span>x),
  <span class="dt">sinx =</span> <span class="kw">cos</span>(pi <span class="op">*</span><span class="st"> </span>x),
  <span class="dt">tanx =</span> <span class="kw">tan</span>(pi <span class="op">*</span><span class="st"> </span>x)
)
<span class="co">#&gt; # A tibble: 21 x 4</span>
<span class="co">#&gt;        x                   cosx                   sinx                tanx</span>
<span class="co">#&gt;    &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -3.00  -1.00                  -1.00                             3.67e⁻¹⁶</span>
<span class="co">#&gt; 2 -2.50   0.000000000000000306   0.000000000000000306            -3.27e⁺¹⁵</span>
<span class="co">#&gt; 3 -2.00   1.00                   1.00                             2.45e⁻¹⁶</span>
<span class="co">#&gt; 4 -1.50  -0.000000000000000184  -0.000000000000000184            -5.44e⁺¹⁵</span>
<span class="co">#&gt; 5 -1.00  -1.00                  -1.00                             1.22e⁻¹⁶</span>
<span class="co">#&gt; 6 -0.500  0.0000000000000000612  0.0000000000000000612           -1.63e⁺¹⁶</span>
<span class="co">#&gt; # ... with 15 more rows</span></code></pre></div>
<p>The convenience function <code>cospi(x)</code> is equivalent to <code>cos(pi * x)</code>, with <code>sinpi</code> and <code>tanpi</code> similarly defined,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">by =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),
  <span class="dt">cosx =</span> <span class="kw">cospi</span>(x),
  <span class="dt">sinx =</span> <span class="kw">cos</span>(x),
  <span class="dt">tanx =</span> <span class="kw">tan</span>(x)
)
<span class="co">#&gt; # A tibble: 21 x 4</span>
<span class="co">#&gt;        x  cosx    sinx    tanx</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -3.00  -1.00 -0.990    0.143</span>
<span class="co">#&gt; 2 -2.50   0    -0.801    0.747</span>
<span class="co">#&gt; 3 -2.00   1.00 -0.416    2.19 </span>
<span class="co">#&gt; 4 -1.50   0     0.0707 -14.1  </span>
<span class="co">#&gt; 5 -1.00  -1.00  0.540  - 1.56 </span>
<span class="co">#&gt; 6 -0.500  0     0.878  - 0.546</span>
<span class="co">#&gt; # ... with 15 more rows</span></code></pre></div>
<p>The inverse function arc-cosine (<code>acos</code>), arc-sine (<code>asin</code>), and arc-tangent (<code>atan</code>) are provided,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">4</span>),
  <span class="dt">acosx =</span> <span class="kw">acos</span>(x),
  <span class="dt">asinx =</span> <span class="kw">asin</span>(x),
  <span class="dt">atanx =</span> <span class="kw">atan</span>(x)
)
<span class="co">#&gt; # A tibble: 9 x 4</span>
<span class="co">#&gt;        x acosx  asinx  atanx</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -1.00   3.14 -1.57  -0.785</span>
<span class="co">#&gt; 2 -0.750  2.42 -0.848 -0.644</span>
<span class="co">#&gt; 3 -0.500  2.09 -0.524 -0.464</span>
<span class="co">#&gt; 4 -0.250  1.82 -0.253 -0.245</span>
<span class="co">#&gt; 5  0      1.57  0      0    </span>
<span class="co">#&gt; 6  0.250  1.32  0.253  0.245</span>
<span class="co">#&gt; # ... with 3 more rows</span></code></pre></div>
<p>The function <code>atan2</code> is the angle between the x-axis and the the vector (0,0) to (<code>x</code>, <code>y</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">atan2</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>))
<span class="co">#&gt; [1]  1.57  0.00 -1.57  3.14</span></code></pre></div>
</div>
</div>
</div>
<div id="grouped-summaries-with-summarise" class="section level2">
<h2><span class="header-section-number">5.6</span> Grouped summaries with <code>summarise()</code></h2>
<div id="exercise-1-5" class="section level3 exercise">
<h3><span class="header-section-number">5.6.1</span> Exercise 1</h3>
<div class="question">
<p>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios: - A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time. - A flight is always 10 minutes late. - A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time. - 99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p>
</div>
<div class="answer">
<blockquote>
<p>Which is more important: arrival delay or departure delay?</p>
</blockquote>
<p>Arrival delay is more important. Arriving early is nice, but equally as good as arriving late is bad. Variation is worse than consistency; if I know the plane will always arrive 10 minutes late, then I can plan for it arriving as if the actual arrival time was 10 minutes later than the scheduled arrival time.</p>
<p>So I’d try something that calculates the expected time of the flight, and then aggregates over any delays from that time. I would ignore any early arrival times. A better ranking would also consider cancellations, and need a way to convert them to a delay time (perhaps using the arrival time of the next flight to the same destination).</p>
<p><strong>TOOD: Answer this</strong></p>
</div>
</div>
<div id="exercise-2-5" class="section level3 exercise">
<h3><span class="header-section-number">5.6.2</span> Exercise 2</h3>
<div class="question">
<p>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p>
</div>
<div class="answer">
<p>The data frame <code>not_cancelled</code> is defined in the chapter as,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</code></pre></div>
<p>Count will group a dataset on the given variable and then determine the number of instances within each group. This can be done by by first grouping by the given variable, and then finding the number of observations in each group. The number of observations in each group can be found by calling the <code>length()</code> function on any variable. To make the result match <code>count()</code>, the value should go in a new column <code>n</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">length</span>(dest))
<span class="co">#&gt; # A tibble: 104 x 2</span>
<span class="co">#&gt;   dest      n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 ABQ     254</span>
<span class="co">#&gt; 2 ACK     264</span>
<span class="co">#&gt; 3 ALB     418</span>
<span class="co">#&gt; 4 ANC       8</span>
<span class="co">#&gt; 5 ATL   16837</span>
<span class="co">#&gt; 6 AUS    2411</span>
<span class="co">#&gt; # ... with 98 more rows</span></code></pre></div>
<p>A more concise way to get the number of observations in a data frame, or a group, is the function <code>n()</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
<span class="co">#&gt; # A tibble: 104 x 2</span>
<span class="co">#&gt;   dest      n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 ABQ     254</span>
<span class="co">#&gt; 2 ACK     264</span>
<span class="co">#&gt; 3 ALB     418</span>
<span class="co">#&gt; 4 ANC       8</span>
<span class="co">#&gt; 5 ATL   16837</span>
<span class="co">#&gt; 6 AUS    2411</span>
<span class="co">#&gt; # ... with 98 more rows</span></code></pre></div>
<p>For a weighted count, take the sum of the weight variable in each group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">sum</span>(distance))
<span class="co">#&gt; # A tibble: 4,037 x 2</span>
<span class="co">#&gt;   tailnum      n</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 D942DN    3418</span>
<span class="co">#&gt; 2 N0EGMQ  239143</span>
<span class="co">#&gt; 3 N10156  109664</span>
<span class="co">#&gt; 4 N102UW   25722</span>
<span class="co">#&gt; 5 N103US   24619</span>
<span class="co">#&gt; 6 N104UW   24616</span>
<span class="co">#&gt; # ... with 4,031 more rows</span></code></pre></div>
<p>Alternatively, we could have used <code>group_by</code> followed by <code>tally()</code>, since <code>count()</code> itself is a shortcut for calling <code>group_by()</code> then <code>tally()</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>()
<span class="co">#&gt; # A tibble: 4,037 x 2</span>
<span class="co">#&gt;   tailnum     n</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 D942DN      4</span>
<span class="co">#&gt; 2 N0EGMQ    352</span>
<span class="co">#&gt; 3 N10156    145</span>
<span class="co">#&gt; 4 N102UW     48</span>
<span class="co">#&gt; 5 N103US     46</span>
<span class="co">#&gt; 6 N104UW     46</span>
<span class="co">#&gt; # ... with 4,031 more rows</span></code></pre></div>
<p>and</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>(distance)
<span class="co">#&gt; # A tibble: 4,037 x 2</span>
<span class="co">#&gt;   tailnum      n</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 D942DN    3418</span>
<span class="co">#&gt; 2 N0EGMQ  239143</span>
<span class="co">#&gt; 3 N10156  109664</span>
<span class="co">#&gt; 4 N102UW   25722</span>
<span class="co">#&gt; 5 N103US   24619</span>
<span class="co">#&gt; 6 N104UW   24616</span>
<span class="co">#&gt; # ... with 4,031 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-3-5" class="section level3 exercise">
<h3><span class="header-section-number">5.6.3</span> Exercise 3</h3>
<div class="question">
<p>Our definition of canceled flights <code>(is.na(dep_delay) | is.na(arr_delay))</code> is slightly suboptimal. Why? Which is the most important column?</p>
</div>
<div class="answer">
<p>If a flight never departs, then it won’t arrive. A flight could also depart and not arrive if it crashes, or if it is redirected and lands in an airport other than its intended destination.</p>
<p>The more important column is <code>arr_delay</code>, which indicates the amount of delay in arrival.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time, arr_time, sched_arr_time, dep_delay, arr_delay)
<span class="co">#&gt; # A tibble: 1,175 x 5</span>
<span class="co">#&gt;   dep_time arr_time sched_arr_time dep_delay arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1525     1934           1805    - 5.00        NA</span>
<span class="co">#&gt; 2     1528     2002           1647     29.0         NA</span>
<span class="co">#&gt; 3     1740     2158           2020    - 5.00        NA</span>
<span class="co">#&gt; 4     1807     2251           2103     29.0         NA</span>
<span class="co">#&gt; 5     1939       29           2151     59.0         NA</span>
<span class="co">#&gt; 6     1952     2358           2207     22.0         NA</span>
<span class="co">#&gt; # ... with 1,169 more rows</span></code></pre></div>
<p>Okay, I’m not sure what’s going on in this data. <code>dep_time</code> can be non-missing and <code>arr_delay</code> missing but <code>arr_time</code> not missing. They may be combining different flights?</p>
</div>
</div>
<div id="exercise-4-4" class="section level3 exercise">
<h3><span class="header-section-number">5.6.4</span> Exercise 4</h3>
<div class="question">
<p>Look at the number of canceled flights per day. Is there a pattern? Is the proportion of canceled flights related to the average delay?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">canceled_delayed &lt;-
<span class="st">  </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">canceled =</span> (<span class="kw">is.na</span>(arr_delay) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(dep_delay))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop_canceled =</span> <span class="kw">mean</span>(canceled),
            <span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="kw">ggplot</span>(canceled_delayed, <span class="kw">aes</span>(<span class="dt">x =</span> avg_dep_delay, prop_canceled)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="transform_files/figure-html/unnamed-chunk-48-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5-1" class="section level3 exercise">
<h3><span class="header-section-number">5.6.5</span> Exercise 5</h3>
<div class="question">
<p>Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n())</code>)</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(arr_delay))
<span class="co">#&gt; # A tibble: 16 x 2</span>
<span class="co">#&gt;   carrier arr_delay</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 F9           21.9</span>
<span class="co">#&gt; 2 FL           20.1</span>
<span class="co">#&gt; 3 EV           15.8</span>
<span class="co">#&gt; 4 YV           15.6</span>
<span class="co">#&gt; 5 OO           11.9</span>
<span class="co">#&gt; 6 MQ           10.8</span>
<span class="co">#&gt; # ... with 10 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(airlines, carrier <span class="op">==</span><span class="st"> &quot;F9&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   carrier name                  </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                 </span>
<span class="co">#&gt; 1 F9      Frontier Airlines Inc.</span></code></pre></div>
<p>Frontier Airlines (FL) has the worst delays.</p>
<p>You can get part of the way to disentangling the effects of airports vs. carriers by comparing each flight’s delay to the average delay of destination airport. However, you’d really want to compare it to the average delay of the destination airport, <em>after</em> removing other flights from the same airline.</p>
<p>FiveThirtyEight conducted a <a href="http://fivethirtyeight.com/features/the-best-and-worst-airlines-airports-and-flights-summer-2015-update/">similar analysis</a>.</p>
</div>
</div>
<div id="exercise-6-1" class="section level3 exercise">
<h3><span class="header-section-number">5.6.6</span> Exercise 6</h3>
<div class="question">
<p>For each plane, count the number of flights before the first delay of greater than 1 hour.</p>
</div>
<div class="answer">
<p>I think this requires grouped mutate (but I may be wrong):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(tailnum, year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delay_gt1hr =</span> dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">before_delay =</span> <span class="kw">cumsum</span>(delay_gt1hr)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(before_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(<span class="dt">sort =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 3,755 x 2</span>
<span class="co">#&gt; # Groups:   tailnum [3,755]</span>
<span class="co">#&gt;   tailnum     n</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 N954UW    206</span>
<span class="co">#&gt; 2 N952UW    163</span>
<span class="co">#&gt; 3 N957UW    142</span>
<span class="co">#&gt; 4 N5FAAA    117</span>
<span class="co">#&gt; 5 N38727     99</span>
<span class="co">#&gt; 6 N3742C     98</span>
<span class="co">#&gt; # ... with 3,749 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-7" class="section level3 exercise">
<h3><span class="header-section-number">5.6.7</span> Exercise 7</h3>
<div class="question">
<p>What does the sort argument to <code>count()</code> do. When might you use it?</p>
</div>
<div class="answer">
<p>The sort argument to <code>count</code> sorts the results in order of <code>n</code>. You could use this anytime you would do <code>count</code> followed by <code>arrange</code>.</p>
</div>
</div>
</div>
<div id="grouped-mutates-and-filters" class="section level2">
<h2><span class="header-section-number">5.7</span> Grouped mutates (and filters)</h2>
<div id="exercise-1-6" class="section level3 exercise">
<h3><span class="header-section-number">5.7.1</span> Exercise 1</h3>
<div class="question">
<p>Refer back to the table of useful mutate and filtering functions. Describe how each operation changes when you combine it with grouping.</p>
</div>
<div class="answer">
<p>They operate within each group rather than over the entire data frame. E.g. <code>mean</code> will calculate the mean within each group.</p>
</div>
</div>
<div id="exercise-2-6" class="section level3 exercise">
<h3><span class="header-section-number">5.7.2</span> Exercise 2</h3>
<div class="question">
<p>Which plane (<code>tailnum</code>) has the worst on-time record?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   tailnum arr_delay</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N844MH        320</span></code></pre></div>
</div>
</div>
<div id="exercise-3-6" class="section level3 exercise">
<h3><span class="header-section-number">5.7.3</span> Exercise 3</h3>
<div class="question">
<p>What time of day should you fly if you want to avoid delays as much as possible?</p>
</div>
<div class="answer">
<p>Let’s group by hour. The earlier the better to fly. This is intuitive as delays early in the morning are likely to propagate throughout the day.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hour) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(arr_delay)
<span class="co">#&gt; # A tibble: 20 x 2</span>
<span class="co">#&gt;    hour arr_delay</span>
<span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  7.00    -5.30 </span>
<span class="co">#&gt; 2  5.00    -4.80 </span>
<span class="co">#&gt; 3  6.00    -3.38 </span>
<span class="co">#&gt; 4  9.00    -1.45 </span>
<span class="co">#&gt; 5  8.00    -1.11 </span>
<span class="co">#&gt; 6 10.0      0.954</span>
<span class="co">#&gt; # ... with 14 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-4-5" class="section level3 exercise">
<h3><span class="header-section-number">5.7.4</span> Exercise 4</h3>
<div class="question">
<p>For each destination, compute the total minutes of delay. For each, flight, compute the proportion of the total delay for its destination.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay), arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_delay =</span> <span class="kw">sum</span>(arr_delay),
         <span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay))
<span class="co">#&gt; # A tibble: 133,004 x 21</span>
<span class="co">#&gt; # Groups:   dest [103]</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      542            540      2.00      923</span>
<span class="co">#&gt; 4  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; 5  2013     1     1      555            600     -5.00      913</span>
<span class="co">#&gt; 6  2013     1     1      558            600     -2.00      753</span>
<span class="co">#&gt; # ... with 1.33e+05 more rows, and 14 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span>
<span class="co">#&gt; #   total_delay &lt;dbl&gt;, prop_delay &lt;dbl&gt;</span></code></pre></div>
<p>Alternatively, consider the delay as relative to the <em>minimum</em> delay for any flight to that destination. Now all non-canceled flights have a proportion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay), arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_delay =</span> <span class="kw">sum</span>(arr_delay <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(arr_delay)),
         <span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay))
<span class="co">#&gt; # A tibble: 133,004 x 21</span>
<span class="co">#&gt; # Groups:   dest [103]</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      542            540      2.00      923</span>
<span class="co">#&gt; 4  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; 5  2013     1     1      555            600     -5.00      913</span>
<span class="co">#&gt; 6  2013     1     1      558            600     -2.00      753</span>
<span class="co">#&gt; # ... with 1.33e+05 more rows, and 14 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span>
<span class="co">#&gt; #   total_delay &lt;dbl&gt;, prop_delay &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-5-2" class="section level3 exercise">
<h3><span class="header-section-number">5.7.5</span> Exercise 5</h3>
<div class="question">
<p>Delays are typically temporally correlated: even once the problem that caused the initial delay has been resolved, later flights are delayed to allow earlier flights to leave. Using <code>lag()</code> explore how the delay of a flight is related to the delay of the immediately preceding flight.</p>
</div>
<div class="answer">
<p>We want to group by day to avoid taking the lag from the previous day. Also, I want to use departure delay, since this mechanism is relevant for departures. Also, I remove missing values both before and after calculating the lag delay. However, it would be interesting to ask the probability or average delay after a cancellation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_delay =</span> <span class="kw">lag</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lag_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> lag_delay)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;gam&#39;</span></code></pre></div>
<p><img src="transform_files/figure-html/unnamed-chunk-56-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-6-2" class="section level3 exercise">
<h3><span class="header-section-number">5.7.6</span> Exercise 6</h3>
<div class="question">
<p>Look at each destination. Can you find flights that are suspiciously fast? (i.e. flights that represent a potential data entry error). Compute the air time a flight relative to the shortest flight to that destination. Which flights were most delayed in the air?</p>
</div>
<div class="answer">
<p>The shorter BOS and PHL flights that are 20 minutes for 30+ minutes flights seem plausible - though maybe entries of +/- a few minutes can easily create large changes. I assume that departure time has a standardized definition, but I’m not sure; if there is some discretion, that could create errors that are small in absolute time, but large in relative time for small flights. The ATL, GSP, and BNA flights look suspicious as they are almost half the time of longer flights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(air_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">med_time =</span> <span class="kw">median</span>(air_time),
         <span class="dt">fast =</span> (air_time <span class="op">-</span><span class="st"> </span>med_time) <span class="op">/</span><span class="st"> </span>med_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(fast) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(air_time, med_time, fast, dep_time, sched_dep_time, arr_time, sched_arr_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">15</span>)
<span class="co">#&gt; Adding missing grouping variables: `dest`</span>
<span class="co">#&gt; # A tibble: 15 x 8</span>
<span class="co">#&gt; # Groups:   dest [9]</span>
<span class="co">#&gt;   dest  air_time med_time   fast dep_time sched_dep_time arr_time</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1 BOS       21.0     38.0 -0.447     1450           1500     1547</span>
<span class="co">#&gt; 2 ATL       65.0    112   -0.420     1709           1700     1923</span>
<span class="co">#&gt; 3 GSP       55.0     92.0 -0.402     2040           2025     2225</span>
<span class="co">#&gt; 4 BOS       23.0     38.0 -0.395     1954           2000     2131</span>
<span class="co">#&gt; 5 BNA       70.0    113   -0.381     1914           1910     2045</span>
<span class="co">#&gt; 6 MSP       93.0    149   -0.376     1558           1513     1745</span>
<span class="co">#&gt; # ... with 9 more rows, and 1 more variable: sched_arr_time &lt;int&gt;</span></code></pre></div>
<p>I could also try a z-score. Though the standard deviation and mean will be affected by large delays.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(air_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">air_time_mean =</span> <span class="kw">mean</span>(air_time),
         <span class="dt">air_time_sd =</span> <span class="kw">sd</span>(air_time),
         <span class="dt">z_score =</span> (air_time <span class="op">-</span><span class="st"> </span>air_time_mean) <span class="op">/</span><span class="st"> </span>air_time_sd) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(z_score) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(z_score, air_time_mean, air_time_sd, air_time, dep_time, sched_dep_time, arr_time, sched_arr_time)
<span class="co">#&gt; Adding missing grouping variables: `dest`</span>
<span class="co">#&gt; # A tibble: 327,346 x 9</span>
<span class="co">#&gt; # Groups:   dest [104]</span>
<span class="co">#&gt;   dest  z_score air_time_mean air_time_sd air_time dep_time sched_dep_time</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span>
<span class="co">#&gt; 1 MSP     -4.90         151         11.8      93.0     1558           1513</span>
<span class="co">#&gt; 2 ATL     -4.88         113          9.81     65.0     1709           1700</span>
<span class="co">#&gt; 3 GSP     -4.72          93.4        8.13     55.0     2040           2025</span>
<span class="co">#&gt; 4 BNA     -4.05         114         11.0      70.0     1914           1910</span>
<span class="co">#&gt; 5 CVG     -3.98          96.0        8.52     62.0     1359           1343</span>
<span class="co">#&gt; 6 BOS     -3.63          39.0        4.95     21.0     1450           1500</span>
<span class="co">#&gt; # ... with 3.273e+05 more rows, and 2 more variables: arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(air_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">air_time_diff =</span> air_time <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(air_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(air_time_diff)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dest, year, month, day, carrier, flight, air_time_diff, air_time, dep_time, arr_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()
<span class="co">#&gt; # A tibble: 6 x 10</span>
<span class="co">#&gt; # Groups:   dest [5]</span>
<span class="co">#&gt;   dest   year month   day carrier flight air_time_diff air_time dep_time</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;int&gt;         &lt;dbl&gt;    &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1 SFO    2013     7    28 DL         841           195      490     1727</span>
<span class="co">#&gt; 2 LAX    2013    11    22 DL         426           165      440     1812</span>
<span class="co">#&gt; 3 EGE    2013     1    28 AA         575           163      382     1806</span>
<span class="co">#&gt; 4 DEN    2013     9    10 UA         745           149      331     1513</span>
<span class="co">#&gt; 5 LAX    2013     7    10 DL          17           147      422     1814</span>
<span class="co">#&gt; 6 LAS    2013    11    22 UA         587           143      399     2142</span>
<span class="co">#&gt; # ... with 1 more variable: arr_time &lt;int&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-7-1" class="section level3 exercise">
<h3><span class="header-section-number">5.7.7</span> Exercise 7</h3>
<div class="question">
<p>Find all destinations that are flown by at least two carriers. Use that information to rank the carriers.</p>
</div>
<div class="answer">
<p>The carrier that flies to the most locations is ExpressJet Airlines (EV). ExpressJet is a regional airline and partner for major airlines, so its one of those that flies small planes to close airports</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest, carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(<span class="dt">sort =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 16 x 2</span>
<span class="co">#&gt; # Groups:   carrier [16]</span>
<span class="co">#&gt;   carrier    nn</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 EV         61</span>
<span class="co">#&gt; 2 9E         49</span>
<span class="co">#&gt; 3 UA         47</span>
<span class="co">#&gt; 4 B6         42</span>
<span class="co">#&gt; 5 DL         40</span>
<span class="co">#&gt; 6 MQ         20</span>
<span class="co">#&gt; # ... with 10 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(airlines, carrier <span class="op">==</span><span class="st"> &quot;EV&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   carrier name                    </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                   </span>
<span class="co">#&gt; 1 EV      ExpressJet Airlines Inc.</span></code></pre></div>
</div>
<!--chapter:end:transform.Rmd-->
</div>
</div>
</div>
<div id="workflow-scripts" class="section level1">
<h1><span class="header-section-number">6</span> Workflow: scripts</h1>
<div id="running-code" class="section level2">
<h2><span class="header-section-number">6.1</span> Running code</h2>
<p>No exercises</p>
</div>
<div id="rstudio-diagnostics" class="section level2">
<h2><span class="header-section-number">6.2</span> RStudio diagnostics</h2>
<p>No exercises</p>
</div>
<div id="practice-1" class="section level2">
<h2><span class="header-section-number">6.3</span> Practice</h2>
<div id="exercise-1-7" class="section level3 exercise">
<h3><span class="header-section-number">6.3.1</span> Exercise 1</h3>
<div class="question">
<p>Go to the RStudio Tips twitter account, <a href="https://twitter.com/rstudiotips" class="uri">https://twitter.com/rstudiotips</a> and find one tip that looks interesting. Practice using it!</p>
</div>
<p>This is by its very nature left to the reader.</p>
</div>
<div id="exercise-2-7" class="section level3 exercise">
<h3><span class="header-section-number">6.3.2</span> Exercise 2</h3>
<div class="question">
<p>What other common mistakes will RStudio diagnostics report? Read <a href="https://support.rstudio.com/hc/en-us/articles/205753617-Code-Diagnostics" class="uri">https://support.rstudio.com/hc/en-us/articles/205753617-Code-Diagnostics</a> to find out.</p>
</div>
<p>The user should read that help page. However, to preview its contents, some other diagnostics for R code include:</p>
<ol style="list-style-type: decimal">
<li>Check for Missing, unmatched, partially matched, and too many arguments to functions</li>
<li>Warn if a variable is not defined</li>
<li>Warn if a variable is defined but not used</li>
<li>Style diagnostics to ensure the code conforms to the <a href="http://adv-r.had.co.nz/Style.html">tidyverse style guide</a>.</li>
</ol>
<!--chapter:end:workflow-scripts.Rmd-->
</div>
</div>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1><span class="header-section-number">7</span> Exploratory Data Analysis</h1>
<div id="introduction-3" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</code></pre></div>
<p>This will also use data from <strong>nycflights13</strong>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</code></pre></div>
</div>
<div id="questions" class="section level2">
<h2><span class="header-section-number">7.2</span> Questions</h2>
</div>
<div id="variation" class="section level2">
<h2><span class="header-section-number">7.3</span> Variation</h2>
<div id="exercise-1-8" class="section level3 exercise">
<h3><span class="header-section-number">7.3.1</span> Exercise 1</h3>
<div class="question">
<p>Explore the distribution of each of the x, y, and z variables in diamonds. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.</p>
</div>
<div class="answer">
<p>In order to make it easier to plot them, I’ll reshape the dataset so that I can use the variables as facets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(x, y, z, id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(variable, value, <span class="op">-</span>id)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>There several noticeable features of the distributions</p>
<ol style="list-style-type: decimal">
<li>They are right skewed, with most diamonds small, but a few very large ones.</li>
<li>There is an outlier in <code>y</code>, and <code>z</code> (see the rug)</li>
<li>All three distributions have a bimodality (perhaps due to some sort of threshold)</li>
</ol>
<p>According to the documentation for <code>diamonds</code>: <code>x</code> is length, <code>y</code> is width, and <code>z</code> is depth. I don’t know if I would have figured that out before; maybe if there was data on the type of cuts.</p>
</div>
</div>
<div id="exercise-2.-7" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Exercise 2.</h3>
<div class="question">
<p>Explore the distribution of price. Do you discover anything unusual or surprising? (Hint: Carefully think about the <code>binwidth</code> and make sure you try a wide range of values.)</p>
</div>
<div class="answer">
<ul>
<li>The price data has many spikes, but I can’t tell what each spike corresponds to. The following plots don’t show much difference in the distributions in the last one or two digits.</li>
<li>There are no diamonds with a price of $1,500</li>
<li>There’s a bulge in the distribution around $7,500.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">filter</span>(diamonds, price <span class="op">&lt;</span><span class="st"> </span><span class="dv">2500</span>), <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>, <span class="dt">center =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">filter</span>(diamonds), <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>, <span class="dt">center =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Distribution of last digit</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ending =</span> price <span class="op">%%</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ending)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">center =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ending =</span> price <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ending)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ending =</span> price <span class="op">%%</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(ending <span class="op">&gt;=</span><span class="st"> </span><span class="dv">500</span>, ending <span class="op">&lt;=</span><span class="st"> </span><span class="dv">800</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ending)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3.-7" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Exercise 3.</h3>
<div class="question">
<p>How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?</p>
</div>
<div class="answer">
<p>There are more than 70 times as many 1 carat diamonds as 0.99 carat diamond.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.99</span>, carat <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(carat)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   carat     n</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 0.990    23</span>
<span class="co">#&gt; 2 1.00   1558</span></code></pre></div>
<p>I don’t know exactly the process behind how carats are measured, but some way or another some diamonds carat values are being “rounded up”, because presumably there is a premium for a 1 carat diamond vs. a 0.99 carat diamond beyond the expected increase in price due to a 0.01 carat increase.</p>
<p>To check this intuition, we’d want to look at the number of diamonds in each carat range to seem if there is an abnormally low number at 0.99 carats, and an abnormally high number at 1 carat.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">filter</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>, carat <span class="op">&lt;=</span><span class="st"> </span><span class="fl">1.1</span>) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">count</span>(carat) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">30</span>)
<span class="co">#&gt; # A tibble: 21 x 2</span>
<span class="co">#&gt;    carat     n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 0.900  1485</span>
<span class="co">#&gt;  2 0.910   570</span>
<span class="co">#&gt;  3 0.920   226</span>
<span class="co">#&gt;  4 0.930   142</span>
<span class="co">#&gt;  5 0.940    59</span>
<span class="co">#&gt;  6 0.950    65</span>
<span class="co">#&gt;  7 0.960   103</span>
<span class="co">#&gt;  8 0.970    59</span>
<span class="co">#&gt;  9 0.980    31</span>
<span class="co">#&gt; 10 0.990    23</span>
<span class="co">#&gt; 11 1.00   1558</span>
<span class="co">#&gt; 12 1.01   2242</span>
<span class="co">#&gt; 13 1.02    883</span>
<span class="co">#&gt; 14 1.03    523</span>
<span class="co">#&gt; 15 1.04    475</span>
<span class="co">#&gt; 16 1.05    361</span>
<span class="co">#&gt; 17 1.06    373</span>
<span class="co">#&gt; 18 1.07    342</span>
<span class="co">#&gt; 19 1.08    246</span>
<span class="co">#&gt; 20 1.09    287</span>
<span class="co">#&gt; 21 1.10    278</span></code></pre></div>
</div>
</div>
<div id="exercise-4-6" class="section level3 exercise">
<h3><span class="header-section-number">7.3.4</span> Exercise 4</h3>
<div class="question">
<p>Compare and contrast <code>coord_cartesian()</code> vs <code>xlim()</code> or <code>ylim()</code> when zooming in on a histogram. What happens if you leave <code>binwidth</code> unset? What happens if you try and zoom so only half a bar shows?</p>
</div>
<div class="answer">
<p><code>coord_cartesian</code> simply zooms in on the area specified by the limits. The calculation of the histogram is unaffected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">5000</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3000</span>))
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>However, the <code>xlim</code> and <code>ylim</code> functions first drop any values outside the limits (the <code>ylim</code> doesn’t matter in this case), then calculates the histogram, and draws the graph with the given limits.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">100</span>, <span class="dv">5000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">3000</span>)
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="co">#&gt; Warning: Removed 14714 rows containing non-finite values (stat_bin).</span>
<span class="co">#&gt; Warning: Removed 5 rows containing missing values (geom_bar).</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">7.4</span> Missing Values</h2>
<div id="exercise-1-9" class="section level3 exercise">
<h3><span class="header-section-number">7.4.1</span> Exercise 1</h3>
<div class="question">
<p>What happens to missing values in a histogram? What happens to missing values in a bar chart? &gt; Why is there a difference?</p>
</div>
<div class="answer">
<p>Missing values are removed when the number of observations in each bin are calculated. See the warning message: <code>Removed 9 rows containing non-finite values (stat_bin)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">ifelse</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>y <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, <span class="ot">NA</span>, y))

<span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(<span class="dt">x =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="co">#&gt; Warning: Removed 9 rows containing non-finite values (stat_bin).</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In <code>geom_bar</code>, <code>NA</code> is treated as another category. The <code>x</code> aesthetic in <code>geom_bar</code> requires a discrete (categorical) variable, and missing values act like another category.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cut =</span> <span class="kw">if_else</span>(<span class="kw">runif</span>(<span class="kw">n</span>()) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="ot">NA_character_</span>, <span class="kw">as.character</span>(cut))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In a histogram, the <code>x</code> aesthetic variable needs to be numeric, and <code>stat_bin</code> groups the observations by ranges into bins. Since the numeric value of the <code>NA</code> observations is unknown, they cannot be placed in a particular bin, and are dropped.</p>
</div>
</div>
<div id="exercise-2-8" class="section level3 exercise">
<h3><span class="header-section-number">7.4.2</span> Exercise 2</h3>
<div class="question">
<p>What does <code>na.rm = TRUE</code> do in <code>mean()</code> and <code>sum()</code>?</p>
</div>
<div class="answer">
<p>This option removes <code>NA</code> values from the vector prior to calculating the mean and sum.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 1</span>
<span class="kw">sum</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
</div>
<div id="covariation" class="section level2">
<h2><span class="header-section-number">7.5</span> Covariation</h2>
<div id="a-categorical-and-continuous-variable" class="section level3">
<h3><span class="header-section-number">7.5.1</span> A categorical and continuous variable</h3>
<div id="exercise-1-10" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.1</span> Exercise 1</h4>
<div class="question">
<p>Use what you’ve learned to improve the visualization of the departure times</p>
</div>
<div class="answer">
<p>of canceled vs. non-canceled flights.</p>
<p>Instead of a <code>freqplot</code> use a box-plot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nycflights13<span class="op">::</span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">canceled =</span> <span class="kw">is.na</span>(dep_time),
    <span class="dt">sched_hour =</span> sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>,
    <span class="dt">sched_min =</span> sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,
    <span class="dt">sched_dep_time =</span> sched_hour <span class="op">+</span><span class="st"> </span>sched_min <span class="op">/</span><span class="st"> </span><span class="dv">60</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> sched_dep_time, <span class="dt">x =</span> canceled))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-9" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.2</span> Exercise 2</h4>
<div class="question">
<p>What variable in the diamonds dataset is most important for predicting the price of a diamond? &gt; How is that variable correlated with Why does the combination of those two relationships lead to lower quality diamonds being more expensive?</p>
</div>
<div class="answer">
<p><strong>TODO</strong> I’m unsure what this question is asking conditional on using only the tools introduced in the book thus far.</p>
</div>
</div>
<div id="exercise-3-7" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.3</span> Exercise 3</h4>
<div class="question">
<p>Install the <strong>ggstance</strong> package, and create a horizontal box plot. How does this compare to using <code>coord_flip()</code>?</p>
</div>
<div class="answer">
<p>Earlier we created a horizontal box plot of the distribution <code>hwy</code> by <code>class</code>, using <code>geom_boxplot</code> and <code>coord_flip</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In this case the output looks the same, but in the aesthetics the <code>x</code> and <code>y</code> are flipped from the previous case.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;ggstance&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;ggstance&#39;</span>
<span class="co">#&gt; The following objects are masked from &#39;package:ggplot2&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     geom_errorbarh, GeomErrorbarh</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxploth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), <span class="dt">x =</span> hwy))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-4-7" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.4</span> Exercise 4</h4>
<div class="question">
<p>One problem with box plots is that they were developed in an era of much smaller datasets and tend to display a prohibitively large number of `<code>outlying values''. One approach to remedy this problem is the letter value plot. Install the **lvplot** package, and try using</code>geom_lv()` to display the distribution of price vs cut. What do you learn?</p>
</div>
<div class="answer">
<p>How do you interpret the plots?</p>
<p>The boxes of the letter-value plot correspond to many more quantiles. They are useful for larger datasets because</p>
<ol style="list-style-type: decimal">
<li>larger datasets can give precise estimates of quantiles beyond the quartiles, and</li>
<li>in expectation, larger datasets should have more outliers (in absolute numbers).</li>
</ol>
<p>The letter-value plot is described in:</p>
<blockquote>
<p>Heike Hofmann, Karen Kafadar, and Hadley Wickham. 2011. “Letter-value plots: Boxplots for large data” <a href="http://vita.had.co.nz/papers/letter-value-plot.pdf" class="uri">http://vita.had.co.nz/papers/letter-value-plot.pdf</a></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;lvplot&quot;</span>)
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_lv</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5-3" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.5</span> Exercise 5</h4>
<div class="question">
<p>Compare and contrast <code>geom_violin()</code> with a faceted <code>geom_histogram()</code>, or a colored <code>geom_freqpoly()</code>. What are the pros and cons of each method?</p>
</div>
<div class="answer">
<p>I produce plots for these three methods below. The <code>geom_freqpoly</code> is better for look-up: meaning that given a price, it is easy to tell which <code>cut</code> has the highest density. However, the overlapping lines makes it difficult to distinguish how the overall distributions relate to each other. The <code>geom_violin</code> and faceted <code>geom_histogram</code> have similar strengths and weaknesses. It is easy to visually distinguish differences in the overall shape of the distributions (skewness, central values, variance, etc). However, since we can’t easily compare the vertical values of the distribution, its difficult to look up which category has the highest density for a given price. All of these methods depend on tuning parameters to determine the level of smoothness of the distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> ..density..)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">colour =</span> cut), <span class="dt">binwidth =</span> <span class="dv">500</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The violin plot was first described in</p>
<blockquote>
<p>Hintze JL, Nelson RD (1998). “Violin Plots: A Box Plot-Density Trace Synergism.” The American Statistician, 52(2), 181–184</p>
</blockquote>
</div>
</div>
<div id="exercise-6-3" class="section level4 exercise">
<h4><span class="header-section-number">7.5.1.6</span> Exercise 6</h4>
<div class="question">
<p>If you have a small dataset, it’s sometimes useful to use <code>geom_jitter()</code> to see the relationship between a continuous and categorical variable. The <strong>ggbeeswarm</strong> package provides a number of methods similar to <code>geom_jitter()</code>. List them and briefly describe what each one does.</p>
</div>
<div class="answer">
<p>There are two methods:</p>
<ul>
<li><code>geom_quasirandom</code> that produces plots that resemble something between jitter and violin. There are several different methods that determine exactly how the random location of the points is generated.</li>
<li><code>geom_beeswarm</code> creates a shape similar to a violin plot, but by offsetting the points.</li>
</ul>
<p>I’ll use the <code>mpg</code> box plot example since these methods display individual points, they are better suited for smaller datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;ggbeeswarm&quot;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy),
                   <span class="dt">method =</span> <span class="st">&quot;tukey&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy),
                   <span class="dt">method =</span> <span class="st">&quot;tukeyDense&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy),
                   <span class="dt">method =</span> <span class="st">&quot;frowney&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy),
                   <span class="dt">method =</span> <span class="st">&quot;smiley&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_beeswarm</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),
                                 <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="two-categorical-variables" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Two categorical variables</h3>
<div id="exercise-1-11" class="section level4 exercise">
<h4><span class="header-section-number">7.5.2.1</span> Exercise 1</h4>
<div class="question">
<p>How could you rescale the count dataset above to more clearly show the distribution of cut within color, or color within cut?</p>
</div>
<div class="answer">
<p>To clearly show the distribution of <code>cut</code> within <code>color</code>, calculate a new variable <code>prop</code> which is the proportion of each cut within a <code>color</code>. This is done using a grouped mutate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> prop)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Similarly, to scale by the distribution of <code>color</code> within <code>cut</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> prop)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>I add <code>limit = c(0, 1)</code> to put the color scale between (0, 1). These are the logical boundaries of proportions. This makes it possible to compare each cell to its actual value, and would improve comparisons across multiple plots. However, it ends up limiting the colors and makes it harder to compare within the dataset. However, using the default limits of the minimum and maximum values makes it easier to compare within the dataset the emphasizing relative differences, but harder to compare across datasets.</p>
</div>
</div>
<div id="exercise-2-10" class="section level4 exercise">
<h4><span class="header-section-number">7.5.2.2</span> Exercise 2</h4>
<div class="question">
<p>Use <code>geom_tile()</code> together with <strong>dplyr</strong> to explore how average flight delays vary by destination and month of year. What makes the plot difficult to read? How could you improve it?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> dest, <span class="dt">fill =</span> dep_delay)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Month&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Destination&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Departure Delay&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-32-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>There are several things that could be done to improve it,</p>
<ul>
<li>sort destinations by a meaningful quantity (distance, number of flights, average delay)</li>
<li>remove missing values</li>
<li>better color scheme (viridis)</li>
</ul>
<p>How to treat missing values is difficult. In this case, missing values correspond to airports which don’t have regular flights (at least one flight each month) from NYC. These are likely smaller airports (with higher variance in their average due to fewer observations).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)
flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dest =</span> <span class="kw">fct_reorder</span>(dest, dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> dest, <span class="dt">fill =</span> dep_delay)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Month&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Destination&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Departure Delay&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3-8" class="section level4 exercise">
<h4><span class="header-section-number">7.5.2.3</span> Exercise 3</h4>
<div class="question">
<p>Why is it slightly better to use <code>aes(x = color, y = cut)</code> rather than <code>aes(x = cut, y = color)</code> in the example above?</p>
</div>
<div class="answer">
<p>It’s usually better to use the categorical variable with a larger number of categories or the longer labels on the y axis. If at all possible, labels should be horizontal because that is easier to read.</p>
<p>However, switching the order doesn’t result in overlapping labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> color, <span class="dt">x =</span> cut)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> n))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-34-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Another justification, for switching the order is that the larger numbers are at the top when <code>x = color</code> and <code>y = cut</code>, and that lowers the cognitive burden of interpreting the plot.</p>
</div>
</div>
</div>
<div id="two-continuous-variables" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Two continuous variables</h3>
<div id="exercise-1-12" class="section level4 exercise">
<h4><span class="header-section-number">7.5.3.1</span> Exercise 1</h4>
<div class="question">
<p>Instead of summarizing the conditional distribution with a box plot, you could use a frequency polygon. What do you need to consider when using <code>cut_width()</code> vs <code>cut_number()</code>? How does that impact a visualization of</p>
</div>
<div class="answer">
<p>the 2d distribution of <code>carat</code> and <code>price</code>?</p>
<p>When using <code>cut_width</code> the number in each bin may be unequal. The distribution of <code>carat</code> is right skewed so there are few diamonds in those bins.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price,
                     <span class="dt">colour =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.3</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /> Plotting the density instead of counts will make the distributions comparable, although the bins with few observations will still be hard to interpret.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price,
                     <span class="dt">y =</span> ..density..,
                     <span class="dt">colour =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.3</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-36-1.png" width="70%" style="display: block; margin: auto;" /> Plotting the density instead of counts will make the distributions comparable, although the bins with few observations will still be hard to interpret.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price,
                     <span class="dt">colour =</span> <span class="kw">cut_number</span>(carat, <span class="dv">10</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-37-1.png" width="70%" style="display: block; margin: auto;" /> Since there are equal numbers in each bin, the plot looks the same if density is used for the y aesthetic (although the values are on a different scale).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price,
                     <span class="dt">y =</span> ..density..,
                     <span class="dt">colour =</span> <span class="kw">cut_number</span>(carat, <span class="dv">10</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-11" class="section level4 exercise">
<h4><span class="header-section-number">7.5.3.2</span> Exercise 2</h4>
<div class="question">
<p>Visualize the distribution of <code>carat</code>, partitioned by <code>price</code>.</p>
</div>
<div class="answer">
<p>With a box plot, partitioning into an 10 bins with the same number of observations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_number</span>(price, <span class="dv">10</span>), <span class="dt">y =</span> carat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Price&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;" /> With a box plot, partitioning into an bins of $2,000 with the width of the box determined by the number of observations. I use <code>boundary = 0</code> to ensure the first bin goes from $0–$2,000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_width</span>(price, <span class="dv">2000</span>, <span class="dt">boundary =</span> <span class="dv">0</span>), <span class="dt">y =</span> carat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">varwidth =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Price&quot;</span>)</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3-9" class="section level4 exercise">
<h4><span class="header-section-number">7.5.3.3</span> Exercise 3</h4>
<div class="question">
<p>How does the price distribution of very large diamonds compare to small diamonds. Is it as you expect, or does it surprise you?</p>
</div>
<div class="answer">
<p>The distribution of very large diamonds is more variable. I’m not surprised, since I had a very weak prior about diamond prices. Ex post, I would reason that above a certain size other factors such as cut, clarity, color play more of a role in the price.</p>
</div>
</div>
<div id="exercise-4-8" class="section level4 exercise">
<h4><span class="header-section-number">7.5.3.4</span> Exercise 4</h4>
<div class="question">
<p>Combine two of the techniques you’ve learned to visualize the combined distribution of cut, carat, and price.</p>
</div>
<div class="answer">
<p>There’s lots of options to try, so readers may prodocue a variety of solutions. Here’s a couple that I tried.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>()
<span class="co">#&gt; Loading required package: methods</span></code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-41-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_number</span>(carat, <span class="dv">5</span>), <span class="dt">y =</span> price, <span class="dt">colour =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-42-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">cut_number</span>(carat, <span class="dv">5</span>), <span class="dt">y =</span> price, <span class="dt">x =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-43-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5-4" class="section level4 exercise">
<h4><span class="header-section-number">7.5.3.5</span> Exercise 5</h4>
<div class="question">
<p>Two dimensional plots reveal outliers that are not visible in one dimensional plots. For example, some points in the plot below have an unusual combination of <code>x</code> and <code>y</code> values, which makes the points outliers even though their <code>x</code> and <code>y</code> values appear normal when examined separately.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span>))</code></pre></div>
<p><img src="EDA_files/figure-html/unnamed-chunk-44-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Why is a scatterplot a better display than a binned plot for this case?</p>
<p>In this case, there is a strong relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. The outliers in this case are not extreme in either <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span>. A binned plot would not reveal these outliers, and may lead us to conclude that the largest value of <span class="math inline">\(x\)</span> was an outlier even though it appears to fit the bivariate pattern well.</p>
<p>The later chapter <a href="#model-basics">Model Basics</a> discusses fitting models to bivariate data and plotting residuals, which would reveal this outliers.</p>
</div>
</div>
</div>
</div>
<div id="patterns-and-models" class="section level2">
<h2><span class="header-section-number">7.6</span> Patterns and models</h2>
<p>No exercises</p>
</div>
<div id="ggplot2-calls" class="section level2">
<h2><span class="header-section-number">7.7</span> ggplot2 calls</h2>
<p>No exercises</p>
</div>
<div id="learning-more" class="section level2">
<h2><span class="header-section-number">7.8</span> Learning more</h2>
<p>No exercises.</p>
<!--chapter:end:EDA.Rmd-->
</div>
</div>
<div id="workflow-projects" class="section level1">
<h1><span class="header-section-number">8</span> Workflow: Projects</h1>
<p>No exercises in this chapter.</p>
<!--chapter:end:workflow-projects.Rmd-->
</div>
<div id="part-wrangle" class="section level1 unnumbered">
<h1>(PART) Wrangle</h1>
<!--chapter:end:wrangle.Rmd-->
</div>
<div id="tibbles" class="section level1">
<h1><span class="header-section-number">9</span> Tibbles</h1>
<div id="introduction-4" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
</div>
<div id="creating-tibbles" class="section level2">
<h2><span class="header-section-number">9.2</span> Creating Tibbles</h2>
<p>No exercises</p>
</div>
<div id="tibbles-vs.data.frame" class="section level2">
<h2><span class="header-section-number">9.3</span> Tibbles vs. data.frame</h2>
<p>No exercises</p>
</div>
<div id="subsetting" class="section level2">
<h2><span class="header-section-number">9.4</span> Subsetting</h2>
<p>No exercises</p>
</div>
<div id="interacting-with-older-code" class="section level2">
<h2><span class="header-section-number">9.5</span> Interacting with older code</h2>
<p>No exercises</p>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">9.6</span> Exercises</h2>
<div id="exercise-1-13" class="section level3 exercise">
<h3><span class="header-section-number">9.6.1</span> Exercise 1</h3>
<div class="question">
<p>How can you tell if an object is a tibble? (Hint: try printing <code>mtcars</code>, which is a regular data frame).</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars
<span class="co">#&gt;                      mpg cyl  disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.62 16.5  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.88 17.0  0  1    4    4</span>
<span class="co">#&gt; Datsun 710          22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.21 19.4  1  0    3    1</span>
<span class="co">#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.44 17.0  0  0    3    2</span>
<span class="co">#&gt; Valiant             18.1   6 225.0 105 2.76 3.46 20.2  1  0    3    1</span>
<span class="co">#&gt; Duster 360          14.3   8 360.0 245 3.21 3.57 15.8  0  0    3    4</span>
<span class="co">#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span>
<span class="co">#&gt; Merc 230            22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span>
<span class="co">#&gt; Merc 280            19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4</span>
<span class="co">#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4</span>
<span class="co">#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3</span>
<span class="co">#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3</span>
<span class="co">#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3</span>
<span class="co">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.25 18.0  0  0    3    4</span>
<span class="co">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.42 17.8  0  0    3    4</span>
<span class="co">#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.34 17.4  0  0    3    4</span>
<span class="co">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span>
<span class="co">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span>
<span class="co">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span>
<span class="co">#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span>
<span class="co">#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.52 16.9  0  0    3    2</span>
<span class="co">#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.44 17.3  0  0    3    2</span>
<span class="co">#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.84 15.4  0  0    3    4</span>
<span class="co">#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.85 17.1  0  0    3    2</span>
<span class="co">#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span>
<span class="co">#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span>
<span class="co">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span>
<span class="co">#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.17 14.5  0  1    5    4</span>
<span class="co">#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</span>
<span class="co">#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.57 14.6  0  1    5    8</span>
<span class="co">#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(mtcars)
<span class="co">#&gt; [1] &quot;data.frame&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(<span class="kw">as_tibble</span>(mtcars))
<span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></code></pre></div>
<p>Tibbles will only print out a limited number of rows and show the class on top of each column. Additionally, tibbles have class <code>&quot;tbl_df&quot;</code> and <code>&quot;tbl_&quot;</code> in addition to <code>&quot;data.frame&quot;</code>.</p>
</div>
</div>
<div id="exercise-2-12" class="section level3 exercise">
<h3><span class="header-section-number">9.6.2</span> Exercise 2</h3>
<div class="question">
<p>Compare and contrast the following operations on a <code>data.frame</code> and equivalent tibble. What is different? Why might the default data frame behaviors cause you frustration?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">xyz =</span> <span class="st">&quot;a&quot;</span>)
df<span class="op">$</span>x
<span class="co">#&gt; [1] a</span>
<span class="co">#&gt; Levels: a</span>
df[, <span class="st">&quot;xyz&quot;</span>]
<span class="co">#&gt; [1] a</span>
<span class="co">#&gt; Levels: a</span>
df[, <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>)]
<span class="co">#&gt;   abc xyz</span>
<span class="co">#&gt; 1   1   a</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tbl &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(df)
tbl<span class="op">$</span>x
<span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;x&#39;.</span>
<span class="co">#&gt; NULL</span>
tbl[, <span class="st">&quot;xyz&quot;</span>]
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   xyz  </span>
<span class="co">#&gt;   &lt;fct&gt;</span>
<span class="co">#&gt; 1 a</span>
tbl[, <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>)]
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;     abc xyz  </span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt; 1  1.00 a</span></code></pre></div>
<p>Using <code>$</code> a data.frame will partially complete the column. So even though we wrote <code>df$x</code> it returned <code>df$xyz</code>. This saves a few keystrokes, but can result in accidentally using a different variable than you thought you were using.</p>
<p>With data.frames, with <code>[</code> the type of object that is returned differs on the number of columns. If it is one column, it won’t return a data.frame, but instead will return a vector. With more than one column, then it will return a data.frame. This is fine if you know what you are passing in, but suppose you did <code>df[ , vars]</code> where <code>vars</code> was a variable. Then you what that code does depends on <code>length(vars)</code> and you’d have to write code to account for those situations or risk bugs.</p>
</div>
</div>
<div id="exercise-3-10" class="section level3 exercise">
<h3><span class="header-section-number">9.6.3</span> Exercise 3</h3>
<div class="question">
<p>If you have the name of a variable stored in an object, e.g. <code>var &lt;- &quot;mpg&quot;</code>, how can you extract the reference variable from a tibble?</p>
</div>
<div class="answer">
<p>You can use the double bracket, like <code>df[[var]]</code>. You cannot use the dollar sign, because <code>df$var</code> would look for a column named <code>var</code>.</p>
</div>
</div>
<div id="exercise-4-9" class="section level3 exercise">
<h3><span class="header-section-number">9.6.4</span> Exercise 4</h3>
<div class="question">
<p>Practice referring to non-syntactic names in the following data frame by:</p>
<ol style="list-style-type: decimal">
<li>Extracting the variable called 1.</li>
<li>Plotting a scatterplot of 1 vs 2.</li>
<li>Creating a new column called 3 which is 2 divided by 1.</li>
<li>Renaming the columns to one, two and three.</li>
</ol>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,
  <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">1</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span>))
)</code></pre></div>
<p>Extract the variable called 1:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying[[<span class="st">&quot;1&quot;</span>]]
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span>
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></code></pre></div>
<p>A scatter plot of <code>1</code> vs. <code>2</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(annoying, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="tibble_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>A new column <code>3</code> with is <code>2</code> divided by <code>1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying[[<span class="st">&quot;3&quot;</span>]] &lt;-<span class="st"> </span>annoying<span class="op">$</span><span class="st">`</span><span class="dt">2</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span>annoying<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span></code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying[[<span class="st">&quot;3&quot;</span>]] &lt;-<span class="st"> </span>annoying[[<span class="st">&quot;2&quot;</span>]] <span class="op">/</span><span class="st"> </span>annoying[[<span class="st">&quot;1&quot;</span>]]</code></pre></div>
<p>Renaming the columns to <code>one</code>, <code>two</code>, and <code>three</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying &lt;-<span class="st"> </span><span class="kw">rename</span>(annoying, <span class="dt">one =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">two =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="dt">three =</span> <span class="st">`</span><span class="dt">3</span><span class="st">`</span>)
<span class="kw">glimpse</span>(annoying)
<span class="co">#&gt; Observations: 10</span>
<span class="co">#&gt; Variables: 3</span>
<span class="co">#&gt; $ one   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span>
<span class="co">#&gt; $ two   &lt;dbl&gt; 0.60, 4.26, 3.56, 7.99, 10.62, 13.15, 12.18, 15.75, 17.7...</span>
<span class="co">#&gt; $ three &lt;dbl&gt; 0.60, 2.13, 1.19, 2.00, 2.12, 2.19, 1.74, 1.97, 1.97, 1.97</span></code></pre></div>
</div>
</div>
<div id="exercise-5-5" class="section level3 exercise">
<h3><span class="header-section-number">9.6.5</span> Exercise 5</h3>
<div class="question">
<p>What does <code>tibble::enframe()</code> do? When might you use it?</p>
</div>
<div class="answer">
<p>It converts named vectors to a data frame with names and values</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?tibble<span class="op">::</span>enframe</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">enframe</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>))
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   name  value</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 a      1.00</span>
<span class="co">#&gt; 2 b      2.00</span>
<span class="co">#&gt; 3 c      3.00</span></code></pre></div>
</div>
</div>
<div id="exercise-6-4" class="section level3 exercise">
<h3><span class="header-section-number">9.6.6</span> Exercise 6</h3>
<div class="question">
<p>What option controls how many additional column names are printed at the footer of a tibble?</p>
</div>
<div class="answer">
<p>The print function for tibbles is in <code>print.tbl_df</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?print.tbl_df</code></pre></div>
<p>The option <code>n_extra</code> determines the number of extra columns to print information for.</p>
</div>
<!--chapter:end:tibble.Rmd-->
</div>
</div>
</div>
<div id="data-import" class="section level1">
<h1><span class="header-section-number">10</span> Data Import</h1>
<div id="introduction-5" class="section level2">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
</div>
<div id="getting-started" class="section level2">
<h2><span class="header-section-number">10.2</span> Getting started</h2>
<div id="exercise-1-14" class="section level3 exercise">
<h3><span class="header-section-number">10.2.1</span> Exercise 1</h3>
<div class="question">
<p>What function would you use to read a file where fields were separated with</p>
</div>
<div class="answer">
<p>“|”?</p>
<p>I’d use <code>read_delim</code> with <code>delim=&quot;|&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_delim</span>(file, <span class="dt">delim =</span> <span class="st">&quot;|&quot;</span>)</code></pre></div>
</div>
</div>
<div id="exercise-2-13" class="section level3 exercise">
<h3><span class="header-section-number">10.2.2</span> Exercise 2</h3>
<div class="question">
<p>Apart from <code>file</code>, <code>skip</code>, and <code>comment</code>, what other arguments do <code>read_csv()</code> and <code>read_tsv()</code> have in common?</p>
</div>
<div class="answer">
<p>They have the following arguments in common:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">union</span>(<span class="kw">names</span>(<span class="kw">formals</span>(read_csv)), <span class="kw">names</span>(<span class="kw">formals</span>(read_tsv)))
<span class="co">#&gt;  [1] &quot;file&quot;      &quot;col_names&quot; &quot;col_types&quot; &quot;locale&quot;    &quot;na&quot;       </span>
<span class="co">#&gt;  [6] &quot;quoted_na&quot; &quot;quote&quot;     &quot;comment&quot;   &quot;trim_ws&quot;   &quot;skip&quot;     </span>
<span class="co">#&gt; [11] &quot;n_max&quot;     &quot;guess_max&quot; &quot;progress&quot;</span></code></pre></div>
<ul>
<li><code>col_names</code> and <code>col_types</code> are used to specify the column names and how to parse the columns</li>
<li><code>locale</code> is important for determining things like the encoding and whether “.” or “,” is used as a decimal mark.</li>
<li><code>na</code> and <code>quoted_na</code> control which strings are treated as missing values when parsing vectors</li>
<li><code>trim_ws</code> trims whitespace before and after cells before parsing</li>
<li><code>n_max</code> sets how many rows to read</li>
<li><code>guess_max</code> sets how many rows to use when guessing the column type</li>
<li><code>progress</code> determines whether a progress bar is shown.</li>
</ul>
</div>
</div>
<div id="exercise-3-11" class="section level3 exercise">
<h3><span class="header-section-number">10.2.3</span> Exercise 3</h3>
<div class="question">
<p>What are the most important arguments to <code>read_fwf()</code>?</p>
</div>
<div class="answer">
<p>The most important argument to <code>read_fwf</code> which reads “fixed-width formats”, is <code>col_positions</code> which tells the function where data columns begin and end.</p>
</div>
</div>
<div id="exercise-4-10" class="section level3 exercise">
<h3><span class="header-section-number">10.2.4</span> Exercise 4</h3>
<div class="question">
<p>Sometimes strings in a CSV file contain commas. To prevent them from causing problems they need to be surrounded by a quoting character, like <code>&quot;</code> or <code>'</code>. By convention, <code>read_csv()</code> assumes that the quoting character will be <code>&quot;</code>, and if you want to change it you’ll need to use <code>read_delim()</code> instead. What arguments do you need to specify to read the following text into a data frame?</p>
</div>
<div class="answer">
<pre><code>&quot;x,y\n1,&#39;a,b&#39;&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> &quot;x,y</span><span class="ch">\n</span><span class="st">1,&#39;a,b&#39;&quot;</span>
<span class="kw">read_delim</span>(x, <span class="st">&quot;,&quot;</span>, <span class="dt">quote =</span> <span class="st">&quot;&#39;&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       x y    </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1     1 a,b</span></code></pre></div>
</div>
</div>
<div id="exercise-6-5" class="section level3 exercise">
<h3><span class="header-section-number">10.2.5</span> Exercise 6</h3>
<div class="question">
<p>Identify what is wrong with each of the following inline CSV files. What happens when you run the code?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2,3</span><span class="ch">\n</span><span class="st">4,5,6&quot;</span>)
<span class="co">#&gt; Warning: 2 parsing failures.</span>
<span class="co">#&gt; row # A tibble: 2 x 5 col     row col   expected  actual    file         expected   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;        actual 1     1 &lt;NA&gt;  2 columns 3 columns literal data file 2     2 &lt;NA&gt;  2 columns 3 columns literal data</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;       a     b</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     2</span>
<span class="co">#&gt; 2     4     5</span></code></pre></div>
<p>Only two columns are specified in the header “a” and “b”, but the rows have three columns, so the last column in dropped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;a,b,c</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">1,2,3,4&quot;</span>)
<span class="co">#&gt; Warning: 2 parsing failures.</span>
<span class="co">#&gt; row # A tibble: 2 x 5 col     row col   expected  actual    file         expected   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;        actual 1     1 &lt;NA&gt;  3 columns 2 columns literal data file 2     2 &lt;NA&gt;  3 columns 4 columns literal data</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;       a     b     c</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     2    NA</span>
<span class="co">#&gt; 2     1     2     3</span></code></pre></div>
<p>The numbers of columns in the data do not match the number of columns in the header (three). In row one, there are only two values, so column <code>c</code> is set to missing. In row two, there is an extra value, and that value is dropped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n\&quot;</span><span class="st">1&quot;</span>)
<span class="co">#&gt; Warning: 2 parsing failures.</span>
<span class="co">#&gt; row # A tibble: 2 x 5 col     row col   expected                     actual    file         expected   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                        &lt;chr&gt;     &lt;chr&gt;        actual 1     1 a     closing quote at end of file &quot;&quot;        literal data file 2     1 &lt;NA&gt;  2 columns                    1 columns literal data</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       a b    </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1     1 &lt;NA&gt;</span></code></pre></div>
<p>It’s not clear what the intent was here. The opening quote <code>\\&quot;1</code> is dropped because it is not closed, and <code>a</code> is treated as an integer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">a,b&quot;</span>)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   a     b    </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 1     2    </span>
<span class="co">#&gt; 2 a     b</span></code></pre></div>
<p>Both “a” and “b” are treated as character vectors since they contain non-numeric strings. This may have been intentional, or the author may have intended the values of the columns to be “1,2” and “a,b”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;a;b</span><span class="ch">\n</span><span class="st">1;3&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   `a;b`</span>
<span class="co">#&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1 1;3</span></code></pre></div>
<p>The values are separated by “;” rather than “,”. Use <code>read_csv2</code> instead:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv2</span>(<span class="st">&quot;a;b</span><span class="ch">\n</span><span class="st">1;3&quot;</span>)
<span class="co">#&gt; Using &#39;,&#39; as decimal and &#39;.&#39; as grouping mark. Use read_delim() for more control.</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       a     b</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     3</span></code></pre></div>
</div>
</div>
</div>
<div id="parsing-a-vector" class="section level2">
<h2><span class="header-section-number">10.3</span> Parsing a vector</h2>
<div id="exercise-1-15" class="section level3 exercise">
<h3><span class="header-section-number">10.3.1</span> Exercise 1</h3>
<div class="question">
<p>What are the most important arguments to <code>locale()</code>?</p>
</div>
<div class="answer">
<p>The locale broadly controls the following:</p>
<ul>
<li>date and time formats: <code>date_names</code>, <code>date_format</code>, and <code>time_format</code></li>
<li>time_zone: <code>tz</code></li>
<li>numbers: <code>decimal_mark</code>, <code>grouping_mark</code></li>
<li>encoding: <code>encoding</code></li>
</ul>
</div>
</div>
<div id="exercise-2-14" class="section level3 exercise">
<h3><span class="header-section-number">10.3.2</span> Exercise 2</h3>
<div class="question">
<p>What happens if you try and set <code>decimal_mark</code> and <code>grouping_mark</code> to the same character? What happens to the default value of <code>grouping_mark</code> when you set <code>decimal_mark</code> to <code>&quot;,&quot;</code>? What happens to the default value of <code>decimal_mark</code> when you set the <code>grouping_mark</code> to <code>&quot;.&quot;</code>?</p>
</div>
<div class="answer">
<p>If the decimal and grouping marks are set to the same character, <code>locale</code> throws an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">locale</span>(<span class="dt">decimal_mark =</span> <span class="st">&quot;.&quot;</span>, <span class="dt">grouping_mark =</span> <span class="st">&quot;.&quot;</span>)
<span class="co">#&gt; Error: `decimal_mark` and `grouping_mark` must be different</span></code></pre></div>
<p>If the <code>decimal_mark</code> is set to the comma “<code>,&quot;</code>, then the grouping mark is set to the period <code>&quot;.&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">locale</span>(<span class="dt">decimal_mark =</span> <span class="st">&quot;,&quot;</span>)
<span class="co">#&gt; &lt;locale&gt;</span>
<span class="co">#&gt; Numbers:  123.456,78</span>
<span class="co">#&gt; Formats:  %AD / %AT</span>
<span class="co">#&gt; Timezone: UTC</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; &lt;date_names&gt;</span>
<span class="co">#&gt; Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),</span>
<span class="co">#&gt;         Thursday (Thu), Friday (Fri), Saturday (Sat)</span>
<span class="co">#&gt; Months: January (Jan), February (Feb), March (Mar), April (Apr), May</span>
<span class="co">#&gt;         (May), June (Jun), July (Jul), August (Aug), September</span>
<span class="co">#&gt;         (Sep), October (Oct), November (Nov), December (Dec)</span>
<span class="co">#&gt; AM/PM:  AM/PM</span></code></pre></div>
<p>If the grouping mark is set to a period, then the decimal mark is set to a comma</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">locale</span>(<span class="dt">grouping_mark =</span> <span class="st">&quot;,&quot;</span>)
<span class="co">#&gt; &lt;locale&gt;</span>
<span class="co">#&gt; Numbers:  123,456.78</span>
<span class="co">#&gt; Formats:  %AD / %AT</span>
<span class="co">#&gt; Timezone: UTC</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; &lt;date_names&gt;</span>
<span class="co">#&gt; Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),</span>
<span class="co">#&gt;         Thursday (Thu), Friday (Fri), Saturday (Sat)</span>
<span class="co">#&gt; Months: January (Jan), February (Feb), March (Mar), April (Apr), May</span>
<span class="co">#&gt;         (May), June (Jun), July (Jul), August (Aug), September</span>
<span class="co">#&gt;         (Sep), October (Oct), November (Nov), December (Dec)</span>
<span class="co">#&gt; AM/PM:  AM/PM</span></code></pre></div>
</div>
</div>
<div id="exercise-3-12" class="section level3 exercise">
<h3><span class="header-section-number">10.3.3</span> Exercise 3</h3>
<div class="question">
<p>I didn’t discuss the <code>date_format</code> and <code>time_format</code> options to <code>locale()</code>. What do they do? Construct an example that shows when they might be useful.</p>
</div>
<div class="answer">
<p>They provide default date and time formats. The <a href="https://cran.r-project.org/web/packages/readr/vignettes/locales.html">readr vignette</a> discusses using these to parse dates: since dates can include languages specific weekday and month names, and different conventions for specifying AM/PM</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">locale</span>()
<span class="co">#&gt; &lt;locale&gt;</span>
<span class="co">#&gt; Numbers:  123,456.78</span>
<span class="co">#&gt; Formats:  %AD / %AT</span>
<span class="co">#&gt; Timezone: UTC</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; &lt;date_names&gt;</span>
<span class="co">#&gt; Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),</span>
<span class="co">#&gt;         Thursday (Thu), Friday (Fri), Saturday (Sat)</span>
<span class="co">#&gt; Months: January (Jan), February (Feb), March (Mar), April (Apr), May</span>
<span class="co">#&gt;         (May), June (Jun), July (Jul), August (Aug), September</span>
<span class="co">#&gt;         (Sep), October (Oct), November (Nov), December (Dec)</span>
<span class="co">#&gt; AM/PM:  AM/PM</span></code></pre></div>
<p>Examples from the <strong>readr</strong> vignette of parsing French dates</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_date</span>(<span class="st">&quot;1 janvier 2015&quot;</span>, <span class="st">&quot;%d %B %Y&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="st">&quot;fr&quot;</span>))
<span class="co">#&gt; [1] &quot;2015-01-01&quot;</span>
<span class="kw">parse_date</span>(<span class="st">&quot;14 oct. 1979&quot;</span>, <span class="st">&quot;%d %b %Y&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="st">&quot;fr&quot;</span>))
<span class="co">#&gt; [1] &quot;1979-10-14&quot;</span></code></pre></div>
<p>Apparently the time format is not used for anything, but the date format is used for guessing column types.</p>
</div>
</div>
<div id="exercise-4-11" class="section level3 exercise">
<h3><span class="header-section-number">10.3.4</span> Exercise 4</h3>
<div class="question">
<p>If you live outside the US, create a new locale object that encapsulates the settings for the types of file you read most commonly.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?locale</code></pre></div>
</div>
</div>
<div id="exercise-5-6" class="section level3 exercise">
<h3><span class="header-section-number">10.3.5</span> Exercise 5</h3>
<div class="question">
<p>What’s the difference between <code>read_csv()</code> and <code>read_csv2()</code>?</p>
</div>
<div class="answer">
<p>The delimiter. The function <code>read_csv</code> uses a comma, while <code>read_csv2</code> uses a semi-colon (<code>;</code>). Using a semi-colon is useful when commas are used as the decimal point (as in Europe).</p>
</div>
</div>
<div id="exercise-6-6" class="section level3 exercise">
<h3><span class="header-section-number">10.3.6</span> Exercise 6</h3>
<div class="question">
<p>What are the most common encodings used in Europe? What are the most common encodings used in Asia? Do some googling to find out.</p>
</div>
<div class="answer">
<p>UTF-8 is standard now, and ASCII has been around forever.</p>
<p>For the European languages, there are separate encodings for Romance languages and Eastern European languages using Latin script, Cyrillic, Greek, Hebrew, Turkish: usually with separate ISO and Windows encoding standards. There is also Mac OS Roman.</p>
<p>For Asian languages Arabic and Vietnamese have ISO and Windows standards. The other major Asian scripts have their own:</p>
<ul>
<li>Japanese: JIS X 0208, Shift JIS, ISO-2022-JP</li>
<li>Chinese: GB 2312, GBK, GB 18030</li>
<li>Korean: KS X 1001, EUC-KR, ISO-2022-KR</li>
</ul>
<p>The list in the documentation for <code>stringi::stri_enc_detect</code> is pretty good since it supports the most common encodings:</p>
<ul>
<li>Western European Latin script languages: ISO-8859-1, Windows-1250 (also CP-1250 for code-point)</li>
<li>Eastern European Latin script languages: ISO-8859-2, Windows-1252</li>
<li>Greek: ISO-8859-7</li>
<li>Turkish: ISO-8859-9, Windows-1254</li>
<li>Hebrew: ISO-8859-8, IBM424, Windows 1255</li>
<li>Russian: Windows 1251</li>
<li>Japanese: Shift JIS, ISO-2022-JP, EUC-JP</li>
<li>Korean: ISO-2022-KR, EUC-KR</li>
<li>Chinese: GB18030, ISO-2022-CN (Simplified), Big5 (Traditional)</li>
<li>Arabic: ISO-8859-6, IBM420, Windows 1256</li>
</ul>
<p>For more information on character encodings:</p>
<ul>
<li>The Wikipedia page <a href="https://en.wikipedia.org/wiki/Character_encoding">Character encoding</a>, has a good list of encodings.</li>
<li>Unicode <a href="http://cldr.unicode.org/">CLDR</a> project</li>
<li><a href="http://stackoverflow.com/questions/8509339/what-is-the-most-common-encoding-of-each-language">What is the most common encoding of each language</a> (Stack Overflow)</li>
<li>“What Every Programmer Absolutely, Positively Needs To Know About Encodings And Character Sets To Work With Text”, <a href="http://kunststube.net/encoding/" class="uri">http://kunststube.net/encoding/</a>.</li>
</ul>
<p>Some program that identify the encoding of text are:</p>
<ul>
<li>In R see <code>readr::guess_encoding</code> and the <strong>stringi</strong> package with <code>str_enc_detect</code></li>
<li><a href="https://en.wikipedia.org/wiki/Iconv">iconv</a></li>
<li><a href="https://github.com/chardet/chardet">chardet</a> (Python)</li>
</ul>
</div>
</div>
<div id="exercise-7-2" class="section level3 exercise">
<h3><span class="header-section-number">10.3.7</span> Exercise 7</h3>
<div class="question">
<p>Generate the correct format string to parse each of the following dates and times:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> &quot;January 1, 2010&quot;</span>
d2 &lt;-<span class="st"> &quot;2015-Mar-07&quot;</span>
d3 &lt;-<span class="st"> &quot;06-Jun-2017&quot;</span>
d4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;August 19 (2015)&quot;</span>, <span class="st">&quot;July 1 (2015)&quot;</span>)
d5 &lt;-<span class="st"> &quot;12/30/14&quot;</span> <span class="co"># Dec 30, 2014</span>
t1 &lt;-<span class="st"> &quot;1705&quot;</span>
t2 &lt;-<span class="st"> &quot;11:15:10.12 PM&quot;</span></code></pre></div>
<p>The correct formats are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_date</span>(d1, <span class="st">&quot;%B %d, %Y&quot;</span>)
<span class="co">#&gt; [1] &quot;2010-01-01&quot;</span>
<span class="kw">parse_date</span>(d2, <span class="st">&quot;%Y-%b-%d&quot;</span>)
<span class="co">#&gt; [1] &quot;2015-03-07&quot;</span>
<span class="kw">parse_date</span>(d3, <span class="st">&quot;%d-%b-%Y&quot;</span>)
<span class="co">#&gt; [1] &quot;2017-06-06&quot;</span>
<span class="kw">parse_date</span>(d4, <span class="st">&quot;%B %d (%Y)&quot;</span>)
<span class="co">#&gt; [1] &quot;2015-08-19&quot; &quot;2015-07-01&quot;</span>
<span class="kw">parse_date</span>(d5, <span class="st">&quot;%m/%d/%y&quot;</span>)
<span class="co">#&gt; [1] &quot;2014-12-30&quot;</span>
<span class="kw">parse_time</span>(t1, <span class="st">&quot;%H%M&quot;</span>)
<span class="co">#&gt; 17:05:00</span></code></pre></div>
<p>The time <code>t2</code> uses real seconds,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_time</span>(t2, <span class="st">&quot;%H:%M:%OS %p&quot;</span>)
<span class="co">#&gt; 23:15:10.12</span></code></pre></div>
</div>
</div>
</div>
<div id="parsing-a-file" class="section level2">
<h2><span class="header-section-number">10.4</span> Parsing a file</h2>
<p>No exercises</p>
</div>
<div id="writing-to-a-file" class="section level2">
<h2><span class="header-section-number">10.5</span> Writing to a file</h2>
<p>No exercises</p>
</div>
<div id="other-types-of-data" class="section level2">
<h2><span class="header-section-number">10.6</span> Other Types of Data</h2>
<p>No code</p>
<!--chapter:end:import.Rmd-->
</div>
</div>
<div id="tidy-data" class="section level1">
<h1><span class="header-section-number">11</span> Tidy Data</h1>
<div id="introduction-6" class="section level2">
<h2><span class="header-section-number">11.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
</div>
<div id="tidy-data-1" class="section level2">
<h2><span class="header-section-number">11.2</span> Tidy Data</h2>
<div id="exercise-1-16" class="section level3 exercise">
<h3><span class="header-section-number">11.2.1</span> Exercise 1</h3>
<div class="question">
<p>Using prose, describe how the variables and observations are organized in each of the sample tables.</p>
</div>
<div class="answer">
<p>In <code>table1</code> each row is a (country, year) with variables <code>cases</code> and <code>population</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table1
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   country      year  cases population</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span>
<span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span>
<span class="co">#&gt; 3 Brazil       1999  37737  172006362</span>
<span class="co">#&gt; 4 Brazil       2000  80488  174504898</span>
<span class="co">#&gt; 5 China        1999 212258 1272915272</span>
<span class="co">#&gt; 6 China        2000 213766 1280428583</span></code></pre></div>
<p>In <code>table2</code>, each row is country, year , variable (“cases”, “population”) combination, and there is a <code>count</code> variable with the numeric value of the variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table2
<span class="co">#&gt; # A tibble: 12 x 4</span>
<span class="co">#&gt;   country      year type           count</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1999 cases            745</span>
<span class="co">#&gt; 2 Afghanistan  1999 population  19987071</span>
<span class="co">#&gt; 3 Afghanistan  2000 cases           2666</span>
<span class="co">#&gt; 4 Afghanistan  2000 population  20595360</span>
<span class="co">#&gt; 5 Brazil       1999 cases          37737</span>
<span class="co">#&gt; 6 Brazil       1999 population 172006362</span>
<span class="co">#&gt; # ... with 6 more rows</span></code></pre></div>
<p>In <code>table3</code>, each row is a (country, year) combination with the column <code>rate</code> having the rate of cases to population as a character string in the format <code>&quot;cases/rate&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table3
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   country      year rate             </span>
<span class="co">#&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            </span>
<span class="co">#&gt; 1 Afghanistan  1999 745/19987071     </span>
<span class="co">#&gt; 2 Afghanistan  2000 2666/20595360    </span>
<span class="co">#&gt; 3 Brazil       1999 37737/172006362  </span>
<span class="co">#&gt; 4 Brazil       2000 80488/174504898  </span>
<span class="co">#&gt; 5 China        1999 212258/1272915272</span>
<span class="co">#&gt; 6 China        2000 213766/1280428583</span></code></pre></div>
<p>Table 4 is split into two tables, one table for each variable: <code>table4a</code> is the table for cases, while <code>table4b</code> is the table for population. Within each table, each row is a country, each column is a year, and the cells are the value of the variable for the table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table4a
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   country     `1999` `2000`</span>
<span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan    745   2666</span>
<span class="co">#&gt; 2 Brazil       37737  80488</span>
<span class="co">#&gt; 3 China       212258 213766</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table4b
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   country         `1999`     `2000`</span>
<span class="co">#&gt; * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan   19987071   20595360</span>
<span class="co">#&gt; 2 Brazil       172006362  174504898</span>
<span class="co">#&gt; 3 China       1272915272 1280428583</span></code></pre></div>
</div>
</div>
<div id="exercise-2-15" class="section level3 exercise">
<h3><span class="header-section-number">11.2.2</span> Exercise 2</h3>
<div class="question">
<p>Compute the <code>rate</code> for <code>table2</code>, and <code>table4a</code> + <code>table4b</code>. You will need to perform four operations:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Extract the number of TB cases per country per year.</li>
<li>Extract the matching population per country per year.</li>
<li>Divide cases by population, and multiply by 10000.</li>
<li>Store back in the appropriate place.</li>
</ol>
</blockquote>
<p>Which representation is easiest to work with? Which is hardest? Why?</p>
<p>Without using the join functions introduced in Ch 12:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb2_cases &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>)[[<span class="st">&quot;count&quot;</span>]]
tb2_country &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>)[[<span class="st">&quot;country&quot;</span>]]
tb2_year &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>)[[<span class="st">&quot;year&quot;</span>]]
tb2_population &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;population&quot;</span>)[[<span class="st">&quot;count&quot;</span>]]
table2_clean &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">country =</span> tb2_country,
       <span class="dt">year =</span> tb2_year,
       <span class="dt">rate =</span> tb2_cases <span class="op">/</span><span class="st"> </span>tb2_population)
table2_clean
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   country      year      rate</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1999 0.0000373</span>
<span class="co">#&gt; 2 Afghanistan  2000 0.000129 </span>
<span class="co">#&gt; 3 Brazil       1999 0.000219 </span>
<span class="co">#&gt; 4 Brazil       2000 0.000461 </span>
<span class="co">#&gt; 5 China        1999 0.000167 </span>
<span class="co">#&gt; 6 China        2000 0.000167</span></code></pre></div>
<p>Note, that this assumes that all observations are sorted so that each country, year will have the observation for cases followed by population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">country =</span> table4a[[<span class="st">&quot;country&quot;</span>]],
       <span class="st">`</span><span class="dt">1999</span><span class="st">`</span> =<span class="st"> </span>table4a[[<span class="st">&quot;1999&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;1999&quot;</span>]],
       <span class="st">`</span><span class="dt">2000</span><span class="st">`</span> =<span class="st"> </span>table4b[[<span class="st">&quot;2000&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;2000&quot;</span>]])
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   country        `1999` `2000`</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Afghanistan 0.0000373   1.00</span>
<span class="co">#&gt; 2 Brazil      0.000219    1.00</span>
<span class="co">#&gt; 3 China       0.000167    1.00</span></code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">country =</span> <span class="kw">rep</span>(table4a[[<span class="st">&quot;country&quot;</span>]], <span class="dv">2</span>),
       <span class="dt">year =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1999</span>, <span class="dv">2000</span>), <span class="dt">each =</span> <span class="kw">nrow</span>(table4a)),
       <span class="st">`</span><span class="dt">rate</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(table4a[[<span class="st">&quot;1999&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;1999&quot;</span>]],
                  table4b[[<span class="st">&quot;2000&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;2000&quot;</span>]]))
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   country      year      rate</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1999 0.0000373</span>
<span class="co">#&gt; 2 Brazil       1999 0.000219 </span>
<span class="co">#&gt; 3 China        1999 0.000167 </span>
<span class="co">#&gt; 4 Afghanistan  2000 1.00     </span>
<span class="co">#&gt; 5 Brazil       2000 1.00     </span>
<span class="co">#&gt; 6 China        2000 1.00</span></code></pre></div>
</div>
</div>
<div id="exercise-3-13" class="section level3 exercise">
<h3><span class="header-section-number">11.2.3</span> Exercise 3</h3>
<div class="question">
<p>Recreate the plot showing change in cases over time using <code>table2</code> instead of <code>table1</code>. What do you need to do first?</p>
</div>
<div class="answer">
<p>First, I needed to filter the tibble to only include those rows that represented the “cases” variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, count)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">colour =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> country))</code></pre></div>
<p><img src="tidy_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="spreading-and-gathering" class="section level2">
<h2><span class="header-section-number">11.3</span> Spreading and Gathering</h2>
<p>This code is reproduced from the chapter because it is needed by the exercises:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy4a &lt;-<span class="st"> </span>table4a <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)
tidy4b &lt;-<span class="st"> </span>table4b <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</code></pre></div>
<div id="exercise-1-17" class="section level3 exercise">
<h3><span class="header-section-number">11.3.1</span> Exercise 1</h3>
<div class="question">
<p>Why are <code>gather()</code> and <code>spread()</code> not perfectly symmetrical? Carefully consider the following example:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),
  <span class="dt">half  =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,     <span class="dv">1</span>,    <span class="dv">2</span>),
  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>)
)
stocks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;return&quot;</span>, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;    half year  return</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1  1.00 2015   1.88 </span>
<span class="co">#&gt; 2  2.00 2015   0.590</span>
<span class="co">#&gt; 3  1.00 2016   0.920</span>
<span class="co">#&gt; 4  2.00 2016   0.170</span></code></pre></div>
<p>The functions <code>spread</code> and <code>gather</code> are not perfectly symmetrical because column type information is not transferred between them. In the original table the column <code>year</code> was numeric, but after running <code>spread()</code> and <code>gather()</code> it is a character vector. This is because variable names are always converted to a character vector by <code>gather()</code>.</p>
<p>The <code>convert</code> argument tries to convert character vectors to the appropriate type. In the background this uses the <code>type.convert</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stocks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;return&quot;</span>, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;    half  year return</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1  1.00  2015  1.88 </span>
<span class="co">#&gt; 2  2.00  2015  0.590</span>
<span class="co">#&gt; 3  1.00  2016  0.920</span>
<span class="co">#&gt; 4  2.00  2016  0.170</span></code></pre></div>
</div>
</div>
<div id="exercise-2-16" class="section level3 exercise">
<h3><span class="header-section-number">11.3.2</span> Exercise 2</h3>
<div class="question">
<p>Why does this code fail?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table4a <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dv">1999</span>, <span class="dv">2000</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)
<span class="co">#&gt; Error in inds_combine(.vars, ind_list): Position must be between 0 and n</span></code></pre></div>
<p>The code fails because the column names <code>1999</code> and <code>2000</code> are not standard and thus needs to be quoted. The tidyverse functions will interpret <code>1999</code> and <code>2000</code> without quotes as looking for the 1999th and 2000th column of the data frame. This will work:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table4a <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   country     year   cases</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan 1999     745</span>
<span class="co">#&gt; 2 Brazil      1999   37737</span>
<span class="co">#&gt; 3 China       1999  212258</span>
<span class="co">#&gt; 4 Afghanistan 2000    2666</span>
<span class="co">#&gt; 5 Brazil      2000   80488</span>
<span class="co">#&gt; 6 China       2000  213766</span></code></pre></div>
</div>
</div>
<div id="exercise-3-14" class="section level3 exercise">
<h3><span class="header-section-number">11.3.3</span> Exercise 3</h3>
<div class="question">
<p>Why does spreading this tibble fail? How could you add a new column to fix the problem?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">people &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>name,             <span class="op">~</span>key,    <span class="op">~</span>value,
  <span class="co">#-----------------|--------|------</span>
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;age&quot;</span>,       <span class="dv">45</span>,
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;height&quot;</span>,   <span class="dv">186</span>,
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;age&quot;</span>,       <span class="dv">50</span>,
  <span class="st">&quot;Jessica Cordero&quot;</span>, <span class="st">&quot;age&quot;</span>,       <span class="dv">37</span>,
  <span class="st">&quot;Jessica Cordero&quot;</span>, <span class="st">&quot;height&quot;</span>,   <span class="dv">156</span>
)
<span class="kw">glimpse</span>(people)
<span class="co">#&gt; Observations: 5</span>
<span class="co">#&gt; Variables: 3</span>
<span class="co">#&gt; $ name  &lt;chr&gt; &quot;Phillip Woods&quot;, &quot;Phillip Woods&quot;, &quot;Phillip Woods&quot;, &quot;Jess...</span>
<span class="co">#&gt; $ key   &lt;chr&gt; &quot;age&quot;, &quot;height&quot;, &quot;age&quot;, &quot;age&quot;, &quot;height&quot;</span>
<span class="co">#&gt; $ value &lt;dbl&gt; 45, 186, 50, 37, 156</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spread</span>(people, key, value)
<span class="co">#&gt; Error: Duplicate identifiers for rows (1, 3)</span></code></pre></div>
<p>Spreading the data frame fails because there are two rows with “age” for “Phillip Woods”. We would need to add another column with an indicator for the number observation it is,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">people &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>name,             <span class="op">~</span>key,    <span class="op">~</span>value, <span class="op">~</span>obs,
  <span class="co">#-----------------|--------|------|------</span>
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;age&quot;</span>,       <span class="dv">45</span>, <span class="dv">1</span>,
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;height&quot;</span>,   <span class="dv">186</span>, <span class="dv">1</span>,
  <span class="st">&quot;Phillip Woods&quot;</span>,   <span class="st">&quot;age&quot;</span>,       <span class="dv">50</span>, <span class="dv">2</span>,
  <span class="st">&quot;Jessica Cordero&quot;</span>, <span class="st">&quot;age&quot;</span>,       <span class="dv">37</span>, <span class="dv">1</span>,
  <span class="st">&quot;Jessica Cordero&quot;</span>, <span class="st">&quot;height&quot;</span>,   <span class="dv">156</span>, <span class="dv">1</span>
)
<span class="kw">spread</span>(people, key, value)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   name              obs   age height</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Jessica Cordero  1.00  37.0    156</span>
<span class="co">#&gt; 2 Phillip Woods    1.00  45.0    186</span>
<span class="co">#&gt; 3 Phillip Woods    2.00  50.0     NA</span></code></pre></div>
</div>
</div>
<div id="exercise-4-12" class="section level3 exercise">
<h3><span class="header-section-number">11.3.4</span> Exercise 4</h3>
<div class="question">
<p>Tidy the simple tibble below. Do you need to spread or gather it? What are the variables?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">preg &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>pregnant, <span class="op">~</span>male, <span class="op">~</span>female,
  <span class="st">&quot;yes&quot;</span>,     <span class="ot">NA</span>,    <span class="dv">10</span>,
  <span class="st">&quot;no&quot;</span>,      <span class="dv">20</span>,    <span class="dv">12</span>
)</code></pre></div>
<p>You need to gather it. The variables are:</p>
<ul>
<li>pregnant: logical (“yes”, “no”)</li>
<li>female: logical</li>
<li>count: integer</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(preg, sex, count, male, female) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pregnant =</span> pregnant <span class="op">==</span><span class="st"> &quot;yes&quot;</span>,
         <span class="dt">female =</span> sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>sex)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   pregnant count female</span>
<span class="co">#&gt;   &lt;lgl&gt;    &lt;dbl&gt; &lt;lgl&gt; </span>
<span class="co">#&gt; 1 T         NA   F     </span>
<span class="co">#&gt; 2 F         20.0 F     </span>
<span class="co">#&gt; 3 T         10.0 T     </span>
<span class="co">#&gt; 4 F         12.0 T</span></code></pre></div>
<p>Converting <code>pregnant</code> and <code>female</code> from character vectors to logical was not necessary to tidy it, but it makes it easier to work with.</p>
</div>
</div>
</div>
<div id="separating-and-uniting" class="section level2">
<h2><span class="header-section-number">11.4</span> Separating and Uniting</h2>
<div id="exercise-1-18" class="section level3 exercise">
<h3><span class="header-section-number">11.4.1</span> Exercise 1</h3>
<div class="question">
<p>What do the extra and fill arguments do in <code>separate()</code>? Experiment with the various options for the following two toy datasets.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))
<span class="co">#&gt; Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     f    </span>
<span class="co">#&gt; 3 h     i     j</span>

<span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))
<span class="co">#&gt; Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     &lt;NA&gt; </span>
<span class="co">#&gt; 3 f     g     i</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?separate</code></pre></div>
<p>The <code>extra</code> argument tells <code>separate</code> what to do if there are too many pieces, and the <code>fill</code> argument if there aren’t enough.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))
<span class="co">#&gt; Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     f    </span>
<span class="co">#&gt; 3 h     i     j</span></code></pre></div>
<p>By default <code>separate</code> drops the extra values with a warning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     f    </span>
<span class="co">#&gt; 3 h     i     j</span></code></pre></div>
<p>This produces the same result as above, dropping extra values, but without the warning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     f,g  </span>
<span class="co">#&gt; 3 h     i     j</span></code></pre></div>
<p>In this, the extra values are not split, so <code>&quot;f,g&quot;</code> appears in column three.</p>
<p>In this, one of the entries for column, <code>&quot;d,e&quot;</code>, has too few elements. The default for <code>fill</code> is similar to <code>separate</code>; it fills with missing values but emits a warning. In this, row 2 of column “three”, is <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))
<span class="co">#&gt; Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     &lt;NA&gt; </span>
<span class="co">#&gt; 3 f     g     i</span></code></pre></div>
<p>Alternative options for <code>fill</code> are <code>&quot;right&quot;</code>, to fill with missing values from the right, but without a warning</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 d     e     &lt;NA&gt; </span>
<span class="co">#&gt; 3 f     g     i</span></code></pre></div>
<p>The option <code>fill = &quot;left&quot;</code> also fills with missing values without a warning, but this time from the left side. Now, column “one” of row 2 will be missing, and the other values in that row are shifted over.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">fill =</span> <span class="st">&quot;left&quot;</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   one   two   three</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 a     b     c    </span>
<span class="co">#&gt; 2 &lt;NA&gt;  d     e    </span>
<span class="co">#&gt; 3 f     g     i</span></code></pre></div>
</div>
</div>
<div id="exercise-2-17" class="section level3 exercise">
<h3><span class="header-section-number">11.4.2</span> Exercise 2</h3>
<div class="question">
<p>Both <code>unite()</code> and <code>separate()</code> have a remove argument. What does it do? Why would you set it to <code>FALSE</code>?</p>
</div>
<div class="answer">
<p>You would set it to <code>FALSE</code> if you want to create a new variable, but keep the old one.</p>
</div>
</div>
<div id="exercise-3-15" class="section level3 exercise">
<h3><span class="header-section-number">11.4.3</span> Exercise 3</h3>
<div class="question">
<p>Compare and contrast <code>separate()</code> and <code>extract()</code>, Why are there three variations of separation (by position, by separator, and with groups), but only one unite?</p>
</div>
<div class="answer">
<p>The function <code>extract</code> uses a regular expression to find groups and split into columns. In <code>unite</code> it is unambiguous since it is many columns to one, and once the columns are specified, there is only one way to do it, the only choice is the <code>sep</code>. In <code>separate</code>, it is one to many, and there are multiple ways to split the character string.</p>
</div>
</div>
</div>
<div id="missing-values-1" class="section level2">
<h2><span class="header-section-number">11.5</span> Missing Values</h2>
<div id="exercise-1-19" class="section level3 exercise">
<h3><span class="header-section-number">11.5.1</span> Exercise 1</h3>
<div class="question">
<p>Compare and contrast the <code>fill</code> arguments to <code>spread()</code> and <code>complete()</code>.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?spread</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?complete</code></pre></div>
<p>In <code>spread</code>, the fill argument explicitly sets the value to replace <code>NA</code>s. In <code>complete</code>, the fill argument also sets a value to replace <code>NA</code>s but it is named list, allowing for different values for different variables. Also, both cases replace both implicit and explicit missing values.</p>
</div>
</div>
<div id="exercise-2-18" class="section level3 exercise">
<h3><span class="header-section-number">11.5.2</span> Exercise 2</h3>
<div class="question">
<p>What does the direction argument to <code>fill()</code> do?</p>
</div>
<div class="answer">
<p>With <code>fill</code>, it determines whether <code>NA</code> values should be replaced by the previous non-missing value (<code>&quot;down&quot;</code>) or the next non-missing value (<code>&quot;up&quot;</code>).</p>
</div>
</div>
</div>
<div id="case-study" class="section level2">
<h2><span class="header-section-number">11.6</span> Case Study</h2>
<p>This code is repeated from the chapter because it is needed by the exercises.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who1 &lt;-<span class="st"> </span>who <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">key =</span> <span class="st">&quot;key&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">glimpse</span>(who1)
<span class="co">#&gt; Observations: 76,046</span>
<span class="co">#&gt; Variables: 6</span>
<span class="co">#&gt; $ country &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanis...</span>
<span class="co">#&gt; $ iso2    &lt;chr&gt; &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, &quot;AF&quot;, ...</span>
<span class="co">#&gt; $ iso3    &lt;chr&gt; &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;, &quot;AFG&quot;...</span>
<span class="co">#&gt; $ year    &lt;int&gt; 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, ...</span>
<span class="co">#&gt; $ key     &lt;chr&gt; &quot;new_sp_m014&quot;, &quot;new_sp_m014&quot;, &quot;new_sp_m014&quot;, &quot;new_sp_m...</span>
<span class="co">#&gt; $ cases   &lt;int&gt; 0, 30, 8, 52, 129, 90, 127, 139, 151, 193, 186, 187, 2...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who2 &lt;-<span class="st"> </span>who1 <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">key =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(key, <span class="st">&quot;newrel&quot;</span>, <span class="st">&quot;new_rel&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who3 &lt;-<span class="st"> </span>who2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;sexage&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
who3
<span class="co">#&gt; # A tibble: 76,046 x 8</span>
<span class="co">#&gt;   country     iso2  iso3   year new   type  sexage cases</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan AF    AFG    1997 new   sp    m014       0</span>
<span class="co">#&gt; 2 Afghanistan AF    AFG    1998 new   sp    m014      30</span>
<span class="co">#&gt; 3 Afghanistan AF    AFG    1999 new   sp    m014       8</span>
<span class="co">#&gt; 4 Afghanistan AF    AFG    2000 new   sp    m014      52</span>
<span class="co">#&gt; 5 Afghanistan AF    AFG    2001 new   sp    m014     129</span>
<span class="co">#&gt; 6 Afghanistan AF    AFG    2002 new   sp    m014      90</span>
<span class="co">#&gt; # ... with 7.604e+04 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who3 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(new)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   new       n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 new   76046</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who4 &lt;-<span class="st"> </span>who3 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who5 &lt;-<span class="st"> </span>who4 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(sexage, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">1</span>)
who5
<span class="co">#&gt; # A tibble: 76,046 x 6</span>
<span class="co">#&gt;   country      year type  sex   age   cases</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1997 sp    m     014       0</span>
<span class="co">#&gt; 2 Afghanistan  1998 sp    m     014      30</span>
<span class="co">#&gt; 3 Afghanistan  1999 sp    m     014       8</span>
<span class="co">#&gt; 4 Afghanistan  2000 sp    m     014      52</span>
<span class="co">#&gt; 5 Afghanistan  2001 sp    m     014     129</span>
<span class="co">#&gt; 6 Afghanistan  2002 sp    m     014      90</span>
<span class="co">#&gt; # ... with 7.604e+04 more rows</span></code></pre></div>
<div id="exercise-1-20" class="section level3 exercise">
<h3><span class="header-section-number">11.6.1</span> Exercise 1</h3>
<div class="question">
<p>In this case study I set <code>na.rm = TRUE</code> just to make it easier to check that we had the correct values. Is this reasonable? Think about how missing values are represented in this dataset. Are there implicit missing values? What’s the difference between an <code>NA</code> and zero?</p>
</div>
<div class="answer">
<p>Perhaps? I would need to know more about the data generation process. There are zero’s in the data, which means they may explicitly be indicating no cases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(cases <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 11080</span></code></pre></div>
<p>So it appears that either a country has all its values in a year as non-missing if the WHO collected data for that country, or all its values are non-missing. So it is okay to treat explicitly and implicitly missing values the same, and we don’t lose any information by dropping them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(who, new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">key =</span> <span class="st">&quot;key&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country, year)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">missing =</span> <span class="kw">is.na</span>(cases)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(country, year, missing) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 6,968 x 3</span>
<span class="co">#&gt; # Groups:   country, year [3,484]</span>
<span class="co">#&gt;   country      year missing</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;lgl&gt;  </span>
<span class="co">#&gt; 1 Afghanistan  1997 F      </span>
<span class="co">#&gt; 2 Afghanistan  1998 F      </span>
<span class="co">#&gt; 3 Afghanistan  1999 F      </span>
<span class="co">#&gt; 4 Afghanistan  2000 F      </span>
<span class="co">#&gt; 5 Afghanistan  2001 F      </span>
<span class="co">#&gt; 6 Afghanistan  2002 F      </span>
<span class="co">#&gt; # ... with 6,962 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-2-19" class="section level3 exercise">
<h3><span class="header-section-number">11.6.2</span> Exercise 2</h3>
<div class="question">
<p>What happens if you neglect the <code>mutate()</code> step? (<code>mutate(key = stringr::str_replace(key, &quot;newrel&quot;, &quot;new_rel&quot;)</code>)</p>
</div>
<div class="answer">
<p><code>separate</code> emits the warning “too few values”, and if we check the rows for keys beginning with <code>&quot;newrel_&quot;</code>, we see that <code>sexage</code> is messing, and <code>type = m014</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who3a &lt;-<span class="st"> </span>who1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;sexage&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
<span class="co">#&gt; Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2580 rows</span>
<span class="co">#&gt; [73467, 73468, 73469, 73470, 73471, 73472, 73473, 73474, 73475, 73476,</span>
<span class="co">#&gt; 73477, 73478, 73479, 73480, 73481, 73482, 73483, 73484, 73485, 73486, ...].</span>

<span class="kw">filter</span>(who3a, new <span class="op">==</span><span class="st"> &quot;newrel&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   country     iso2  iso3   year new    type  sexage cases</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 Afghanistan AF    AFG    2013 newrel m014  &lt;NA&gt;    1705</span>
<span class="co">#&gt; 2 Albania     AL    ALB    2013 newrel m014  &lt;NA&gt;      14</span>
<span class="co">#&gt; 3 Algeria     DZ    DZA    2013 newrel m014  &lt;NA&gt;      25</span>
<span class="co">#&gt; 4 Andorra     AD    AND    2013 newrel m014  &lt;NA&gt;       0</span>
<span class="co">#&gt; 5 Angola      AO    AGO    2013 newrel m014  &lt;NA&gt;     486</span>
<span class="co">#&gt; 6 Anguilla    AI    AIA    2013 newrel m014  &lt;NA&gt;       0</span></code></pre></div>
</div>
</div>
<div id="exercise-3-16" class="section level3 exercise">
<h3><span class="header-section-number">11.6.3</span> Exercise 3</h3>
<div class="question">
<p>I claimed that <code>iso2</code> and <code>iso3</code> were redundant with country. Confirm this claim.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(who3, country, iso2, iso3) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 0 x 3</span>
<span class="co">#&gt; # Groups:   country [0]</span>
<span class="co">#&gt; # ... with 3 variables: country &lt;chr&gt;, iso2 &lt;chr&gt;, iso3 &lt;chr&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-4-13" class="section level3 exercise">
<h3><span class="header-section-number">11.6.4</span> Exercise 4</h3>
<div class="question">
<p>For each country, year, and sex compute the total number of cases of TB. Make an informative visualization of the data.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">who5 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country, year, sex) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1995</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(country_sex, country, sex, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cases, <span class="dt">group =</span> country_sex, <span class="dt">colour =</span> sex)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()

  </code></pre></div>
<p><img src="tidy_files/figure-html/unnamed-chunk-42-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>A small multiples plot faceting by country is difficult given the number of countries. Focusing on those countries with the largest changes or absolute magnitudes after providing the context above is another option.</p>
</div>
</div>
</div>
<div id="non-tidy-data" class="section level2">
<h2><span class="header-section-number">11.7</span> Non-Tidy Data</h2>
<p>No exercises</p>
<!--chapter:end:tidy.Rmd-->
</div>
</div>
<div id="relational-data" class="section level1">
<h1><span class="header-section-number">12</span> Relational Data</h1>
<div id="introduction-7" class="section level2">
<h2><span class="header-section-number">12.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</code></pre></div>
<p>The package datamodelr is used to draw database schema:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;datamodelr&quot;</span>)</code></pre></div>
</div>
<div id="nycflights13" class="section level2">
<h2><span class="header-section-number">12.2</span> nycflights13</h2>
<div id="exercise-1-21" class="section level3 exercise">
<h3><span class="header-section-number">12.2.1</span> Exercise 1</h3>
<div class="question">
<p>Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination. What variables would you need? What tables would you need to combine?</p>
</div>
<div class="answer">
<ul>
<li><code>flights</code> table: <code>origin</code> and <code>dest</code></li>
<li><code>airports</code> table: longitude and latitude variables</li>
<li>We would merge the <code>flights</code> with airports twice: once to get the location of the <code>origin</code> airport, and once to get the location of the <code>dest</code> airport.</li>
</ul>
</div>
</div>
<div id="exercise-2-20" class="section level3 exercise">
<h3><span class="header-section-number">12.2.2</span> Exercise 2</h3>
<div class="question">
<p>I forgot to draw the relationship between weather and airports. What is the relationship and how should it appear in the diagram?</p>
</div>
<div class="answer">
<p>The variable <code>origin</code> in <code>weather</code> is matched with <code>faa</code> in <code>airports</code>.</p>
</div>
</div>
<div id="exercise-3-17" class="section level3 exercise">
<h3><span class="header-section-number">12.2.3</span> Exercise 3</h3>
<div class="question">
<p>weather only contains information for the origin (NYC) airports. If it contained weather records for all airports in the USA, what additional relation would it define with <code>flights</code>?</p>
</div>
<div class="answer">
<p><code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>origin</code> in <code>weather</code> would be matched to <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>dest</code> in <code>flight</code> (though it should use the arrival date-time values for <code>dest</code> if possible).</p>
</div>
</div>
<div id="exercise-4-14" class="section level3 exercise">
<h3><span class="header-section-number">12.2.4</span> Exercise 4</h3>
<div class="question">
<p>We know that some days of the year are “special”, and fewer people than usual fly on them. How might you represent that data as a data frame? What would be the primary keys of that table? How would it connect to the existing tables?</p>
</div>
<div class="answer">
<p>I would add a table of special dates. The primary key would be date. It would match to the <code>year</code>, <code>month</code>, <code>day</code> columns of `flights.</p>
</div>
</div>
</div>
<div id="keys" class="section level2">
<h2><span class="header-section-number">12.3</span> Keys</h2>
<div id="exercise-1-22" class="section level3 exercise">
<h3><span class="header-section-number">12.3.1</span> Exercise 1</h3>
<div class="question">
<p>Add a surrogate key to flights.</p>
</div>
<div class="answer">
<p>I add the column <code>flight_id</code> as a surrogate key. I sort the data prior to making the key, even though it is not strictly necessary, so the order of the rows has some meaning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(year, month, day, sched_dep_time, carrier, flight) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">flight_id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()
<span class="co">#&gt; Observations: 336,776</span>
<span class="co">#&gt; Variables: 20</span>
<span class="co">#&gt; $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,...</span>
<span class="co">#&gt; $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span>
<span class="co">#&gt; $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span>
<span class="co">#&gt; $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 559, 558, 559, 558, 55...</span>
<span class="co">#&gt; $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 558, 559, 600, 600, 600, 60...</span>
<span class="co">#&gt; $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -4, 0, -2, -1, -2, -2, -3, NA, 1, ...</span>
<span class="co">#&gt; $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 740, 702, 753, 941, 849, 8...</span>
<span class="co">#&gt; $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 728, 706, 745, 910, 851, 8...</span>
<span class="co">#&gt; $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, 12, -4, 8, 31, -2, -3, -8, NA,...</span>
<span class="co">#&gt; $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;AA&quot;, &quot;AA&quot;,...</span>
<span class="co">#&gt; $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 1696, 1806, 301, 707, 49...</span>
<span class="co">#&gt; $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N39463...</span>
<span class="co">#&gt; $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;EWR&quot;, &quot;JFK&quot;, &quot;LGA&quot;...</span>
<span class="co">#&gt; $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ORD&quot;, &quot;BOS&quot;, &quot;ORD&quot;...</span>
<span class="co">#&gt; $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 150, 44, 138, 257, 149, 158...</span>
<span class="co">#&gt; $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 719, 187, 733, 1389, 10...</span>
<span class="co">#&gt; $ hour           &lt;dbl&gt; 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,...</span>
<span class="co">#&gt; $ minute         &lt;dbl&gt; 15, 29, 40, 45, 58, 59, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...</span>
<span class="co">#&gt; $ flight_id      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, ...</span></code></pre></div>
</div>
</div>
<div id="exercise-2-21" class="section level3 exercise">
<h3><span class="header-section-number">12.3.2</span> Exercise 2</h3>
<div class="question">
<p>Identify the keys in the following datasets</p>
<ol style="list-style-type: decimal">
<li><code>Lahman::Batting</code></li>
<li><code>babynames::babynames</code></li>
<li><code>nasaweather::atmos</code></li>
<li><code>fueleconomy::vehicles</code></li>
<li><code>ggplot2::diamonds</code></li>
</ol>
</div>
<div class="answer">
<blockquote>
<p>(You might need to install some packages and read some documentation.)</p>
</blockquote>
<p>The primary key for <code>Lahman::Batting</code> is <code>playerID</code>, <code>yearID</code>, <code>stint</code>. It is not simply <code>playerID</code>, <code>yearID</code> because players can have different stints in different leagues within the same year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Lahman<span class="op">::</span>Batting <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID, yearID, stint) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>The primary key for <code>babynames::babynames</code> is <code>year</code>, <code>sex</code>, <code>name</code>. It is no simply <code>year</code>, <code>name</code> since names can appear for both sexes with different counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">babynames<span class="op">::</span>babynames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, sex, name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>The primary key for <code>nasaweather::atmos</code> is the location and time of the measurement: <code>lat</code>, <code>long</code>, <code>year</code>, <code>month</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nasaweather<span class="op">::</span>atmos <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(lat, long, year, month) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>The column <code>id</code> (unique EPA identifier) is the primary key for <code>fueleconomy::vehicles</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>There is no primary key for <code>ggplot2::diamonds</code>. Using all variables in the data frame, the number of distinct rows is less than the total number of rows, meaning no combination of variables uniquely identifies the observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ggplot2<span class="op">::</span>diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">nrow</span>()
<span class="co">#&gt; [1] 53794</span>
<span class="kw">nrow</span>(ggplot2<span class="op">::</span>diamonds)
<span class="co">#&gt; [1] 53940</span></code></pre></div>
</div>
</div>
<div id="exercise-4-15" class="section level3 exercise">
<h3><span class="header-section-number">12.3.3</span> Exercise 4</h3>
<p>Draw a diagram illustrating the connections between the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables in the <strong>Lahman</strong> package. Draw another diagram that shows the relationship between <code>Master</code>, <code>Managers</code>, <code>AwardsManagers</code>.</p>
<p>Most flowchart or diagramming software can be used used to create database schema diagrams. For example, the diagrams in <em>R for Data Science</em> were created with <a href="https://www.gliffy.com/">Gliffy</a>.</p>
<p>You can use anything to create these diagrams, but I’ll use the R package <a href="https://github.com/bergant/datamodelr">datamodelr</a> to programmatically create data models from R.</p>
<p>For the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables:</p>
<ul>
<li><code>Master</code></li>
<li>Primary keys: <code>playerID</code></li>
<li><code>Batting</code></li>
<li>Primary keys: <code>yearID</code>, <code>yearID</code>, <code>stint</code></li>
<li>Foreign Keys:
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
<li><code>Salaries</code>:</li>
<li>Primary keys: <code>yearID</code>, <code>teamID</code>, <code>playerID</code></li>
<li>Foreign Keys
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dm1 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(<span class="dt">Batting =</span> Lahman<span class="op">::</span>Batting, 
                                <span class="dt">Master =</span> Lahman<span class="op">::</span>Master, 
                                <span class="dt">Salaries =</span> Lahman<span class="op">::</span>Salaries)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Batting&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;stint&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Master&quot;</span>, <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Salaries&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;playerID&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_add_references</span>(
    Batting<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,
    Salaries<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID
  )

<span class="kw">dm_create_graph</span>(dm1, <span class="dt">rankdir =</span> <span class="st">&quot;LR&quot;</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>For the <code>Master</code>, <code>Manager</code>, and <code>AwardsManagers</code> tables:</p>
<ul>
<li><code>Master</code></li>
<li>Primary keys: <code>playerID</code></li>
<li><code>Managers</code></li>
<li>Primary keys: <code>yearID</code>, <code>teamID</code>, <code>inseason</code></li>
<li>Foreign Keys:
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
<li><code>AwardsManagers</code>:
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dm2 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(<span class="dt">Master =</span> Lahman<span class="op">::</span>Master, 
                                <span class="dt">Managers =</span> Lahman<span class="op">::</span>Managers,
                                <span class="dt">AwardsManagers =</span> Lahman<span class="op">::</span>AwardsManagers)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Master&quot;</span>, <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Managers&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;inseason&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;AwardsManagers&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;awardID&quot;</span>, <span class="st">&quot;yearID&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dm_add_references</span>(
    Managers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,
    AwardsManagers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID
  )

<span class="kw">dm_create_graph</span>(dm2, <span class="dt">rankdir =</span> <span class="st">&quot;LR&quot;</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>In the previous diagrams, I do not consider <code>teamID</code> and <code>lgID</code> as foreign keys even though they appear in multiple tables (and have the same meaning) because they are not primary keys in the tables considered in this exercise. The <code>teamID</code> variable references <code>Teams$teamID</code>, and <code>lgID</code> does not have its own table.</p>
<p>How would you characterize the relationship between the <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> tables?</p>
<p>The <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> tables all have a primary key consisting of the <code>playerID</code>, <code>yearID</code>, and <code>stint</code> variables. They all have a 1-1 relationship to each other.</p>
</div>
</div>
<div id="mutating-joins" class="section level2">
<h2><span class="header-section-number">12.4</span> Mutating Joins</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights2 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest, tailnum, carrier)</code></pre></div>
<div id="exercise-1-23" class="section level3 exercise">
<h3><span class="header-section-number">12.4.1</span> Exercise 1</h3>
<div class="question">
<p>Compute the average delay by destination, then join on the <code>airports</code> data frame so you can show the spatial distribution of delays. Here’s an easy way to draw a map of the United States:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(flights, <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;dest&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_quickmap</span>()
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;maps&#39;</span>
<span class="co">#&gt; The following object is masked from &#39;package:purrr&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     map</span></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>(Don’t worry if you don’t understand what <code>semi_join()</code> does — you’ll learn about it next.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_dest_delays &lt;-
<span class="st">  </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># arrival delay NA&#39;s are cancelled flights</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">&quot;faa&quot;</span>))

avg_dest_delays <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat, <span class="dt">colour =</span> delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_quickmap</span>()</code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>You might want to use the size or color of the points to display the average delay for each airport.</p>
</div>
</div>
<div id="exercise-2-22" class="section level3 exercise">
<h3><span class="header-section-number">12.4.2</span> Exercise 2</h3>
<div class="question">
<p>Add the location of the origin and destination (i.e. the <code>lat</code> and <code>lon</code>) to <code>flights</code>.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">&quot;faa&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">origin =</span> <span class="st">&quot;faa&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()
<span class="co">#&gt; # A tibble: 6 x 33</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      542            540      2.00      923</span>
<span class="co">#&gt; 4  2013     1     1      544            545     -1.00     1004</span>
<span class="co">#&gt; 5  2013     1     1      554            600     -6.00      812</span>
<span class="co">#&gt; 6  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; # ... with 26 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span>
<span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span>
<span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span>
<span class="co">#&gt; #   time_hour &lt;dttm&gt;, name.x &lt;chr&gt;, lat.x &lt;dbl&gt;, lon.x &lt;dbl&gt;, alt.x &lt;int&gt;,</span>
<span class="co">#&gt; #   tz.x &lt;dbl&gt;, dst.x &lt;chr&gt;, tzone.x &lt;chr&gt;, name.y &lt;chr&gt;, lat.y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   lon.y &lt;dbl&gt;, alt.y &lt;int&gt;, tz.y &lt;dbl&gt;, dst.y &lt;chr&gt;, tzone.y &lt;chr&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-18" class="section level3 exercise">
<h3><span class="header-section-number">12.4.3</span> Exercise 3</h3>
<div class="question">
<p>Is there a relationship between the age of a plane and its delays?</p>
</div>
<div class="answer">
<p>Surprisingly not. If anything (departure) delay seems to decrease slightly with the age of the plane. This could be due to choices about how airlines allocate planes to airports.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plane_ages &lt;-<span class="st"> </span>
<span class="st">  </span>planes <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="dv">2013</span> <span class="op">-</span><span class="st"> </span>year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(tailnum, age)

flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(plane_ages, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> delay)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_path).</span></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-4-16" class="section level3 exercise">
<h3><span class="header-section-number">12.4.4</span> Exercise 4</h3>
<div class="question">
<p>What weather conditions make it more likely to see a delay?</p>
</div>
<div class="answer">
<p>Almost any amount or precipitation is associated with a delay, though not as strong a trend after 0.02 in as one would expect</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flight_weather &lt;-
<span class="st">  </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(weather, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;origin&quot;</span>,
                            <span class="st">&quot;year&quot;</span> =<span class="st"> &quot;year&quot;</span>,
                            <span class="st">&quot;month&quot;</span> =<span class="st"> &quot;month&quot;</span>,
                            <span class="st">&quot;day&quot;</span> =<span class="st"> &quot;day&quot;</span>,
                            <span class="st">&quot;hour&quot;</span> =<span class="st"> &quot;hour&quot;</span>))

flight_weather <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(precip) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> precip, <span class="dt">y =</span> delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-5-7" class="section level3 exercise">
<h3><span class="header-section-number">12.4.5</span> Exercise 5</h3>
<div class="question">
<p>What happened on June 13 2013? Display the spatial pattern of delays, and then use Google to cross-reference with the weather.</p>
</div>
<div class="answer">
<p>There was a large series of storms (derechos) in the southeastern US (see <a href="https://en.wikipedia.org/wiki/June_12%E2%80%9313,_2013_derecho_series">June 12-13, 2013 derecho series</a>)</p>
<p>The largest delays are in Tennessee (Nashville), the Southeast, and the Midwest, which were the locations of the derechos:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(viridis)
<span class="co">#&gt; Loading required package: viridisLite</span>
flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>, month <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">13</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lat, <span class="dt">x =</span> lon, <span class="dt">size =</span> delay, <span class="dt">colour =</span> delay)) <span class="op">+</span>
<span class="st">  </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_quickmap</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_colour_viridis</span>()
<span class="co">#&gt; Warning: Removed 3 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="filtering-joins" class="section level2">
<h2><span class="header-section-number">12.5</span> Filtering Joins</h2>
<div id="exercise-1-24" class="section level3 exercise">
<h3><span class="header-section-number">12.5.1</span> Exercise 1</h3>
<div class="question">
<p>What does it mean for a flight to have a missing <code>tailnum</code>? What do the tail numbers that don’t have a matching record in planes have in common? (Hint: one variable explains ~90% of the problems.)</p>
</div>
<div class="answer">
<p>American Airlines (AA) and Envoy Airlines (MQ) don’t report tail numbers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(carrier, <span class="dt">sort =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;   carrier     n</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 MQ      25397</span>
<span class="co">#&gt; 2 AA      22558</span>
<span class="co">#&gt; 3 UA       1693</span>
<span class="co">#&gt; 4 9E       1044</span>
<span class="co">#&gt; 5 B6        830</span>
<span class="co">#&gt; 6 US        699</span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-2-23" class="section level3 exercise">
<h3><span class="header-section-number">12.5.2</span> Exercise 2</h3>
<div class="question">
<p>Filter flights to only show flights with planes that have flown at least 100 flights.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes_gt100 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(flights) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)

flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(planes_gt100, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>)
<span class="co">#&gt; # A tibble: 229,202 x 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      517            515      2.00      830</span>
<span class="co">#&gt; 2  2013     1     1      533            529      4.00      850</span>
<span class="co">#&gt; 3  2013     1     1      544            545     -1.00     1004</span>
<span class="co">#&gt; 4  2013     1     1      554            558     -4.00      740</span>
<span class="co">#&gt; 5  2013     1     1      555            600     -5.00      913</span>
<span class="co">#&gt; 6  2013     1     1      557            600     -3.00      709</span>
<span class="co">#&gt; # ... with 2.292e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-19" class="section level3 exercise">
<h3><span class="header-section-number">12.5.3</span> Exercise 3</h3>
<div class="question">
<p>Combine <code>fueleconomy::vehicles</code> and <code>fueleconomy::common</code> to find only the records for the most common models.</p>
</div>
<div class="answer">
<p>The table <code>fueleconomy::common</code> identifies vehicles by <code>make</code> and <code>model</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(fueleconomy<span class="op">::</span>vehicles)
<span class="co">#&gt; Observations: 33,442</span>
<span class="co">#&gt; Variables: 12</span>
<span class="co">#&gt; $ id    &lt;int&gt; 27550, 28426, 27549, 28425, 1032, 1033, 3347, 13309, 133...</span>
<span class="co">#&gt; $ make  &lt;chr&gt; &quot;AM General&quot;, &quot;AM General&quot;, &quot;AM General&quot;, &quot;AM General&quot;, ...</span>
<span class="co">#&gt; $ model &lt;chr&gt; &quot;DJ Po Vehicle 2WD&quot;, &quot;DJ Po Vehicle 2WD&quot;, &quot;FJ8c Post Off...</span>
<span class="co">#&gt; $ year  &lt;int&gt; 1984, 1984, 1984, 1984, 1985, 1985, 1987, 1997, 1997, 19...</span>
<span class="co">#&gt; $ class &lt;chr&gt; &quot;Special Purpose Vehicle 2WD&quot;, &quot;Special Purpose Vehicle ...</span>
<span class="co">#&gt; $ trans &lt;chr&gt; &quot;Automatic 3-spd&quot;, &quot;Automatic 3-spd&quot;, &quot;Automatic 3-spd&quot;,...</span>
<span class="co">#&gt; $ drive &lt;chr&gt; &quot;2-Wheel Drive&quot;, &quot;2-Wheel Drive&quot;, &quot;2-Wheel Drive&quot;, &quot;2-Wh...</span>
<span class="co">#&gt; $ cyl   &lt;int&gt; 4, 4, 6, 6, 4, 6, 6, 4, 4, 6, 4, 4, 6, 4, 4, 6, 5, 5, 6,...</span>
<span class="co">#&gt; $ displ &lt;dbl&gt; 2.5, 2.5, 4.2, 4.2, 2.5, 4.2, 3.8, 2.2, 2.2, 3.0, 2.3, 2...</span>
<span class="co">#&gt; $ fuel  &lt;chr&gt; &quot;Regular&quot;, &quot;Regular&quot;, &quot;Regular&quot;, &quot;Regular&quot;, &quot;Regular&quot;, &quot;...</span>
<span class="co">#&gt; $ hwy   &lt;int&gt; 17, 17, 13, 13, 17, 13, 21, 26, 28, 26, 27, 29, 26, 27, ...</span>
<span class="co">#&gt; $ cty   &lt;int&gt; 18, 18, 13, 13, 16, 13, 14, 20, 22, 18, 19, 21, 17, 20, ...</span>
<span class="kw">glimpse</span>(fueleconomy<span class="op">::</span>common)
<span class="co">#&gt; Observations: 347</span>
<span class="co">#&gt; Variables: 4</span>
<span class="co">#&gt; $ make  &lt;chr&gt; &quot;Acura&quot;, &quot;Acura&quot;, &quot;Acura&quot;, &quot;Acura&quot;, &quot;Acura&quot;, &quot;Audi&quot;, &quot;Au...</span>
<span class="co">#&gt; $ model &lt;chr&gt; &quot;Integra&quot;, &quot;Legend&quot;, &quot;MDX 4WD&quot;, &quot;NSX&quot;, &quot;TSX&quot;, &quot;A4&quot;, &quot;A4 ...</span>
<span class="co">#&gt; $ n     &lt;int&gt; 42, 28, 12, 28, 27, 49, 49, 66, 20, 12, 46, 20, 30, 29, ...</span>
<span class="co">#&gt; $ years &lt;int&gt; 16, 10, 12, 14, 11, 19, 15, 19, 19, 12, 20, 15, 16, 16, ...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(fueleconomy<span class="op">::</span>common, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;make&quot;</span>, <span class="st">&quot;model&quot;</span>))
<span class="co">#&gt; # A tibble: 14,531 x 12</span>
<span class="co">#&gt;      id make  model   year class trans drive   cyl displ fuel    hwy   cty</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  1833 Acura Integ…  1986 Subc… Auto… Fron…     4  1.60 Regu…    28    22</span>
<span class="co">#&gt; 2  1834 Acura Integ…  1986 Subc… Manu… Fron…     4  1.60 Regu…    28    23</span>
<span class="co">#&gt; 3  3037 Acura Integ…  1987 Subc… Auto… Fron…     4  1.60 Regu…    28    22</span>
<span class="co">#&gt; 4  3038 Acura Integ…  1987 Subc… Manu… Fron…     4  1.60 Regu…    28    23</span>
<span class="co">#&gt; 5  4183 Acura Integ…  1988 Subc… Auto… Fron…     4  1.60 Regu…    27    22</span>
<span class="co">#&gt; 6  4184 Acura Integ…  1988 Subc… Manu… Fron…     4  1.60 Regu…    28    23</span>
<span class="co">#&gt; # ... with 1.452e+04 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-3-20" class="section level3 exercise">
<h3><span class="header-section-number">12.5.4</span> Exercise 3</h3>
<div class="question">
<p>Find the 48 hours (over the course of the whole year) that have the worst delays. Cross-reference it with the weather data. Can you see any patterns?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_24 =</span> <span class="kw">sum</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)<span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_48 =</span> total_<span class="dv">24</span> <span class="op">+</span><span class="st"> </span><span class="kw">lag</span>(total_<span class="dv">24</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_<span class="dv">48</span>))
<span class="co">#&gt; # A tibble: 365 x 5</span>
<span class="co">#&gt; # Groups:   year, month [12]</span>
<span class="co">#&gt;    year month   day total_24 total_48</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2013     7    23    80641   175419</span>
<span class="co">#&gt; 2  2013     3     8   135264   167530</span>
<span class="co">#&gt; 3  2013     6    25    80434   166649</span>
<span class="co">#&gt; 4  2013     8     9    72866   165287</span>
<span class="co">#&gt; 5  2013     6    28    81389   157910</span>
<span class="co">#&gt; 6  2013     7    10    97120   157396</span>
<span class="co">#&gt; # ... with 359 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-4-17" class="section level3 exercise">
<h3><span class="header-section-number">12.5.5</span> Exercise 4</h3>
<div class="question">
<p>What does <code>anti_join(flights, airports, by = c(&quot;dest&quot; = &quot;faa&quot;))</code> tell you? What does <code>anti_join(airports, flights, by = c(&quot;faa&quot; = &quot;dest&quot;))</code> tell you?</p>
</div>
<div class="answer">
<p><code>anti_join(flights, airports, by = c(&quot;dest&quot; = &quot;faa&quot;))</code> are flights that go to an airport that is not in FAA list of destinations, likely foreign airports.</p>
<p><code>anti_join(airports, flights, by = c(&quot;faa&quot; = &quot;dest&quot;))</code> are US airports that don’t have a flight in the data, meaning that there were no flights to that airport <strong>from</strong> New York in 2013.</p>
</div>
</div>
<div id="exercise-5-8" class="section level3 exercise">
<h3><span class="header-section-number">12.5.6</span> Exercise 5</h3>
<div class="question">
<p>You might expect that there’s an implicit relationship between plane and airline, because each plane is flown by a single airline. Confirm or reject this hypothesis using the tools you’ve learned above.</p>
</div>
<div class="answer">
<p>There isn’t such a relationship over the lifetime of an airplane since planes can be sold or leased and airlines can merge. It should be the case that an airplane is associated with only airline at a given time, though may However, even though that’s a possibility, it doesn’t necessarily mean that plane associated with more than one appear in this data. Let’s check:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airplane_multi_carrier &lt;-<span class="st"> </span>
<span class="st">  </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum, carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>()
<span class="co">#&gt; Adding missing grouping variables: `carrier`</span>
airplane_multi_carrier
<span class="co">#&gt; # A tibble: 0 x 2</span>
<span class="co">#&gt; # Groups:   tailnum, carrier [0]</span>
<span class="co">#&gt; # ... with 2 variables: carrier &lt;chr&gt;, tailnum &lt;chr&gt;</span></code></pre></div>
<p>There are 0 airplanes in this dataset that have had more than one carrier. Even if there were none, the substantive reasons why an airplane <em>could</em> have more than one carrier would hold.</p>
<p>It is quite possible that we could have looked at the data, seen that each airplane only has one carrier, not thought much about it, and proceeded with some analysis that implicitly or explicitly relies on that one-to-one relationship. Then we apply our analysis to a larger set of data where that one-to-one relationship no longer holds, and it breaks. There is rarely a substitute for understanding the data which you are using as an analyst.</p>
</div>
</div>
</div>
<div id="join-problems" class="section level2">
<h2><span class="header-section-number">12.6</span> Join problems</h2>
<p>No exercises</p>
</div>
<div id="set-operations" class="section level2">
<h2><span class="header-section-number">12.7</span> Set operations</h2>
<p>No exercises</p>
<!--chapter:end:relational-data.Rmd-->
</div>
</div>
<div id="strings" class="section level1">
<h1><span class="header-section-number">13</span> Strings</h1>
<div id="introduction-8" class="section level2">
<h2><span class="header-section-number">13.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(stringr)</code></pre></div>
</div>
<div id="string-basics" class="section level2">
<h2><span class="header-section-number">13.2</span> String Basics</h2>
<div id="exercise-1-25" class="section level3 exercise">
<h3><span class="header-section-number">13.2.1</span> Exercise 1</h3>
<div class="question">
<p>In code that doesn’t use <strong>stringr</strong>, you’ll often see <code>paste()</code> and <code>paste0()</code>. What’s the difference between the two functions? What <strong>stringr</strong> function are they equivalent to? How do the functions differ in their handling of NA?</p>
</div>
<div class="answer">
<p>The function <code>paste</code> separates strings by spaces by default, while <code>paste0</code> does not separate strings with spaces by default.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>)
<span class="co">#&gt; [1] &quot;foo bar&quot;</span>
<span class="kw">paste0</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>)
<span class="co">#&gt; [1] &quot;foobar&quot;</span></code></pre></div>
<p>Since <code>str_c</code> does not separate strings with spaces by default it is closer in behavior to <code>paste0</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>)
<span class="co">#&gt; [1] &quot;foobar&quot;</span></code></pre></div>
<p>However, <code>str_c</code> and the paste function handle NA differently. The function <code>str_c</code> propagates <code>NA</code>, if any argument is a missing value, it returns a missing value. This is in line with how the numeric R functions, e.g. <code>sum</code>, <code>mean</code>, handle missing values. However, the paste functions, convert <code>NA</code> to the string <code>&quot;NA&quot;</code> and then treat it as any other character vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_c</span>(<span class="st">&quot;foo&quot;</span>, <span class="ot">NA</span>)
<span class="co">#&gt; [1] NA</span>
<span class="kw">paste</span>(<span class="st">&quot;foo&quot;</span>, <span class="ot">NA</span>)
<span class="co">#&gt; [1] &quot;foo NA&quot;</span>
<span class="kw">paste0</span>(<span class="st">&quot;foo&quot;</span>, <span class="ot">NA</span>)
<span class="co">#&gt; [1] &quot;fooNA&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-24" class="section level3 exercise">
<h3><span class="header-section-number">13.2.2</span> Exercise 2</h3>
<div class="question">
<p>In your own words, describe the difference between the <code>sep</code> and <code>collapse</code> arguments to <code>str_c()</code>.</p>
</div>
<div class="answer">
<p>The <code>sep</code> argument is the string inserted between arguments to <code>str_c</code>, while <code>collapse</code> is the string used to separate any elements of the character vector into a character vector of length one.</p>
</div>
</div>
<div id="exercise-3-21" class="section level3 exercise">
<h3><span class="header-section-number">13.2.3</span> Exercise 3</h3>
<div class="question">
<p>Use <code>str_length()</code> and <code>str_sub()</code> to extract the middle character from a string. What will you do if the string has an even number of characters?</p>
</div>
<div class="answer">
<p>The following function extracts the middle character. If the string has an even number of characters the choice is arbitrary. We choose to select <span class="math inline">\(\lceil n / 2 \rceil\)</span>, because that case works even if the string is only of length one. A more general method would allow the user to select either the floor or ceiling for the middle character of an even string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;abc&quot;</span>, <span class="st">&quot;abcd&quot;</span>, <span class="st">&quot;abcde&quot;</span>, <span class="st">&quot;abcdef&quot;</span>)
L &lt;-<span class="st"> </span><span class="kw">str_length</span>(x)
m &lt;-<span class="st"> </span><span class="kw">ceiling</span>(L <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">str_sub</span>(x, m, m)
<span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;c&quot; &quot;c&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-4-18" class="section level3 exercise">
<h3><span class="header-section-number">13.2.4</span> Exercise 4</h3>
<div class="question">
<p>What does <code>str_wrap()</code> do? When might you want to use it?</p>
</div>
<div class="answer">
<p>The function <code>str_wrap</code> wraps text so that it fits within a certain width. This is useful for wrapping long strings of text to be typeset.</p>
</div>
</div>
<div id="exercise-5-9" class="section level3 exercise">
<h3><span class="header-section-number">13.2.5</span> Exercise 5</h3>
<div class="question">
<p>What does <code>str_trim()</code> do? What’s the opposite of <code>str_trim()</code>?</p>
</div>
<div class="answer">
<p>The function <code>str_trim</code> trims the whitespace from a string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>)
<span class="co">#&gt; [1] &quot;abc&quot;</span>
<span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>)
<span class="co">#&gt; [1] &quot;abc &quot;</span>
<span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>)
<span class="co">#&gt; [1] &quot; abc&quot;</span></code></pre></div>
<p>The opposite of <code>str_trim</code> is <code>str_pad</code> which adds characters to each side.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">5</span>, <span class="dt">side =</span> <span class="st">&quot;both&quot;</span>)
<span class="co">#&gt; [1] &quot; abc &quot;</span>
<span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">4</span>, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>)
<span class="co">#&gt; [1] &quot;abc &quot;</span>
<span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">4</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>)
<span class="co">#&gt; [1] &quot; abc&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-6-7" class="section level3 exercise">
<h3><span class="header-section-number">13.2.6</span> Exercise 6</h3>
<div class="question">
<p>Write a function that turns (e.g.) a vector c(“a”, “b”, “c”) into the string a, b, and c. Think carefully about what it should do if given a vector of length 0, 1, or 2.</p>
</div>
<div class="answer">
<p>See the Chapter <a href="#functions">Functions</a> for more details on writing R functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">str_commasep &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>, <span class="dt">last =</span> <span class="st">&quot;, and &quot;</span>) {
  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {
    <span class="kw">str_c</span>(<span class="kw">str_c</span>(x[<span class="op">-</span><span class="kw">length</span>(x)], <span class="dt">collapse =</span> sep),
                x[<span class="kw">length</span>(x)],
                <span class="dt">sep =</span> last)
  } <span class="cf">else</span> {
    x
  }
}
<span class="kw">str_commasep</span>(<span class="st">&quot;&quot;</span>)
<span class="co">#&gt; [1] &quot;&quot;</span>
<span class="kw">str_commasep</span>(<span class="st">&quot;a&quot;</span>)
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="kw">str_commasep</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))
<span class="co">#&gt; [1] &quot;a, and b&quot;</span>
<span class="kw">str_commasep</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))
<span class="co">#&gt; [1] &quot;a, b, and c&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="matching-patterns-and-regular-expressions" class="section level2">
<h2><span class="header-section-number">13.3</span> Matching Patterns and Regular Expressions</h2>
<div id="basic-matches" class="section level3">
<h3><span class="header-section-number">13.3.1</span> Basic Matches</h3>
<div id="exercise-1-26" class="section level4 exercise">
<h4><span class="header-section-number">13.3.1.1</span> Exercise 1</h4>
<div class="question">
<p>Explain why each of these strings don’t match a <code>\</code>: <code>&quot;\&quot;</code>, <code>&quot;\\&quot;</code>, <code>&quot;\\\&quot;</code>.</p>
</div>
<div class="answer">
<ul>
<li><code>&quot;\&quot;</code>: This will escape the next character in the R string.</li>
<li><code>&quot;\\&quot;</code>: This will resolve to <code>\</code> in the regular expression, which will escape the next character in the regular expression.</li>
<li><code>&quot;\\\&quot;</code>: The first two backslashes will resolve to a literal backslash in the regular expression, the third will escape the next character. So in the regular expression, this will escape some escaped character.</li>
</ul>
</div>
</div>
<div id="exercise-2-25" class="section level4 exercise">
<h4><span class="header-section-number">13.3.1.2</span> Exercise 2</h4>
<div class="question">
<p>How would you match the sequence <code>&quot;'\</code> ?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&#39;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)</code></pre></div>
<div id="htmlwidget-14d5992801777f4abbc5" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-14d5992801777f4abbc5">{"x":{"html":"<ul>\n  <li><span class='match'>\"'\\<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-3-22" class="section level4 exercise">
<h4><span class="header-section-number">13.3.1.3</span> Exercise 3</h4>
<div class="question">
<p>What patterns will the regular expression <code>\..\..\..</code> match? How would you represent it as a string?</p>
</div>
<div class="answer">
<p>It will match any patterns that are a dot followed by any character, repeated three times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;.a.b.c&quot;</span>, <span class="st">&quot;.a.b&quot;</span>, <span class="st">&quot;.....&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">..</span><span class="ch">\\</span><span class="st">..</span><span class="ch">\\</span><span class="st">..&quot;</span>))</code></pre></div>
<div id="htmlwidget-df2c08526632671063f9" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-df2c08526632671063f9">{"x":{"html":"<ul>\n  <li><span class='match'>.a.b.c<\/span><\/li>\n  <li>.a.b<\/li>\n  <li>.....<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;^a&quot;</span>)</code></pre></div>
<div id="htmlwidget-4aadbc32fbbd0d87b2b0" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-4aadbc32fbbd0d87b2b0">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple<\/li>\n  <li>banana<\/li>\n  <li>pear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;a$&quot;</span>)</code></pre></div>
<div id="htmlwidget-07394da27a6eb4f22e37" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-07394da27a6eb4f22e37">{"x":{"html":"<ul>\n  <li>apple<\/li>\n  <li>banan<span class='match'>a<\/span><\/li>\n  <li>pear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple pie&quot;</span>, <span class="st">&quot;apple&quot;</span>, <span class="st">&quot;apple cake&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;apple&quot;</span>)</code></pre></div>
<div id="htmlwidget-ae7fa4a918c3c5fdf863" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ae7fa4a918c3c5fdf863">{"x":{"html":"<ul>\n  <li><span class='match'>apple<\/span> pie<\/li>\n  <li><span class='match'>apple<\/span><\/li>\n  <li><span class='match'>apple<\/span> cake<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;^apple$&quot;</span>)</code></pre></div>
<div id="htmlwidget-76502c887ec734b6105a" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-76502c887ec734b6105a">{"x":{"html":"<ul>\n  <li>apple pie<\/li>\n  <li><span class='match'>apple<\/span><\/li>\n  <li>apple cake<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="anchors" class="section level3">
<h3><span class="header-section-number">13.3.2</span> Anchors</h3>
<div id="exercise-1-27" class="section level4 exercise">
<h4><span class="header-section-number">13.3.2.1</span> Exercise 1</h4>
<div class="question">
<p>How would you match the literal string <code>&quot;$^$&quot;</code>?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;$^$&quot;</span>, <span class="st">&quot;ab$^$sfas&quot;</span>), <span class="st">&quot;^</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">^</span><span class="ch">\\</span><span class="st">$$&quot;</span>)</code></pre></div>
<div id="htmlwidget-d34691559831f28a8b47" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d34691559831f28a8b47">{"x":{"html":"<ul>\n  <li><span class='match'>$^$<\/span><\/li>\n  <li>ab$^$sfas<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-2-26" class="section level4 exercise">
<h4><span class="header-section-number">13.3.2.2</span> Exercise 2</h4>
<div class="question">
<p>Given the corpus of common words in <code>stringr::words</code>, create regular expressions that find all words that:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Start with “y”.</li>
<li>End with “x”</li>
<li>Are exactly three letters long. (Don’t cheat by using <code>str_length()</code>!)</li>
<li>Have seven letters or more.</li>
</ol>
<p>Since this list is long, you might want to use the match argument to <code>str_view()</code> to show only the matching or non-matching words.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^y&quot;</span>, <span class="dt">match =</span><span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-725f07776305608fdb62" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-725f07776305608fdb62">{"x":{"html":"<ul>\n  <li><span class='match'>y<\/span>ear<\/li>\n  <li><span class='match'>y<\/span>es<\/li>\n  <li><span class='match'>y<\/span>esterday<\/li>\n  <li><span class='match'>y<\/span>et<\/li>\n  <li><span class='match'>y<\/span>ou<\/li>\n  <li><span class='match'>y<\/span>oung<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;x$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-8799424a7aeb6636ab0f" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8799424a7aeb6636ab0f">{"x":{"html":"<ul>\n  <li>bo<span class='match'>x<\/span><\/li>\n  <li>se<span class='match'>x<\/span><\/li>\n  <li>si<span class='match'>x<\/span><\/li>\n  <li>ta<span class='match'>x<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^...$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-ff2684d8b73d8cd50778" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff2684d8b73d8cd50778">{"x":{"html":"<ul>\n  <li><span class='match'>act<\/span><\/li>\n  <li><span class='match'>add<\/span><\/li>\n  <li><span class='match'>age<\/span><\/li>\n  <li><span class='match'>ago<\/span><\/li>\n  <li><span class='match'>air<\/span><\/li>\n  <li><span class='match'>all<\/span><\/li>\n  <li><span class='match'>and<\/span><\/li>\n  <li><span class='match'>any<\/span><\/li>\n  <li><span class='match'>arm<\/span><\/li>\n  <li><span class='match'>art<\/span><\/li>\n  <li><span class='match'>ask<\/span><\/li>\n  <li><span class='match'>bad<\/span><\/li>\n  <li><span class='match'>bag<\/span><\/li>\n  <li><span class='match'>bar<\/span><\/li>\n  <li><span class='match'>bed<\/span><\/li>\n  <li><span class='match'>bet<\/span><\/li>\n  <li><span class='match'>big<\/span><\/li>\n  <li><span class='match'>bit<\/span><\/li>\n  <li><span class='match'>box<\/span><\/li>\n  <li><span class='match'>boy<\/span><\/li>\n  <li><span class='match'>bus<\/span><\/li>\n  <li><span class='match'>but<\/span><\/li>\n  <li><span class='match'>buy<\/span><\/li>\n  <li><span class='match'>can<\/span><\/li>\n  <li><span class='match'>car<\/span><\/li>\n  <li><span class='match'>cat<\/span><\/li>\n  <li><span class='match'>cup<\/span><\/li>\n  <li><span class='match'>cut<\/span><\/li>\n  <li><span class='match'>dad<\/span><\/li>\n  <li><span class='match'>day<\/span><\/li>\n  <li><span class='match'>die<\/span><\/li>\n  <li><span class='match'>dog<\/span><\/li>\n  <li><span class='match'>dry<\/span><\/li>\n  <li><span class='match'>due<\/span><\/li>\n  <li><span class='match'>eat<\/span><\/li>\n  <li><span class='match'>egg<\/span><\/li>\n  <li><span class='match'>end<\/span><\/li>\n  <li><span class='match'>eye<\/span><\/li>\n  <li><span class='match'>far<\/span><\/li>\n  <li><span class='match'>few<\/span><\/li>\n  <li><span class='match'>fit<\/span><\/li>\n  <li><span class='match'>fly<\/span><\/li>\n  <li><span class='match'>for<\/span><\/li>\n  <li><span class='match'>fun<\/span><\/li>\n  <li><span class='match'>gas<\/span><\/li>\n  <li><span class='match'>get<\/span><\/li>\n  <li><span class='match'>god<\/span><\/li>\n  <li><span class='match'>guy<\/span><\/li>\n  <li><span class='match'>hit<\/span><\/li>\n  <li><span class='match'>hot<\/span><\/li>\n  <li><span class='match'>how<\/span><\/li>\n  <li><span class='match'>job<\/span><\/li>\n  <li><span class='match'>key<\/span><\/li>\n  <li><span class='match'>kid<\/span><\/li>\n  <li><span class='match'>lad<\/span><\/li>\n  <li><span class='match'>law<\/span><\/li>\n  <li><span class='match'>lay<\/span><\/li>\n  <li><span class='match'>leg<\/span><\/li>\n  <li><span class='match'>let<\/span><\/li>\n  <li><span class='match'>lie<\/span><\/li>\n  <li><span class='match'>lot<\/span><\/li>\n  <li><span class='match'>low<\/span><\/li>\n  <li><span class='match'>man<\/span><\/li>\n  <li><span class='match'>may<\/span><\/li>\n  <li><span class='match'>mrs<\/span><\/li>\n  <li><span class='match'>new<\/span><\/li>\n  <li><span class='match'>non<\/span><\/li>\n  <li><span class='match'>not<\/span><\/li>\n  <li><span class='match'>now<\/span><\/li>\n  <li><span class='match'>odd<\/span><\/li>\n  <li><span class='match'>off<\/span><\/li>\n  <li><span class='match'>old<\/span><\/li>\n  <li><span class='match'>one<\/span><\/li>\n  <li><span class='match'>out<\/span><\/li>\n  <li><span class='match'>own<\/span><\/li>\n  <li><span class='match'>pay<\/span><\/li>\n  <li><span class='match'>per<\/span><\/li>\n  <li><span class='match'>put<\/span><\/li>\n  <li><span class='match'>red<\/span><\/li>\n  <li><span class='match'>rid<\/span><\/li>\n  <li><span class='match'>run<\/span><\/li>\n  <li><span class='match'>say<\/span><\/li>\n  <li><span class='match'>see<\/span><\/li>\n  <li><span class='match'>set<\/span><\/li>\n  <li><span class='match'>sex<\/span><\/li>\n  <li><span class='match'>she<\/span><\/li>\n  <li><span class='match'>sir<\/span><\/li>\n  <li><span class='match'>sit<\/span><\/li>\n  <li><span class='match'>six<\/span><\/li>\n  <li><span class='match'>son<\/span><\/li>\n  <li><span class='match'>sun<\/span><\/li>\n  <li><span class='match'>tax<\/span><\/li>\n  <li><span class='match'>tea<\/span><\/li>\n  <li><span class='match'>ten<\/span><\/li>\n  <li><span class='match'>the<\/span><\/li>\n  <li><span class='match'>tie<\/span><\/li>\n  <li><span class='match'>too<\/span><\/li>\n  <li><span class='match'>top<\/span><\/li>\n  <li><span class='match'>try<\/span><\/li>\n  <li><span class='match'>two<\/span><\/li>\n  <li><span class='match'>use<\/span><\/li>\n  <li><span class='match'>war<\/span><\/li>\n  <li><span class='match'>way<\/span><\/li>\n  <li><span class='match'>wee<\/span><\/li>\n  <li><span class='match'>who<\/span><\/li>\n  <li><span class='match'>why<\/span><\/li>\n  <li><span class='match'>win<\/span><\/li>\n  <li><span class='match'>yes<\/span><\/li>\n  <li><span class='match'>yet<\/span><\/li>\n  <li><span class='match'>you<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;.......&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-ced067376bab81a983d5" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ced067376bab81a983d5">{"x":{"html":"<ul>\n  <li><span class='match'>absolut<\/span>e<\/li>\n  <li><span class='match'>account<\/span><\/li>\n  <li><span class='match'>achieve<\/span><\/li>\n  <li><span class='match'>address<\/span><\/li>\n  <li><span class='match'>adverti<\/span>se<\/li>\n  <li><span class='match'>afterno<\/span>on<\/li>\n  <li><span class='match'>against<\/span><\/li>\n  <li><span class='match'>already<\/span><\/li>\n  <li><span class='match'>alright<\/span><\/li>\n  <li><span class='match'>althoug<\/span>h<\/li>\n  <li><span class='match'>america<\/span><\/li>\n  <li><span class='match'>another<\/span><\/li>\n  <li><span class='match'>apparen<\/span>t<\/li>\n  <li><span class='match'>appoint<\/span><\/li>\n  <li><span class='match'>approac<\/span>h<\/li>\n  <li><span class='match'>appropr<\/span>iate<\/li>\n  <li><span class='match'>arrange<\/span><\/li>\n  <li><span class='match'>associa<\/span>te<\/li>\n  <li><span class='match'>authori<\/span>ty<\/li>\n  <li><span class='match'>availab<\/span>le<\/li>\n  <li><span class='match'>balance<\/span><\/li>\n  <li><span class='match'>because<\/span><\/li>\n  <li><span class='match'>believe<\/span><\/li>\n  <li><span class='match'>benefit<\/span><\/li>\n  <li><span class='match'>between<\/span><\/li>\n  <li><span class='match'>brillia<\/span>nt<\/li>\n  <li><span class='match'>britain<\/span><\/li>\n  <li><span class='match'>brother<\/span><\/li>\n  <li><span class='match'>busines<\/span>s<\/li>\n  <li><span class='match'>certain<\/span><\/li>\n  <li><span class='match'>chairma<\/span>n<\/li>\n  <li><span class='match'>charact<\/span>er<\/li>\n  <li><span class='match'>Christm<\/span>as<\/li>\n  <li><span class='match'>colleag<\/span>ue<\/li>\n  <li><span class='match'>collect<\/span><\/li>\n  <li><span class='match'>college<\/span><\/li>\n  <li><span class='match'>comment<\/span><\/li>\n  <li><span class='match'>committ<\/span>ee<\/li>\n  <li><span class='match'>communi<\/span>ty<\/li>\n  <li><span class='match'>company<\/span><\/li>\n  <li><span class='match'>compare<\/span><\/li>\n  <li><span class='match'>complet<\/span>e<\/li>\n  <li><span class='match'>compute<\/span><\/li>\n  <li><span class='match'>concern<\/span><\/li>\n  <li><span class='match'>conditi<\/span>on<\/li>\n  <li><span class='match'>conside<\/span>r<\/li>\n  <li><span class='match'>consult<\/span><\/li>\n  <li><span class='match'>contact<\/span><\/li>\n  <li><span class='match'>continu<\/span>e<\/li>\n  <li><span class='match'>contrac<\/span>t<\/li>\n  <li><span class='match'>control<\/span><\/li>\n  <li><span class='match'>convers<\/span>e<\/li>\n  <li><span class='match'>correct<\/span><\/li>\n  <li><span class='match'>council<\/span><\/li>\n  <li><span class='match'>country<\/span><\/li>\n  <li><span class='match'>current<\/span><\/li>\n  <li><span class='match'>decisio<\/span>n<\/li>\n  <li><span class='match'>definit<\/span>e<\/li>\n  <li><span class='match'>departm<\/span>ent<\/li>\n  <li><span class='match'>describ<\/span>e<\/li>\n  <li><span class='match'>develop<\/span><\/li>\n  <li><span class='match'>differe<\/span>nce<\/li>\n  <li><span class='match'>difficu<\/span>lt<\/li>\n  <li><span class='match'>discuss<\/span><\/li>\n  <li><span class='match'>distric<\/span>t<\/li>\n  <li><span class='match'>documen<\/span>t<\/li>\n  <li><span class='match'>economy<\/span><\/li>\n  <li><span class='match'>educate<\/span><\/li>\n  <li><span class='match'>electri<\/span>c<\/li>\n  <li><span class='match'>encoura<\/span>ge<\/li>\n  <li><span class='match'>english<\/span><\/li>\n  <li><span class='match'>environ<\/span>ment<\/li>\n  <li><span class='match'>especia<\/span>l<\/li>\n  <li><span class='match'>evening<\/span><\/li>\n  <li><span class='match'>evidenc<\/span>e<\/li>\n  <li><span class='match'>example<\/span><\/li>\n  <li><span class='match'>exercis<\/span>e<\/li>\n  <li><span class='match'>expense<\/span><\/li>\n  <li><span class='match'>experie<\/span>nce<\/li>\n  <li><span class='match'>explain<\/span><\/li>\n  <li><span class='match'>express<\/span><\/li>\n  <li><span class='match'>finance<\/span><\/li>\n  <li><span class='match'>fortune<\/span><\/li>\n  <li><span class='match'>forward<\/span><\/li>\n  <li><span class='match'>functio<\/span>n<\/li>\n  <li><span class='match'>further<\/span><\/li>\n  <li><span class='match'>general<\/span><\/li>\n  <li><span class='match'>germany<\/span><\/li>\n  <li><span class='match'>goodbye<\/span><\/li>\n  <li><span class='match'>history<\/span><\/li>\n  <li><span class='match'>holiday<\/span><\/li>\n  <li><span class='match'>hospita<\/span>l<\/li>\n  <li><span class='match'>however<\/span><\/li>\n  <li><span class='match'>hundred<\/span><\/li>\n  <li><span class='match'>husband<\/span><\/li>\n  <li><span class='match'>identif<\/span>y<\/li>\n  <li><span class='match'>imagine<\/span><\/li>\n  <li><span class='match'>importa<\/span>nt<\/li>\n  <li><span class='match'>improve<\/span><\/li>\n  <li><span class='match'>include<\/span><\/li>\n  <li><span class='match'>increas<\/span>e<\/li>\n  <li><span class='match'>individ<\/span>ual<\/li>\n  <li><span class='match'>industr<\/span>y<\/li>\n  <li><span class='match'>instead<\/span><\/li>\n  <li><span class='match'>interes<\/span>t<\/li>\n  <li><span class='match'>introdu<\/span>ce<\/li>\n  <li><span class='match'>involve<\/span><\/li>\n  <li><span class='match'>kitchen<\/span><\/li>\n  <li><span class='match'>languag<\/span>e<\/li>\n  <li><span class='match'>machine<\/span><\/li>\n  <li><span class='match'>meaning<\/span><\/li>\n  <li><span class='match'>measure<\/span><\/li>\n  <li><span class='match'>mention<\/span><\/li>\n  <li><span class='match'>million<\/span><\/li>\n  <li><span class='match'>ministe<\/span>r<\/li>\n  <li><span class='match'>morning<\/span><\/li>\n  <li><span class='match'>necessa<\/span>ry<\/li>\n  <li><span class='match'>obvious<\/span><\/li>\n  <li><span class='match'>occasio<\/span>n<\/li>\n  <li><span class='match'>operate<\/span><\/li>\n  <li><span class='match'>opportu<\/span>nity<\/li>\n  <li><span class='match'>organiz<\/span>e<\/li>\n  <li><span class='match'>origina<\/span>l<\/li>\n  <li><span class='match'>otherwi<\/span>se<\/li>\n  <li><span class='match'>paragra<\/span>ph<\/li>\n  <li><span class='match'>particu<\/span>lar<\/li>\n  <li><span class='match'>pension<\/span><\/li>\n  <li><span class='match'>percent<\/span><\/li>\n  <li><span class='match'>perfect<\/span><\/li>\n  <li><span class='match'>perhaps<\/span><\/li>\n  <li><span class='match'>photogr<\/span>aph<\/li>\n  <li><span class='match'>picture<\/span><\/li>\n  <li><span class='match'>politic<\/span><\/li>\n  <li><span class='match'>positio<\/span>n<\/li>\n  <li><span class='match'>positiv<\/span>e<\/li>\n  <li><span class='match'>possibl<\/span>e<\/li>\n  <li><span class='match'>practis<\/span>e<\/li>\n  <li><span class='match'>prepare<\/span><\/li>\n  <li><span class='match'>present<\/span><\/li>\n  <li><span class='match'>pressur<\/span>e<\/li>\n  <li><span class='match'>presume<\/span><\/li>\n  <li><span class='match'>previou<\/span>s<\/li>\n  <li><span class='match'>private<\/span><\/li>\n  <li><span class='match'>probabl<\/span>e<\/li>\n  <li><span class='match'>problem<\/span><\/li>\n  <li><span class='match'>proceed<\/span><\/li>\n  <li><span class='match'>process<\/span><\/li>\n  <li><span class='match'>produce<\/span><\/li>\n  <li><span class='match'>product<\/span><\/li>\n  <li><span class='match'>program<\/span>me<\/li>\n  <li><span class='match'>project<\/span><\/li>\n  <li><span class='match'>propose<\/span><\/li>\n  <li><span class='match'>protect<\/span><\/li>\n  <li><span class='match'>provide<\/span><\/li>\n  <li><span class='match'>purpose<\/span><\/li>\n  <li><span class='match'>quality<\/span><\/li>\n  <li><span class='match'>quarter<\/span><\/li>\n  <li><span class='match'>questio<\/span>n<\/li>\n  <li><span class='match'>realise<\/span><\/li>\n  <li><span class='match'>receive<\/span><\/li>\n  <li><span class='match'>recogni<\/span>ze<\/li>\n  <li><span class='match'>recomme<\/span>nd<\/li>\n  <li><span class='match'>relatio<\/span>n<\/li>\n  <li><span class='match'>remembe<\/span>r<\/li>\n  <li><span class='match'>represe<\/span>nt<\/li>\n  <li><span class='match'>require<\/span><\/li>\n  <li><span class='match'>researc<\/span>h<\/li>\n  <li><span class='match'>resourc<\/span>e<\/li>\n  <li><span class='match'>respect<\/span><\/li>\n  <li><span class='match'>respons<\/span>ible<\/li>\n  <li><span class='match'>saturda<\/span>y<\/li>\n  <li><span class='match'>science<\/span><\/li>\n  <li><span class='match'>scotlan<\/span>d<\/li>\n  <li><span class='match'>secreta<\/span>ry<\/li>\n  <li><span class='match'>section<\/span><\/li>\n  <li><span class='match'>separat<\/span>e<\/li>\n  <li><span class='match'>serious<\/span><\/li>\n  <li><span class='match'>service<\/span><\/li>\n  <li><span class='match'>similar<\/span><\/li>\n  <li><span class='match'>situate<\/span><\/li>\n  <li><span class='match'>society<\/span><\/li>\n  <li><span class='match'>special<\/span><\/li>\n  <li><span class='match'>specifi<\/span>c<\/li>\n  <li><span class='match'>standar<\/span>d<\/li>\n  <li><span class='match'>station<\/span><\/li>\n  <li><span class='match'>straigh<\/span>t<\/li>\n  <li><span class='match'>strateg<\/span>y<\/li>\n  <li><span class='match'>structu<\/span>re<\/li>\n  <li><span class='match'>student<\/span><\/li>\n  <li><span class='match'>subject<\/span><\/li>\n  <li><span class='match'>succeed<\/span><\/li>\n  <li><span class='match'>suggest<\/span><\/li>\n  <li><span class='match'>support<\/span><\/li>\n  <li><span class='match'>suppose<\/span><\/li>\n  <li><span class='match'>surpris<\/span>e<\/li>\n  <li><span class='match'>telepho<\/span>ne<\/li>\n  <li><span class='match'>televis<\/span>ion<\/li>\n  <li><span class='match'>terribl<\/span>e<\/li>\n  <li><span class='match'>therefo<\/span>re<\/li>\n  <li><span class='match'>thirtee<\/span>n<\/li>\n  <li><span class='match'>thousan<\/span>d<\/li>\n  <li><span class='match'>through<\/span><\/li>\n  <li><span class='match'>thursda<\/span>y<\/li>\n  <li><span class='match'>togethe<\/span>r<\/li>\n  <li><span class='match'>tomorro<\/span>w<\/li>\n  <li><span class='match'>tonight<\/span><\/li>\n  <li><span class='match'>traffic<\/span><\/li>\n  <li><span class='match'>transpo<\/span>rt<\/li>\n  <li><span class='match'>trouble<\/span><\/li>\n  <li><span class='match'>tuesday<\/span><\/li>\n  <li><span class='match'>underst<\/span>and<\/li>\n  <li><span class='match'>univers<\/span>ity<\/li>\n  <li><span class='match'>various<\/span><\/li>\n  <li><span class='match'>village<\/span><\/li>\n  <li><span class='match'>wednesd<\/span>ay<\/li>\n  <li><span class='match'>welcome<\/span><\/li>\n  <li><span class='match'>whether<\/span><\/li>\n  <li><span class='match'>without<\/span><\/li>\n  <li><span class='match'>yesterd<\/span>ay<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="character-classes-and-alternatives" class="section level3">
<h3><span class="header-section-number">13.3.3</span> Character classes and alternatives</h3>
<div id="exercise-1-28" class="section level4 exercise">
<h4><span class="header-section-number">13.3.3.1</span> Exercise 1</h4>
<div class="question">
<p>Create regular expressions to find all words that:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Start with a vowel.</li>
<li>That only contain consonants. (Hint: thinking about matching “not”-vowels.)</li>
<li>End with <code>ed</code>, but not with <code>eed</code>.</li>
<li>End with <code>ing</code> or <code>ise</code>.</li>
</ol>
</blockquote>
<p>Words starting with vowels</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^[aeiou]&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-b5df02e3ff805bc695a2" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b5df02e3ff805bc695a2">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span><\/li>\n  <li><span class='match'>a<\/span>ble<\/li>\n  <li><span class='match'>a<\/span>bout<\/li>\n  <li><span class='match'>a<\/span>bsolute<\/li>\n  <li><span class='match'>a<\/span>ccept<\/li>\n  <li><span class='match'>a<\/span>ccount<\/li>\n  <li><span class='match'>a<\/span>chieve<\/li>\n  <li><span class='match'>a<\/span>cross<\/li>\n  <li><span class='match'>a<\/span>ct<\/li>\n  <li><span class='match'>a<\/span>ctive<\/li>\n  <li><span class='match'>a<\/span>ctual<\/li>\n  <li><span class='match'>a<\/span>dd<\/li>\n  <li><span class='match'>a<\/span>ddress<\/li>\n  <li><span class='match'>a<\/span>dmit<\/li>\n  <li><span class='match'>a<\/span>dvertise<\/li>\n  <li><span class='match'>a<\/span>ffect<\/li>\n  <li><span class='match'>a<\/span>fford<\/li>\n  <li><span class='match'>a<\/span>fter<\/li>\n  <li><span class='match'>a<\/span>fternoon<\/li>\n  <li><span class='match'>a<\/span>gain<\/li>\n  <li><span class='match'>a<\/span>gainst<\/li>\n  <li><span class='match'>a<\/span>ge<\/li>\n  <li><span class='match'>a<\/span>gent<\/li>\n  <li><span class='match'>a<\/span>go<\/li>\n  <li><span class='match'>a<\/span>gree<\/li>\n  <li><span class='match'>a<\/span>ir<\/li>\n  <li><span class='match'>a<\/span>ll<\/li>\n  <li><span class='match'>a<\/span>llow<\/li>\n  <li><span class='match'>a<\/span>lmost<\/li>\n  <li><span class='match'>a<\/span>long<\/li>\n  <li><span class='match'>a<\/span>lready<\/li>\n  <li><span class='match'>a<\/span>lright<\/li>\n  <li><span class='match'>a<\/span>lso<\/li>\n  <li><span class='match'>a<\/span>lthough<\/li>\n  <li><span class='match'>a<\/span>lways<\/li>\n  <li><span class='match'>a<\/span>merica<\/li>\n  <li><span class='match'>a<\/span>mount<\/li>\n  <li><span class='match'>a<\/span>nd<\/li>\n  <li><span class='match'>a<\/span>nother<\/li>\n  <li><span class='match'>a<\/span>nswer<\/li>\n  <li><span class='match'>a<\/span>ny<\/li>\n  <li><span class='match'>a<\/span>part<\/li>\n  <li><span class='match'>a<\/span>pparent<\/li>\n  <li><span class='match'>a<\/span>ppear<\/li>\n  <li><span class='match'>a<\/span>pply<\/li>\n  <li><span class='match'>a<\/span>ppoint<\/li>\n  <li><span class='match'>a<\/span>pproach<\/li>\n  <li><span class='match'>a<\/span>ppropriate<\/li>\n  <li><span class='match'>a<\/span>rea<\/li>\n  <li><span class='match'>a<\/span>rgue<\/li>\n  <li><span class='match'>a<\/span>rm<\/li>\n  <li><span class='match'>a<\/span>round<\/li>\n  <li><span class='match'>a<\/span>rrange<\/li>\n  <li><span class='match'>a<\/span>rt<\/li>\n  <li><span class='match'>a<\/span>s<\/li>\n  <li><span class='match'>a<\/span>sk<\/li>\n  <li><span class='match'>a<\/span>ssociate<\/li>\n  <li><span class='match'>a<\/span>ssume<\/li>\n  <li><span class='match'>a<\/span>t<\/li>\n  <li><span class='match'>a<\/span>ttend<\/li>\n  <li><span class='match'>a<\/span>uthority<\/li>\n  <li><span class='match'>a<\/span>vailable<\/li>\n  <li><span class='match'>a<\/span>ware<\/li>\n  <li><span class='match'>a<\/span>way<\/li>\n  <li><span class='match'>a<\/span>wful<\/li>\n  <li><span class='match'>e<\/span>ach<\/li>\n  <li><span class='match'>e<\/span>arly<\/li>\n  <li><span class='match'>e<\/span>ast<\/li>\n  <li><span class='match'>e<\/span>asy<\/li>\n  <li><span class='match'>e<\/span>at<\/li>\n  <li><span class='match'>e<\/span>conomy<\/li>\n  <li><span class='match'>e<\/span>ducate<\/li>\n  <li><span class='match'>e<\/span>ffect<\/li>\n  <li><span class='match'>e<\/span>gg<\/li>\n  <li><span class='match'>e<\/span>ight<\/li>\n  <li><span class='match'>e<\/span>ither<\/li>\n  <li><span class='match'>e<\/span>lect<\/li>\n  <li><span class='match'>e<\/span>lectric<\/li>\n  <li><span class='match'>e<\/span>leven<\/li>\n  <li><span class='match'>e<\/span>lse<\/li>\n  <li><span class='match'>e<\/span>mploy<\/li>\n  <li><span class='match'>e<\/span>ncourage<\/li>\n  <li><span class='match'>e<\/span>nd<\/li>\n  <li><span class='match'>e<\/span>ngine<\/li>\n  <li><span class='match'>e<\/span>nglish<\/li>\n  <li><span class='match'>e<\/span>njoy<\/li>\n  <li><span class='match'>e<\/span>nough<\/li>\n  <li><span class='match'>e<\/span>nter<\/li>\n  <li><span class='match'>e<\/span>nvironment<\/li>\n  <li><span class='match'>e<\/span>qual<\/li>\n  <li><span class='match'>e<\/span>special<\/li>\n  <li><span class='match'>e<\/span>urope<\/li>\n  <li><span class='match'>e<\/span>ven<\/li>\n  <li><span class='match'>e<\/span>vening<\/li>\n  <li><span class='match'>e<\/span>ver<\/li>\n  <li><span class='match'>e<\/span>very<\/li>\n  <li><span class='match'>e<\/span>vidence<\/li>\n  <li><span class='match'>e<\/span>xact<\/li>\n  <li><span class='match'>e<\/span>xample<\/li>\n  <li><span class='match'>e<\/span>xcept<\/li>\n  <li><span class='match'>e<\/span>xcuse<\/li>\n  <li><span class='match'>e<\/span>xercise<\/li>\n  <li><span class='match'>e<\/span>xist<\/li>\n  <li><span class='match'>e<\/span>xpect<\/li>\n  <li><span class='match'>e<\/span>xpense<\/li>\n  <li><span class='match'>e<\/span>xperience<\/li>\n  <li><span class='match'>e<\/span>xplain<\/li>\n  <li><span class='match'>e<\/span>xpress<\/li>\n  <li><span class='match'>e<\/span>xtra<\/li>\n  <li><span class='match'>e<\/span>ye<\/li>\n  <li><span class='match'>i<\/span>dea<\/li>\n  <li><span class='match'>i<\/span>dentify<\/li>\n  <li><span class='match'>i<\/span>f<\/li>\n  <li><span class='match'>i<\/span>magine<\/li>\n  <li><span class='match'>i<\/span>mportant<\/li>\n  <li><span class='match'>i<\/span>mprove<\/li>\n  <li><span class='match'>i<\/span>n<\/li>\n  <li><span class='match'>i<\/span>nclude<\/li>\n  <li><span class='match'>i<\/span>ncome<\/li>\n  <li><span class='match'>i<\/span>ncrease<\/li>\n  <li><span class='match'>i<\/span>ndeed<\/li>\n  <li><span class='match'>i<\/span>ndividual<\/li>\n  <li><span class='match'>i<\/span>ndustry<\/li>\n  <li><span class='match'>i<\/span>nform<\/li>\n  <li><span class='match'>i<\/span>nside<\/li>\n  <li><span class='match'>i<\/span>nstead<\/li>\n  <li><span class='match'>i<\/span>nsure<\/li>\n  <li><span class='match'>i<\/span>nterest<\/li>\n  <li><span class='match'>i<\/span>nto<\/li>\n  <li><span class='match'>i<\/span>ntroduce<\/li>\n  <li><span class='match'>i<\/span>nvest<\/li>\n  <li><span class='match'>i<\/span>nvolve<\/li>\n  <li><span class='match'>i<\/span>ssue<\/li>\n  <li><span class='match'>i<\/span>t<\/li>\n  <li><span class='match'>i<\/span>tem<\/li>\n  <li><span class='match'>o<\/span>bvious<\/li>\n  <li><span class='match'>o<\/span>ccasion<\/li>\n  <li><span class='match'>o<\/span>dd<\/li>\n  <li><span class='match'>o<\/span>f<\/li>\n  <li><span class='match'>o<\/span>ff<\/li>\n  <li><span class='match'>o<\/span>ffer<\/li>\n  <li><span class='match'>o<\/span>ffice<\/li>\n  <li><span class='match'>o<\/span>ften<\/li>\n  <li><span class='match'>o<\/span>kay<\/li>\n  <li><span class='match'>o<\/span>ld<\/li>\n  <li><span class='match'>o<\/span>n<\/li>\n  <li><span class='match'>o<\/span>nce<\/li>\n  <li><span class='match'>o<\/span>ne<\/li>\n  <li><span class='match'>o<\/span>nly<\/li>\n  <li><span class='match'>o<\/span>pen<\/li>\n  <li><span class='match'>o<\/span>perate<\/li>\n  <li><span class='match'>o<\/span>pportunity<\/li>\n  <li><span class='match'>o<\/span>ppose<\/li>\n  <li><span class='match'>o<\/span>r<\/li>\n  <li><span class='match'>o<\/span>rder<\/li>\n  <li><span class='match'>o<\/span>rganize<\/li>\n  <li><span class='match'>o<\/span>riginal<\/li>\n  <li><span class='match'>o<\/span>ther<\/li>\n  <li><span class='match'>o<\/span>therwise<\/li>\n  <li><span class='match'>o<\/span>ught<\/li>\n  <li><span class='match'>o<\/span>ut<\/li>\n  <li><span class='match'>o<\/span>ver<\/li>\n  <li><span class='match'>o<\/span>wn<\/li>\n  <li><span class='match'>u<\/span>nder<\/li>\n  <li><span class='match'>u<\/span>nderstand<\/li>\n  <li><span class='match'>u<\/span>nion<\/li>\n  <li><span class='match'>u<\/span>nit<\/li>\n  <li><span class='match'>u<\/span>nite<\/li>\n  <li><span class='match'>u<\/span>niversity<\/li>\n  <li><span class='match'>u<\/span>nless<\/li>\n  <li><span class='match'>u<\/span>ntil<\/li>\n  <li><span class='match'>u<\/span>p<\/li>\n  <li><span class='match'>u<\/span>pon<\/li>\n  <li><span class='match'>u<\/span>se<\/li>\n  <li><span class='match'>u<\/span>sual<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Words that contain only consonants</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^[^aeiou]+$&quot;</span>, <span class="dt">match=</span><span class="ot">TRUE</span>)</code></pre></div>
<p><div id="htmlwidget-db9140ebde3f67c51e31" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-db9140ebde3f67c51e31">{"x":{"html":"<ul>\n  <li><span class='match'>by<\/span><\/li>\n  <li><span class='match'>dry<\/span><\/li>\n  <li><span class='match'>fly<\/span><\/li>\n  <li><span class='match'>mrs<\/span><\/li>\n  <li><span class='match'>try<\/span><\/li>\n  <li><span class='match'>why<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> This seems to require using the <code>+</code> pattern introduced later, unless one wants to be very verbose and specify words of certain lengths.</p>
<p>Words that end with <code>ed</code> but not with <code>eed</code>. This handles the special case of “ed”, as well as words with length &gt; 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^ed$|[^e]ed$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-2aa9dbed8d93af3e0be8" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-2aa9dbed8d93af3e0be8">{"x":{"html":"<ul>\n  <li><span class='match'>bed<\/span><\/li>\n  <li>hund<span class='match'>red<\/span><\/li>\n  <li><span class='match'>red<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Words ending in <code>ing</code> or <code>ise</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;i(ng|se)$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-12ff9c2ce809973ce8d1" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-12ff9c2ce809973ce8d1">{"x":{"html":"<ul>\n  <li>advert<span class='match'>ise<\/span><\/li>\n  <li>br<span class='match'>ing<\/span><\/li>\n  <li>dur<span class='match'>ing<\/span><\/li>\n  <li>even<span class='match'>ing<\/span><\/li>\n  <li>exerc<span class='match'>ise<\/span><\/li>\n  <li>k<span class='match'>ing<\/span><\/li>\n  <li>mean<span class='match'>ing<\/span><\/li>\n  <li>morn<span class='match'>ing<\/span><\/li>\n  <li>otherw<span class='match'>ise<\/span><\/li>\n  <li>pract<span class='match'>ise<\/span><\/li>\n  <li>ra<span class='match'>ise<\/span><\/li>\n  <li>real<span class='match'>ise<\/span><\/li>\n  <li>r<span class='match'>ing<\/span><\/li>\n  <li>r<span class='match'>ise<\/span><\/li>\n  <li>s<span class='match'>ing<\/span><\/li>\n  <li>surpr<span class='match'>ise<\/span><\/li>\n  <li>th<span class='match'>ing<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-2-27" class="section level4 exercise">
<h4><span class="header-section-number">13.3.3.2</span> Exercise 2</h4>
<div class="question">
<p>Empirically verify the rule ``i before e except after c’’.</p>
</div>
<div class="answer">
<p>Using only what has been introduced thus far:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cei|[^c]ie)&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-b338ba377455914076ea" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b338ba377455914076ea">{"x":{"html":"<ul>\n  <li>ac<span class='match'>hie<\/span>ve<\/li>\n  <li>be<span class='match'>lie<\/span>ve<\/li>\n  <li>b<span class='match'>rie<\/span>f<\/li>\n  <li>c<span class='match'>lie<\/span>nt<\/li>\n  <li><span class='match'>die<\/span><\/li>\n  <li>expe<span class='match'>rie<\/span>nce<\/li>\n  <li><span class='match'>fie<\/span>ld<\/li>\n  <li>f<span class='match'>rie<\/span>nd<\/li>\n  <li><span class='match'>lie<\/span><\/li>\n  <li><span class='match'>pie<\/span>ce<\/li>\n  <li>q<span class='match'>uie<\/span>t<\/li>\n  <li>re<span class='match'>cei<\/span>ve<\/li>\n  <li><span class='match'>tie<\/span><\/li>\n  <li><span class='match'>vie<\/span>w<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cie|[^c]ei)&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-f9d1e794c5feb6374ab8" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f9d1e794c5feb6374ab8">{"x":{"html":"<ul>\n  <li>s<span class='match'>cie<\/span>nce<\/li>\n  <li>so<span class='match'>cie<\/span>ty<\/li>\n  <li><span class='match'>wei<\/span>gh<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Using <code>str_detect</code> we can count the number of words that follow these rules:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">str_detect</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cei|[^c]ie)&quot;</span>))
<span class="co">#&gt; [1] 14</span>
<span class="kw">sum</span>(<span class="kw">str_detect</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cie|[^c]ei)&quot;</span>))
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
<div id="exercise-3-23" class="section level4 exercise">
<h4><span class="header-section-number">13.3.3.3</span> Exercise 3</h4>
<div class="question">
<p>Is <code>q'' always followed by a</code>u’’?</p>
</div>
<div class="answer">
<p>In the <code>stringr::words</code> dataset, yes. In the full English language, no.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;q[^u]&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-dd3d01f170c0aa6859bc" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-dd3d01f170c0aa6859bc">{"x":{"html":"<ul>\n  <li><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-4-19" class="section level4 exercise">
<h4><span class="header-section-number">13.3.3.4</span> Exercise 4</h4>
<div class="question">
<p>Write a regular expression that matches a word if it’s probably written in British English, not American English.</p>
</div>
<div class="answer">
<p>In the general case, this is hard, and could require a dictionary. But, there are a few heuristics to consider that would account for some common cases: British English tends to use the following:</p>
<ul>
<li>“ou” instead of “o”</li>
<li>use of “ae” and “oe” instead of “a” and “o”</li>
<li>ends in <code>ise</code> instead of <code>ize</code></li>
<li>ends in <code>yse</code></li>
</ul>
<p>The regex <code>ou|ise^|ae|oe|yse^</code> would match these.</p>
<p>There are other [spelling differences between American and British English] (<a href="https://en.wikipedia.org/wiki/American_and_British_English_spelling_differences" class="uri">https://en.wikipedia.org/wiki/American_and_British_English_spelling_differences</a>) but they are not patterns amenable to regular expressions. It would require a dictionary with differences in spellings for different words.</p>
</div>
</div>
<div id="exercise-5-10" class="section level4 exercise">
<h4><span class="header-section-number">13.3.3.5</span> Exercise 5</h4>
<div class="question">
<p>Create a regular expression that will match telephone numbers as commonly written in your country.</p>
</div>
<div class="answer">
<p>The answer to this will vary by country.</p>
<p>For the United States, phone numbers have a format like <code>123-456-7890</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;123-456-7890&quot;</span>, <span class="st">&quot;1235-2351&quot;</span>)
<span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d-</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d-</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-aa15db13da1b7c3faf29" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-aa15db13da1b7c3faf29">{"x":{"html":"<ul>\n  <li><span class='match'>123-456-7890<\/span><\/li>\n  <li>1235-2351<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;[0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9][0-9][0-9]&quot;</span>)</code></pre></div>
<div id="htmlwidget-f3525ce3d319e7c562ff" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f3525ce3d319e7c562ff">{"x":{"html":"<ul>\n  <li>123-456-7890<\/li>\n  <li>1235-2351<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>This regular expression can be simplified with the <code>{m,n}</code> regular expression modifier introduced in the next section,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{3}-</span><span class="ch">\\</span><span class="st">d{3}-</span><span class="ch">\\</span><span class="st">d{4}&quot;</span>)</code></pre></div>
<div id="htmlwidget-59f2370825da36350af1" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-59f2370825da36350af1">{"x":{"html":"<ul>\n  <li><span class='match'>123-456-7890<\/span><\/li>\n  <li>1235-2351<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Note that this pattern doesn’t account for phone numbers that are invalid because of unassigned area code, or special numbers like 911, or extensions. See the Wikipedia page for the <a href="https://en.wikipedia.org/wiki/North_American_Numbering_Plan">North American Numbering Plan</a> for more information on the complexities of US phone numbers, and <a href="http://stackoverflow.com/questions/123559/a-comprehensive-regex-for-phone-number-validation">this Stack Overflow question</a> for a discussion of using a regex for phone number validation.</p>
</div>
</div>
</div>
<div id="repetition" class="section level3">
<h3><span class="header-section-number">13.3.4</span> Repetition</h3>
<div id="exercise-1-29" class="section level4 exercise">
<h4><span class="header-section-number">13.3.4.1</span> Exercise 1</h4>
<div class="question">
<p>Describe the equivalents of <code>?</code>, <code>+</code>, <code>*</code> in <code>{m,n}</code> form.</p>
</div>
<div class="answer">
<table>
<tbody>
<tr class="odd">
<td align="left"><code>-</code></td>
<td align="left"><code>{,1}</code></td>
<td align="left">Match at most 1</td>
</tr>
<tr class="even">
<td align="left"><code>+</code></td>
<td align="left"><code>{1,}</code></td>
<td align="left">Match one or more</td>
</tr>
<tr class="odd">
<td align="left"><code>*</code></td>
<td align="left">None</td>
<td align="left">No equivalent</td>
</tr>
</tbody>
</table>
<p>The <code>*</code> pattern has no <code>{m,n}</code> equivalent since there is no upper bound on the number of matches. The expected pattern <code>{,}</code> is not valid.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(<span class="st">&quot;abcd&quot;</span>, <span class="st">&quot;.{,}&quot;</span>)
<span class="co">#&gt; Error in stri_locate_first_regex(string, pattern, opts_regex = opts(pattern)): Error in {min,max} interval. (U_REGEX_BAD_INTERVAL)</span></code></pre></div>
</div>
</div>
<div id="exercise-2-28" class="section level4 exercise">
<h4><span class="header-section-number">13.3.4.2</span> Exercise 2</h4>
<div class="question">
<p>Describe in words what these regular expressions match: (read carefully to see if I’m using a regular expression or a string that defines a regular expression.)</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li><code>^.*$</code></li>
<li><code>&quot;\\{.+\\}&quot;</code></li>
<li><code>\d{4}-\d{2}-\d{2}</code></li>
<li><code>&quot;\\\\{4}&quot;</code></li>
</ol>
</blockquote>
<hr />
<p><code>^.*$</code> Any string <code>&quot;\\{.+\\}&quot;</code> Any string with curly braces surrounding at least one character. <code>\d{4}-\d{2}-\d{2}</code> Four digits followed by a hyphen, followed by two digits followed by a hyphen, followed by another two digits. This is a regular expression that can match dates formatted like “YYYY-MM-DD” (“%Y-%m-%d”). <code>&quot;\\\\{4}&quot;</code> This resolves to the regular expression <code>\\{4}</code>, which is four backslashes.</p>
<p>Examples:</p>
<ul>
<li><code>^.*$</code>: <code>c(&quot;dog&quot;, &quot;$1.23&quot;, &quot;lorem ipsum&quot;)</code></li>
<li><code>&quot;\\{.+\\}&quot;</code>: <code>c(&quot;{a}&quot;, &quot;{abc}&quot;)</code></li>
<li><code>\d{4}-\d{2}-\d{2}</code>: <code>2018-01-11</code></li>
<li><code>&quot;\\\\{4}&quot;</code>: <code>&quot;\\\\\\\\&quot;</code> (Backslashes in an R character vector need to be escaped.)</li>
</ul>
</div>
</div>
<div id="exercise-3-24" class="section level4 exercise">
<h4><span class="header-section-number">13.3.4.3</span> Exercise 3</h4>
<div class="question">
<p>Create regular expressions to find all words that:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Start with three consonants.</li>
<li>Have three or more vowels in a row.</li>
<li>Have two or more vowel-consonant pairs in a row.</li>
</ol>
</blockquote>
<p>A regex to find all words starting with three consonants</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;^[^aeiou]{3}&quot;</span>)</code></pre></div>
<div id="htmlwidget-3ec749e04bfb96c2d6c3" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3ec749e04bfb96c2d6c3">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>absolute<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li>agent<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li>along<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li>america<\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li>another<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li>apart<\/li>\n  <li>apparent<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>appropriate<\/li>\n  <li>area<\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>authority<\/li>\n  <li>available<\/li>\n  <li>aware<\/li>\n  <li>away<\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>balance<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>basis<\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>beauty<\/li>\n  <li>because<\/li>\n  <li>become<\/li>\n  <li>bed<\/li>\n  <li>before<\/li>\n  <li>begin<\/li>\n  <li>behind<\/li>\n  <li>believe<\/li>\n  <li>benefit<\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>business<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>character<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li><span class='match'>Chr<\/span>ist<\/li>\n  <li><span class='match'>Chr<\/span>istmas<\/li>\n  <li>church<\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>closes<\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>community<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>condition<\/li>\n  <li>confer<\/li>\n  <li>consider<\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>cover<\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li>dad<\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li>dead<\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>debate<\/li>\n  <li>decide<\/li>\n  <li>decision<\/li>\n  <li>deep<\/li>\n  <li>definite<\/li>\n  <li>degree<\/li>\n  <li>department<\/li>\n  <li>depend<\/li>\n  <li>describe<\/li>\n  <li>design<\/li>\n  <li>detail<\/li>\n  <li>develop<\/li>\n  <li>die<\/li>\n  <li>difference<\/li>\n  <li>difficult<\/li>\n  <li>dinner<\/li>\n  <li>direct<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>divide<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>document<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li><span class='match'>dry<\/span><\/li>\n  <li>due<\/li>\n  <li>during<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li>economy<\/li>\n  <li>educate<\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li>elect<\/li>\n  <li>electric<\/li>\n  <li>eleven<\/li>\n  <li>else<\/li>\n  <li>employ<\/li>\n  <li>encourage<\/li>\n  <li>end<\/li>\n  <li>engine<\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li>environment<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li>europe<\/li>\n  <li>even<\/li>\n  <li>evening<\/li>\n  <li>ever<\/li>\n  <li>every<\/li>\n  <li>evidence<\/li>\n  <li>exact<\/li>\n  <li>example<\/li>\n  <li>except<\/li>\n  <li>excuse<\/li>\n  <li>exercise<\/li>\n  <li>exist<\/li>\n  <li>expect<\/li>\n  <li>expense<\/li>\n  <li>experience<\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li>eye<\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>family<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>figure<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>final<\/li>\n  <li>finance<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>finish<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li><span class='match'>fly<\/span><\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>friday<\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>future<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>general<\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>govern<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li>health<\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li>high<\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>holiday<\/li>\n  <li>home<\/li>\n  <li>honest<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hospital<\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>however<\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li>identify<\/li>\n  <li>if<\/li>\n  <li>imagine<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>individual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>interest<\/li>\n  <li>into<\/li>\n  <li>introduce<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li>item<\/li>\n  <li>jesus<\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li>knock<\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li>level<\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>likely<\/li>\n  <li>limit<\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li>local<\/li>\n  <li>lock<\/li>\n  <li>london<\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>major<\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>manage<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>meaning<\/li>\n  <li>measure<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>minister<\/li>\n  <li>minus<\/li>\n  <li>minute<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>moment<\/li>\n  <li>monday<\/li>\n  <li>money<\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li><span class='match'>mrs<\/span><\/li>\n  <li>much<\/li>\n  <li>music<\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li>nation<\/li>\n  <li>nature<\/li>\n  <li>near<\/li>\n  <li>necessary<\/li>\n  <li>need<\/li>\n  <li>never<\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li>non<\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>notice<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obvious<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li>okay<\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li>open<\/li>\n  <li>operate<\/li>\n  <li>opportunity<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>organize<\/li>\n  <li>original<\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li>over<\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>paper<\/li>\n  <li>paragraph<\/li>\n  <li>pardon<\/li>\n  <li>parent<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>particular<\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li>photograph<\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>police<\/li>\n  <li>policy<\/li>\n  <li>politic<\/li>\n  <li>poor<\/li>\n  <li>position<\/li>\n  <li>positive<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>power<\/li>\n  <li>practise<\/li>\n  <li>prepare<\/li>\n  <li>present<\/li>\n  <li>press<\/li>\n  <li>pressure<\/li>\n  <li>presume<\/li>\n  <li>pretty<\/li>\n  <li>previous<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>private<\/li>\n  <li>probable<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>process<\/li>\n  <li>produce<\/li>\n  <li>product<\/li>\n  <li>programme<\/li>\n  <li>project<\/li>\n  <li>proper<\/li>\n  <li>propose<\/li>\n  <li>protect<\/li>\n  <li>provide<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>quality<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>quiet<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li>rather<\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>realise<\/li>\n  <li>really<\/li>\n  <li>reason<\/li>\n  <li>receive<\/li>\n  <li>recent<\/li>\n  <li>reckon<\/li>\n  <li>recognize<\/li>\n  <li>recommend<\/li>\n  <li>record<\/li>\n  <li>red<\/li>\n  <li>reduce<\/li>\n  <li>refer<\/li>\n  <li>regard<\/li>\n  <li>region<\/li>\n  <li>relation<\/li>\n  <li>remember<\/li>\n  <li>report<\/li>\n  <li>represent<\/li>\n  <li>require<\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>result<\/li>\n  <li>return<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>saturday<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li><span class='match'>sch<\/span>eme<\/li>\n  <li><span class='match'>sch<\/span>ool<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>second<\/li>\n  <li>secretary<\/li>\n  <li>section<\/li>\n  <li>secure<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li>sense<\/li>\n  <li>separate<\/li>\n  <li>serious<\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>seven<\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>similar<\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>specific<\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li>stairs<\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li><span class='match'>str<\/span>aight<\/li>\n  <li><span class='match'>str<\/span>ategy<\/li>\n  <li><span class='match'>str<\/span>eet<\/li>\n  <li><span class='match'>str<\/span>ike<\/li>\n  <li><span class='match'>str<\/span>ong<\/li>\n  <li><span class='match'>str<\/span>ucture<\/li>\n  <li>student<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>stupid<\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li><span class='match'>sys<\/span>tem<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>telephone<\/li>\n  <li>television<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li>test<\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>therefore<\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>thousand<\/li>\n  <li><span class='match'>thr<\/span>ee<\/li>\n  <li><span class='match'>thr<\/span>ough<\/li>\n  <li><span class='match'>thr<\/span>ow<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>today<\/li>\n  <li>together<\/li>\n  <li>tomorrow<\/li>\n  <li>tonight<\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>total<\/li>\n  <li>touch<\/li>\n  <li>toward<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li>transport<\/li>\n  <li>travel<\/li>\n  <li>treat<\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li>trust<\/li>\n  <li><span class='match'>try<\/span><\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li><span class='match'>typ<\/span>e<\/li>\n  <li>under<\/li>\n  <li>understand<\/li>\n  <li>union<\/li>\n  <li>unit<\/li>\n  <li>unite<\/li>\n  <li>university<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li>upon<\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>various<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>visit<\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>water<\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>whether<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li><span class='match'>why<\/span><\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li>window<\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>woman<\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li>yesterday<\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>A regex to find three or more vowels in a row:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;[aeiou]{3,}&quot;</span>)</code></pre></div>
<div id="htmlwidget-6a2314a79aa854fab7df" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-6a2314a79aa854fab7df">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>absolute<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li>agent<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li>along<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li>america<\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li>another<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li>apart<\/li>\n  <li>apparent<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>appropriate<\/li>\n  <li>area<\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>authority<\/li>\n  <li>available<\/li>\n  <li>aware<\/li>\n  <li>away<\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>balance<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>basis<\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>b<span class='match'>eau<\/span>ty<\/li>\n  <li>because<\/li>\n  <li>become<\/li>\n  <li>bed<\/li>\n  <li>before<\/li>\n  <li>begin<\/li>\n  <li>behind<\/li>\n  <li>believe<\/li>\n  <li>benefit<\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>business<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>character<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li>Christ<\/li>\n  <li>Christmas<\/li>\n  <li>church<\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>closes<\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>community<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>condition<\/li>\n  <li>confer<\/li>\n  <li>consider<\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>cover<\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li>dad<\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li>dead<\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>debate<\/li>\n  <li>decide<\/li>\n  <li>decision<\/li>\n  <li>deep<\/li>\n  <li>definite<\/li>\n  <li>degree<\/li>\n  <li>department<\/li>\n  <li>depend<\/li>\n  <li>describe<\/li>\n  <li>design<\/li>\n  <li>detail<\/li>\n  <li>develop<\/li>\n  <li>die<\/li>\n  <li>difference<\/li>\n  <li>difficult<\/li>\n  <li>dinner<\/li>\n  <li>direct<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>divide<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>document<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li>dry<\/li>\n  <li>due<\/li>\n  <li>during<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li>economy<\/li>\n  <li>educate<\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li>elect<\/li>\n  <li>electric<\/li>\n  <li>eleven<\/li>\n  <li>else<\/li>\n  <li>employ<\/li>\n  <li>encourage<\/li>\n  <li>end<\/li>\n  <li>engine<\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li>environment<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li>europe<\/li>\n  <li>even<\/li>\n  <li>evening<\/li>\n  <li>ever<\/li>\n  <li>every<\/li>\n  <li>evidence<\/li>\n  <li>exact<\/li>\n  <li>example<\/li>\n  <li>except<\/li>\n  <li>excuse<\/li>\n  <li>exercise<\/li>\n  <li>exist<\/li>\n  <li>expect<\/li>\n  <li>expense<\/li>\n  <li>experience<\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li>eye<\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>family<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>figure<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>final<\/li>\n  <li>finance<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>finish<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li>fly<\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>friday<\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>future<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>general<\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>govern<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li>health<\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li>high<\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>holiday<\/li>\n  <li>home<\/li>\n  <li>honest<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hospital<\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>however<\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li>identify<\/li>\n  <li>if<\/li>\n  <li>imagine<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>individual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>interest<\/li>\n  <li>into<\/li>\n  <li>introduce<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li>item<\/li>\n  <li>jesus<\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li>knock<\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li>level<\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>likely<\/li>\n  <li>limit<\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li>local<\/li>\n  <li>lock<\/li>\n  <li>london<\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>major<\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>manage<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>meaning<\/li>\n  <li>measure<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>minister<\/li>\n  <li>minus<\/li>\n  <li>minute<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>moment<\/li>\n  <li>monday<\/li>\n  <li>money<\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li>mrs<\/li>\n  <li>much<\/li>\n  <li>music<\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li>nation<\/li>\n  <li>nature<\/li>\n  <li>near<\/li>\n  <li>necessary<\/li>\n  <li>need<\/li>\n  <li>never<\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li>non<\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>notice<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obv<span class='match'>iou<\/span>s<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li>okay<\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li>open<\/li>\n  <li>operate<\/li>\n  <li>opportunity<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>organize<\/li>\n  <li>original<\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li>over<\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>paper<\/li>\n  <li>paragraph<\/li>\n  <li>pardon<\/li>\n  <li>parent<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>particular<\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li>photograph<\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>police<\/li>\n  <li>policy<\/li>\n  <li>politic<\/li>\n  <li>poor<\/li>\n  <li>position<\/li>\n  <li>positive<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>power<\/li>\n  <li>practise<\/li>\n  <li>prepare<\/li>\n  <li>present<\/li>\n  <li>press<\/li>\n  <li>pressure<\/li>\n  <li>presume<\/li>\n  <li>pretty<\/li>\n  <li>prev<span class='match'>iou<\/span>s<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>private<\/li>\n  <li>probable<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>process<\/li>\n  <li>produce<\/li>\n  <li>product<\/li>\n  <li>programme<\/li>\n  <li>project<\/li>\n  <li>proper<\/li>\n  <li>propose<\/li>\n  <li>protect<\/li>\n  <li>provide<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>quality<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>q<span class='match'>uie<\/span>t<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li>rather<\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>realise<\/li>\n  <li>really<\/li>\n  <li>reason<\/li>\n  <li>receive<\/li>\n  <li>recent<\/li>\n  <li>reckon<\/li>\n  <li>recognize<\/li>\n  <li>recommend<\/li>\n  <li>record<\/li>\n  <li>red<\/li>\n  <li>reduce<\/li>\n  <li>refer<\/li>\n  <li>regard<\/li>\n  <li>region<\/li>\n  <li>relation<\/li>\n  <li>remember<\/li>\n  <li>report<\/li>\n  <li>represent<\/li>\n  <li>require<\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>result<\/li>\n  <li>return<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>saturday<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li>scheme<\/li>\n  <li>school<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>second<\/li>\n  <li>secretary<\/li>\n  <li>section<\/li>\n  <li>secure<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li>sense<\/li>\n  <li>separate<\/li>\n  <li>ser<span class='match'>iou<\/span>s<\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>seven<\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>similar<\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>specific<\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li>stairs<\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li>straight<\/li>\n  <li>strategy<\/li>\n  <li>street<\/li>\n  <li>strike<\/li>\n  <li>strong<\/li>\n  <li>structure<\/li>\n  <li>student<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>stupid<\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li>system<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>telephone<\/li>\n  <li>television<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li>test<\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>therefore<\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>thousand<\/li>\n  <li>three<\/li>\n  <li>through<\/li>\n  <li>throw<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>today<\/li>\n  <li>together<\/li>\n  <li>tomorrow<\/li>\n  <li>tonight<\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>total<\/li>\n  <li>touch<\/li>\n  <li>toward<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li>transport<\/li>\n  <li>travel<\/li>\n  <li>treat<\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li>trust<\/li>\n  <li>try<\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li>type<\/li>\n  <li>under<\/li>\n  <li>understand<\/li>\n  <li>union<\/li>\n  <li>unit<\/li>\n  <li>unite<\/li>\n  <li>university<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li>upon<\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>var<span class='match'>iou<\/span>s<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>visit<\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>water<\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>whether<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li>why<\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li>window<\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>woman<\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li>yesterday<\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Two or more vowel-consonant pairs in a row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;([aeiou][^aeiou]){2,}&quot;</span>)</code></pre></div>
<div id="htmlwidget-fb37aa630b9d9968db84" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-fb37aa630b9d9968db84">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>abs<span class='match'>olut<\/span>e<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li><span class='match'>agen<\/span>t<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li><span class='match'>alon<\/span>g<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li><span class='match'>americ<\/span>a<\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li><span class='match'>anot<\/span>her<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li><span class='match'>apar<\/span>t<\/li>\n  <li>app<span class='match'>aren<\/span>t<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>appropriate<\/li>\n  <li>area<\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>auth<span class='match'>orit<\/span>y<\/li>\n  <li>ava<span class='match'>ilab<\/span>le<\/li>\n  <li><span class='match'>awar<\/span>e<\/li>\n  <li><span class='match'>away<\/span><\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>b<span class='match'>alan<\/span>ce<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>b<span class='match'>asis<\/span><\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>beauty<\/li>\n  <li>because<\/li>\n  <li>b<span class='match'>ecom<\/span>e<\/li>\n  <li>bed<\/li>\n  <li>b<span class='match'>efor<\/span>e<\/li>\n  <li>b<span class='match'>egin<\/span><\/li>\n  <li>b<span class='match'>ehin<\/span>d<\/li>\n  <li>believe<\/li>\n  <li>b<span class='match'>enefit<\/span><\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>b<span class='match'>usines<\/span>s<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>ch<span class='match'>arac<\/span>ter<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li>Christ<\/li>\n  <li>Christmas<\/li>\n  <li>church<\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>cl<span class='match'>oses<\/span><\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>comm<span class='match'>unit<\/span>y<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>condition<\/li>\n  <li>confer<\/li>\n  <li>cons<span class='match'>ider<\/span><\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>c<span class='match'>over<\/span><\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li>dad<\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li>dead<\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>d<span class='match'>ebat<\/span>e<\/li>\n  <li>d<span class='match'>ecid<\/span>e<\/li>\n  <li>d<span class='match'>ecis<\/span>ion<\/li>\n  <li>deep<\/li>\n  <li>d<span class='match'>efinit<\/span>e<\/li>\n  <li>degree<\/li>\n  <li>d<span class='match'>epar<\/span>tment<\/li>\n  <li>d<span class='match'>epen<\/span>d<\/li>\n  <li>describe<\/li>\n  <li>d<span class='match'>esig<\/span>n<\/li>\n  <li>detail<\/li>\n  <li>d<span class='match'>evelop<\/span><\/li>\n  <li>die<\/li>\n  <li>diff<span class='match'>eren<\/span>ce<\/li>\n  <li>diff<span class='match'>icul<\/span>t<\/li>\n  <li>dinner<\/li>\n  <li>d<span class='match'>irec<\/span>t<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>d<span class='match'>ivid<\/span>e<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>d<span class='match'>ocumen<\/span>t<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li>dry<\/li>\n  <li>due<\/li>\n  <li>d<span class='match'>urin<\/span>g<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li><span class='match'>econom<\/span>y<\/li>\n  <li><span class='match'>educat<\/span>e<\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li><span class='match'>elec<\/span>t<\/li>\n  <li><span class='match'>elec<\/span>tric<\/li>\n  <li><span class='match'>eleven<\/span><\/li>\n  <li>else<\/li>\n  <li>employ<\/li>\n  <li>enco<span class='match'>urag<\/span>e<\/li>\n  <li>end<\/li>\n  <li>engine<\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li>env<span class='match'>iron<\/span>ment<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li>e<span class='match'>urop<\/span>e<\/li>\n  <li><span class='match'>even<\/span><\/li>\n  <li><span class='match'>evenin<\/span>g<\/li>\n  <li><span class='match'>ever<\/span><\/li>\n  <li><span class='match'>ever<\/span>y<\/li>\n  <li><span class='match'>eviden<\/span>ce<\/li>\n  <li><span class='match'>exac<\/span>t<\/li>\n  <li><span class='match'>exam<\/span>ple<\/li>\n  <li>except<\/li>\n  <li>excuse<\/li>\n  <li><span class='match'>exer<\/span>cise<\/li>\n  <li><span class='match'>exis<\/span>t<\/li>\n  <li>expect<\/li>\n  <li>expense<\/li>\n  <li>experience<\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li>eye<\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>f<span class='match'>amil<\/span>y<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>f<span class='match'>igur<\/span>e<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>f<span class='match'>inal<\/span><\/li>\n  <li>f<span class='match'>inan<\/span>ce<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>f<span class='match'>inis<\/span>h<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li>fly<\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>fr<span class='match'>iday<\/span><\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>f<span class='match'>utur<\/span>e<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>g<span class='match'>eneral<\/span><\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>g<span class='match'>over<\/span>n<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li>health<\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li>high<\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>h<span class='match'>oliday<\/span><\/li>\n  <li>home<\/li>\n  <li>h<span class='match'>ones<\/span>t<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hosp<span class='match'>ital<\/span><\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>h<span class='match'>owever<\/span><\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li><span class='match'>iden<\/span>tify<\/li>\n  <li>if<\/li>\n  <li><span class='match'>imagin<\/span>e<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>ind<span class='match'>ivid<\/span>ual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>int<span class='match'>eres<\/span>t<\/li>\n  <li>into<\/li>\n  <li>intr<span class='match'>oduc<\/span>e<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li><span class='match'>item<\/span><\/li>\n  <li>j<span class='match'>esus<\/span><\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li>knock<\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li>l<span class='match'>evel<\/span><\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>l<span class='match'>ikel<\/span>y<\/li>\n  <li>l<span class='match'>imit<\/span><\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li>l<span class='match'>ocal<\/span><\/li>\n  <li>lock<\/li>\n  <li>london<\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>m<span class='match'>ajor<\/span><\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>m<span class='match'>anag<\/span>e<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>me<span class='match'>anin<\/span>g<\/li>\n  <li>me<span class='match'>asur<\/span>e<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>m<span class='match'>inis<\/span>ter<\/li>\n  <li>m<span class='match'>inus<\/span><\/li>\n  <li>m<span class='match'>inut<\/span>e<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>m<span class='match'>omen<\/span>t<\/li>\n  <li>monday<\/li>\n  <li>m<span class='match'>oney<\/span><\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li>mrs<\/li>\n  <li>much<\/li>\n  <li>m<span class='match'>usic<\/span><\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li>nation<\/li>\n  <li>n<span class='match'>atur<\/span>e<\/li>\n  <li>near<\/li>\n  <li>n<span class='match'>eces<\/span>sary<\/li>\n  <li>need<\/li>\n  <li>n<span class='match'>ever<\/span><\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li>non<\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>n<span class='match'>otic<\/span>e<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obvious<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li><span class='match'>okay<\/span><\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li><span class='match'>open<\/span><\/li>\n  <li><span class='match'>operat<\/span>e<\/li>\n  <li>opport<span class='match'>unit<\/span>y<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>org<span class='match'>aniz<\/span>e<\/li>\n  <li><span class='match'>original<\/span><\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li><span class='match'>over<\/span><\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>p<span class='match'>aper<\/span><\/li>\n  <li>p<span class='match'>arag<\/span>raph<\/li>\n  <li>pardon<\/li>\n  <li>p<span class='match'>aren<\/span>t<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>part<span class='match'>icular<\/span><\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li>ph<span class='match'>otog<\/span>raph<\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>p<span class='match'>olic<\/span>e<\/li>\n  <li>p<span class='match'>olic<\/span>y<\/li>\n  <li>p<span class='match'>olitic<\/span><\/li>\n  <li>poor<\/li>\n  <li>p<span class='match'>osit<\/span>ion<\/li>\n  <li>p<span class='match'>ositiv<\/span>e<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>p<span class='match'>ower<\/span><\/li>\n  <li>practise<\/li>\n  <li>pr<span class='match'>epar<\/span>e<\/li>\n  <li>pr<span class='match'>esen<\/span>t<\/li>\n  <li>press<\/li>\n  <li>pressure<\/li>\n  <li>pr<span class='match'>esum<\/span>e<\/li>\n  <li>pretty<\/li>\n  <li>previous<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>pr<span class='match'>ivat<\/span>e<\/li>\n  <li>pr<span class='match'>obab<\/span>le<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>pr<span class='match'>oces<\/span>s<\/li>\n  <li>pr<span class='match'>oduc<\/span>e<\/li>\n  <li>pr<span class='match'>oduc<\/span>t<\/li>\n  <li>programme<\/li>\n  <li>pr<span class='match'>ojec<\/span>t<\/li>\n  <li>pr<span class='match'>oper<\/span><\/li>\n  <li>pr<span class='match'>opos<\/span>e<\/li>\n  <li>pr<span class='match'>otec<\/span>t<\/li>\n  <li>pr<span class='match'>ovid<\/span>e<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>qu<span class='match'>alit<\/span>y<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>quiet<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li>rather<\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>re<span class='match'>alis<\/span>e<\/li>\n  <li>really<\/li>\n  <li>re<span class='match'>ason<\/span><\/li>\n  <li>receive<\/li>\n  <li>r<span class='match'>ecen<\/span>t<\/li>\n  <li>reckon<\/li>\n  <li>r<span class='match'>ecog<\/span>nize<\/li>\n  <li>r<span class='match'>ecom<\/span>mend<\/li>\n  <li>r<span class='match'>ecor<\/span>d<\/li>\n  <li>red<\/li>\n  <li>r<span class='match'>educ<\/span>e<\/li>\n  <li>r<span class='match'>efer<\/span><\/li>\n  <li>r<span class='match'>egar<\/span>d<\/li>\n  <li>region<\/li>\n  <li>r<span class='match'>elat<\/span>ion<\/li>\n  <li>r<span class='match'>emem<\/span>ber<\/li>\n  <li>r<span class='match'>epor<\/span>t<\/li>\n  <li>repr<span class='match'>esen<\/span>t<\/li>\n  <li>require<\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>r<span class='match'>esul<\/span>t<\/li>\n  <li>r<span class='match'>etur<\/span>n<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>s<span class='match'>atur<\/span>day<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li>scheme<\/li>\n  <li>school<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>s<span class='match'>econ<\/span>d<\/li>\n  <li>secr<span class='match'>etar<\/span>y<\/li>\n  <li>section<\/li>\n  <li>s<span class='match'>ecur<\/span>e<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li>sense<\/li>\n  <li>s<span class='match'>eparat<\/span>e<\/li>\n  <li>serious<\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>s<span class='match'>even<\/span><\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>s<span class='match'>imilar<\/span><\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>sp<span class='match'>ecific<\/span><\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li>stairs<\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li>straight<\/li>\n  <li>str<span class='match'>ateg<\/span>y<\/li>\n  <li>street<\/li>\n  <li>strike<\/li>\n  <li>strong<\/li>\n  <li>structure<\/li>\n  <li>st<span class='match'>uden<\/span>t<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>st<span class='match'>upid<\/span><\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li>system<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>t<span class='match'>elep<\/span>hone<\/li>\n  <li>t<span class='match'>elevis<\/span>ion<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li>test<\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>th<span class='match'>erefor<\/span>e<\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>tho<span class='match'>usan<\/span>d<\/li>\n  <li>three<\/li>\n  <li>through<\/li>\n  <li>throw<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>t<span class='match'>oday<\/span><\/li>\n  <li>t<span class='match'>oget<\/span>her<\/li>\n  <li>t<span class='match'>omor<\/span>row<\/li>\n  <li>t<span class='match'>onig<\/span>ht<\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>t<span class='match'>otal<\/span><\/li>\n  <li>touch<\/li>\n  <li>t<span class='match'>owar<\/span>d<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li>transport<\/li>\n  <li>tr<span class='match'>avel<\/span><\/li>\n  <li>treat<\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li>trust<\/li>\n  <li>try<\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li>type<\/li>\n  <li>under<\/li>\n  <li>understand<\/li>\n  <li>union<\/li>\n  <li><span class='match'>unit<\/span><\/li>\n  <li><span class='match'>unit<\/span>e<\/li>\n  <li><span class='match'>univer<\/span>sity<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li><span class='match'>upon<\/span><\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>various<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>v<span class='match'>isit<\/span><\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>w<span class='match'>ater<\/span><\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>whether<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li>why<\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li>window<\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>w<span class='match'>oman<\/span><\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li>yesterday<\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-4-20" class="section level4 exercise">
<h4><span class="header-section-number">13.3.4.4</span> Exercise 4</h4>
<div class="question">
<p>Solve the beginner regexp crosswords at <a href="https://regexcrossword.com/challenges/" class="uri">https://regexcrossword.com/challenges/</a></p>
</div>
<div class="answer">
<p>Exercise left to reader. That site validates its solutions, so they aren’t repeated here.</p>
</div>
</div>
</div>
<div id="grouping-and-backreferences" class="section level3">
<h3><span class="header-section-number">13.3.5</span> Grouping and backreferences</h3>
<div id="exercise-1-30" class="section level4 exercise">
<h4><span class="header-section-number">13.3.5.1</span> Exercise 1</h4>
<div class="question">
<p>Describe, in words, what these expressions will match:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li><code>(.)\1\1</code> :</li>
<li><code>&quot;(.)(.)\\2\\1&quot;</code>:</li>
<li><code>(..)\1</code>: Any two characters repeated. E.g. <code>&quot;a1a1&quot;</code>.</li>
<li><code>&quot;(.).\\1.\\1&quot;</code>:</li>
<li><code>&quot;(.)(.)(.).*\\3\\2\\1&quot;</code></li>
</ol>
</blockquote>
<ol style="list-style-type: decimal">
<li><code>(.)\1\1</code> : The same character appearing three times in a row. E.g. <code>&quot;aaa&quot;</code></li>
<li><code>&quot;(.)(.)\\2\\1&quot;</code>: A pair of characters followed by the same pair of characters in reversed order. E.g. <code>&quot;abba&quot;</code>.</li>
<li><code>(..)\1</code>: Any two characters repeated. E.g. <code>&quot;a1a1&quot;</code>.</li>
<li><code>&quot;(.).\\1.\\1&quot;</code>: A character followed by any character, the original character, any other character, the original character again. E.g. <code>&quot;abaca&quot;</code>, <code>&quot;b8b.b&quot;</code>.</li>
<li><code>&quot;(.)(.)(.).*\\3\\2\\1&quot;</code> Three characters followed by zero or more characters of any kind followed by the same three characters but in reverse order. E.g. <code>&quot;abcsgasgddsadgsdgcba&quot;</code> or <code>&quot;abccba&quot;</code> or <code>&quot;abc1cba&quot;</code>.</li>
</ol>
</div>
</div>
<div id="exercise-2-29" class="section level4 exercise">
<h4><span class="header-section-number">13.3.5.2</span> Exercise 2</h4>
<div class="question">
<p>Construct regular expressions to match words that:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Start and end with the same character. Assuming the word is more than one character and all strings are considered words, <code>^(.).*\1$</code></li>
<li>Contain a repeated pair of letters (e.g. <code>church'' contains</code>ch’’ repeated twice.)</li>
<li>Contain one letter repeated in at least three places (e.g. <code>eleven'' contains three</code>e’’s.)</li>
</ol>
</blockquote>
<p>Start and end with the same character. Assuming the word is more than one character and all strings are considered words, <code>^(.).*\1$</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;^(.).*</span><span class="ch">\\</span><span class="st">1$&quot;</span>)</code></pre></div>
<div id="htmlwidget-fa04ac5febadaac18a3d" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-fa04ac5febadaac18a3d">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>absolute<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li>agent<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li>along<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li><span class='match'>america<\/span><\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li>another<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li>apart<\/li>\n  <li>apparent<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>appropriate<\/li>\n  <li><span class='match'>area<\/span><\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>authority<\/li>\n  <li>available<\/li>\n  <li>aware<\/li>\n  <li>away<\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>balance<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>basis<\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>beauty<\/li>\n  <li>because<\/li>\n  <li>become<\/li>\n  <li>bed<\/li>\n  <li>before<\/li>\n  <li>begin<\/li>\n  <li>behind<\/li>\n  <li>believe<\/li>\n  <li>benefit<\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>business<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>character<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li>Christ<\/li>\n  <li>Christmas<\/li>\n  <li>church<\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>closes<\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>community<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>condition<\/li>\n  <li>confer<\/li>\n  <li>consider<\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>cover<\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li><span class='match'>dad<\/span><\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li><span class='match'>dead<\/span><\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>debate<\/li>\n  <li>decide<\/li>\n  <li>decision<\/li>\n  <li>deep<\/li>\n  <li>definite<\/li>\n  <li>degree<\/li>\n  <li>department<\/li>\n  <li><span class='match'>depend<\/span><\/li>\n  <li>describe<\/li>\n  <li>design<\/li>\n  <li>detail<\/li>\n  <li>develop<\/li>\n  <li>die<\/li>\n  <li>difference<\/li>\n  <li>difficult<\/li>\n  <li>dinner<\/li>\n  <li>direct<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>divide<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>document<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li>dry<\/li>\n  <li>due<\/li>\n  <li>during<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li>economy<\/li>\n  <li><span class='match'>educate<\/span><\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li>elect<\/li>\n  <li>electric<\/li>\n  <li>eleven<\/li>\n  <li><span class='match'>else<\/span><\/li>\n  <li>employ<\/li>\n  <li><span class='match'>encourage<\/span><\/li>\n  <li>end<\/li>\n  <li><span class='match'>engine<\/span><\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li>environment<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li><span class='match'>europe<\/span><\/li>\n  <li>even<\/li>\n  <li>evening<\/li>\n  <li>ever<\/li>\n  <li>every<\/li>\n  <li><span class='match'>evidence<\/span><\/li>\n  <li>exact<\/li>\n  <li><span class='match'>example<\/span><\/li>\n  <li>except<\/li>\n  <li><span class='match'>excuse<\/span><\/li>\n  <li><span class='match'>exercise<\/span><\/li>\n  <li>exist<\/li>\n  <li>expect<\/li>\n  <li><span class='match'>expense<\/span><\/li>\n  <li><span class='match'>experience<\/span><\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li><span class='match'>eye<\/span><\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>family<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>figure<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>final<\/li>\n  <li>finance<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>finish<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li>fly<\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>friday<\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>future<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>general<\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>govern<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li><span class='match'>health<\/span><\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li><span class='match'>high<\/span><\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>holiday<\/li>\n  <li>home<\/li>\n  <li>honest<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hospital<\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>however<\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li>identify<\/li>\n  <li>if<\/li>\n  <li>imagine<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>individual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>interest<\/li>\n  <li>into<\/li>\n  <li>introduce<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li>item<\/li>\n  <li>jesus<\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li><span class='match'>knock<\/span><\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li><span class='match'>level<\/span><\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>likely<\/li>\n  <li>limit<\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li><span class='match'>local<\/span><\/li>\n  <li>lock<\/li>\n  <li>london<\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>major<\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>manage<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>meaning<\/li>\n  <li>measure<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>minister<\/li>\n  <li>minus<\/li>\n  <li>minute<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>moment<\/li>\n  <li>monday<\/li>\n  <li>money<\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li>mrs<\/li>\n  <li>much<\/li>\n  <li>music<\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li><span class='match'>nation<\/span><\/li>\n  <li>nature<\/li>\n  <li>near<\/li>\n  <li>necessary<\/li>\n  <li>need<\/li>\n  <li>never<\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li><span class='match'>non<\/span><\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>notice<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obvious<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li>okay<\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li>open<\/li>\n  <li>operate<\/li>\n  <li>opportunity<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>organize<\/li>\n  <li>original<\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li>over<\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>paper<\/li>\n  <li>paragraph<\/li>\n  <li>pardon<\/li>\n  <li>parent<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>particular<\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li>photograph<\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>police<\/li>\n  <li>policy<\/li>\n  <li>politic<\/li>\n  <li>poor<\/li>\n  <li>position<\/li>\n  <li>positive<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>power<\/li>\n  <li>practise<\/li>\n  <li>prepare<\/li>\n  <li>present<\/li>\n  <li>press<\/li>\n  <li>pressure<\/li>\n  <li>presume<\/li>\n  <li>pretty<\/li>\n  <li>previous<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>private<\/li>\n  <li>probable<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>process<\/li>\n  <li>produce<\/li>\n  <li>product<\/li>\n  <li>programme<\/li>\n  <li>project<\/li>\n  <li>proper<\/li>\n  <li>propose<\/li>\n  <li>protect<\/li>\n  <li>provide<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>quality<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>quiet<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li><span class='match'>rather<\/span><\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>realise<\/li>\n  <li>really<\/li>\n  <li>reason<\/li>\n  <li>receive<\/li>\n  <li>recent<\/li>\n  <li>reckon<\/li>\n  <li>recognize<\/li>\n  <li>recommend<\/li>\n  <li>record<\/li>\n  <li>red<\/li>\n  <li>reduce<\/li>\n  <li><span class='match'>refer<\/span><\/li>\n  <li>regard<\/li>\n  <li>region<\/li>\n  <li>relation<\/li>\n  <li><span class='match'>remember<\/span><\/li>\n  <li>report<\/li>\n  <li>represent<\/li>\n  <li>require<\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>result<\/li>\n  <li>return<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>saturday<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li>scheme<\/li>\n  <li>school<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>second<\/li>\n  <li>secretary<\/li>\n  <li>section<\/li>\n  <li>secure<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li>sense<\/li>\n  <li>separate<\/li>\n  <li><span class='match'>serious<\/span><\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>seven<\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>similar<\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>specific<\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li><span class='match'>stairs<\/span><\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li>straight<\/li>\n  <li>strategy<\/li>\n  <li>street<\/li>\n  <li>strike<\/li>\n  <li>strong<\/li>\n  <li>structure<\/li>\n  <li>student<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>stupid<\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li>system<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>telephone<\/li>\n  <li>television<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li><span class='match'>test<\/span><\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>therefore<\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>thousand<\/li>\n  <li>three<\/li>\n  <li>through<\/li>\n  <li>throw<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>today<\/li>\n  <li>together<\/li>\n  <li>tomorrow<\/li>\n  <li><span class='match'>tonight<\/span><\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>total<\/li>\n  <li>touch<\/li>\n  <li>toward<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li><span class='match'>transport<\/span><\/li>\n  <li>travel<\/li>\n  <li><span class='match'>treat<\/span><\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li><span class='match'>trust<\/span><\/li>\n  <li>try<\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li>type<\/li>\n  <li>under<\/li>\n  <li>understand<\/li>\n  <li>union<\/li>\n  <li>unit<\/li>\n  <li>unite<\/li>\n  <li>university<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li>upon<\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>various<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>visit<\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>water<\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>whether<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li>why<\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li><span class='match'>window<\/span><\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>woman<\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li><span class='match'>yesterday<\/span><\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Contain a repeated pair of letters (e.g. “church” contains “ch” repeated twice.):</p>
<p>I’ll consider several patterns with varying levels of generality. This pattern checks for any pair of repeated characters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;(..).*</span><span class="ch">\\</span><span class="st">1&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-826abaa365f54c0c9337" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-826abaa365f54c0c9337">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>absolute<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li>agent<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li>along<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li>america<\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li>another<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li>apart<\/li>\n  <li>apparent<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>ap<span class='match'>propr<\/span>iate<\/li>\n  <li>area<\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>authority<\/li>\n  <li>available<\/li>\n  <li>aware<\/li>\n  <li>away<\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>balance<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>basis<\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>beauty<\/li>\n  <li>because<\/li>\n  <li>become<\/li>\n  <li>bed<\/li>\n  <li>before<\/li>\n  <li>begin<\/li>\n  <li>behind<\/li>\n  <li>believe<\/li>\n  <li>benefit<\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>business<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>character<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li>Christ<\/li>\n  <li>Christmas<\/li>\n  <li><span class='match'>church<\/span><\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>closes<\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>community<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>c<span class='match'>ondition<\/span><\/li>\n  <li>confer<\/li>\n  <li>consider<\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>cover<\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li>dad<\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li>dead<\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>debate<\/li>\n  <li><span class='match'>decide<\/span><\/li>\n  <li>decision<\/li>\n  <li>deep<\/li>\n  <li>definite<\/li>\n  <li>degree<\/li>\n  <li>department<\/li>\n  <li>depend<\/li>\n  <li>describe<\/li>\n  <li>design<\/li>\n  <li>detail<\/li>\n  <li>develop<\/li>\n  <li>die<\/li>\n  <li>difference<\/li>\n  <li>difficult<\/li>\n  <li>dinner<\/li>\n  <li>direct<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>divide<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>document<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li>dry<\/li>\n  <li>due<\/li>\n  <li>during<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li>economy<\/li>\n  <li>educate<\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li>elect<\/li>\n  <li>electric<\/li>\n  <li>eleven<\/li>\n  <li>else<\/li>\n  <li>employ<\/li>\n  <li>encourage<\/li>\n  <li>end<\/li>\n  <li>engine<\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li><span class='match'>environmen<\/span>t<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li>europe<\/li>\n  <li>even<\/li>\n  <li>evening<\/li>\n  <li>ever<\/li>\n  <li>every<\/li>\n  <li>evidence<\/li>\n  <li>exact<\/li>\n  <li>example<\/li>\n  <li>except<\/li>\n  <li>excuse<\/li>\n  <li>exercise<\/li>\n  <li>exist<\/li>\n  <li>expect<\/li>\n  <li>expense<\/li>\n  <li>experience<\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li>eye<\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>family<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>figure<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>final<\/li>\n  <li>finance<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>finish<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li>fly<\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>friday<\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>future<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>general<\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>govern<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li>health<\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li>high<\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>holiday<\/li>\n  <li>home<\/li>\n  <li>honest<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hospital<\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>however<\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li>identify<\/li>\n  <li>if<\/li>\n  <li>imagine<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>individual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>interest<\/li>\n  <li>into<\/li>\n  <li>introduce<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li>item<\/li>\n  <li>jesus<\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li>knock<\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li>level<\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>likely<\/li>\n  <li>limit<\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li>local<\/li>\n  <li>lock<\/li>\n  <li>l<span class='match'>ondon<\/span><\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>major<\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>manage<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>meaning<\/li>\n  <li>measure<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>minister<\/li>\n  <li>minus<\/li>\n  <li>minute<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>moment<\/li>\n  <li>monday<\/li>\n  <li>money<\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li>mrs<\/li>\n  <li>much<\/li>\n  <li>music<\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li>nation<\/li>\n  <li>nature<\/li>\n  <li>near<\/li>\n  <li>necessary<\/li>\n  <li>need<\/li>\n  <li>never<\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li>non<\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>notice<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obvious<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li>okay<\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li>open<\/li>\n  <li>operate<\/li>\n  <li>opportunity<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>organize<\/li>\n  <li>original<\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li>over<\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>paper<\/li>\n  <li>pa<span class='match'>ragra<\/span>ph<\/li>\n  <li>pardon<\/li>\n  <li>parent<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>p<span class='match'>articular<\/span><\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li><span class='match'>photograph<\/span><\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>police<\/li>\n  <li>policy<\/li>\n  <li>politic<\/li>\n  <li>poor<\/li>\n  <li>position<\/li>\n  <li>positive<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>power<\/li>\n  <li>practise<\/li>\n  <li>p<span class='match'>repare<\/span><\/li>\n  <li>present<\/li>\n  <li>press<\/li>\n  <li>p<span class='match'>ressure<\/span><\/li>\n  <li>presume<\/li>\n  <li>pretty<\/li>\n  <li>previous<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>private<\/li>\n  <li>probable<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>process<\/li>\n  <li>produce<\/li>\n  <li>product<\/li>\n  <li>programme<\/li>\n  <li>project<\/li>\n  <li>proper<\/li>\n  <li>propose<\/li>\n  <li>protect<\/li>\n  <li>provide<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>quality<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>quiet<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li>rather<\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>realise<\/li>\n  <li>really<\/li>\n  <li>reason<\/li>\n  <li>receive<\/li>\n  <li>recent<\/li>\n  <li>reckon<\/li>\n  <li>recognize<\/li>\n  <li>recommend<\/li>\n  <li>record<\/li>\n  <li>red<\/li>\n  <li>reduce<\/li>\n  <li>refer<\/li>\n  <li>regard<\/li>\n  <li>region<\/li>\n  <li>relation<\/li>\n  <li>r<span class='match'>emem<\/span>ber<\/li>\n  <li>report<\/li>\n  <li><span class='match'>repre<\/span>sent<\/li>\n  <li><span class='match'>require<\/span><\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>result<\/li>\n  <li>return<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>saturday<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li>scheme<\/li>\n  <li>school<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>second<\/li>\n  <li>secretary<\/li>\n  <li>section<\/li>\n  <li>secure<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li><span class='match'>sense<\/span><\/li>\n  <li>separate<\/li>\n  <li>serious<\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>seven<\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>similar<\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>specific<\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li>stairs<\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li>straight<\/li>\n  <li>strategy<\/li>\n  <li>street<\/li>\n  <li>strike<\/li>\n  <li>strong<\/li>\n  <li>structure<\/li>\n  <li>student<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>stupid<\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li>system<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>telephone<\/li>\n  <li>television<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li>test<\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>the<span class='match'>refore<\/span><\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>thousand<\/li>\n  <li>three<\/li>\n  <li>through<\/li>\n  <li>throw<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>today<\/li>\n  <li>together<\/li>\n  <li>tomorrow<\/li>\n  <li>tonight<\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>total<\/li>\n  <li>touch<\/li>\n  <li>toward<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li>transport<\/li>\n  <li>travel<\/li>\n  <li>treat<\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li>trust<\/li>\n  <li>try<\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li>type<\/li>\n  <li>under<\/li>\n  <li>u<span class='match'>nderstand<\/span><\/li>\n  <li>union<\/li>\n  <li>unit<\/li>\n  <li>unite<\/li>\n  <li>university<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li>upon<\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>various<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>visit<\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>water<\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>w<span class='match'>hethe<\/span>r<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li>why<\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li>window<\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>woman<\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li>yesterday<\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> This pattern is checks for any pair of repeated “letters”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(words, <span class="st">&quot;([A-Za-z][A-Za-z]).*</span><span class="ch">\\</span><span class="st">1&quot;</span>)</code></pre></div>
<div id="htmlwidget-20f0cdc2888b18632cb0" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-20f0cdc2888b18632cb0">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>able<\/li>\n  <li>about<\/li>\n  <li>absolute<\/li>\n  <li>accept<\/li>\n  <li>account<\/li>\n  <li>achieve<\/li>\n  <li>across<\/li>\n  <li>act<\/li>\n  <li>active<\/li>\n  <li>actual<\/li>\n  <li>add<\/li>\n  <li>address<\/li>\n  <li>admit<\/li>\n  <li>advertise<\/li>\n  <li>affect<\/li>\n  <li>afford<\/li>\n  <li>after<\/li>\n  <li>afternoon<\/li>\n  <li>again<\/li>\n  <li>against<\/li>\n  <li>age<\/li>\n  <li>agent<\/li>\n  <li>ago<\/li>\n  <li>agree<\/li>\n  <li>air<\/li>\n  <li>all<\/li>\n  <li>allow<\/li>\n  <li>almost<\/li>\n  <li>along<\/li>\n  <li>already<\/li>\n  <li>alright<\/li>\n  <li>also<\/li>\n  <li>although<\/li>\n  <li>always<\/li>\n  <li>america<\/li>\n  <li>amount<\/li>\n  <li>and<\/li>\n  <li>another<\/li>\n  <li>answer<\/li>\n  <li>any<\/li>\n  <li>apart<\/li>\n  <li>apparent<\/li>\n  <li>appear<\/li>\n  <li>apply<\/li>\n  <li>appoint<\/li>\n  <li>approach<\/li>\n  <li>ap<span class='match'>propr<\/span>iate<\/li>\n  <li>area<\/li>\n  <li>argue<\/li>\n  <li>arm<\/li>\n  <li>around<\/li>\n  <li>arrange<\/li>\n  <li>art<\/li>\n  <li>as<\/li>\n  <li>ask<\/li>\n  <li>associate<\/li>\n  <li>assume<\/li>\n  <li>at<\/li>\n  <li>attend<\/li>\n  <li>authority<\/li>\n  <li>available<\/li>\n  <li>aware<\/li>\n  <li>away<\/li>\n  <li>awful<\/li>\n  <li>baby<\/li>\n  <li>back<\/li>\n  <li>bad<\/li>\n  <li>bag<\/li>\n  <li>balance<\/li>\n  <li>ball<\/li>\n  <li>bank<\/li>\n  <li>bar<\/li>\n  <li>base<\/li>\n  <li>basis<\/li>\n  <li>be<\/li>\n  <li>bear<\/li>\n  <li>beat<\/li>\n  <li>beauty<\/li>\n  <li>because<\/li>\n  <li>become<\/li>\n  <li>bed<\/li>\n  <li>before<\/li>\n  <li>begin<\/li>\n  <li>behind<\/li>\n  <li>believe<\/li>\n  <li>benefit<\/li>\n  <li>best<\/li>\n  <li>bet<\/li>\n  <li>between<\/li>\n  <li>big<\/li>\n  <li>bill<\/li>\n  <li>birth<\/li>\n  <li>bit<\/li>\n  <li>black<\/li>\n  <li>bloke<\/li>\n  <li>blood<\/li>\n  <li>blow<\/li>\n  <li>blue<\/li>\n  <li>board<\/li>\n  <li>boat<\/li>\n  <li>body<\/li>\n  <li>book<\/li>\n  <li>both<\/li>\n  <li>bother<\/li>\n  <li>bottle<\/li>\n  <li>bottom<\/li>\n  <li>box<\/li>\n  <li>boy<\/li>\n  <li>break<\/li>\n  <li>brief<\/li>\n  <li>brilliant<\/li>\n  <li>bring<\/li>\n  <li>britain<\/li>\n  <li>brother<\/li>\n  <li>budget<\/li>\n  <li>build<\/li>\n  <li>bus<\/li>\n  <li>business<\/li>\n  <li>busy<\/li>\n  <li>but<\/li>\n  <li>buy<\/li>\n  <li>by<\/li>\n  <li>cake<\/li>\n  <li>call<\/li>\n  <li>can<\/li>\n  <li>car<\/li>\n  <li>card<\/li>\n  <li>care<\/li>\n  <li>carry<\/li>\n  <li>case<\/li>\n  <li>cat<\/li>\n  <li>catch<\/li>\n  <li>cause<\/li>\n  <li>cent<\/li>\n  <li>centre<\/li>\n  <li>certain<\/li>\n  <li>chair<\/li>\n  <li>chairman<\/li>\n  <li>chance<\/li>\n  <li>change<\/li>\n  <li>chap<\/li>\n  <li>character<\/li>\n  <li>charge<\/li>\n  <li>cheap<\/li>\n  <li>check<\/li>\n  <li>child<\/li>\n  <li>choice<\/li>\n  <li>choose<\/li>\n  <li>Christ<\/li>\n  <li>Christmas<\/li>\n  <li><span class='match'>church<\/span><\/li>\n  <li>city<\/li>\n  <li>claim<\/li>\n  <li>class<\/li>\n  <li>clean<\/li>\n  <li>clear<\/li>\n  <li>client<\/li>\n  <li>clock<\/li>\n  <li>close<\/li>\n  <li>closes<\/li>\n  <li>clothe<\/li>\n  <li>club<\/li>\n  <li>coffee<\/li>\n  <li>cold<\/li>\n  <li>colleague<\/li>\n  <li>collect<\/li>\n  <li>college<\/li>\n  <li>colour<\/li>\n  <li>come<\/li>\n  <li>comment<\/li>\n  <li>commit<\/li>\n  <li>committee<\/li>\n  <li>common<\/li>\n  <li>community<\/li>\n  <li>company<\/li>\n  <li>compare<\/li>\n  <li>complete<\/li>\n  <li>compute<\/li>\n  <li>concern<\/li>\n  <li>c<span class='match'>ondition<\/span><\/li>\n  <li>confer<\/li>\n  <li>consider<\/li>\n  <li>consult<\/li>\n  <li>contact<\/li>\n  <li>continue<\/li>\n  <li>contract<\/li>\n  <li>control<\/li>\n  <li>converse<\/li>\n  <li>cook<\/li>\n  <li>copy<\/li>\n  <li>corner<\/li>\n  <li>correct<\/li>\n  <li>cost<\/li>\n  <li>could<\/li>\n  <li>council<\/li>\n  <li>count<\/li>\n  <li>country<\/li>\n  <li>county<\/li>\n  <li>couple<\/li>\n  <li>course<\/li>\n  <li>court<\/li>\n  <li>cover<\/li>\n  <li>create<\/li>\n  <li>cross<\/li>\n  <li>cup<\/li>\n  <li>current<\/li>\n  <li>cut<\/li>\n  <li>dad<\/li>\n  <li>danger<\/li>\n  <li>date<\/li>\n  <li>day<\/li>\n  <li>dead<\/li>\n  <li>deal<\/li>\n  <li>dear<\/li>\n  <li>debate<\/li>\n  <li><span class='match'>decide<\/span><\/li>\n  <li>decision<\/li>\n  <li>deep<\/li>\n  <li>definite<\/li>\n  <li>degree<\/li>\n  <li>department<\/li>\n  <li>depend<\/li>\n  <li>describe<\/li>\n  <li>design<\/li>\n  <li>detail<\/li>\n  <li>develop<\/li>\n  <li>die<\/li>\n  <li>difference<\/li>\n  <li>difficult<\/li>\n  <li>dinner<\/li>\n  <li>direct<\/li>\n  <li>discuss<\/li>\n  <li>district<\/li>\n  <li>divide<\/li>\n  <li>do<\/li>\n  <li>doctor<\/li>\n  <li>document<\/li>\n  <li>dog<\/li>\n  <li>door<\/li>\n  <li>double<\/li>\n  <li>doubt<\/li>\n  <li>down<\/li>\n  <li>draw<\/li>\n  <li>dress<\/li>\n  <li>drink<\/li>\n  <li>drive<\/li>\n  <li>drop<\/li>\n  <li>dry<\/li>\n  <li>due<\/li>\n  <li>during<\/li>\n  <li>each<\/li>\n  <li>early<\/li>\n  <li>east<\/li>\n  <li>easy<\/li>\n  <li>eat<\/li>\n  <li>economy<\/li>\n  <li>educate<\/li>\n  <li>effect<\/li>\n  <li>egg<\/li>\n  <li>eight<\/li>\n  <li>either<\/li>\n  <li>elect<\/li>\n  <li>electric<\/li>\n  <li>eleven<\/li>\n  <li>else<\/li>\n  <li>employ<\/li>\n  <li>encourage<\/li>\n  <li>end<\/li>\n  <li>engine<\/li>\n  <li>english<\/li>\n  <li>enjoy<\/li>\n  <li>enough<\/li>\n  <li>enter<\/li>\n  <li><span class='match'>environmen<\/span>t<\/li>\n  <li>equal<\/li>\n  <li>especial<\/li>\n  <li>europe<\/li>\n  <li>even<\/li>\n  <li>evening<\/li>\n  <li>ever<\/li>\n  <li>every<\/li>\n  <li>evidence<\/li>\n  <li>exact<\/li>\n  <li>example<\/li>\n  <li>except<\/li>\n  <li>excuse<\/li>\n  <li>exercise<\/li>\n  <li>exist<\/li>\n  <li>expect<\/li>\n  <li>expense<\/li>\n  <li>experience<\/li>\n  <li>explain<\/li>\n  <li>express<\/li>\n  <li>extra<\/li>\n  <li>eye<\/li>\n  <li>face<\/li>\n  <li>fact<\/li>\n  <li>fair<\/li>\n  <li>fall<\/li>\n  <li>family<\/li>\n  <li>far<\/li>\n  <li>farm<\/li>\n  <li>fast<\/li>\n  <li>father<\/li>\n  <li>favour<\/li>\n  <li>feed<\/li>\n  <li>feel<\/li>\n  <li>few<\/li>\n  <li>field<\/li>\n  <li>fight<\/li>\n  <li>figure<\/li>\n  <li>file<\/li>\n  <li>fill<\/li>\n  <li>film<\/li>\n  <li>final<\/li>\n  <li>finance<\/li>\n  <li>find<\/li>\n  <li>fine<\/li>\n  <li>finish<\/li>\n  <li>fire<\/li>\n  <li>first<\/li>\n  <li>fish<\/li>\n  <li>fit<\/li>\n  <li>five<\/li>\n  <li>flat<\/li>\n  <li>floor<\/li>\n  <li>fly<\/li>\n  <li>follow<\/li>\n  <li>food<\/li>\n  <li>foot<\/li>\n  <li>for<\/li>\n  <li>force<\/li>\n  <li>forget<\/li>\n  <li>form<\/li>\n  <li>fortune<\/li>\n  <li>forward<\/li>\n  <li>four<\/li>\n  <li>france<\/li>\n  <li>free<\/li>\n  <li>friday<\/li>\n  <li>friend<\/li>\n  <li>from<\/li>\n  <li>front<\/li>\n  <li>full<\/li>\n  <li>fun<\/li>\n  <li>function<\/li>\n  <li>fund<\/li>\n  <li>further<\/li>\n  <li>future<\/li>\n  <li>game<\/li>\n  <li>garden<\/li>\n  <li>gas<\/li>\n  <li>general<\/li>\n  <li>germany<\/li>\n  <li>get<\/li>\n  <li>girl<\/li>\n  <li>give<\/li>\n  <li>glass<\/li>\n  <li>go<\/li>\n  <li>god<\/li>\n  <li>good<\/li>\n  <li>goodbye<\/li>\n  <li>govern<\/li>\n  <li>grand<\/li>\n  <li>grant<\/li>\n  <li>great<\/li>\n  <li>green<\/li>\n  <li>ground<\/li>\n  <li>group<\/li>\n  <li>grow<\/li>\n  <li>guess<\/li>\n  <li>guy<\/li>\n  <li>hair<\/li>\n  <li>half<\/li>\n  <li>hall<\/li>\n  <li>hand<\/li>\n  <li>hang<\/li>\n  <li>happen<\/li>\n  <li>happy<\/li>\n  <li>hard<\/li>\n  <li>hate<\/li>\n  <li>have<\/li>\n  <li>he<\/li>\n  <li>head<\/li>\n  <li>health<\/li>\n  <li>hear<\/li>\n  <li>heart<\/li>\n  <li>heat<\/li>\n  <li>heavy<\/li>\n  <li>hell<\/li>\n  <li>help<\/li>\n  <li>here<\/li>\n  <li>high<\/li>\n  <li>history<\/li>\n  <li>hit<\/li>\n  <li>hold<\/li>\n  <li>holiday<\/li>\n  <li>home<\/li>\n  <li>honest<\/li>\n  <li>hope<\/li>\n  <li>horse<\/li>\n  <li>hospital<\/li>\n  <li>hot<\/li>\n  <li>hour<\/li>\n  <li>house<\/li>\n  <li>how<\/li>\n  <li>however<\/li>\n  <li>hullo<\/li>\n  <li>hundred<\/li>\n  <li>husband<\/li>\n  <li>idea<\/li>\n  <li>identify<\/li>\n  <li>if<\/li>\n  <li>imagine<\/li>\n  <li>important<\/li>\n  <li>improve<\/li>\n  <li>in<\/li>\n  <li>include<\/li>\n  <li>income<\/li>\n  <li>increase<\/li>\n  <li>indeed<\/li>\n  <li>individual<\/li>\n  <li>industry<\/li>\n  <li>inform<\/li>\n  <li>inside<\/li>\n  <li>instead<\/li>\n  <li>insure<\/li>\n  <li>interest<\/li>\n  <li>into<\/li>\n  <li>introduce<\/li>\n  <li>invest<\/li>\n  <li>involve<\/li>\n  <li>issue<\/li>\n  <li>it<\/li>\n  <li>item<\/li>\n  <li>jesus<\/li>\n  <li>job<\/li>\n  <li>join<\/li>\n  <li>judge<\/li>\n  <li>jump<\/li>\n  <li>just<\/li>\n  <li>keep<\/li>\n  <li>key<\/li>\n  <li>kid<\/li>\n  <li>kill<\/li>\n  <li>kind<\/li>\n  <li>king<\/li>\n  <li>kitchen<\/li>\n  <li>knock<\/li>\n  <li>know<\/li>\n  <li>labour<\/li>\n  <li>lad<\/li>\n  <li>lady<\/li>\n  <li>land<\/li>\n  <li>language<\/li>\n  <li>large<\/li>\n  <li>last<\/li>\n  <li>late<\/li>\n  <li>laugh<\/li>\n  <li>law<\/li>\n  <li>lay<\/li>\n  <li>lead<\/li>\n  <li>learn<\/li>\n  <li>leave<\/li>\n  <li>left<\/li>\n  <li>leg<\/li>\n  <li>less<\/li>\n  <li>let<\/li>\n  <li>letter<\/li>\n  <li>level<\/li>\n  <li>lie<\/li>\n  <li>life<\/li>\n  <li>light<\/li>\n  <li>like<\/li>\n  <li>likely<\/li>\n  <li>limit<\/li>\n  <li>line<\/li>\n  <li>link<\/li>\n  <li>list<\/li>\n  <li>listen<\/li>\n  <li>little<\/li>\n  <li>live<\/li>\n  <li>load<\/li>\n  <li>local<\/li>\n  <li>lock<\/li>\n  <li>l<span class='match'>ondon<\/span><\/li>\n  <li>long<\/li>\n  <li>look<\/li>\n  <li>lord<\/li>\n  <li>lose<\/li>\n  <li>lot<\/li>\n  <li>love<\/li>\n  <li>low<\/li>\n  <li>luck<\/li>\n  <li>lunch<\/li>\n  <li>machine<\/li>\n  <li>main<\/li>\n  <li>major<\/li>\n  <li>make<\/li>\n  <li>man<\/li>\n  <li>manage<\/li>\n  <li>many<\/li>\n  <li>mark<\/li>\n  <li>market<\/li>\n  <li>marry<\/li>\n  <li>match<\/li>\n  <li>matter<\/li>\n  <li>may<\/li>\n  <li>maybe<\/li>\n  <li>mean<\/li>\n  <li>meaning<\/li>\n  <li>measure<\/li>\n  <li>meet<\/li>\n  <li>member<\/li>\n  <li>mention<\/li>\n  <li>middle<\/li>\n  <li>might<\/li>\n  <li>mile<\/li>\n  <li>milk<\/li>\n  <li>million<\/li>\n  <li>mind<\/li>\n  <li>minister<\/li>\n  <li>minus<\/li>\n  <li>minute<\/li>\n  <li>miss<\/li>\n  <li>mister<\/li>\n  <li>moment<\/li>\n  <li>monday<\/li>\n  <li>money<\/li>\n  <li>month<\/li>\n  <li>more<\/li>\n  <li>morning<\/li>\n  <li>most<\/li>\n  <li>mother<\/li>\n  <li>motion<\/li>\n  <li>move<\/li>\n  <li>mrs<\/li>\n  <li>much<\/li>\n  <li>music<\/li>\n  <li>must<\/li>\n  <li>name<\/li>\n  <li>nation<\/li>\n  <li>nature<\/li>\n  <li>near<\/li>\n  <li>necessary<\/li>\n  <li>need<\/li>\n  <li>never<\/li>\n  <li>new<\/li>\n  <li>news<\/li>\n  <li>next<\/li>\n  <li>nice<\/li>\n  <li>night<\/li>\n  <li>nine<\/li>\n  <li>no<\/li>\n  <li>non<\/li>\n  <li>none<\/li>\n  <li>normal<\/li>\n  <li>north<\/li>\n  <li>not<\/li>\n  <li>note<\/li>\n  <li>notice<\/li>\n  <li>now<\/li>\n  <li>number<\/li>\n  <li>obvious<\/li>\n  <li>occasion<\/li>\n  <li>odd<\/li>\n  <li>of<\/li>\n  <li>off<\/li>\n  <li>offer<\/li>\n  <li>office<\/li>\n  <li>often<\/li>\n  <li>okay<\/li>\n  <li>old<\/li>\n  <li>on<\/li>\n  <li>once<\/li>\n  <li>one<\/li>\n  <li>only<\/li>\n  <li>open<\/li>\n  <li>operate<\/li>\n  <li>opportunity<\/li>\n  <li>oppose<\/li>\n  <li>or<\/li>\n  <li>order<\/li>\n  <li>organize<\/li>\n  <li>original<\/li>\n  <li>other<\/li>\n  <li>otherwise<\/li>\n  <li>ought<\/li>\n  <li>out<\/li>\n  <li>over<\/li>\n  <li>own<\/li>\n  <li>pack<\/li>\n  <li>page<\/li>\n  <li>paint<\/li>\n  <li>pair<\/li>\n  <li>paper<\/li>\n  <li>pa<span class='match'>ragra<\/span>ph<\/li>\n  <li>pardon<\/li>\n  <li>parent<\/li>\n  <li>park<\/li>\n  <li>part<\/li>\n  <li>p<span class='match'>articular<\/span><\/li>\n  <li>party<\/li>\n  <li>pass<\/li>\n  <li>past<\/li>\n  <li>pay<\/li>\n  <li>pence<\/li>\n  <li>pension<\/li>\n  <li>people<\/li>\n  <li>per<\/li>\n  <li>percent<\/li>\n  <li>perfect<\/li>\n  <li>perhaps<\/li>\n  <li>period<\/li>\n  <li>person<\/li>\n  <li><span class='match'>photograph<\/span><\/li>\n  <li>pick<\/li>\n  <li>picture<\/li>\n  <li>piece<\/li>\n  <li>place<\/li>\n  <li>plan<\/li>\n  <li>play<\/li>\n  <li>please<\/li>\n  <li>plus<\/li>\n  <li>point<\/li>\n  <li>police<\/li>\n  <li>policy<\/li>\n  <li>politic<\/li>\n  <li>poor<\/li>\n  <li>position<\/li>\n  <li>positive<\/li>\n  <li>possible<\/li>\n  <li>post<\/li>\n  <li>pound<\/li>\n  <li>power<\/li>\n  <li>practise<\/li>\n  <li>p<span class='match'>repare<\/span><\/li>\n  <li>present<\/li>\n  <li>press<\/li>\n  <li>p<span class='match'>ressure<\/span><\/li>\n  <li>presume<\/li>\n  <li>pretty<\/li>\n  <li>previous<\/li>\n  <li>price<\/li>\n  <li>print<\/li>\n  <li>private<\/li>\n  <li>probable<\/li>\n  <li>problem<\/li>\n  <li>proceed<\/li>\n  <li>process<\/li>\n  <li>produce<\/li>\n  <li>product<\/li>\n  <li>programme<\/li>\n  <li>project<\/li>\n  <li>proper<\/li>\n  <li>propose<\/li>\n  <li>protect<\/li>\n  <li>provide<\/li>\n  <li>public<\/li>\n  <li>pull<\/li>\n  <li>purpose<\/li>\n  <li>push<\/li>\n  <li>put<\/li>\n  <li>quality<\/li>\n  <li>quarter<\/li>\n  <li>question<\/li>\n  <li>quick<\/li>\n  <li>quid<\/li>\n  <li>quiet<\/li>\n  <li>quite<\/li>\n  <li>radio<\/li>\n  <li>rail<\/li>\n  <li>raise<\/li>\n  <li>range<\/li>\n  <li>rate<\/li>\n  <li>rather<\/li>\n  <li>read<\/li>\n  <li>ready<\/li>\n  <li>real<\/li>\n  <li>realise<\/li>\n  <li>really<\/li>\n  <li>reason<\/li>\n  <li>receive<\/li>\n  <li>recent<\/li>\n  <li>reckon<\/li>\n  <li>recognize<\/li>\n  <li>recommend<\/li>\n  <li>record<\/li>\n  <li>red<\/li>\n  <li>reduce<\/li>\n  <li>refer<\/li>\n  <li>regard<\/li>\n  <li>region<\/li>\n  <li>relation<\/li>\n  <li>r<span class='match'>emem<\/span>ber<\/li>\n  <li>report<\/li>\n  <li><span class='match'>repre<\/span>sent<\/li>\n  <li><span class='match'>require<\/span><\/li>\n  <li>research<\/li>\n  <li>resource<\/li>\n  <li>respect<\/li>\n  <li>responsible<\/li>\n  <li>rest<\/li>\n  <li>result<\/li>\n  <li>return<\/li>\n  <li>rid<\/li>\n  <li>right<\/li>\n  <li>ring<\/li>\n  <li>rise<\/li>\n  <li>road<\/li>\n  <li>role<\/li>\n  <li>roll<\/li>\n  <li>room<\/li>\n  <li>round<\/li>\n  <li>rule<\/li>\n  <li>run<\/li>\n  <li>safe<\/li>\n  <li>sale<\/li>\n  <li>same<\/li>\n  <li>saturday<\/li>\n  <li>save<\/li>\n  <li>say<\/li>\n  <li>scheme<\/li>\n  <li>school<\/li>\n  <li>science<\/li>\n  <li>score<\/li>\n  <li>scotland<\/li>\n  <li>seat<\/li>\n  <li>second<\/li>\n  <li>secretary<\/li>\n  <li>section<\/li>\n  <li>secure<\/li>\n  <li>see<\/li>\n  <li>seem<\/li>\n  <li>self<\/li>\n  <li>sell<\/li>\n  <li>send<\/li>\n  <li><span class='match'>sense<\/span><\/li>\n  <li>separate<\/li>\n  <li>serious<\/li>\n  <li>serve<\/li>\n  <li>service<\/li>\n  <li>set<\/li>\n  <li>settle<\/li>\n  <li>seven<\/li>\n  <li>sex<\/li>\n  <li>shall<\/li>\n  <li>share<\/li>\n  <li>she<\/li>\n  <li>sheet<\/li>\n  <li>shoe<\/li>\n  <li>shoot<\/li>\n  <li>shop<\/li>\n  <li>short<\/li>\n  <li>should<\/li>\n  <li>show<\/li>\n  <li>shut<\/li>\n  <li>sick<\/li>\n  <li>side<\/li>\n  <li>sign<\/li>\n  <li>similar<\/li>\n  <li>simple<\/li>\n  <li>since<\/li>\n  <li>sing<\/li>\n  <li>single<\/li>\n  <li>sir<\/li>\n  <li>sister<\/li>\n  <li>sit<\/li>\n  <li>site<\/li>\n  <li>situate<\/li>\n  <li>six<\/li>\n  <li>size<\/li>\n  <li>sleep<\/li>\n  <li>slight<\/li>\n  <li>slow<\/li>\n  <li>small<\/li>\n  <li>smoke<\/li>\n  <li>so<\/li>\n  <li>social<\/li>\n  <li>society<\/li>\n  <li>some<\/li>\n  <li>son<\/li>\n  <li>soon<\/li>\n  <li>sorry<\/li>\n  <li>sort<\/li>\n  <li>sound<\/li>\n  <li>south<\/li>\n  <li>space<\/li>\n  <li>speak<\/li>\n  <li>special<\/li>\n  <li>specific<\/li>\n  <li>speed<\/li>\n  <li>spell<\/li>\n  <li>spend<\/li>\n  <li>square<\/li>\n  <li>staff<\/li>\n  <li>stage<\/li>\n  <li>stairs<\/li>\n  <li>stand<\/li>\n  <li>standard<\/li>\n  <li>start<\/li>\n  <li>state<\/li>\n  <li>station<\/li>\n  <li>stay<\/li>\n  <li>step<\/li>\n  <li>stick<\/li>\n  <li>still<\/li>\n  <li>stop<\/li>\n  <li>story<\/li>\n  <li>straight<\/li>\n  <li>strategy<\/li>\n  <li>street<\/li>\n  <li>strike<\/li>\n  <li>strong<\/li>\n  <li>structure<\/li>\n  <li>student<\/li>\n  <li>study<\/li>\n  <li>stuff<\/li>\n  <li>stupid<\/li>\n  <li>subject<\/li>\n  <li>succeed<\/li>\n  <li>such<\/li>\n  <li>sudden<\/li>\n  <li>suggest<\/li>\n  <li>suit<\/li>\n  <li>summer<\/li>\n  <li>sun<\/li>\n  <li>sunday<\/li>\n  <li>supply<\/li>\n  <li>support<\/li>\n  <li>suppose<\/li>\n  <li>sure<\/li>\n  <li>surprise<\/li>\n  <li>switch<\/li>\n  <li>system<\/li>\n  <li>table<\/li>\n  <li>take<\/li>\n  <li>talk<\/li>\n  <li>tape<\/li>\n  <li>tax<\/li>\n  <li>tea<\/li>\n  <li>teach<\/li>\n  <li>team<\/li>\n  <li>telephone<\/li>\n  <li>television<\/li>\n  <li>tell<\/li>\n  <li>ten<\/li>\n  <li>tend<\/li>\n  <li>term<\/li>\n  <li>terrible<\/li>\n  <li>test<\/li>\n  <li>than<\/li>\n  <li>thank<\/li>\n  <li>the<\/li>\n  <li>then<\/li>\n  <li>there<\/li>\n  <li>the<span class='match'>refore<\/span><\/li>\n  <li>they<\/li>\n  <li>thing<\/li>\n  <li>think<\/li>\n  <li>thirteen<\/li>\n  <li>thirty<\/li>\n  <li>this<\/li>\n  <li>thou<\/li>\n  <li>though<\/li>\n  <li>thousand<\/li>\n  <li>three<\/li>\n  <li>through<\/li>\n  <li>throw<\/li>\n  <li>thursday<\/li>\n  <li>tie<\/li>\n  <li>time<\/li>\n  <li>to<\/li>\n  <li>today<\/li>\n  <li>together<\/li>\n  <li>tomorrow<\/li>\n  <li>tonight<\/li>\n  <li>too<\/li>\n  <li>top<\/li>\n  <li>total<\/li>\n  <li>touch<\/li>\n  <li>toward<\/li>\n  <li>town<\/li>\n  <li>trade<\/li>\n  <li>traffic<\/li>\n  <li>train<\/li>\n  <li>transport<\/li>\n  <li>travel<\/li>\n  <li>treat<\/li>\n  <li>tree<\/li>\n  <li>trouble<\/li>\n  <li>true<\/li>\n  <li>trust<\/li>\n  <li>try<\/li>\n  <li>tuesday<\/li>\n  <li>turn<\/li>\n  <li>twelve<\/li>\n  <li>twenty<\/li>\n  <li>two<\/li>\n  <li>type<\/li>\n  <li>under<\/li>\n  <li>u<span class='match'>nderstand<\/span><\/li>\n  <li>union<\/li>\n  <li>unit<\/li>\n  <li>unite<\/li>\n  <li>university<\/li>\n  <li>unless<\/li>\n  <li>until<\/li>\n  <li>up<\/li>\n  <li>upon<\/li>\n  <li>use<\/li>\n  <li>usual<\/li>\n  <li>value<\/li>\n  <li>various<\/li>\n  <li>very<\/li>\n  <li>video<\/li>\n  <li>view<\/li>\n  <li>village<\/li>\n  <li>visit<\/li>\n  <li>vote<\/li>\n  <li>wage<\/li>\n  <li>wait<\/li>\n  <li>walk<\/li>\n  <li>wall<\/li>\n  <li>want<\/li>\n  <li>war<\/li>\n  <li>warm<\/li>\n  <li>wash<\/li>\n  <li>waste<\/li>\n  <li>watch<\/li>\n  <li>water<\/li>\n  <li>way<\/li>\n  <li>we<\/li>\n  <li>wear<\/li>\n  <li>wednesday<\/li>\n  <li>wee<\/li>\n  <li>week<\/li>\n  <li>weigh<\/li>\n  <li>welcome<\/li>\n  <li>well<\/li>\n  <li>west<\/li>\n  <li>what<\/li>\n  <li>when<\/li>\n  <li>where<\/li>\n  <li>w<span class='match'>hethe<\/span>r<\/li>\n  <li>which<\/li>\n  <li>while<\/li>\n  <li>white<\/li>\n  <li>who<\/li>\n  <li>whole<\/li>\n  <li>why<\/li>\n  <li>wide<\/li>\n  <li>wife<\/li>\n  <li>will<\/li>\n  <li>win<\/li>\n  <li>wind<\/li>\n  <li>window<\/li>\n  <li>wish<\/li>\n  <li>with<\/li>\n  <li>within<\/li>\n  <li>without<\/li>\n  <li>woman<\/li>\n  <li>wonder<\/li>\n  <li>wood<\/li>\n  <li>word<\/li>\n  <li>work<\/li>\n  <li>world<\/li>\n  <li>worry<\/li>\n  <li>worse<\/li>\n  <li>worth<\/li>\n  <li>would<\/li>\n  <li>write<\/li>\n  <li>wrong<\/li>\n  <li>year<\/li>\n  <li>yes<\/li>\n  <li>yesterday<\/li>\n  <li>yet<\/li>\n  <li>you<\/li>\n  <li>young<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Contain one letter repeated in at least three places (e.g. <code>eleven'' contains three</code>e’’s.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(<span class="kw">str_to_lower</span>(words), <span class="st">&quot;([a-z]).*</span><span class="ch">\\</span><span class="st">1.*</span><span class="ch">\\</span><span class="st">1&quot;</span>)
<span class="co">#&gt;  [1] &quot;appropriate&quot; &quot;available&quot;   &quot;believe&quot;     &quot;between&quot;     &quot;business&quot;   </span>
<span class="co">#&gt;  [6] &quot;degree&quot;      &quot;difference&quot;  &quot;discuss&quot;     &quot;eleven&quot;      &quot;environment&quot;</span>
<span class="co">#&gt; [11] &quot;evidence&quot;    &quot;exercise&quot;    &quot;expense&quot;     &quot;experience&quot;  &quot;individual&quot; </span>
<span class="co">#&gt; [16] &quot;paragraph&quot;   &quot;receive&quot;     &quot;remember&quot;    &quot;represent&quot;   &quot;telephone&quot;  </span>
<span class="co">#&gt; [21] &quot;therefore&quot;   &quot;tomorrow&quot;</span></code></pre></div>
<p>The <code>\\1</code> is used to refer back to the first group (<code>(.)</code>) so that whatever letter is matched by <code>[A-Za-z]</code> is again matched.</p>
</div>
</div>
</div>
</div>
<div id="tools" class="section level2">
<h2><span class="header-section-number">13.4</span> Tools</h2>
<div id="detect-matches" class="section level3">
<h3><span class="header-section-number">13.4.1</span> Detect matches</h3>
<p>No exercises</p>
</div>
<div id="exercises-1" class="section level3">
<h3><span class="header-section-number">13.4.2</span> Exercises</h3>
<div id="exercise-1-31" class="section level4 exercise">
<h4><span class="header-section-number">13.4.2.1</span> Exercise 1</h4>
<div class="question">
<p>For each of the following challenges, try solving it by using both a single regular expression, and a combination of multiple <code>str_detect()</code> calls.</p>
</div>
<div class="answer">
<ol style="list-style-type: decimal">
<li>Find all words that start or end with x.</li>
<li>Find all words that start with a vowel and end with a consonant.</li>
<li>Are there any words that contain at least one of each different vowel?</li>
</ol>
<p>Words that start or end with <code>x</code>?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

<span class="co"># one regex</span>
words[<span class="kw">str_detect</span>(words, <span class="st">&quot;^x|x$&quot;</span>)]
<span class="co">#&gt; [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</span>
<span class="co"># split regex into parts</span>
start_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;^x&quot;</span>)
end_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;x$&quot;</span>)
words[start_with_x <span class="op">|</span><span class="st"> </span>end_with_x]
<span class="co">#&gt; [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</span></code></pre></div>
<p>Find all words starting with vowel and ending with consonant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(words, <span class="st">&quot;^[aeiou].*[^aeiou]$&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;about&quot;   &quot;accept&quot;  &quot;account&quot; &quot;across&quot;  &quot;act&quot;     &quot;actual&quot;</span>
start_with_vowel &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;^[aeiou]&quot;</span>)
end_with_consonant &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;[^aeiou]$&quot;</span>)
words[start_with_vowel <span class="op">&amp;</span><span class="st"> </span>end_with_consonant] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;about&quot;   &quot;accept&quot;  &quot;account&quot; &quot;across&quot;  &quot;act&quot;     &quot;actual&quot;</span></code></pre></div>
<p>Words that contain at least one of each vowel. I can’t think of a good way of doing this without doing a regex of the permutations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-
<span class="st">  </span><span class="kw">cross_n</span>(<span class="kw">rerun</span>(<span class="dv">5</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;o&quot;</span>, <span class="st">&quot;u&quot;</span>)),
        <span class="dt">.filter =</span> <span class="cf">function</span>(...) {
          x &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unlist</span>(<span class="kw">list</span>(...)))
          <span class="kw">length</span>(x) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(x))
        }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_c</span>(<span class="kw">unlist</span>(.x), <span class="dt">collapse =</span> <span class="st">&quot;.*&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>)
<span class="co">#&gt; Warning: `cross_n()` is deprecated; please use `cross()` instead.</span>

<span class="kw">str_subset</span>(words, pattern)
<span class="co">#&gt; character(0)</span>

words[<span class="kw">str_detect</span>(words, <span class="st">&quot;a&quot;</span>) <span class="op">&amp;</span>
<span class="st">        </span><span class="kw">str_detect</span>(words, <span class="st">&quot;e&quot;</span>) <span class="op">&amp;</span>
<span class="st">        </span><span class="kw">str_detect</span>(words, <span class="st">&quot;i&quot;</span>) <span class="op">&amp;</span>
<span class="st">        </span><span class="kw">str_detect</span>(words, <span class="st">&quot;o&quot;</span>) <span class="op">&amp;</span>
<span class="st">        </span><span class="kw">str_detect</span>(words, <span class="st">&quot;u&quot;</span>)]
<span class="co">#&gt; character(0)</span></code></pre></div>
<p>There appear to be none. To check that it works,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(<span class="st">&quot;aseiouds&quot;</span>, pattern)
<span class="co">#&gt; [1] &quot;aseiouds&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-30" class="section level4 exercise">
<h4><span class="header-section-number">13.4.2.2</span> Exercise 2</h4>
<div class="question">
<p>What word has the highest number of vowels? What word has the highest proportion of vowels? (Hint: what is the denominator?)</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prop_vowels &lt;-<span class="st"> </span><span class="kw">str_count</span>(words, <span class="st">&quot;[aeiou]&quot;</span>) <span class="op">/</span><span class="st"> </span><span class="kw">str_length</span>(words)
words[<span class="kw">which</span>(prop_vowels <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(prop_vowels))]
<span class="co">#&gt; [1] &quot;a&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="extract-matches" class="section level3">
<h3><span class="header-section-number">13.4.3</span> Extract Matches</h3>
<div id="exercise-1-32" class="section level4 exercise">
<h4><span class="header-section-number">13.4.3.1</span> Exercise 1</h4>
<div class="question">
<p>In the previous example, you might have noticed that the regular expression matched “flickered”, which is not a color. Modify the regex to fix the problem.</p>
</div>
<div class="answer">
<p>This was the original color match pattern:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">colours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>)
colour_match &lt;-<span class="st"> </span><span class="kw">str_c</span>(colours, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>)</code></pre></div>
<p>It matches “flickered” because it matches “red”. The problem is that the previous pattern will match any word with the name of a color inside it. We want to only match colors in which the entire word is the name of the color. We can do this by adding a <code>\b</code> (to indicate a word boundary) before and after the pattern:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">colour_match2 &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(&quot;</span>, <span class="kw">str_c</span>(colours, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>), <span class="st">&quot;)</span><span class="ch">\\</span><span class="st">b&quot;</span>)
colour_match2
<span class="co">#&gt; [1] &quot;\\b(red|orange|yellow|green|blue|purple)\\b&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">more2 &lt;-<span class="st"> </span>sentences[<span class="kw">str_count</span>(sentences, colour_match) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view_all</span>(more2, colour_match2, <span class="dt">match =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-acf232f763a6d01286c3" style="width:960px;height:auto;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-acf232f763a6d01286c3">{"x":{"html":"<ul>\n  <li>It is hard to erase <span class='match'>blue<\/span> or <span class='match'>red<\/span> ink.<\/li>\n  <li>The <span class='match'>green<\/span> light in the brown box flickered.<\/li>\n  <li>The sky in the west is tinged with <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercise-2-31" class="section level4 exercise">
<h4><span class="header-section-number">13.4.3.2</span> Exercise 2</h4>
<div class="question">
<p>From the Harvard sentences data, extract:</p>
<ol style="list-style-type: decimal">
<li>The first word from each sentence.</li>
<li>All words ending in <code>ing</code>.</li>
<li>All plurals.</li>
</ol>
</div>
<div class="answer">
<p>The first word in each sentence requires defining what a word is. I’ll consider a word any contiguous</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(sentences, <span class="st">&quot;[a-zA-X]+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;The&quot;   &quot;Glue&quot;  &quot;It&quot;    &quot;These&quot; &quot;Rice&quot;  &quot;The&quot;</span></code></pre></div>
<p>All words ending in <code>ing</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>
sentences_with_ing &lt;-<span class="st"> </span><span class="kw">str_detect</span>(sentences, pattern)
<span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences[sentences_with_ing], pattern))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;spring&quot;  &quot;evening&quot; &quot;morning&quot; &quot;winding&quot; &quot;living&quot;  &quot;king&quot;</span></code></pre></div>
<p>All plurals. This cannot be done correctly with regular expressions alone. It would require morphological inforation about words in the language. See <a href="https://cran.r-project.org/web/packages/wordnet/index.html">WordNet</a> for a resource that would do that. However, identifying words that end in an “s” and with more than three characters in order to remove “as”, “is”, “gas”, etc., will provide a reasonable approximation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]{3,}s</span><span class="ch">\\</span><span class="st">b&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;planks&quot; &quot;days&quot;   &quot;bowls&quot;  &quot;lemons&quot; &quot;makes&quot;  &quot;hogs&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="grouped-matches" class="section level3">
<h3><span class="header-section-number">13.4.4</span> Grouped Matches</h3>
<div id="exercise-1-33" class="section level4 exercise">
<h4><span class="header-section-number">13.4.4.1</span> Exercise 1</h4>
<div class="question">
<p>Find all words that come after a “number” like “one”, “two”, “three” etc. Pull out both the number and the word.</p>
</div>
<div class="answer">
<p>I’ll use the same following “word” pattern as used above</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numword &lt;-<span class="st"> &quot;(one|two|three|four|five|six|seven|eight|nine|ten) +(</span><span class="ch">\\</span><span class="st">S+)&quot;</span>
sentences[<span class="kw">str_detect</span>(sentences, numword)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_extract</span>(numword)
<span class="co">#&gt;  [1] &quot;ten served&quot;    &quot;one over&quot;      &quot;seven books&quot;   &quot;two met&quot;      </span>
<span class="co">#&gt;  [5] &quot;two factors&quot;   &quot;one and&quot;       &quot;three lists&quot;   &quot;seven is&quot;     </span>
<span class="co">#&gt;  [9] &quot;two when&quot;      &quot;one floor.&quot;    &quot;ten inches.&quot;   &quot;one with&quot;     </span>
<span class="co">#&gt; [13] &quot;one war&quot;       &quot;one button&quot;    &quot;six minutes.&quot;  &quot;ten years&quot;    </span>
<span class="co">#&gt; [17] &quot;one in&quot;        &quot;ten chased&quot;    &quot;one like&quot;      &quot;two shares&quot;   </span>
<span class="co">#&gt; [21] &quot;two distinct&quot;  &quot;one costs&quot;     &quot;ten two&quot;       &quot;five robins.&quot; </span>
<span class="co">#&gt; [25] &quot;four kinds&quot;    &quot;one rang&quot;      &quot;ten him.&quot;      &quot;three story&quot;  </span>
<span class="co">#&gt; [29] &quot;ten by&quot;        &quot;one wall.&quot;     &quot;three inches&quot;  &quot;ten your&quot;     </span>
<span class="co">#&gt; [33] &quot;six comes&quot;     &quot;one before&quot;    &quot;three batches&quot; &quot;two leaves.&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-32" class="section level4 exercise">
<h4><span class="header-section-number">13.4.4.2</span> Exercise 2</h4>
<div class="question">
<p>Find all contractions. Separate out the pieces before and after the apostrophe.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">contraction &lt;-<span class="st"> &quot;([A-Za-z]+)&#39;([A-Za-z]+)&quot;</span>
sentences <span class="op">%&gt;%</span>
<span class="st">  `</span><span class="dt">[</span><span class="st">`</span>(<span class="kw">str_detect</span>(sentences, contraction)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_extract</span>(contraction)
<span class="co">#&gt;  [1] &quot;It&#39;s&quot;       &quot;man&#39;s&quot;      &quot;don&#39;t&quot;      &quot;store&#39;s&quot;    &quot;workmen&#39;s&quot; </span>
<span class="co">#&gt;  [6] &quot;Let&#39;s&quot;      &quot;sun&#39;s&quot;      &quot;child&#39;s&quot;    &quot;king&#39;s&quot;     &quot;It&#39;s&quot;      </span>
<span class="co">#&gt; [11] &quot;don&#39;t&quot;      &quot;queen&#39;s&quot;    &quot;don&#39;t&quot;      &quot;pirate&#39;s&quot;   &quot;neighbor&#39;s&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="replacing-matches" class="section level3">
<h3><span class="header-section-number">13.4.5</span> Replacing Matches</h3>
<div id="exercise-1-34" class="section level4 exercise">
<h4><span class="header-section-number">13.4.5.1</span> Exercise 1</h4>
<div class="question">
<p>Replace all forward slashes in a string with backslashes.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">backslashed &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(<span class="st">&quot;past/present/future&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">/&quot;</span>, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)
<span class="kw">writeLines</span>(backslashed)
<span class="co">#&gt; past\present\future</span></code></pre></div>
</div>
</div>
<div id="exercise-2-33" class="section level4 exercise">
<h4><span class="header-section-number">13.4.5.2</span> Exercise 2</h4>
<div class="question">
<p>Implement a simple version of <code>str_to_lower()</code> using <code>replace_all()</code>.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lower &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(words, <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>=<span class="st">&quot;a&quot;</span>, <span class="st">&quot;B&quot;</span>=<span class="st">&quot;b&quot;</span>, <span class="st">&quot;C&quot;</span>=<span class="st">&quot;c&quot;</span>, <span class="st">&quot;D&quot;</span>=<span class="st">&quot;d&quot;</span>, <span class="st">&quot;E&quot;</span>=<span class="st">&quot;e&quot;</span>, <span class="st">&quot;F&quot;</span>=<span class="st">&quot;f&quot;</span>, <span class="st">&quot;G&quot;</span>=<span class="st">&quot;g&quot;</span>, <span class="st">&quot;H&quot;</span>=<span class="st">&quot;h&quot;</span>, <span class="st">&quot;I&quot;</span>=<span class="st">&quot;i&quot;</span>, <span class="st">&quot;J&quot;</span>=<span class="st">&quot;j&quot;</span>, <span class="st">&quot;K&quot;</span>=<span class="st">&quot;k&quot;</span>, <span class="st">&quot;L&quot;</span>=<span class="st">&quot;l&quot;</span>, <span class="st">&quot;M&quot;</span>=<span class="st">&quot;m&quot;</span>, <span class="st">&quot;N&quot;</span>=<span class="st">&quot;n&quot;</span>, <span class="st">&quot;O&quot;</span>=<span class="st">&quot;o&quot;</span>, <span class="st">&quot;P&quot;</span>=<span class="st">&quot;p&quot;</span>, <span class="st">&quot;Q&quot;</span>=<span class="st">&quot;q&quot;</span>, <span class="st">&quot;R&quot;</span>=<span class="st">&quot;r&quot;</span>, <span class="st">&quot;S&quot;</span>=<span class="st">&quot;s&quot;</span>, <span class="st">&quot;T&quot;</span>=<span class="st">&quot;t&quot;</span>, <span class="st">&quot;U&quot;</span>=<span class="st">&quot;u&quot;</span>, <span class="st">&quot;V&quot;</span>=<span class="st">&quot;v&quot;</span>, <span class="st">&quot;W&quot;</span>=<span class="st">&quot;w&quot;</span>, <span class="st">&quot;X&quot;</span>=<span class="st">&quot;x&quot;</span>, <span class="st">&quot;Y&quot;</span>=<span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>=<span class="st">&quot;z&quot;</span>))</code></pre></div>
</div>
</div>
<div id="exercise-3-25" class="section level4 exercise">
<h4><span class="header-section-number">13.4.5.3</span> Exercise 3</h4>
<div class="question">
<p>Switch the first and last letters in <code>words</code>. Which of those strings are still words?</p>
</div>
<div class="answer">
<p>First, make a vector of all the words with first and last letters swapped,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">swapped &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(words, <span class="st">&quot;^([A-Za-z])(.*)([a-z])$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">3</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">1&quot;</span>)</code></pre></div>
<p>Next, find what of “swapped” is also in the original list using the function <code>intersect</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">intersect</span>(swapped,words)
<span class="co">#&gt;  [1] &quot;a&quot;          &quot;america&quot;    &quot;area&quot;       &quot;dad&quot;        &quot;dead&quot;      </span>
<span class="co">#&gt;  [6] &quot;lead&quot;       &quot;read&quot;       &quot;depend&quot;     &quot;god&quot;        &quot;educate&quot;   </span>
<span class="co">#&gt; [11] &quot;else&quot;       &quot;encourage&quot;  &quot;engine&quot;     &quot;europe&quot;     &quot;evidence&quot;  </span>
<span class="co">#&gt; [16] &quot;example&quot;    &quot;excuse&quot;     &quot;exercise&quot;   &quot;expense&quot;    &quot;experience&quot;</span>
<span class="co">#&gt; [21] &quot;eye&quot;        &quot;dog&quot;        &quot;health&quot;     &quot;high&quot;       &quot;knock&quot;     </span>
<span class="co">#&gt; [26] &quot;deal&quot;       &quot;level&quot;      &quot;local&quot;      &quot;nation&quot;     &quot;on&quot;        </span>
<span class="co">#&gt; [31] &quot;non&quot;        &quot;no&quot;         &quot;rather&quot;     &quot;dear&quot;       &quot;refer&quot;     </span>
<span class="co">#&gt; [36] &quot;remember&quot;   &quot;serious&quot;    &quot;stairs&quot;     &quot;test&quot;       &quot;tonight&quot;   </span>
<span class="co">#&gt; [41] &quot;transport&quot;  &quot;treat&quot;      &quot;trust&quot;      &quot;window&quot;     &quot;yesterday&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="splitting" class="section level3">
<h3><span class="header-section-number">13.4.6</span> Splitting</h3>
<div id="exercise-1-35" class="section level4 exercise">
<h4><span class="header-section-number">13.4.6.1</span> Exercise 1</h4>
<div class="question">
<p>Split up a string like <code>&quot;apples, pears, and bananas&quot;</code> into individual components.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apples, pears, and bananas&quot;</span>)
<span class="kw">str_split</span>(x, <span class="st">&quot;, +(and +)?&quot;</span>)[[<span class="dv">1</span>]]
<span class="co">#&gt; [1] &quot;apples&quot;  &quot;pears&quot;   &quot;bananas&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-34" class="section level4 exercise">
<h4><span class="header-section-number">13.4.6.2</span> Exercise 2</h4>
<div class="question">
<p>Why is it better to split up by <code>boundary(&quot;word&quot;)</code> than <code>&quot; &quot;</code>?</p>
</div>
<div class="answer">
<p>Splitting by <code>boundary(&quot;word&quot;)</code> is a more intelligent means of splitting up a string into words. It will recognize non-space punctation that splits words, and also remove that punctuation from words. You can read the set of rules that are used to determine word boundaries on the <a href="http://userguide.icu-project.org/boundaryanalysis">ICU website</a>.</p>
<p>Consider this sentence from the official <a href="http://www.unicode.org/reports/tr29/#Word_Boundaries">Unicode Report on word boundaries</a>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sentence &lt;-<span class="st"> &quot;The quick (“brown”) fox can’t jump 32.3 feet, right?&quot;</span></code></pre></div>
<p>Splitting the string on spaces considers will group the punctuation with the words,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_split</span>(sentence, <span class="st">&quot; &quot;</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;The&quot;       &quot;quick&quot;     &quot;(“brown”)&quot; &quot;fox&quot;       &quot;can’t&quot;     &quot;jump&quot;     </span>
<span class="co">#&gt; [7] &quot;32.3&quot;      &quot;feet,&quot;     &quot;right?&quot;</span></code></pre></div>
<p>However, splitting the string using <code>boundary(&quot;word&quot;)</code> correctly removes punctuation, while not separating “32.2” and “can’t”,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_split</span>(sentence, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;The&quot;   &quot;quick&quot; &quot;brown&quot; &quot;fox&quot;   &quot;can’t&quot; &quot;jump&quot;  &quot;32.3&quot;  &quot;feet&quot;  &quot;right&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-26" class="section level4 exercise">
<h4><span class="header-section-number">13.4.6.3</span> Exercise 3</h4>
<div class="question">
<p>What does splitting with an empty string <code>(&quot;&quot;)</code> do? Experiment, and then read the documentation.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_split</span>(<span class="st">&quot;ab. cd|agt&quot;</span>, <span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]
<span class="co">#&gt;  [1] &quot;a&quot; &quot;b&quot; &quot;.&quot; &quot; &quot; &quot;c&quot; &quot;d&quot; &quot;|&quot; &quot;a&quot; &quot;g&quot; &quot;t&quot;</span></code></pre></div>
<p>It splits the string into individual characters.</p>
</div>
</div>
</div>
<div id="find-matches" class="section level3">
<h3><span class="header-section-number">13.4.7</span> Find matches</h3>
<p>No exercises</p>
</div>
</div>
<div id="other-types-of-patterns" class="section level2">
<h2><span class="header-section-number">13.5</span> Other types of patterns</h2>
<div id="exercise-1-36" class="section level3 exercise">
<h3><span class="header-section-number">13.5.1</span> Exercise 1</h3>
<div class="question">
<p>How would you find all strings containing <code>\</code> with <code>regex()</code> vs. with <code>fixed()</code>?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(<span class="kw">c</span>(<span class="st">&quot;a</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot;ab&quot;</span>), <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)
<span class="co">#&gt; [1] &quot;a\\b&quot;</span>
<span class="kw">str_subset</span>(<span class="kw">c</span>(<span class="st">&quot;a</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot;ab&quot;</span>), <span class="kw">fixed</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span>))
<span class="co">#&gt; [1] &quot;a\\b&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-35" class="section level3 exercise">
<h3><span class="header-section-number">13.5.2</span> Exercise 2</h3>
<div class="question">
<p>What are the five most common words in sentences?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;word&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(word) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(<span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt; # Groups:   word [5]</span>
<span class="co">#&gt;   word      n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 the     751</span>
<span class="co">#&gt; 2 a       202</span>
<span class="co">#&gt; 3 of      132</span>
<span class="co">#&gt; 4 to      123</span>
<span class="co">#&gt; 5 and     118</span></code></pre></div>
</div>
</div>
</div>
<div id="other-uses-of-regular-expressions" class="section level2">
<h2><span class="header-section-number">13.6</span> Other uses of regular expressions</h2>
<p>No exercises</p>
</div>
<div id="stringi" class="section level2">
<h2><span class="header-section-number">13.7</span> stringi</h2>
<div id="exercise-1-37" class="section level3 exercise">
<h3><span class="header-section-number">13.7.1</span> Exercise 1</h3>
<div class="question">
<p>Find the <strong>stringi</strong> functions that:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Count the number of words. <code>stri_count_words</code></li>
<li>Find duplicated strings. <code>stri_duplicated</code></li>
<li>Generate random text. There are several functions beginning with <code>stri_rand_</code>. <code>stri_rand_lipsum</code> generates lorem ipsum text, <code>stri_rand_strings</code> generates random strings, <code>stri_rand_shuffle</code> randomly shuffles the code points in the text.</li>
</ol>
</blockquote>
<ol style="list-style-type: decimal">
<li>Count the number of words. <code>stri_count_words</code></li>
<li>Find duplicated strings. <code>stri_duplicated</code></li>
<li>Generate random text. There are several functions beginning with <code>stri_rand_</code>. <code>stri_rand_lipsum</code> generates lorem ipsum text, <code>stri_rand_strings</code> generates random strings, <code>stri_rand_shuffle</code> randomly shuffles the code points in the text.</li>
</ol>
</div>
</div>
<div id="exercise-2-36" class="section level3 exercise">
<h3><span class="header-section-number">13.7.2</span> Exercise 2</h3>
<div class="question">
<p>How do you control the language that <code>stri_sort()</code> uses for sorting?</p>
</div>
<div class="answer">
<p>Use the <code>locale</code> argument to the <code>opts_collator</code> argument.</p>
</div>
<!--chapter:end:strings.Rmd-->
</div>
</div>
</div>
<div id="factors" class="section level1">
<h1><span class="header-section-number">14</span> Factors</h1>
<div id="introduction-9" class="section level2">
<h2><span class="header-section-number">14.1</span> Introduction</h2>
<p>Functions and packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</code></pre></div>
</div>
<div id="creating-factors" class="section level2">
<h2><span class="header-section-number">14.2</span> Creating Factors</h2>
<p>No exercises</p>
</div>
<div id="general-social-survey" class="section level2">
<h2><span class="header-section-number">14.3</span> General Social Survey</h2>
<div id="exercise-1-38" class="section level3 exercise">
<h3><span class="header-section-number">14.3.1</span> Exercise 1</h3>
<div class="question">
<p>Explore the distribution of <code>rincome</code> (reported income). What makes the default bar chart hard to understand? How could you improve the plot?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rincome_plot &lt;-
<span class="st">  </span>gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rincome)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()
rincome_plot</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The default bar chart labels are too squished to read. One solution is to change the angle of the labels,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rincome_plot <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>But that’s not natural either, because text is vertical, and we read horizontally. So with long labels, it is better to flip it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rincome_plot <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This is better, but it unintuitively goes from low to high. It would help if the scale is reversed. Also, if all the missing factors were differentiated.</p>
</div>
</div>
<div id="exercise-2-37" class="section level3 exercise">
<h3><span class="header-section-number">14.3.2</span> Exercise 2</h3>
<div class="question">
<p>What is the most common <code>relig</code> in this survey? What’s the most common <code>partyid</code>?</p>
</div>
<div class="answer">
<p>The most common <code>relig</code> is “Protestant”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(relig) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>n) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   relig          n</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 Protestant 10846</span></code></pre></div>
<p>The most common <code>partyid</code> is “Independent”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(partyid) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>n) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   partyid         n</span>
<span class="co">#&gt;   &lt;fct&gt;       &lt;int&gt;</span>
<span class="co">#&gt; 1 Independent  4119</span></code></pre></div>
</div>
</div>
<div id="exercise-4-21" class="section level3 exercise">
<h3><span class="header-section-number">14.3.3</span> Exercise 4</h3>
<div class="question">
<p>Which <code>relig</code> does <code>denom</code> (denomination) apply to? How can you find out with a table? How can you find out with a visualization?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>denom)
<span class="co">#&gt;  [1] &quot;No answer&quot;            &quot;Don&#39;t know&quot;           &quot;No denomination&quot;     </span>
<span class="co">#&gt;  [4] &quot;Other&quot;                &quot;Episcopal&quot;            &quot;Presbyterian-dk wh&quot;  </span>
<span class="co">#&gt;  [7] &quot;Presbyterian, merged&quot; &quot;Other presbyterian&quot;   &quot;United pres ch in us&quot;</span>
<span class="co">#&gt; [10] &quot;Presbyterian c in us&quot; &quot;Lutheran-dk which&quot;    &quot;Evangelical luth&quot;    </span>
<span class="co">#&gt; [13] &quot;Other lutheran&quot;       &quot;Wi evan luth synod&quot;   &quot;Lutheran-mo synod&quot;   </span>
<span class="co">#&gt; [16] &quot;Luth ch in america&quot;   &quot;Am lutheran&quot;          &quot;Methodist-dk which&quot;  </span>
<span class="co">#&gt; [19] &quot;Other methodist&quot;      &quot;United methodist&quot;     &quot;Afr meth ep zion&quot;    </span>
<span class="co">#&gt; [22] &quot;Afr meth episcopal&quot;   &quot;Baptist-dk which&quot;     &quot;Other baptists&quot;      </span>
<span class="co">#&gt; [25] &quot;Southern baptist&quot;     &quot;Nat bapt conv usa&quot;    &quot;Nat bapt conv of am&quot; </span>
<span class="co">#&gt; [28] &quot;Am bapt ch in usa&quot;    &quot;Am baptist asso&quot;      &quot;Not applicable&quot;</span></code></pre></div>
<p>From the context it is clear that <code>denom</code> refers to “Protestant” (and unsurprising given that it is the largest category in <code>freq</code>). Let’s filter out the non-responses, no answers, others, not-applicable, or no denomination, to leave only answers to denominations. After doing that, the only remaining responses are “Protestant”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>denom <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Other&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Not applicable&quot;</span>,
                       <span class="st">&quot;No denomination&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(relig)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   relig          n</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 Protestant  7025</span></code></pre></div>
<p>This is also clear in a scatter plot of <code>relig</code> vs. <code>denom</code> where the points are proportional to the size of the number of answers (since otherwise there would be overplotting).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(relig, denom) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> relig, <span class="dt">y =</span> denom, <span class="dt">size =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="modifying-factor-order" class="section level2">
<h2><span class="header-section-number">14.4</span> Modifying factor order</h2>
<div id="exercise-1-39" class="section level3 exercise">
<h3><span class="header-section-number">14.4.1</span> Exercise 1</h3>
<div class="question">
<p>There are some suspiciously high numbers in <code>tvhours</code>. Is the <code>mean</code> a good summary?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gss_cat[[<span class="st">&quot;tvhours&quot;</span>]])
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span class="co">#&gt;       0       1       2       3       4      24   10146</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tvhours)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> tvhours)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Whether the mean is the best summary depends on what you are using it for :-), i.e. your objective. But probably the median would be what most people prefer. And the hours of TV doesn’t look that surprising to me.</p>
</div>
</div>
<div id="exercise-2-38" class="section level3 exercise">
<h3><span class="header-section-number">14.4.2</span> Exercise 2</h3>
<div class="question">
<p>For each factor in <code>gss_cat</code> identify whether the order of the levels is arbitrary or principled.</p>
</div>
<div class="answer">
<p>The following piece of code uses functions introduced in Ch 21, to print out the names of only the factors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">keep</span>(gss_cat, is.factor) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()
<span class="co">#&gt; [1] &quot;marital&quot; &quot;race&quot;    &quot;rincome&quot; &quot;partyid&quot; &quot;relig&quot;   &quot;denom&quot;</span></code></pre></div>
<p>There are five six categorical variables: <code>marital</code>, <code>race</code>, <code>rincome</code>, <code>partyid</code>, <code>relig</code>, <code>denom</code>.</p>
<p>The ordering of marital is “somewhat principled”. There is some sort of logic in that the levels are grouped “never married”, married at some point (separated, divorced, widowed), and “married”; though it would seem that “Never Married”, “Divorced”, “Widowed”, “Separated”, “Married” might be more natural. I find that the question of ordering can be determined by the level of aggregation in a categorical variable, and there can be more “partially ordered” factors than one would expect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat[[<span class="st">&quot;marital&quot;</span>]])
<span class="co">#&gt; [1] &quot;No answer&quot;     &quot;Never married&quot; &quot;Separated&quot;     &quot;Divorced&quot;     </span>
<span class="co">#&gt; [5] &quot;Widowed&quot;       &quot;Married&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> marital)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The ordering of race is principled in that the categories are ordered by count of observations in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>race)
<span class="co">#&gt; [1] &quot;Other&quot;          &quot;Black&quot;          &quot;White&quot;          &quot;Not applicable&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">drop =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Warning: Ignoring unknown parameters: drop</span></code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The levels of <code>rincome</code> are ordered in decreasing order of the income; however the placement of “No answer”, “Don’t know”, and “Refused” before, and “Not applicable” after the income levels is arbitrary. It would be better to place all the missing income level categories either before or after all the known values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>rincome)
<span class="co">#&gt;  [1] &quot;No answer&quot;      &quot;Don&#39;t know&quot;     &quot;Refused&quot;        &quot;$25000 or more&quot;</span>
<span class="co">#&gt;  [5] &quot;$20000 - 24999&quot; &quot;$15000 - 19999&quot; &quot;$10000 - 14999&quot; &quot;$8000 to 9999&quot; </span>
<span class="co">#&gt;  [9] &quot;$7000 to 7999&quot;  &quot;$6000 to 6999&quot;  &quot;$5000 to 5999&quot;  &quot;$4000 to 4999&quot; </span>
<span class="co">#&gt; [13] &quot;$3000 to 3999&quot;  &quot;$1000 to 2999&quot;  &quot;Lt $1000&quot;       &quot;Not applicable&quot;</span></code></pre></div>
<p>The levels of <code>relig</code> is arbitrary: there is no natural ordering, and they don’t appear to be ordered by stats within the dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>relig)
<span class="co">#&gt;  [1] &quot;No answer&quot;               &quot;Don&#39;t know&quot;             </span>
<span class="co">#&gt;  [3] &quot;Inter-nondenominational&quot; &quot;Native american&quot;        </span>
<span class="co">#&gt;  [5] &quot;Christian&quot;               &quot;Orthodox-christian&quot;     </span>
<span class="co">#&gt;  [7] &quot;Moslem/islam&quot;            &quot;Other eastern&quot;          </span>
<span class="co">#&gt;  [9] &quot;Hinduism&quot;                &quot;Buddhism&quot;               </span>
<span class="co">#&gt; [11] &quot;Other&quot;                   &quot;None&quot;                   </span>
<span class="co">#&gt; [13] &quot;Jewish&quot;                  &quot;Catholic&quot;               </span>
<span class="co">#&gt; [15] &quot;Protestant&quot;              &quot;Not applicable&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(relig)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The same goes for <code>denom</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>denom)
<span class="co">#&gt;  [1] &quot;No answer&quot;            &quot;Don&#39;t know&quot;           &quot;No denomination&quot;     </span>
<span class="co">#&gt;  [4] &quot;Other&quot;                &quot;Episcopal&quot;            &quot;Presbyterian-dk wh&quot;  </span>
<span class="co">#&gt;  [7] &quot;Presbyterian, merged&quot; &quot;Other presbyterian&quot;   &quot;United pres ch in us&quot;</span>
<span class="co">#&gt; [10] &quot;Presbyterian c in us&quot; &quot;Lutheran-dk which&quot;    &quot;Evangelical luth&quot;    </span>
<span class="co">#&gt; [13] &quot;Other lutheran&quot;       &quot;Wi evan luth synod&quot;   &quot;Lutheran-mo synod&quot;   </span>
<span class="co">#&gt; [16] &quot;Luth ch in america&quot;   &quot;Am lutheran&quot;          &quot;Methodist-dk which&quot;  </span>
<span class="co">#&gt; [19] &quot;Other methodist&quot;      &quot;United methodist&quot;     &quot;Afr meth ep zion&quot;    </span>
<span class="co">#&gt; [22] &quot;Afr meth episcopal&quot;   &quot;Baptist-dk which&quot;     &quot;Other baptists&quot;      </span>
<span class="co">#&gt; [25] &quot;Southern baptist&quot;     &quot;Nat bapt conv usa&quot;    &quot;Nat bapt conv of am&quot; </span>
<span class="co">#&gt; [28] &quot;Am bapt ch in usa&quot;    &quot;Am baptist asso&quot;      &quot;Not applicable&quot;</span></code></pre></div>
<p>Ignoring “No answer”, “Don’t know”, and “Other party”, the levels of <code>partyid</code> are ordered from “Strong Republican”&quot; to “Strong Democrat”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>partyid)
<span class="co">#&gt;  [1] &quot;No answer&quot;          &quot;Don&#39;t know&quot;         &quot;Other party&quot;       </span>
<span class="co">#&gt;  [4] &quot;Strong republican&quot;  &quot;Not str republican&quot; &quot;Ind,near rep&quot;      </span>
<span class="co">#&gt;  [7] &quot;Independent&quot;        &quot;Ind,near dem&quot;       &quot;Not str democrat&quot;  </span>
<span class="co">#&gt; [10] &quot;Strong democrat&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-27" class="section level3 exercise">
<h3><span class="header-section-number">14.4.3</span> Exercise 3</h3>
<div class="question">
<p>Why did moving “Not applicable” to the front of the levels move it to the bottom of the plot?</p>
</div>
<div class="answer">
<p>Because that gives the level “Not applicable” an integer value of 1.</p>
</div>
</div>
</div>
<div id="modifying-factor-levels" class="section level2">
<h2><span class="header-section-number">14.5</span> Modifying factor levels</h2>
<div id="exercise-1-40" class="section level3 exercise">
<h3><span class="header-section-number">14.5.1</span> Exercise 1</h3>
<div class="question">
<p>How have the proportions of people identifying as Democrat, Republican, and Independent changed over time?</p>
</div>
<div class="answer">
<p>To answer that, we need to combine the multiple levels into Democrat, Republican, and Independent</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>partyid)
<span class="co">#&gt;  [1] &quot;No answer&quot;          &quot;Don&#39;t know&quot;         &quot;Other party&quot;       </span>
<span class="co">#&gt;  [4] &quot;Strong republican&quot;  &quot;Not str republican&quot; &quot;Ind,near rep&quot;      </span>
<span class="co">#&gt;  [7] &quot;Independent&quot;        &quot;Ind,near dem&quot;       &quot;Not str democrat&quot;  </span>
<span class="co">#&gt; [10] &quot;Strong democrat&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span>
           <span class="kw">fct_collapse</span>(partyid,
                        <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Other party&quot;</span>),
                        <span class="dt">rep =</span> <span class="kw">c</span>(<span class="st">&quot;Strong republican&quot;</span>, <span class="st">&quot;Not str republican&quot;</span>),
                        <span class="dt">ind =</span> <span class="kw">c</span>(<span class="st">&quot;Ind,near rep&quot;</span>, <span class="st">&quot;Independent&quot;</span>, <span class="st">&quot;Ind,near dem&quot;</span>),
                        <span class="dt">dem =</span> <span class="kw">c</span>(<span class="st">&quot;Not str democrat&quot;</span>, <span class="st">&quot;Strong democrat&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(year, partyid)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> p,
             <span class="dt">colour =</span> <span class="kw">fct_reorder2</span>(partyid, year, p))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;Party ID.&quot;</span>)</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-39" class="section level3 exercise">
<h3><span class="header-section-number">14.5.2</span> Exercise 2</h3>
<div class="question">
<p>How could you collapse <code>rincome</code> into a small set of categories?</p>
</div>
<div class="answer">
<p>Group all the non-responses into one category, and then group other categories into a smaller number. Since there is a clear ordering, we wouldn’t want to use something like <code>fct_lump</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(gss_cat<span class="op">$</span>rincome)
<span class="co">#&gt;  [1] &quot;No answer&quot;      &quot;Don&#39;t know&quot;     &quot;Refused&quot;        &quot;$25000 or more&quot;</span>
<span class="co">#&gt;  [5] &quot;$20000 - 24999&quot; &quot;$15000 - 19999&quot; &quot;$10000 - 14999&quot; &quot;$8000 to 9999&quot; </span>
<span class="co">#&gt;  [9] &quot;$7000 to 7999&quot;  &quot;$6000 to 6999&quot;  &quot;$5000 to 5999&quot;  &quot;$4000 to 4999&quot; </span>
<span class="co">#&gt; [13] &quot;$3000 to 3999&quot;  &quot;$1000 to 2999&quot;  &quot;Lt $1000&quot;       &quot;Not applicable&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;stringr&quot;</span>)
gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rincome =</span>
           <span class="kw">fct_collapse</span>(
             rincome,
             <span class="st">`</span><span class="dt">Unknown</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Refused&quot;</span>, <span class="st">&quot;Not applicable&quot;</span>),
             <span class="st">`</span><span class="dt">Lt $5000</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Lt $1000&quot;</span>, <span class="kw">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;3000&quot;</span>, <span class="st">&quot;4000&quot;</span>),
                                              <span class="st">&quot; to &quot;</span>, <span class="kw">c</span>(<span class="st">&quot;2999&quot;</span>, <span class="st">&quot;3999&quot;</span>, <span class="st">&quot;4999&quot;</span>))),
             <span class="st">`</span><span class="dt">$5000 to 10000</span><span class="st">`</span> =<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;5000&quot;</span>, <span class="st">&quot;6000&quot;</span>, <span class="st">&quot;7000&quot;</span>, <span class="st">&quot;8000&quot;</span>),
                                      <span class="st">&quot; to &quot;</span>, <span class="kw">c</span>(<span class="st">&quot;5999&quot;</span>, <span class="st">&quot;6999&quot;</span>, <span class="st">&quot;7999&quot;</span>, <span class="st">&quot;9999&quot;</span>))
           )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rincome)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="factors_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<!--chapter:end:factors.Rmd-->
</div>
</div>
</div>
<div id="dates-and-times" class="section level1">
<h1><span class="header-section-number">15</span> Dates and Times</h1>
<div id="introduction-10" class="section level2">
<h2><span class="header-section-number">15.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(nycflights13)</code></pre></div>
</div>
<div id="creating-datetimes" class="section level2">
<h2><span class="header-section-number">15.2</span> Creating date/times</h2>
<p>This code is needed by exercises.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_datetime_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="cf">function</span>(year, month, day, time) {
  <span class="kw">make_datetime</span>(year, month, day, time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>, time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>)
}

flights_dt &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_time), <span class="op">!</span><span class="kw">is.na</span>(arr_time)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">dep_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, dep_time),
    <span class="dt">arr_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, arr_time),
    <span class="dt">sched_dep_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, sched_dep_time),
    <span class="dt">sched_arr_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, sched_arr_time)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(origin, dest, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), <span class="kw">ends_with</span>(<span class="st">&quot;time&quot;</span>))</code></pre></div>
<div id="exercise-1-41" class="section level3 exercise">
<h3><span class="header-section-number">15.2.1</span> Exercise 1</h3>
<div class="question">
<p>What happens if you parse a string that contains invalid dates?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ret &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">c</span>(<span class="st">&quot;2010-10-10&quot;</span>, <span class="st">&quot;bananas&quot;</span>))
<span class="co">#&gt; Warning: 1 failed to parse.</span>
<span class="kw">print</span>(<span class="kw">class</span>(ret))
<span class="co">#&gt; [1] &quot;Date&quot;</span>
ret
<span class="co">#&gt; [1] &quot;2010-10-10&quot; NA</span></code></pre></div>
<p>It produces an <code>NA</code> and an warning message.</p>
</div>
</div>
<div id="exercise-2-40" class="section level3 exercise">
<h3><span class="header-section-number">15.2.2</span> Exercise 2</h3>
<p>What does the <code>tzone</code> argument to <code>today()</code> do? Why is it important?</p>
<p>It determines the time-zone of the date. Since different time-zones can have different dates, the value of <code>today()</code> can vary depending on the time-zone specified.</p>
</div>
<div id="exercise-3-28" class="section level3 exercise">
<h3><span class="header-section-number">15.2.3</span> Exercise 3</h3>
<div class="question">
<p>Use the appropriate <strong>lubridate</strong> function to parse each of the following dates:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> &quot;January 1, 2010&quot;</span>
<span class="kw">mdy</span>(d1)
<span class="co">#&gt; [1] &quot;2010-01-01&quot;</span>
d2 &lt;-<span class="st"> &quot;2015-Mar-07&quot;</span>
<span class="kw">ymd</span>(d2)
<span class="co">#&gt; [1] &quot;2015-03-07&quot;</span>
d3 &lt;-<span class="st"> &quot;06-Jun-2017&quot;</span>
<span class="kw">dmy</span>(d3)
<span class="co">#&gt; [1] &quot;2017-06-06&quot;</span>
d4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;August 19 (2015)&quot;</span>, <span class="st">&quot;July 1 (2015)&quot;</span>)
<span class="kw">mdy</span>(d4)
<span class="co">#&gt; [1] &quot;2015-08-19&quot; &quot;2015-07-01&quot;</span>
d5 &lt;-<span class="st"> &quot;12/30/14&quot;</span> <span class="co"># Dec 30, 2014</span>
<span class="kw">mdy</span>(d5)
<span class="co">#&gt; [1] &quot;2014-12-30&quot;</span></code></pre></div>
</div>
</div>
</div>
<div id="date-time-components" class="section level2">
<h2><span class="header-section-number">15.3</span> Date-Time Components</h2>
<p>The following code from the chapter is used</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sched_dep &lt;-<span class="st"> </span>flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">n =</span> <span class="kw">n</span>())</code></pre></div>
<p>In the previous code, the difference between rounded and un-rounded dates provides the within-period time.</p>
<div id="exercise-1-42" class="section level3 exercise">
<h3><span class="header-section-number">15.3.1</span> Exercise 1</h3>
<div class="question">
<p>How does the distribution of flight times within a day change over the course of the year?</p>
</div>
<div class="answer">
<p>Let’s try plotting this by month:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> <span class="kw">hour</span>(dep_time) <span class="op">*</span><span class="st"> </span><span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw">minute</span>(dep_time),
         <span class="dt">mon =</span> <span class="kw">as.factor</span>(month
                         (dep_time))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">group =</span> mon, <span class="dt">colour =</span> mon)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>)</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This will look better if everything is normalized within groups. The reason that February is lower is that there are fewer days and thus fewer flights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> <span class="kw">hour</span>(dep_time) <span class="op">*</span><span class="st"> </span><span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw">minute</span>(dep_time),
         <span class="dt">mon =</span> <span class="kw">as.factor</span>(month
                         (dep_time))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> ..density.., <span class="dt">group =</span> mon, <span class="dt">colour =</span> mon)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>)</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>At least to me there doesn’t appear to much difference in within-day distribution over the year, but I maybe thinking about it incorrectly.</p>
</div>
</div>
<div id="exercise-2-41" class="section level3 exercise">
<h3><span class="header-section-number">15.3.2</span> Exercise 2</h3>
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code> and <code>dep_delay</code>. Are they consistent? Explain your findings.</p>
<p>If they are consistent, then <code>dep_time = sched_dep_time + dep_delay</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_time_ =</span> sched_dep_time <span class="op">+</span><span class="st"> </span>dep_delay <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(dep_time_ <span class="op">!=</span><span class="st"> </span>dep_time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(dep_time_, dep_time, sched_dep_time, dep_delay)
<span class="co">#&gt; # A tibble: 1,205 x 4</span>
<span class="co">#&gt;   dep_time_           dep_time            sched_dep_time      dep_delay</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;                  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-01-02 08:48:00 2013-01-01 08:48:00 2013-01-01 18:35:00     853  </span>
<span class="co">#&gt; 2 2013-01-03 00:42:00 2013-01-02 00:42:00 2013-01-02 23:59:00      43.0</span>
<span class="co">#&gt; 3 2013-01-03 01:26:00 2013-01-02 01:26:00 2013-01-02 22:50:00     156  </span>
<span class="co">#&gt; 4 2013-01-04 00:32:00 2013-01-03 00:32:00 2013-01-03 23:59:00      33.0</span>
<span class="co">#&gt; 5 2013-01-04 00:50:00 2013-01-03 00:50:00 2013-01-03 21:45:00     185  </span>
<span class="co">#&gt; 6 2013-01-04 02:35:00 2013-01-03 02:35:00 2013-01-03 23:59:00     156  </span>
<span class="co">#&gt; # ... with 1,199 more rows</span></code></pre></div>
<p>There exist discrepancies. It looks like there are mistakes in the dates. These are flights in which the actual departure time is on the <em>next</em> day relative to the scheduled departure time. We forgot to account for this when creating the date-times. The code would have had to check if the departure time is less than the scheduled departure time. Alternatively, simply adding the delay time is more robust because it will automatically account for crossing into the next day.</p>
</div>
<div id="exercise-3-29" class="section level3 exercise">
<h3><span class="header-section-number">15.3.3</span> Exercise 3</h3>
<p>Compare <code>air_time</code> with the duration between the departure and arrival. Explain your findings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">flight_duration =</span> <span class="kw">as.numeric</span>(arr_time <span class="op">-</span><span class="st"> </span>dep_time),
         <span class="dt">air_time_mins =</span> air_time,
         <span class="dt">diff =</span> flight_duration <span class="op">-</span><span class="st"> </span>air_time_mins) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(origin, dest, flight_duration, air_time_mins, diff)
<span class="co">#&gt; # A tibble: 328,063 x 5</span>
<span class="co">#&gt;   origin dest  flight_duration air_time_mins  diff</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 EWR    IAH               193           227 -34.0</span>
<span class="co">#&gt; 2 LGA    IAH               197           227 -30.0</span>
<span class="co">#&gt; 3 JFK    MIA               221           160  61.0</span>
<span class="co">#&gt; 4 JFK    BQN               260           183  77.0</span>
<span class="co">#&gt; 5 LGA    ATL               138           116  22.0</span>
<span class="co">#&gt; 6 EWR    ORD               106           150 -44.0</span>
<span class="co">#&gt; # ... with 3.281e+05 more rows</span></code></pre></div>
</div>
<div id="exercise-4-22" class="section level3 exercise">
<h3><span class="header-section-number">15.3.4</span> Exercise 4</h3>
<p>How does the average delay time change over the course of a day? Should you use <code>dep_time</code> or <code>sched_dep_time</code>? Why?</p>
<p>Use <code>sched_dep_time</code> because that is the relevant metric for someone scheduling a flight. Also, using <code>dep_time</code> will always bias delays to later in the day since delays will push flights later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sched_dep_hour =</span> <span class="kw">hour</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(sched_dep_hour) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dep_delay, <span class="dt">x =</span> sched_dep_hour)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-5-11" class="section level3 exercise">
<h3><span class="header-section-number">15.3.5</span> Exercise 5</h3>
<p>On what day of the week should you leave if you want to minimize the chance of a delay?</p>
<p>Sunday has the lowest average departure delay time and the lowest average arrival delay time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dow =</span> <span class="kw">wday</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dow) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay),
            <span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt; # A tibble: 7 x 3</span>
<span class="co">#&gt;     dow dep_delay arr_delay</span>
<span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  1.00      11.5      4.82</span>
<span class="co">#&gt; 2  2.00      14.7      9.65</span>
<span class="co">#&gt; 3  3.00      10.6      5.39</span>
<span class="co">#&gt; 4  4.00      11.7      7.05</span>
<span class="co">#&gt; 5  5.00      16.1     11.7 </span>
<span class="co">#&gt; 6  6.00      14.7      9.07</span>
<span class="co">#&gt; # ... with 1 more row</span></code></pre></div>
</div>
<div id="exercise-6-8" class="section level3 exercise">
<h3><span class="header-section-number">15.3.6</span> Exercise 6</h3>
<p>What makes the distribution of <code>diamonds$carat</code> and <code>flights$sched_dep_time</code> similar?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In both <code>carat</code> and <code>sched_dep_time</code> there are abnormally large numbers of values are at nice “human” numbers. In <code>sched_dep_time</code> it is at 00 and 30 minutes. In carats, it is at 0, 1/3, 1/2, 2/3,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat <span class="op">%%</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In scheduled departure times it is 00 and 30 minutes, and minutes ending in 0 and 5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(flights_dt, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">minute</span>(sched_dep_time))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-7-3" class="section level3 exercise">
<h3><span class="header-section-number">15.3.7</span> Exercise 7</h3>
<p>Confirm my hypothesis that the early departures of flights in minutes 20-30 and 50-60 are caused by scheduled flights that leave early. Hint: create a binary variable that tells you whether or not a flight was delayed.</p>
<p>At the minute level, there doesn’t appear to be anything:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">early =</span> dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,
         <span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">early =</span> <span class="kw">mean</span>(early)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> minute, <span class="dt">y =</span> early)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>But if grouped in 10 minute intervals, there is a higher proportion of early flights during those minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_dt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">early =</span> dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,
         <span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time) <span class="op">%%</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">early =</span> <span class="kw">mean</span>(early)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> minute, <span class="dt">y =</span> early)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="datetimes_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="time-spans" class="section level2">
<h2><span class="header-section-number">15.4</span> Time Spans</h2>
<div id="exercise-1-43" class="section level3 exercise">
<h3><span class="header-section-number">15.4.1</span> Exercise 1</h3>
<div class="question">
<p>Why is there <code>months()</code> but no <code>dmonths()</code>?</p>
</div>
<div class="answer">
<p>There is no direct unambiguous value of months in seconds since months have differing numbers of days.</p>
<ul>
<li>31 days: January, March, May, July, August, October</li>
<li>30 days: April, Jun, September, November, December</li>
<li>28 or 29 days: February</li>
</ul>
<p>Though in the past, in the pre-computer era, for arithmetic convenience, bankers adopted a 360 day year with 30 day months.</p>
</div>
</div>
<div id="exercise-2-42" class="section level3 exercise">
<h3><span class="header-section-number">15.4.2</span> Exercise 2</h3>
<div class="question">
<p>Explain <code>days(overnight * 1)</code> to someone who has just started learning R. How does it work?</p>
</div>
<div class="answer">
<p>The variable <code>overnight</code> is equal to <code>TRUE</code> or <code>FALSE</code>. If it is an overnight flight, this becomes 1 day, and if not, then overnight = 0, and no days are added to the date.</p>
</div>
</div>
<div id="exercise-3-30" class="section level3 exercise">
<h3><span class="header-section-number">15.4.3</span> Exercise 3</h3>
<div class="question">
<p>Create a vector of dates giving the first day of every month in 2015. Create a vector of dates giving the first day of every month in the current year.</p>
</div>
<div class="answer">
<p>A vector of the first day of the month for every month in 2015:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ymd</span>(<span class="st">&quot;2015-01-01&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)
<span class="co">#&gt;  [1] &quot;2015-01-01&quot; &quot;2015-02-01&quot; &quot;2015-03-01&quot; &quot;2015-04-01&quot; &quot;2015-05-01&quot;</span>
<span class="co">#&gt;  [6] &quot;2015-06-01&quot; &quot;2015-07-01&quot; &quot;2015-08-01&quot; &quot;2015-09-01&quot; &quot;2015-10-01&quot;</span>
<span class="co">#&gt; [11] &quot;2015-11-01&quot; &quot;2015-12-01&quot;</span></code></pre></div>
<p>To get the vector of the first day of the month for <em>this</em> year, we first need to figure out what this year is, and get January 1st of it. I can do that by taking <code>today()</code> and truncating it to the year using <code>floor_date</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">floor_date</span>(<span class="kw">today</span>(), <span class="dt">unit =</span> <span class="st">&quot;year&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)
<span class="co">#&gt;  [1] &quot;2018-01-01&quot; &quot;2018-02-01&quot; &quot;2018-03-01&quot; &quot;2018-04-01&quot; &quot;2018-05-01&quot;</span>
<span class="co">#&gt;  [6] &quot;2018-06-01&quot; &quot;2018-07-01&quot; &quot;2018-08-01&quot; &quot;2018-09-01&quot; &quot;2018-10-01&quot;</span>
<span class="co">#&gt; [11] &quot;2018-11-01&quot; &quot;2018-12-01&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-4-23" class="section level3 exercise">
<h3><span class="header-section-number">15.4.4</span> Exercise 4</h3>
<div class="question">
<p>Write a function that given your birthday (as a date), returns how old you are in years.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age &lt;-<span class="st"> </span><span class="cf">function</span>(bday) {
  (bday <span class="op">%--%</span><span class="st"> </span><span class="kw">today</span>()) <span class="op">%/%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>)
}
<span class="kw">age</span>(<span class="kw">ymd</span>(<span class="st">&quot;1990-10-12&quot;</span>))
<span class="co">#&gt; Note: method with signature &#39;Timespan#Timespan&#39; chosen for function &#39;%/%&#39;,</span>
<span class="co">#&gt;  target signature &#39;Interval#Period&#39;.</span>
<span class="co">#&gt;  &quot;Interval#ANY&quot;, &quot;ANY#Period&quot; would also be valid</span>
<span class="co">#&gt; [1] 27</span></code></pre></div>
</div>
</div>
<div id="exercise-5-12" class="section level3 exercise">
<h3><span class="header-section-number">15.4.5</span> Exercise 5</h3>
<div class="question">
<p>Why can’t <code>(today() %--% (today() + years(1)) / months(1)</code> work?</p>
</div>
<div class="answer">
<p>It appears to work. Today is a date. Today + 1 year is a valid endpoint for an interval. And months is period that is defined in this period.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">today</span>() <span class="op">%--%</span><span class="st"> </span>(<span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>))) <span class="op">%/%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] 12</span>
(<span class="kw">today</span>() <span class="op">%--%</span><span class="st"> </span>(<span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>))) <span class="op">/</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] 12</span></code></pre></div>
</div>
</div>
</div>
<div id="time-zones" class="section level2">
<h2><span class="header-section-number">15.5</span> Time Zones</h2>
<p>No exercises.</p>
<!--chapter:end:datetimes.Rmd-->
</div>
</div>
<div id="part-program" class="section level1 unnumbered">
<h1>(PART) Program</h1>
</div>
<div id="program-intro" class="section level1">
<h1><span class="header-section-number">16</span> Introduction</h1>
<!--chapter:end:program.Rmd-->
</div>
<div id="pipes" class="section level1">
<h1><span class="header-section-number">17</span> Pipes</h1>
<p>No exercises in this chapter.</p>
<!--chapter:end:pipes.Rmd-->
</div>
<div id="functions" class="section level1">
<h1><span class="header-section-number">18</span> Functions</h1>
<div id="introduction-11" class="section level2">
<h2><span class="header-section-number">18.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;lubridate&quot;</span>)</code></pre></div>
</div>
<div id="when-should-you-write-a-function" class="section level2">
<h2><span class="header-section-number">18.2</span> When should you write a function?</h2>
<div id="exercise-1-44" class="section level3 exercise">
<h3><span class="header-section-number">18.2.1</span> Exercise 1</h3>
<div class="question">
<p>Why is TRUE not a parameter to <code>rescale01()</code>? What would happen if <code>x</code> contained a single missing value, and <code>na.rm</code> was <code>FALSE</code>?</p>
</div>
<div class="answer">
<p>First, note that by a a single missing value, this means that the vector <code>x</code> has at least one element equal to <code>NA</code>.</p>
<p>If there were any <code>NA</code> values, and <code>na.rm = FALSE</code>, then the function would return <code>NA</code>.</p>
<p>I can confirm this by testing a function that allows for <code>na.rm</code> as an argument,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rescale01_alt &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">finite =</span> <span class="ot">TRUE</span>) {
  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> finite, <span class="dt">finite =</span> finite)
  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
}
<span class="kw">rescale01_alt</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="dt">finite =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] NA NA NA NA NA NA</span>
<span class="kw">rescale01_alt</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="dt">finite =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1]   NA 0.00 0.25 0.50 0.75 1.00</span></code></pre></div>
</div>
</div>
<div id="exercise-2-43" class="section level3 exercise">
<h3><span class="header-section-number">18.2.2</span> Exercise 2</h3>
<div class="question">
<p>In the second variant of <code>rescale01()</code>, infinite values are left unchanged. Rewrite <code>rescale01()</code> so that <code>-Inf</code> is mapped to 0, and <code>Inf</code> is mapped to 1.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">finite =</span> <span class="ot">TRUE</span>)
  y &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
  y[y <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
  y[y <span class="op">==</span><span class="st"> </span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
  y
}

<span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">NA</span>))
<span class="co">#&gt; [1] 1.0 0.0 0.0 0.2 0.4 0.6 0.8 1.0  NA</span></code></pre></div>
</div>
</div>
<div id="exercise-3-31" class="section level3 exercise">
<h3><span class="header-section-number">18.2.3</span> Exercise 3</h3>
<div class="question">
<p>Practice turning the following code snippets into functions. Think about what each function does. What would you call it? How many arguments does it need? Can you rewrite it to be more expressive or less duplicative?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">is.na</span>(x))

x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>This function calculates the proportion of <code>NA</code> values in a vector,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prop_na &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">mean</span>(<span class="kw">is.na</span>(x))
}
<span class="kw">prop_na</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">0</span>, <span class="ot">NA</span>, <span class="dv">0</span>, <span class="ot">NA</span>))
<span class="co">#&gt; [1] 0.6</span></code></pre></div>
<p>This function standardizes a function to its weight. If all elements of <code>x</code> are non-negative, this will ensure the vector sums to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weights &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
}
y &lt;-<span class="st"> </span><span class="kw">weights</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">5</span>)
y
<span class="co">#&gt; [1] 0.0000 0.0667 0.1333 0.2000 0.2667 0.3333</span>
<span class="kw">sum</span>(y)
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>This function calculates the <a href="https://en.wikipedia.org/wiki/Coefficient_of_variation">coefficient of variation</a> (assuming that <code>x</code> can only take non-negative values). The coefficient of variation is the standard deviation divided by the mean</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coef_variation &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
}
<span class="kw">coef_variation</span>(<span class="kw">runif</span>(<span class="dv">10</span>))
<span class="co">#&gt; [1] 0.672</span></code></pre></div>
</div>
</div>
<div id="exercise-4-24" class="section level3">
<h3><span class="header-section-number">18.2.4</span> Exercise 4</h3>
<div class="question">
<p>Follow <a href="http://nicercode.github.io/intro/writing-functions.html" class="uri">http://nicercode.github.io/intro/writing-functions.html</a> to write your own functions to compute the variance and skew of a numeric vector.</p>
</div>
<div class="answer">
<p><strong>Note</strong> The math in <a href="https://nicercode.github.io/intro/writing-functions.html" class="uri">https://nicercode.github.io/intro/writing-functions.html</a> seems not to be rendering, but I’ll write functions for the variance and skewness.</p>
<p>The sample variance is defined as <span class="math display">\[
Var(x) = \frac{1}{n - 1} \sum_{i=1}^n (x_i - \bar{x}) ^2
\]</span> where the sample mean is <span class="math inline">\(\bar{x} = (\sum x_i) / n\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">variance &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="co"># remove missing values</span>
  x &lt;-<span class="st"> </span>x[<span class="op">!</span><span class="kw">is.na</span>(x)]
  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)
  m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
  sq_err &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>m) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>
  <span class="kw">sum</span>(sq_err) <span class="op">/</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
}
<span class="kw">var</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt; [1] 9.17</span>
<span class="kw">variance</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt; [1] 9.17</span></code></pre></div>
<p>There are multiple definitions of <a href="https://en.wikipedia.org/wiki/Skewness">skewness</a>, but I’ll use the method of moments estimator of the population skewness, <span class="math display">\[
b_1 =  \frac{m_3}{s^3} = \frac{\frac{1}{n} \sum (x_i - \bar{x}) ^ 3}{{\left(\frac{1}{n - 1} \sum (x_i - \bar{x}) ^ 2\right)} ^ \frac{3}{2}}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">skewness &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x &lt;-<span class="st"> </span>x[<span class="op">!</span><span class="kw">is.na</span>(x)] 
  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)
  m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
  m3 &lt;-<span class="st"> </span><span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span>m) <span class="op">^</span><span class="st"> </span><span class="dv">3</span>) <span class="op">/</span><span class="st"> </span>n
  s3 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span>m) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))
  m3 <span class="op">/</span><span class="st"> </span>s3
}
<span class="kw">skewness</span>(<span class="kw">rgamma</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">1</span>))
<span class="co">#&gt; [1] 1.56</span></code></pre></div>
</div>
<div id="exercise-5-13" class="section level4 exercise">
<h4><span class="header-section-number">18.2.4.1</span> Exercise 5</h4>
<div class="question">
<p>Write <code>both_na()</code>, a function that takes two vectors of the same length and returns the number of positions that have an <code>NA</code> in both vectors.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">both_na &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  <span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))
}
<span class="kw">both_na</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="dv">1</span>, <span class="dv">2</span>),
        <span class="kw">c</span>(<span class="ot">NA</span>,  <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">2</span>))
<span class="co">#&gt; [1] 1</span>
<span class="kw">both_na</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span>), 
        <span class="kw">c</span>(<span class="ot">NA</span>,  <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span>))
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
</div>
<div id="exercise-6-9" class="section level3 exercise">
<h3><span class="header-section-number">18.2.5</span> Exercise 6</h3>
<div class="question">
<p>What do the following functions do? Why are they useful even though they are so short?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">is_directory &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">file.info</span>(x)<span class="op">$</span>isdir
is_readable &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">file.access</span>(x, <span class="dv">4</span>) <span class="op">==</span><span class="st"> </span><span class="dv">0</span></code></pre></div>
<p>The function <code>is_directory</code> checks whether the path in <code>x</code> is a directory. The function <code>is_readable</code> checks whether the path in <code>x</code> is readable, meaning that the file exists and the user has permission to open it. These functions are useful even though they are short because their names make it much clearer what the code is doing.</p>
</div>
</div>
<div id="exercise-7-4" class="section level3 exercise">
<h3><span class="header-section-number">18.2.6</span> Exercise 7</h3>
<div class="question">
<p>Read the complete lyrics to ``Little Bunny Foo Foo’’. There’s a lot of duplication in this song. Extend the initial piping example to recreate the complete song, and use functions to reduce the duplication.</p>
</div>
<div class="answer">
<p>The lyrics of one of the <a href="https://en.wikipedia.org/wiki/Little_Bunny_Foo_Foo">most common versions</a> of this song are</p>
<p>Little bunny Foo Foo Hopping through the forest Scooping up the field mice And bopping them on the head</p>
<p>Down came the Good Fairy, and she said “Little bunny Foo Foo I don’t want to see you Scooping up the field mice</p>
<p>And bopping them on the head. I’ll give you three chances, And if you don’t stop, I’ll turn you into a GOON!&quot; And the next day…</p>
<p>The verses repeat with one chance fewer each time. When there are no chances left, the Good Fairy says</p>
<blockquote>
<p>“I gave you three chances, and you didn’t stop; so….” POOF. She turned him into a GOON! And the moral of this story is: <em>hare today, goon tomorrow.</em></p>
</blockquote>
<p>Here’s one way of writing this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">threat &lt;-<span class="st"> </span><span class="cf">function</span>(chances) {
  <span class="kw">give_chances</span>(<span class="dt">from =</span> Good_Fairy,
               <span class="dt">to =</span> foo_foo,
               <span class="dt">number =</span> chances,
               <span class="dt">condition =</span> <span class="st">&quot;Don&#39;t behave&quot;</span>,
               <span class="dt">consequence =</span> turn_into_goon)  
}

lyric &lt;-<span class="st"> </span><span class="cf">function</span>() {
  foo_foo <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">hop</span>(<span class="dt">through =</span> forest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">scoop</span>(<span class="dt">up =</span> field_mouse) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">bop</span>(<span class="dt">on =</span> head)
  
  <span class="kw">down_came</span>(Good_Fairy)
  <span class="kw">said</span>(Good_Fairy, 
      <span class="kw">c</span>(<span class="st">&quot;Little bunny Foo Foo&quot;</span>,
        <span class="st">&quot;I don&#39;t want to see you&quot;</span>,
        <span class="st">&quot;Scooping up the field mice&quot;</span>,
        <span class="st">&quot;And bopping them on the head.&quot;</span>)
<span class="er">}</span>

<span class="kw">lyric</span>()
<span class="kw">threat</span>(<span class="dv">3</span>)
<span class="kw">lyric</span>()
<span class="kw">threat</span>(<span class="dv">2</span>)
<span class="kw">lyric</span>()
<span class="kw">threat</span>(<span class="dv">1</span>)
<span class="kw">lyric</span>()
<span class="kw">turn_into_goon</span>(Good_Fairy, foo_foo)
             </code></pre></div>
</div>
</div>
</div>
<div id="functions-are-for-humans-and-computers" class="section level2">
<h2><span class="header-section-number">18.3</span> Functions are for humans and computers</h2>
<div id="exercise-1-45" class="section level3 exercise">
<h3><span class="header-section-number">18.3.1</span> Exercise 1</h3>
<div class="question">
<p>Read the source code for each of the following three functions, puzzle out what they do, and then brainstorm better names.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(string, prefix) {
  <span class="kw">substr</span>(string, <span class="dv">1</span>, <span class="kw">nchar</span>(prefix)) <span class="op">==</span><span class="st"> </span>prefix
}

f2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)
  x[<span class="op">-</span><span class="kw">length</span>(x)]
}

f3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  <span class="kw">rep</span>(y, <span class="dt">length.out =</span> <span class="kw">length</span>(x))
}</code></pre></div>
<p>The function <code>f1</code> returns whether a function has a common prefix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">f1</span>(<span class="kw">c</span>(<span class="st">&quot;str_c&quot;</span>, <span class="st">&quot;str_foo&quot;</span>, <span class="st">&quot;abc&quot;</span>), <span class="st">&quot;str_&quot;</span>)
<span class="co">#&gt; [1]  TRUE  TRUE FALSE</span></code></pre></div>
<p>A better name for <code>f1</code> is <code>has_prefix()</code></p>
<p>The function <code>f2</code> drops the last element</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">f2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)
<span class="co">#&gt; [1] 1 2</span>
<span class="kw">f2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)
<span class="co">#&gt; [1] 1</span>
<span class="kw">f2</span>(<span class="dv">1</span>)
<span class="co">#&gt; NULL</span></code></pre></div>
<p>A better name for <code>f2</code> is <code>drop_last()</code>.</p>
<p>The function <code>f3</code> repeats <code>y</code> once for each element of <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">f3</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">4</span>)
<span class="co">#&gt; [1] 4 4 4</span></code></pre></div>
<p>This is a harder one to name. I would say something like <code>recycle</code> (R’s name for this behavior), or <code>epxand</code>.</p>
</div>
</div>
<div id="exercise-2-44" class="section level3 exercise">
<h3><span class="header-section-number">18.3.2</span> Exercise 2</h3>
<div class="question">
<p>Take a function that you’ve written recently and spend 5 minutes brainstorming a better name for it and its arguments.</p>
</div>
<div class="answer">
<p>Answer left to the reader.</p>
</div>
</div>
<div id="exercise-3-32" class="section level3 exercise">
<h3><span class="header-section-number">18.3.3</span> Exercise 3</h3>
<div class="question">
<p>Compare and contrast <code>rnorm()</code> and <code>MASS::mvrnorm()</code>. How could you make them more consistent?</p>
</div>
<div class="answer">
<p><em>You can ignore</em></p>
<p><code>rnorm</code> samples from the univariate normal distribution, while <code>MASS::mvrnorm</code> samples from the multivariate normal distribution. The main arguments in <code>rnorm</code> are <code>n</code>, <code>mean</code>, <code>sd</code>. The main arguments is <code>MASS::mvrnorm</code> are <code>n</code>, <code>mu</code>, <code>Sigma</code>. To be consistent they should have the same names. However, this is difficult. In general, it is better to be consistent with more widely used functions, e.g. <code>rmvnorm</code> should follow the conventions of <code>rnorm</code>. However, while <code>mean</code> is correct in the multivariate case, <code>sd</code> does not make sense in the multivariate case. Both functions an internally consistent though; it would be bad to have <code>mu</code> and <code>sd</code> or <code>mean</code> and <code>Sigma</code>.</p>
</div>
</div>
<div id="exercise-4-25" class="section level3 exercise">
<h3><span class="header-section-number">18.3.4</span> Exercise 4</h3>
<div class="question">
<p>Make a case for why <code>norm_r()</code>, <code>norm_d()</code> etc would be better than <code>rnorm()</code>, <code>dnorm()</code>. Make a case for the opposite.</p>
</div>
<div class="answer">
<p>If named <code>norm_r</code> and <code>norm_d</code>, it groups the family of functions related to the normal distribution. If named <code>rnorm</code>, and <code>dnorm</code>, functions related to are grouped into families by the action they perform. <code>r*</code> functions always sample from distributions: <code>rnorm</code>, <code>rbinom</code>, <code>runif</code>, <code>rexp</code>. <code>d*</code> functions calculate the probability density or mass of a distribution: <code>dnorm</code>, <code>dbinom</code>, <code>dunif</code>, <code>dexp</code>.</p>
</div>
</div>
</div>
<div id="conditional-execution" class="section level2">
<h2><span class="header-section-number">18.4</span> Conditional execution</h2>
<div id="exercise-1-46" class="section level3 exercise">
<h3><span class="header-section-number">18.4.1</span> Exercise 1</h3>
<div class="question">
<p>What’s the difference between <code>if</code> and <code>ifelse()</code>? &gt; Carefully read the help and construct three examples that illustrate the key differences.</p>
</div>
<div class="answer">
<p>The keyword <code>if</code> tests a single condition, while <code>ifelse</code> tests each element.</p>
</div>
</div>
<div id="exercise-2-45" class="section level3 exercise">
<h3><span class="header-section-number">18.4.2</span> Exercise 2</h3>
<div class="question">
<p>Write a greeting function that says “good morning”, “good afternoon”, or “good evening”, depending on the time of day. (Hint: use a time argument that defaults to <code>lubridate::now()</code>. That will make it easier to test your function.)</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">greet &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">time =</span> lubridate<span class="op">::</span><span class="kw">now</span>()) {
  hr &lt;-<span class="st"> </span><span class="kw">hour</span>(time)
  <span class="co"># I don&#39;t know what to do about times after midnight, </span>
  <span class="co"># are they evening or morning?</span>
  <span class="cf">if</span> (hr <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>) {
    <span class="kw">print</span>(<span class="st">&quot;good morning&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (hr <span class="op">&lt;</span><span class="st"> </span><span class="dv">17</span>) {
    <span class="kw">print</span>(<span class="st">&quot;good afternoon&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">print</span>(<span class="st">&quot;good evening&quot;</span>)
  }
} 
<span class="kw">greet</span>()
<span class="co">#&gt; [1] &quot;good afternoon&quot;</span>
<span class="kw">greet</span>(<span class="kw">ymd_h</span>(<span class="st">&quot;2017-01-08:05&quot;</span>))
<span class="co">#&gt; [1] &quot;good morning&quot;</span>
<span class="kw">greet</span>(<span class="kw">ymd_h</span>(<span class="st">&quot;2017-01-08:13&quot;</span>))
<span class="co">#&gt; [1] &quot;good afternoon&quot;</span>
<span class="kw">greet</span>(<span class="kw">ymd_h</span>(<span class="st">&quot;2017-01-08:20&quot;</span>))
<span class="co">#&gt; [1] &quot;good evening&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-3-33" class="section level3 exercise">
<h3><span class="header-section-number">18.4.3</span> Exercise 3</h3>
<div class="question">
<p>Implement a <code>fizzbuzz</code> function. It takes a single number as input. If the number is divisible by three, it returns “fizz”. If it’s divisible by five it returns “buzz”. If it’s divisible by three and five, it returns “fizzbuzz”. Otherwise, it returns the number. Make sure you first write working code before you create the function.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fizzbuzz &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">stopifnot</span>(<span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)
  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))
  <span class="co"># this could be made more efficient by minimizing the</span>
  <span class="co"># number of tests</span>
  <span class="cf">if</span> (<span class="op">!</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">3</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">5</span>)) {
    <span class="kw">print</span>(<span class="st">&quot;fizzbuzz&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">3</span>)) {
    <span class="kw">print</span>(<span class="st">&quot;fizz&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">5</span>)) {
    <span class="kw">print</span>(<span class="st">&quot;buzz&quot;</span>)
  }
}
<span class="kw">fizzbuzz</span>(<span class="dv">6</span>)
<span class="co">#&gt; [1] &quot;fizz&quot;</span>
<span class="kw">fizzbuzz</span>(<span class="dv">10</span>)
<span class="co">#&gt; [1] &quot;buzz&quot;</span>
<span class="kw">fizzbuzz</span>(<span class="dv">15</span>)
<span class="co">#&gt; [1] &quot;fizzbuzz&quot;</span>
<span class="kw">fizzbuzz</span>(<span class="dv">2</span>)</code></pre></div>
</div>
</div>
<div id="exercise-4-26" class="section level3 exercise">
<h3><span class="header-section-number">18.4.4</span> Exercise 4</h3>
<div class="question">
<p>How could you use <code>cut()</code> to simplify this set of nested if-else statements?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="st">&quot;freezing&quot;</span>
} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) {
  <span class="st">&quot;cold&quot;</span>
} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span>) {
  <span class="st">&quot;cool&quot;</span>
} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>) {
  <span class="st">&quot;warm&quot;</span>
} <span class="cf">else</span> {
  <span class="st">&quot;hot&quot;</span>
}</code></pre></div>
<p>How would you change the call to <code>cut()</code> if I’d used <code>&lt;</code> instead of <code>&lt;=</code>? What is the other chief advantage of cut() for this problem? (Hint: what happens if you have many values in temp?)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>)
<span class="kw">cut</span>(temp, <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="ot">Inf</span>), <span class="dt">right =</span> <span class="ot">TRUE</span>,
    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;freezing&quot;</span>, <span class="st">&quot;cold&quot;</span>, <span class="st">&quot;cool&quot;</span>, <span class="st">&quot;warm&quot;</span>, <span class="st">&quot;hot&quot;</span>))
<span class="co">#&gt;  [1] freezing freezing freezing cold     cold     cool     cool    </span>
<span class="co">#&gt;  [8] warm     warm     hot      hot      hot      hot     </span>
<span class="co">#&gt; Levels: freezing cold cool warm hot</span></code></pre></div>
<p>To have intervals open on the left (using <code>&lt;</code>), I change the argument to <code>right = FALSE</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>)
<span class="kw">cut</span>(temp, <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="ot">Inf</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>,
    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;freezing&quot;</span>, <span class="st">&quot;cold&quot;</span>, <span class="st">&quot;cool&quot;</span>, <span class="st">&quot;warm&quot;</span>, <span class="st">&quot;hot&quot;</span>))
<span class="co">#&gt;  [1] freezing freezing cold     cold     cool     cool     warm    </span>
<span class="co">#&gt;  [8] warm     hot      hot      hot      hot      hot     </span>
<span class="co">#&gt; Levels: freezing cold cool warm hot</span></code></pre></div>
<p>Two advantages of using <code>cut</code> is that it works on vectors, whereas <code>if</code> only works on a single value (I already demonstrated this above), and that to change comparisons I only needed to change the argument to <code>right</code>, but I would have had to change four operators in the <code>if</code> expression.</p>
</div>
</div>
<div id="exercise-5-14" class="section level3 exercise">
<h3><span class="header-section-number">18.4.5</span> Exercise 5</h3>
<div class="question">
<p>What happens if you use <code>switch()</code> with numeric values?</p>
</div>
<div class="answer">
<p>It selects that number argument from <code>...</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">switch</span>(<span class="dv">2</span>, <span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>)
<span class="co">#&gt; [1] &quot;two&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-6-10" class="section level3 exercise">
<h3><span class="header-section-number">18.4.6</span> Exercise 6</h3>
<div class="question">
<p>What does this <code>switch()</code> call do? What happens if <code>x</code> is <code>&quot;e&quot;</code>?</p>
</div>
<div class="answer">
<p>It will return the <code>&quot;ab&quot;</code> for <code>a</code> or <code>b</code>, <code>&quot;cd&quot;</code> for <code>c</code> or <code>d</code>, an <code>NULL</code> for <code>e</code>. It returns the first non-missing value for the first name it matches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> &quot;e&quot;</span>
<span class="cf">switch</span>(x, 
  <span class="dt">a =</span> ,
  <span class="dt">b =</span> <span class="st">&quot;ab&quot;</span>,
  <span class="dt">c =</span> ,
  <span class="dt">d =</span> <span class="st">&quot;cd&quot;</span>
)</code></pre></div>
<p>Experiment, then carefully read the documentation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">switcheroo &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">switch</span>(x, 
  <span class="dt">a =</span> ,
  <span class="dt">b =</span> <span class="st">&quot;ab&quot;</span>,
  <span class="dt">c =</span> ,
  <span class="dt">d =</span> <span class="st">&quot;cd&quot;</span>
  )
}
<span class="kw">switcheroo</span>(<span class="st">&quot;a&quot;</span>)
<span class="co">#&gt; [1] &quot;ab&quot;</span>
<span class="kw">switcheroo</span>(<span class="st">&quot;b&quot;</span>)
<span class="co">#&gt; [1] &quot;ab&quot;</span>
<span class="kw">switcheroo</span>(<span class="st">&quot;c&quot;</span>)
<span class="co">#&gt; [1] &quot;cd&quot;</span>
<span class="kw">switcheroo</span>(<span class="st">&quot;d&quot;</span>)
<span class="co">#&gt; [1] &quot;cd&quot;</span>
<span class="kw">switcheroo</span>(<span class="st">&quot;e&quot;</span>)</code></pre></div>
</div>
</div>
</div>
<div id="function-arguments" class="section level2">
<h2><span class="header-section-number">18.5</span> Function arguments</h2>
<div id="exercise-1-47" class="section level3 exercise">
<h3><span class="header-section-number">18.5.1</span> Exercise 1</h3>
<div class="question">
<p>What does <code>commas(letters, collapse = &quot;-&quot;)</code> do? Why?</p>
</div>
<div class="answer">
<p>The <code>commas</code> function in the chapter is defined as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">commas &lt;-<span class="st"> </span><span class="cf">function</span>(...) {
  stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)
}</code></pre></div>
<p>When <code>commas()</code> is given a collapse argument, it throws an error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">commas</span>(letters, <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)
<span class="co">#&gt; Error in stringr::str_c(..., collapse = &quot;, &quot;): formal argument &quot;collapse&quot; matched by multiple actual arguments</span></code></pre></div>
<p>This is because when the argument <code>collapse</code> is given to <code>commas</code>, it is passed to <code>str_c</code> as part of <code>...</code>. In other words, the previous code is equivalent to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_c</span>(letters, <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</code></pre></div>
<p>However, it is an error to give the same named argument to a function twice.</p>
<p>One way to allow the user to override the separator in <code>commas</code> is to add a <code>collapse</code> argument to the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">commas &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>) {
  stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> collapse)
}</code></pre></div>
</div>
</div>
<div id="exercise-2-46" class="section level3 exercise">
<h3><span class="header-section-number">18.5.2</span> Exercise 2</h3>
<div class="question">
<p>It’d be nice if you could supply multiple characters to the pad argument, e.g. <code>rule(&quot;Title&quot;, pad = &quot;-+&quot;)</code>. Why doesn’t this currently work? How could you fix it?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pad =</span> <span class="st">&quot;-&quot;</span>) {
  title &lt;-<span class="st"> </span><span class="kw">paste0</span>(...)
  width &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">nchar</span>(title) <span class="op">-</span><span class="st"> </span><span class="dv">5</span>
  <span class="kw">cat</span>(title, <span class="st">&quot; &quot;</span>, stringr<span class="op">::</span><span class="kw">str_dup</span>(pad, width), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>)
<span class="co">#&gt; Important output ------------------------------------------------------</span>
<span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;-+&quot;</span>)
<span class="co">#&gt; Important output -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></code></pre></div>
<p>It does not work because it duplicates pad by the width minus the length of the string. This is implicitly assuming that pad is only one character. I could adjust the code to calculate the length of pad. The trickiest part is handling what to do if width is not a multiple of the number of characters of <code>pad</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pad =</span> <span class="st">&quot;-&quot;</span>) {
  title &lt;-<span class="st"> </span><span class="kw">paste0</span>(...)
  width &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">nchar</span>(title) <span class="op">-</span><span class="st"> </span><span class="dv">5</span>
  padchar &lt;-<span class="st"> </span><span class="kw">nchar</span>(pad)
  <span class="kw">cat</span>(title, <span class="st">&quot; &quot;</span>,
      stringr<span class="op">::</span><span class="kw">str_dup</span>(pad, width <span class="op">%/%</span><span class="st"> </span>padchar),
      <span class="co"># if not multiple, fill in the remaining characters</span>
      stringr<span class="op">::</span><span class="kw">str_sub</span>(pad, <span class="dv">1</span>, width <span class="op">%%</span><span class="st"> </span>padchar),
      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
}
<span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>)
<span class="co">#&gt; Important output ------------------------------------------------------</span>
<span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;-+&quot;</span>)
<span class="co">#&gt; Important output -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;-+-&quot;</span>)
<span class="co">#&gt; Important output -+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+-</span></code></pre></div>
</div>
</div>
<div id="exercise-3-34" class="section level3 exercise">
<h3><span class="header-section-number">18.5.3</span> Exercise 3</h3>
<div class="question">
<p>What does the <code>trim</code> argument to <code>mean()</code> do? When might you use it?</p>
</div>
<div class="answer">
<p>The <code>trim</code> arguments trims a fraction of observations from each end of the vector (meaning the range) before calculating the mean. This is useful for calculating a measure of central tendency that is robust to outliers.</p>
</div>
</div>
<div id="exercise-4-27" class="section level3 exercise">
<h3><span class="header-section-number">18.5.4</span> Exercise 4</h3>
<div class="question">
<p>The default value for the <code>method</code> argument to <code>cor()</code> is <code>c(&quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot;)</code>. What does that mean? What value is used by default?</p>
</div>
<div class="answer">
<p>It means that the <code>method</code> argument can take one of those three values. The first value, <code>&quot;pearson&quot;</code>, is used by default.</p>
</div>
</div>
</div>
<div id="environment" class="section level2">
<h2><span class="header-section-number">18.6</span> Environment</h2>
<p>No Exercises</p>
<!--chapter:end:functions.Rmd-->
</div>
</div>
<div id="vectors" class="section level1">
<h1><span class="header-section-number">19</span> Vectors</h1>
<div id="introduction-12" class="section level2">
<h2><span class="header-section-number">19.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</span>
<span class="co">#&gt; ✔ ggplot2 2.2.1          ✔ purrr   0.2.4     </span>
<span class="co">#&gt; ✔ tibble  1.4.2          ✔ dplyr   0.7.4.9000</span>
<span class="co">#&gt; ✔ tidyr   0.8.0          ✔ stringr 1.2.0     </span>
<span class="co">#&gt; ✔ readr   1.1.1          ✔ forcats 0.3.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></code></pre></div>
</div>
<div id="vector-basics" class="section level2">
<h2><span class="header-section-number">19.2</span> Vector Basics</h2>
<p>No exercises</p>
</div>
<div id="important-types-of-atomic-vector" class="section level2">
<h2><span class="header-section-number">19.3</span> Important Types of Atomic Vector</h2>
<div id="exercise-1-48" class="section level3 exercise">
<h3><span class="header-section-number">19.3.1</span> Exercise 1</h3>
<div class="question">
<p>Describe the difference between <code>is.finite(x)</code> and <code>!is.infinite(x)</code>.</p>
</div>
<div class="answer">
<p>To find out, try the functions on a numeric vector that includes a number and the five special values (<code>NA</code>, <code>NaN</code>, <code>Inf</code>, <code>-Inf</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>, <span class="ot">NaN</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>)
<span class="kw">is.finite</span>(x)
<span class="co">#&gt; [1]  TRUE FALSE FALSE FALSE FALSE</span>
<span class="op">!</span><span class="kw">is.infinite</span>(x)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE FALSE FALSE</span></code></pre></div>
<p><code>is.finite</code> considers only a number to be finite, and considers missing (<code>NA</code>), not a number (<code>NaN</code>), and positive and negative infinity to be not finite. However, since <code>is.infinite</code> only considers <code>Inf</code> and <code>-Inf</code> to be infinite, <code>!is.infinite</code> considers <code>0</code> as well as missing and not-a-number to be not infinite.</p>
<p>So <code>NA</code> and <code>NaN</code> are neither finite or infinite. Mind blown.</p>
</div>
</div>
<div id="exercise-2-47" class="section level3 exercise">
<h3><span class="header-section-number">19.3.2</span> Exercise 2</h3>
<div class="question">
<p>Read the source code for <code>dplyr::near()</code> (Hint: to see the source code, drop the ()). How does it work?</p>
</div>
<div class="answer">
<p>The source for <code>dplyr::near</code> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplyr<span class="op">::</span>near
<span class="co">#&gt; function(x, y, tol = .Machine$double.eps ^ 0.5) {</span>
<span class="co">#&gt;   abs(x - y) &lt; tol</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;environment: namespace:dplyr&gt;</span></code></pre></div>
<p>Instead of checking for exact equality, it checks that two numbers are within a certain tolerance, <code>tol</code>. By default the tolerance is set to the square root of <code>.Machine$double.eps</code>, which is the smallest floating point number that the computer can represent.</p>
</div>
</div>
<div id="exercise-3-35" class="section level3 exercise">
<h3><span class="header-section-number">19.3.3</span> Exercise 3</h3>
<div class="question">
<p>A logical vector can take 3 possible values. How many possible values can an integer vector take? How many possible values can a double take? Use Google to do some research.</p>
</div>
<div class="answer">
<p>The help for <code>.Machine</code> describes some of this:</p>
<p>As all current implementations of R use 32-bit integers and uses IEC 60559 floating-point (double precision) arithmetic,</p>
<p>The <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">IEC 60559</a> or IEEE 754 format uses a 64 bit vector, but</p>
</div>
</div>
<div id="exercise-4-28" class="section level3 exercise">
<h3><span class="header-section-number">19.3.4</span> Exercise 4</h3>
<div class="question">
<p>Brainstorm at least four functions that allow you to convert a double to an integer. How do they differ? Be precise.</p>
</div>
<div class="answer">
<p>Broadly, could convert a double to an integer by truncating or rounding to the nearest integer. For truncating or for handling ties (doubles ending in 0.5), there are multiple methods for determining which integer value to go to.</p>
<table>
<thead>
<tr class="header">
<th align="left">methods</th>
<th align="left">0.5</th>
<th align="left">-0.5</th>
<th align="left">1.5</th>
<th align="left">-1.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">towards zero:</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">away from zero</td>
<td align="left">1</td>
<td align="left">-1</td>
<td align="left">2</td>
<td align="left">-2</td>
</tr>
<tr class="odd">
<td align="left">largest towards <span class="math inline">\(+\infty\)</span>)</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">2</td>
<td align="left">-1</td>
</tr>
<tr class="even">
<td align="left">smallest (towards <span class="math inline">\(-\infty\)</span>)</td>
<td align="left">0</td>
<td align="left">-1</td>
<td align="left">1</td>
<td align="left">-2</td>
</tr>
<tr class="odd">
<td align="left">even</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">2</td>
<td align="left">-2</td>
</tr>
<tr class="even">
<td align="left">odd</td>
<td align="left">1</td>
<td align="left">-1</td>
<td align="left">1</td>
<td align="left">-1</td>
</tr>
</tbody>
</table>
<p>See the Wikipedia article <a href="https://en.wikipedia.org/wiki/IEEE_floating_point">IEEE floating point</a> for rounding rules.</p>
<p>For rounding, R and many programming languages use the IEEE standard. This is “round to nearest, ties to even”. This is not the same as what you See the value of looking at the value of <code>.Machine$double.rounding</code> and its documentation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="fl">0.5</span>)

round2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">to_even =</span> <span class="ot">TRUE</span>) {
  q &lt;-<span class="st"> </span>x <span class="op">%/%</span><span class="st"> </span><span class="dv">1</span>
  r &lt;-<span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">1</span>
  q <span class="op">+</span><span class="st"> </span>(r <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.5</span>)
}
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">12.5</span>, <span class="op">-</span><span class="fl">11.5</span>, <span class="fl">11.5</span>, <span class="fl">12.5</span>)
<span class="kw">round</span>(x)
<span class="co">#&gt; [1] -12 -12  12  12</span>
<span class="kw">round2</span>(x, <span class="dt">to_even =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] -12 -11  12  13</span></code></pre></div>
<p>The problem with the always rounding 0.5 up rule is that it is biased upwards. Rounding to nearest with ties towards even is not. Consider the sequence <span class="math inline">\(-100.5, -99.5, \dots, 0, \dots, 99.5, 100.5\)</span>. Its sum is 0. It would be nice if rounding preserved that sum. Using the “ties towards even”, the sum is still zero. However, the “ties towards <span class="math inline">\(+\infty\)</span>” produces a non-zero number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">100.5</span>, <span class="fl">100.5</span>, <span class="dt">by =</span> <span class="dv">1</span>)
<span class="kw">sum</span>(x)
<span class="co">#&gt; [1] 0</span>
<span class="kw">sum</span>(<span class="kw">round</span>(x))
<span class="co">#&gt; [1] 0</span>
<span class="kw">sum</span>(<span class="kw">round2</span>(x))
<span class="co">#&gt; [1] 101</span></code></pre></div>
<p>Here’s a real-world non-engineering example of rounding going terribly wrong. In 1983, the Vancouver stock exchange adjusted its index from 524.811 to 1098.892 to correct for accumulated error due to rounding to three decimal points (see <a href="https://en.wikipedia.org/wiki/Vancouver_Stock_Exchange%5D">Vancouver Stock Exchange</a>).</p>
<p>Here’s a <a href="https://www.ma.utexas.edu/users/arbogast/misc/disasters.html">list</a> of a few more.</p>
</div>
</div>
<div id="exercise-5-15" class="section level3 exercise">
<h3><span class="header-section-number">19.3.5</span> Exercise 5</h3>
<div class="question">
<p>What functions from the <strong>readr</strong> package allow you to turn a string into logical, integer, and double vector?</p>
</div>
<div class="answer">
<p>The functions <code>parse_logical</code>, <code>parse_integer</code>, and <code>parse_number</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_logical</span>(<span class="kw">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;true&quot;</span>, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;NA&quot;</span>))
<span class="co">#&gt; [1]  TRUE FALSE  TRUE FALSE  TRUE  TRUE    NA</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;1235&quot;</span>, <span class="st">&quot;0134&quot;</span>, <span class="st">&quot;NA&quot;</span>))
<span class="co">#&gt; [1] 1235  134   NA</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_number</span>(<span class="kw">c</span>(<span class="st">&quot;1.0&quot;</span>, <span class="st">&quot;3.5&quot;</span>, <span class="st">&quot;1,000&quot;</span>, <span class="st">&quot;NA&quot;</span>))
<span class="co">#&gt; [1]    1.0    3.5 1000.0     NA</span></code></pre></div>
<p>Read the documentation of <code>read_number</code>. In order to ignore things like currency symbols and comma separators in number strings it ignores them using a heuristic.</p>
</div>
</div>
</div>
<div id="using-atomic-vectors" class="section level2">
<h2><span class="header-section-number">19.4</span> Using atomic vectors</h2>
<div id="exercise-1-49" class="section level3 exercise">
<h3><span class="header-section-number">19.4.1</span> Exercise 1</h3>
<div class="question">
<p>What does <code>mean(is.na(x))</code> tell you about a vector <code>x</code>? What about <code>sum(!is.finite(x))</code>?</p>
</div>
<div class="answer">
<p>The expression <code>mean(is.na(x))</code> calculates the proportion of missing values in a vector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>, <span class="ot">NaN</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>)
<span class="kw">mean</span>(<span class="kw">is.na</span>(x))
<span class="co">#&gt; [1] 0.143</span></code></pre></div>
<p>The expression <code>mean(!is.finite(x))</code> calculates the proportion of values that are <code>NA</code>, <code>NaN</code>, or infinite.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="op">!</span><span class="kw">is.finite</span>(x))
<span class="co">#&gt; [1] 0.286</span></code></pre></div>
</div>
</div>
<div id="exercise-2-48" class="section level3 exercise">
<h3><span class="header-section-number">19.4.2</span> Exercise 2</h3>
<div class="question">
<p>Carefully read the documentation of <code>is.vector()</code>. What does it actually test for? Why does <code>is.atomic()</code> not agree with the definition of atomic vectors above?</p>
</div>
<div class="answer">
<p>The function <code>is.vector</code> only checks whether the object has no attributes other than names. Thus a <code>list</code> is a vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.vector</span>(<span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>))
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>But any object that has an attribute (other than names) is not:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
<span class="kw">attr</span>(x, <span class="st">&quot;something&quot;</span>) &lt;-<span class="st"> </span><span class="ot">TRUE</span>
<span class="kw">is.vector</span>(x)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>The idea behind this is that object oriented classes will include attributes, including, but not limited to <code>&quot;class&quot;</code>.</p>
<p>The function <code>is.atomic</code> explicitly checks whether an object is one of the atomic types (“logical”, “integer”, “numeric”, “complex”, “character”, and “raw”) or NULL.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.atomic</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">is.atomic</span>(<span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>))
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>The function <code>is.atomic</code> will consider objects to be atomic even if they have extra attributes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.atomic</span>(x)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
<div id="exercise-3-36" class="section level3 exercise">
<h3><span class="header-section-number">19.4.3</span> Exercise 3</h3>
<div class="question">
<p>Compare and contrast <code>setNames()</code> with <code>purrr::set_names()</code>.</p>
</div>
<div class="answer">
<p>These are simple functions, so we can simply print out their source code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">setNames
<span class="co">#&gt; function (object = nm, nm) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     names(object) &lt;- nm</span>
<span class="co">#&gt;     object</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x7fd9b7019b20&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:stats&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">purrr<span class="op">::</span>set_names
<span class="co">#&gt; function(x, nm = x, ...) {</span>
<span class="co">#&gt;   set_names_impl(x, x, nm, ...)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x7fd9b9b84a68&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:rlang&gt;</span></code></pre></div>
<p>From the code we can see that <code>set_names</code> adds a few sanity checks: <code>x</code> has to be a vector, and the lengths of the object and the names have to be the same.</p>
</div>
</div>
<div id="exercise-4-29" class="section level3 exercise">
<h3><span class="header-section-number">19.4.4</span> Exercise 4</h3>
<div class="question">
<p>Create functions that take a vector as input and returns:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>The last value. Should you use [ or [[? 2 The elements at even numbered positions.</li>
<li>Every element except the last value.</li>
<li>Only even numbers (and no missing values).</li>
</ol>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">last_value &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="co"># check for case with no length</span>
  <span class="cf">if</span> (<span class="kw">length</span>(x)) {
    <span class="co"># Use [[ as suggested because it returns one element</span>
    x[[<span class="kw">length</span>(x)]]  
  } <span class="cf">else</span> {
    x
  }
}
<span class="kw">last_value</span>(<span class="kw">numeric</span>())
<span class="co">#&gt; numeric(0)</span>
<span class="kw">last_value</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] 1</span>
<span class="kw">last_value</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt; [1] 10</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">even_indices &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">length</span>(x)) {
    x[<span class="kw">seq_along</span>(x) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]
  } <span class="cf">else</span> {
    x
  }  
}
<span class="kw">even_indices</span>(<span class="kw">numeric</span>())
<span class="co">#&gt; numeric(0)</span>
<span class="kw">even_indices</span>(<span class="dv">1</span>)
<span class="co">#&gt; numeric(0)</span>
<span class="kw">even_indices</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt; [1]  2  4  6  8 10</span>
<span class="co"># test using case to ensure that values not indices</span>
<span class="co"># are being returned</span>
<span class="kw">even_indices</span>(letters)
<span class="co">#&gt;  [1] &quot;b&quot; &quot;d&quot; &quot;f&quot; &quot;h&quot; &quot;j&quot; &quot;l&quot; &quot;n&quot; &quot;p&quot; &quot;r&quot; &quot;t&quot; &quot;v&quot; &quot;x&quot; &quot;z&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_last &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">length</span>(x)) {
    x[<span class="op">-</span><span class="kw">length</span>(x)]
  } <span class="cf">else</span> {
    x
  }
}
<span class="kw">not_last</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
<span class="co">#&gt; [1] 1 2 3 4</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">even_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x[<span class="op">!</span><span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)]
}
<span class="kw">even_numbers</span>(<span class="op">-</span><span class="dv">10</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#&gt;  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10</span></code></pre></div>
</div>
</div>
<div id="exercise-5-16" class="section level3 exercise">
<h3><span class="header-section-number">19.4.5</span> Exercise 5</h3>
<div class="question">
<p>Why is <code>x[-which(x &gt; 0)]</code> not the same as <code>x[x &lt;= 0]</code>?</p>
</div>
<div class="answer">
<p>They will treat missing values differently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="ot">NaN</span>, <span class="ot">NA</span>)
x[<span class="op">-</span><span class="kw">which</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)]
<span class="co">#&gt; [1]   -5   -4   -3   -2   -1    0 -Inf  NaN   NA</span>
<span class="op">-</span><span class="kw">which</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)
<span class="co">#&gt; [1]  -7  -8  -9 -10 -11 -12</span>
x[x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>]
<span class="co">#&gt; [1]   -5   -4   -3   -2   -1    0 -Inf   NA   NA</span>
x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>
<span class="co">#&gt;  [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; [12] FALSE  TRUE    NA    NA</span></code></pre></div>
<p><code>-which(x &gt; 0)</code> which calculates the indexes for any value that is <code>TRUE</code> and ignores <code>NA</code>. Thus is keeps <code>NA</code> and <code>NaN</code> because the comparison is not <code>TRUE</code>. <code>x &lt;= 0</code> works slightly differently. If <code>x &lt;= 0</code> returns <code>TRUE</code> or <code>FALSE</code> it works the same way. However, if the comparison generates a <code>NA</code>, then it will always keep that entry, but set it to <code>NA</code>. This is why the last two values of <code>x[x &lt;= 0]</code> are <code>NA</code> rather than <code>c(NaN, NA)</code>.</p>
</div>
</div>
<div id="exercise-6-11" class="section level3 exercise">
<h3><span class="header-section-number">19.4.6</span> Exercise 6</h3>
<div class="question">
<p>What happens when you subset with a positive integer that’s bigger than the length of the vector? What happens when you subset with a name that doesn’t exist?</p>
</div>
<div class="answer">
<p>When you subset with positive integers that are larger than the length of the vector, <code>NA</code> values are returned for those integers larger than the length of the vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)[<span class="dv">11</span><span class="op">:</span><span class="dv">12</span>]
<span class="co">#&gt; [1] NA NA</span></code></pre></div>
<p>When a vector is subset with a name that doesn’t exist, an error is generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dv">2</span>)[[<span class="st">&quot;b&quot;</span>]]
<span class="co">#&gt; Error in c(a = 1, 2)[[&quot;b&quot;]]: subscript out of bounds</span></code></pre></div>
</div>
</div>
</div>
<div id="recursive-vectors-lists" class="section level2">
<h2><span class="header-section-number">19.5</span> Recursive Vectors (lists)</h2>
<div id="exercise-1-50" class="section level3 exercise">
<h3><span class="header-section-number">19.5.1</span> Exercise 1</h3>
<div class="question">
<p>Draw the following lists as nested sets:</p>
<ol style="list-style-type: decimal">
<li><code>list(a, b, list(c, d), list(e, f))</code></li>
<li><code>list(list(list(list(list(list(a))))))</code></li>
</ol>
</div>
<p><strong>TODO</strong></p>
<div class="answer">

</div>
</div>
<div id="exercise-2-49" class="section level3 exercise">
<h3><span class="header-section-number">19.5.2</span> Exercise 2</h3>
<div class="question">
<p>What happens if you subset a <code>tibble</code> as if you’re subsetting a list? What are the key differences between a list and a <code>tibble</code>?</p>
</div>
<div class="answer">
<p>Subsetting a <code>tibble</code> works the same way as a list; a data frame can be thought of as a list of columns. The key different between a list and a <code>tibble</code> is that a tibble (data frame) has the restriction that all its elements (columns) must have the same length.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">b =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)
x[[<span class="st">&quot;a&quot;</span>]]
<span class="co">#&gt; [1] 1 2</span>
x[<span class="st">&quot;a&quot;</span>]
<span class="co">#&gt; # A tibble: 2 x 1</span>
<span class="co">#&gt;       a</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1     1</span>
<span class="co">#&gt; 2     2</span>
x[<span class="dv">1</span>]
<span class="co">#&gt; # A tibble: 2 x 1</span>
<span class="co">#&gt;       a</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1     1</span>
<span class="co">#&gt; 2     2</span>
x[<span class="dv">1</span>, ]
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       a     b</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     3</span></code></pre></div>
</div>
</div>
</div>
<div id="attributes" class="section level2">
<h2><span class="header-section-number">19.6</span> Attributes</h2>
<p>No exercises</p>
</div>
<div id="augmented-vectors" class="section level2">
<h2><span class="header-section-number">19.7</span> Augmented Vectors</h2>
<div id="exercise-1-51" class="section level3 exercise">
<h3><span class="header-section-number">19.7.1</span> Exercise 1</h3>
<div class="question">
<p>What does <code>hms::hms(3600)</code> return? How does it print? What primitive type is the augmented vector built on top of? What attributes does it use?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>hms<span class="op">::</span><span class="kw">hms</span>(<span class="dv">3600</span>)
<span class="kw">class</span>(x)
<span class="co">#&gt; [1] &quot;hms&quot;      &quot;difftime&quot;</span>
x
<span class="co">#&gt; 01:00:00</span></code></pre></div>
<p><code>hms::hms</code> returns an object of class, and prints the time in “%H:%M:%S” format.</p>
<p>The primitive type is a double</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">typeof</span>(x)
<span class="co">#&gt; [1] &quot;double&quot;</span></code></pre></div>
<p>The attributes is uses are <code>&quot;units&quot;</code> and <code>&quot;class&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(x)
<span class="co">#&gt; $units</span>
<span class="co">#&gt; [1] &quot;secs&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] &quot;hms&quot;      &quot;difftime&quot;</span></code></pre></div>
</div>
</div>
<div id="exercise-2-50" class="section level3 exercise">
<h3><span class="header-section-number">19.7.2</span> Exercise 2</h3>
<div class="question">
<p>Try and make a tibble that has columns with different lengths. What happens?</p>
</div>
<div class="answer">
<p>If I try to create at tibble with a scalar and column of a different length there are no issues, and the scalar is repeated to the length of the longer vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;       x     y</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  1.00     1</span>
<span class="co">#&gt; 2  1.00     2</span>
<span class="co">#&gt; 3  1.00     3</span>
<span class="co">#&gt; 4  1.00     4</span>
<span class="co">#&gt; 5  1.00     5</span></code></pre></div>
<p>However, if I try to create a tibble with two vectors of different lengths (other than one), the <code>tibble</code> function throws an error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)
<span class="co">#&gt; Error: Column `x` must be length 1 or 4, not 3</span></code></pre></div>
</div>
</div>
<div id="exercise-3-37" class="section level3 exercise">
<h3><span class="header-section-number">19.7.3</span> Exercise 3</h3>
<div class="question">
<p>Based on the definition above, is it OK to have a list as a column of a tibble?</p>
</div>
<div class="answer">
<p>If I didn’t already know the answer, what I would do is try it out. From the above, the error message was about vectors having different lengths. But there is nothing that prevents a tibble from having vectors of different types: doubles, character, integers, logical, factor, date. The later are still atomic, but they have additional attributes. So, maybe there won’t be an issue with a list vector as long as it is the same length.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span>, <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;       x y         </span>
<span class="co">#&gt;   &lt;int&gt; &lt;list&gt;    </span>
<span class="co">#&gt; 1     1 &lt;chr [1]&gt; </span>
<span class="co">#&gt; 2     2 &lt;dbl [1]&gt; </span>
<span class="co">#&gt; 3     3 &lt;list [1]&gt;</span></code></pre></div>
<p>It works! I even used a list with heterogeneous types and there wasn’t an issue. In following chapters we’ll see that list vectors can be very useful: for example, when processing many different models.</p>
</div>
<!--chapter:end:vectors.Rmd-->
</div>
</div>
</div>
<div id="iteration" class="section level1">
<h1><span class="header-section-number">20</span> Iteration</h1>
<div id="introduction-13" class="section level2">
<h2><span class="header-section-number">20.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;stringr&quot;</span>)</code></pre></div>
<p>The package <strong>microbenchmark</strong> is used for timing code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;microbenchmark&quot;</span>)</code></pre></div>
</div>
<div id="for-loops" class="section level2">
<h2><span class="header-section-number">20.2</span> For Loops</h2>
<div id="exercise-1-52" class="section level3 exercise">
<h3><span class="header-section-number">20.2.1</span> Exercise 1</h3>
<div class="question">
<p>Write for loops to:</p>
<ol style="list-style-type: decimal">
<li>Compute the mean of every column in <code>mtcars</code>.</li>
<li>Determine the type of each column in <code>nycflights13::flights</code>.</li>
<li>Compute the number of unique values in each column of <code>iris</code>.</li>
<li>Generate 10 random normals for each of <span class="math inline">\(\mu = -10\)</span>, 0, 10, and 100.</li>
</ol>
</div>
<div class="answer">
<blockquote>
<p>Think about the output, sequence, and body before you start writing the loop.</p>
</blockquote>
<p>To compute the mean of every column in <code>mtcars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(mtcars))
<span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(mtcars)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">names</span>(mtcars)) {
  output[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(mtcars[[i]])
}
output
<span class="co">#&gt;     mpg     cyl    disp      hp    drat      wt    qsec      vs      am </span>
<span class="co">#&gt;  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406 </span>
<span class="co">#&gt;    gear    carb </span>
<span class="co">#&gt;   3.688   2.812</span></code></pre></div>
<p>Determine the type of each column in <code>nycflights13::flights</code>. Note that we need to use a <code>list</code>, not a character vector, since the class can have multiple values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;flights&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;nycflights13&quot;</span>)
output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">ncol</span>(flights))
<span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(flights)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">names</span>(flights)) {
  output[[i]] &lt;-<span class="st"> </span><span class="kw">class</span>(flights[[i]])
}
output
<span class="co">#&gt; $year</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $month</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $day</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dep_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sched_dep_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dep_delay</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $arr_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sched_arr_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $arr_delay</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $carrier</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $flight</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tailnum</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $origin</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dest</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $air_time</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $distance</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hour</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $minute</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time_hour</span>
<span class="co">#&gt; [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(iris)
iris_uniq &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(iris))
<span class="kw">names</span>(iris_uniq) &lt;-<span class="st"> </span><span class="kw">names</span>(iris)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">names</span>(iris)) {
  iris_uniq[i] &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(iris[[i]]))
}
iris_uniq
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;           35           23           43           22            3</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># number to draw</span>
n &lt;-<span class="st"> </span><span class="dv">10</span>
<span class="co"># values of the mean</span>
mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)
normals &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(mu))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(normals)) {
  normals[[i]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu[i])
}
normals
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] -11.40  -9.74 -12.44 -10.01  -9.38  -8.85 -11.82 -10.25 -10.24 -10.28</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;  [1] -0.5537  0.6290  2.0650 -1.6310  0.5124 -1.8630 -0.5220 -0.0526</span>
<span class="co">#&gt;  [9]  0.5430 -0.9141</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;  [1] 10.47 10.36  8.70 10.74 11.89  9.90  9.06  9.98  9.17  8.49</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;  [1] 100.9 100.2 100.2 101.6 100.1  99.9  98.1  99.7  99.7 101.1</span></code></pre></div>
<p>However, we don’t need a <code>for</code> loop for this since <code>rnorm</code> recycles means.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(mu), <span class="dt">mean =</span> mu), <span class="dt">ncol =</span> n)
<span class="co">#&gt;        [,1]   [,2]  [,3]     [,4]   [,5]   [,6]    [,7]   [,8]    [,9]</span>
<span class="co">#&gt; [1,] -9.930  -9.56 -9.88 -10.2061 -12.27 -8.926 -11.178  -9.51  -8.663</span>
<span class="co">#&gt; [2,] -0.639   2.76 -1.91   0.0192   2.68 -0.665  -0.976  -1.70   0.237</span>
<span class="co">#&gt; [3,]  9.950  10.05 10.86  10.0296   9.64 11.114  11.065   8.53  11.318</span>
<span class="co">#&gt; [4,] 99.749 100.58 99.76 100.5498 100.21 99.754 100.132 100.28 100.524</span>
<span class="co">#&gt;      [,10]</span>
<span class="co">#&gt; [1,] -9.39</span>
<span class="co">#&gt; [2,] -0.11</span>
<span class="co">#&gt; [3,] 10.17</span>
<span class="co">#&gt; [4,] 99.91</span></code></pre></div>
</div>
</div>
<div id="exercise-2-51" class="section level3 exercise">
<h3><span class="header-section-number">20.2.2</span> Exercise 2</h3>
<div class="question">
<p>Eliminate the for loop in each of the following examples by taking advantage of an existing function that works with vectors:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> &quot;&quot;</span>
<span class="cf">for</span> (x <span class="cf">in</span> letters) {
  out &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_c</span>(out, x)
}
out
<span class="co">#&gt; [1] &quot;abcdefghijklmnopqrstuvwxyz&quot;</span></code></pre></div>
<p><code>str_c</code> already works with vectors, so simply use <code>str_c</code> with the <code>collapse</code> argument to return a single string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stringr<span class="op">::</span><span class="kw">str_c</span>(letters, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
<span class="co">#&gt; [1] &quot;abcdefghijklmnopqrstuvwxyz&quot;</span></code></pre></div>
<p>For this I’m going to rename the variable <code>sd</code> to something different because <code>sd</code> is the name of the function we want to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">100</span>)
sd. &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
  sd. &lt;-<span class="st"> </span>sd. <span class="op">+</span><span class="st"> </span>(x[i] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>
}
sd. &lt;-<span class="st"> </span><span class="kw">sqrt</span>(sd. <span class="op">/</span><span class="st"> </span>(<span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))
sd.
<span class="co">#&gt; [1] 29</span></code></pre></div>
<p>We could simply use the <code>sd</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(x)
<span class="co">#&gt; [1] 29</span></code></pre></div>
<p>Or if there was a need to use the equation (e.g. for pedagogical reasons), then the functions <code>mean</code> and <code>sum</code> already work with vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(<span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))
<span class="co">#&gt; [1] 29</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100</span>)
out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">length</span>(x))
out[<span class="dv">1</span>] &lt;-<span class="st"> </span>x[<span class="dv">1</span>]
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(x)) {
  out[i] &lt;-<span class="st"> </span>out[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x[i]
}
out
<span class="co">#&gt;   [1]  0.126  1.064  1.865  2.623  3.156  3.703  3.799  4.187  4.359  5.050</span>
<span class="co">#&gt;  [11]  5.725  6.672  6.868  7.836  8.224  8.874  9.688  9.759 10.286 11.050</span>
<span class="co">#&gt;  [21] 11.485 12.038 12.242 12.273 13.242 13.421 14.199 15.085 15.921 16.527</span>
<span class="co">#&gt;  [31] 17.434 17.470 17.601 17.695 18.392 18.797 18.863 18.989 19.927 20.143</span>
<span class="co">#&gt;  [41] 20.809 21.013 21.562 22.389 22.517 22.778 23.066 23.081 23.935 24.349</span>
<span class="co">#&gt;  [51] 25.100 25.819 26.334 27.309 27.670 27.840 28.623 28.654 29.444 29.610</span>
<span class="co">#&gt;  [61] 29.639 30.425 31.250 32.216 32.594 32.769 33.372 34.178 34.215 34.947</span>
<span class="co">#&gt;  [71] 35.163 35.179 35.307 35.993 36.635 36.963 37.350 38.058 38.755 39.681</span>
<span class="co">#&gt;  [81] 40.140 40.736 40.901 41.468 42.366 42.960 43.792 44.386 45.165 45.562</span>
<span class="co">#&gt;  [91] 46.412 47.154 47.472 47.583 47.685 48.485 48.865 48.917 49.904 50.508</span></code></pre></div>
<p>The code above is calculating a cumulative sum. Use the function <code>cumsum</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(<span class="kw">cumsum</span>(x),out)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
<div id="exercise-3-38" class="section level3 exercise">
<h3><span class="header-section-number">20.2.3</span> Exercise 3</h3>
<div class="question">
<p>Combine your function writing and for loop skills:</p>
<ol style="list-style-type: decimal">
<li>Write a for loop that <code>prints()</code> the lyrics to the children’s song “Alice the camel”.</li>
<li>Convert the nursery rhyme “ten in the bed” to a function. Generalise it to any number of people in any sleeping structure.</li>
<li>Convert the song “99 bottles of beer on the wall” to a function. Generalise to any number of any vessel containing any liquid on surface.</li>
</ol>
</div>
<div class="answer">
<p>The lyrics for ``Alice the Camel’’ can be found at <a href="http://www.kididdles.com/lyrics/a012.html" class="uri">http://www.kididdles.com/lyrics/a012.html</a>.</p>
<p>We’ll look from five to no humps, and print out a different last line if there are no humps. This uses <code>cat</code> instead of <code>print</code>, so it looks nicer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">humps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;one&quot;</span>, <span class="st">&quot;no&quot;</span>)
<span class="cf">for</span> (i <span class="cf">in</span> humps) {
  <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Alice the camel has &quot;</span>, <span class="kw">rep</span>(i, <span class="dv">3</span>), <span class="st">&quot; humps.&quot;</span>,
             <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> &quot;no&quot;</span>) {
    <span class="kw">cat</span>(<span class="st">&quot;Now Alice is a horse.</span><span class="ch">\n</span><span class="st">&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">cat</span>(<span class="st">&quot;So go, Alice, go.</span><span class="ch">\n</span><span class="st">&quot;</span>)
  }
  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
}
<span class="co">#&gt; Alice the camel has five humps.</span>
<span class="co">#&gt; Alice the camel has five humps.</span>
<span class="co">#&gt; Alice the camel has five humps. </span>
<span class="co">#&gt; So go, Alice, go.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Alice the camel has four humps.</span>
<span class="co">#&gt; Alice the camel has four humps.</span>
<span class="co">#&gt; Alice the camel has four humps. </span>
<span class="co">#&gt; So go, Alice, go.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Alice the camel has three humps.</span>
<span class="co">#&gt; Alice the camel has three humps.</span>
<span class="co">#&gt; Alice the camel has three humps. </span>
<span class="co">#&gt; So go, Alice, go.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Alice the camel has two humps.</span>
<span class="co">#&gt; Alice the camel has two humps.</span>
<span class="co">#&gt; Alice the camel has two humps. </span>
<span class="co">#&gt; So go, Alice, go.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Alice the camel has one humps.</span>
<span class="co">#&gt; Alice the camel has one humps.</span>
<span class="co">#&gt; Alice the camel has one humps. </span>
<span class="co">#&gt; So go, Alice, go.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Alice the camel has no humps.</span>
<span class="co">#&gt; Alice the camel has no humps.</span>
<span class="co">#&gt; Alice the camel has no humps. </span>
<span class="co">#&gt; Now Alice is a horse.</span></code></pre></div>
<p>The lyrics for <a href="http://supersimplelearning.com/songs/original-series/one/ten-in-the-bed/">Ten in the Bed</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ten&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;six&quot;</span>, <span class="st">&quot;five&quot;</span>,
             <span class="st">&quot;four&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;one&quot;</span>)
<span class="cf">for</span> (i <span class="cf">in</span> numbers) {
  <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;There were &quot;</span>, i, <span class="st">&quot; in the bed</span><span class="ch">\n</span><span class="st">&quot;</span>))
  <span class="kw">cat</span>(<span class="st">&quot;and the little one said</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> &quot;one&quot;</span>) {
    <span class="kw">cat</span>(<span class="st">&quot;I&#39;m lonely...&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">cat</span>(<span class="st">&quot;Roll over, roll over</span><span class="ch">\n</span><span class="st">&quot;</span>)
    <span class="kw">cat</span>(<span class="st">&quot;So they all rolled over and one fell out.</span><span class="ch">\n</span><span class="st">&quot;</span>)
  }
  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
}
<span class="co">#&gt; There were ten in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were nine in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were eight in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were seven in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were six in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were five in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were four in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were three in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were two in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; Roll over, roll over</span>
<span class="co">#&gt; So they all rolled over and one fell out.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; There were one in the bed</span>
<span class="co">#&gt; and the little one said</span>
<span class="co">#&gt; I&#39;m lonely...</span></code></pre></div>
<p>For the bottles of beer, I define a helper function to correctly print the number of bottles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bottles &lt;-<span class="st"> </span><span class="cf">function</span>(i) {
  <span class="cf">if</span> (i <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) {
   bottles &lt;-<span class="st"> </span><span class="kw">str_c</span>(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot; bottles&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) {
   bottles &lt;-<span class="st"> &quot;1 bottle&quot;</span>
  } <span class="cf">else</span> {
   bottles &lt;-<span class="st"> &quot;no more bottles&quot;</span>
  }
  bottles
}

beer_bottles &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="co"># should test whether n &gt;= 1.</span>
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(n, <span class="dv">1</span>)) {
     <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="kw">bottles</span>(i), <span class="st">&quot; of beer on the wall, &quot;</span>, <span class="kw">bottles</span>(i), <span class="st">&quot; of beer.</span><span class="ch">\n</span><span class="st">&quot;</span>))
     <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Take one down and pass it around, &quot;</span>, <span class="kw">bottles</span>(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>),
                <span class="st">&quot; of beer on the wall.</span><span class="ch">\n\n</span><span class="st">&quot;</span>))
  }
  <span class="kw">cat</span>(<span class="st">&quot;No more bottles of beer on the wall, no more bottles of beer.</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Go to the store and buy some more, &quot;</span>, <span class="kw">bottles</span>(n), <span class="st">&quot; of beer on the wall.</span><span class="ch">\n</span><span class="st">&quot;</span>))
}
<span class="kw">beer_bottles</span>(<span class="dv">3</span>)
<span class="co">#&gt; 2 bottles of beer on the wall, 2 bottles of beer.</span>
<span class="co">#&gt; Take one down and pass it around, 1 bottle of beer on the wall.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1 bottle of beer on the wall, 1 bottle of beer.</span>
<span class="co">#&gt; Take one down and pass it around, no more bottles of beer on the wall.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; no more bottles of beer on the wall, no more bottles of beer.</span>
<span class="co">#&gt; Take one down and pass it around, no more bottles of beer on the wall.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No more bottles of beer on the wall, no more bottles of beer.</span>
<span class="co">#&gt; Go to the store and buy some more, 2 bottles of beer on the wall.</span></code></pre></div>
</div>
<div id="exercise-4-30" class="section level4 exercise">
<h4><span class="header-section-number">20.2.3.1</span> Exercise 4</h4>
<div class="question">
<p>It’s common to see for loops that don’t preallocate the output and instead increase the length of a vector at each step:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;integer&quot;</span>, <span class="dv">0</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
  output &lt;-<span class="st"> </span><span class="kw">c</span>(output, <span class="kw">lengths</span>(x[[i]]))
}
output</code></pre></div>
<blockquote>
<p>I’ll use the package <strong>microbenchmark</strong> to time this. The <code>microbenchmark</code> function will run an R expression a number of times and time it.</p>
</blockquote>
<p>Define a function that appends to an integer vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_to_vector &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;integer&quot;</span>, <span class="dv">0</span>)
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) {
    output &lt;-<span class="st"> </span><span class="kw">c</span>(output, i)
  }
  output  
}
<span class="kw">microbenchmark</span>(<span class="kw">add_to_vector</span>(<span class="dv">10000</span>), <span class="dt">times =</span> <span class="dv">3</span>)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                  expr min  lq mean median  uq max neval</span>
<span class="co">#&gt;  add_to_vector(10000) 221 222  223    224 224 225     3</span></code></pre></div>
<p>And one that pre-allocates it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_to_vector_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;integer&quot;</span>, n)
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) {
    output[[i]] &lt;-<span class="st"> </span>i
  }
  output
}
<span class="kw">microbenchmark</span>(<span class="kw">add_to_vector_2</span>(<span class="dv">10000</span>), <span class="dt">times =</span> <span class="dv">3</span>)
<span class="co">#&gt; Unit: microseconds</span>
<span class="co">#&gt;                    expr min  lq mean median   uq  max neval</span>
<span class="co">#&gt;  add_to_vector_2(10000) 639 750 2575    860 3542 6224     3</span></code></pre></div>
<p>The pre-allocated vector is about <strong>100</strong> times faster! You may get different answers, but the longer the vector and the bigger the objects, the more that pre-allocation will outperform appending.</p>
</div>
</div>
</div>
</div>
<div id="for-loop-variations" class="section level2">
<h2><span class="header-section-number">20.3</span> For loop variations</h2>
<div id="exercise-1-53" class="section level3 exercise">
<h3><span class="header-section-number">20.3.1</span> Exercise 1</h3>
<div class="question">
<p>Imagine you have a directory full of CSV files that you want to read in. You have their paths in a vector,</p>
</div>
<div class="answer">
<p><code>files &lt;- dir(&quot;data/&quot;, pattern = &quot;\\.csv$&quot;, full.names = TRUE)</code>, and now want to read each one with <code>read_csv()</code>. Write the for loop that will load them into a single data frame.</p>
<p>I will pre-allocate a list, read each file as data frame into an element in that list. This creates a list of data frames. I then use <code>bind_rows</code> to create a single data frame from the list of data frames.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(files))
<span class="cf">for</span> (fname <span class="cf">in</span> <span class="kw">seq_along</span>(files)) {
  df[[i]] &lt;-<span class="st"> </span><span class="kw">read_csv</span>(files[[i]])
}
df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df)</code></pre></div>
</div>
</div>
<div id="exercise-2-52" class="section level3 exercise">
<h3><span class="header-section-number">20.3.2</span> Exercise 2</h3>
<div class="question">
<p>What happens if you use <code>for (nm in names(x))</code> and <code>x</code> has no names? What if only some of the elements are named? What if the names are not unique?</p>
</div>
<div class="answer">
<p>Let’s try it out and see what happens.</p>
<p>When there are no names for the vector, it does not run the code in the loop (it runs zero iterations of the loop):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
<span class="kw">print</span>(<span class="kw">names</span>(x))
<span class="co">#&gt; NULL</span>
<span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(x)) {
  <span class="kw">print</span>(nm)
  <span class="kw">print</span>(x[[nm]])
}</code></pre></div>
<p>Note that the length of <code>NULL</code> is zero:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="ot">NULL</span>)
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>If there only some names, then we get an error if we try to access an element without a name. However, oddly, <code>nm == &quot;&quot;</code> when there is no name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)
<span class="kw">names</span>(x)
<span class="co">#&gt; [1] &quot;a&quot; &quot;&quot;  &quot;c&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(x)) {
  <span class="kw">print</span>(nm)
  <span class="kw">print</span>(x[[nm]])
}
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] &quot;&quot;</span>
<span class="co">#&gt; Error in x[[nm]]: subscript out of bounds</span></code></pre></div>
<p>Finally, if there are duplicate names, then <code>x[[nm]]</code> will give the <em>first</em> element with that name. There is no way to access elements with duplicate names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)
<span class="kw">names</span>(x)
<span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot; &quot;c&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(x)) {
  <span class="kw">print</span>(nm)
  <span class="kw">print</span>(x[[nm]])
}
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] &quot;c&quot;</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
<div id="exercise-3-39" class="section level3 exercise">
<h3><span class="header-section-number">20.3.3</span> Exercise 3</h3>
<div class="question">
<p>Write a function that prints the mean of each numeric column in a data frame, along with its name. For example, <code>show_mean(iris)</code> would print:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show_mean</span>(iris)
<span class="co">#&gt; Sepal.Length: 5.84</span>
<span class="co">#&gt; Sepal.Width:  3.06</span>
<span class="co">#&gt; Petal.Length: 3.76</span>
<span class="co">#&gt; Petal.Width:  1.20</span></code></pre></div>
<blockquote>
<p>(Extra challenge: what function did I use to make sure that the numbers lined up nicely, even though the variable names had different lengths?)</p>
</blockquote>
<p>There may be other functions to do this, but I’ll use <code>str_pad</code>, and <code>str_length</code> to ensure that the space given to the variable names is the same. I messed around with the options to <code>format</code> until I got two digits .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">show_mean &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">digits =</span> <span class="dv">2</span>) {
  <span class="co"># Get max length of any variable in the dataset</span>
  maxstr &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">str_length</span>(<span class="kw">names</span>(df)))
  <span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(df)) {
    <span class="cf">if</span> (<span class="kw">is.numeric</span>(df[[nm]])) {
      <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="kw">str_pad</span>(<span class="kw">str_c</span>(nm, <span class="st">&quot;:&quot;</span>), maxstr <span class="op">+</span><span class="st"> </span>1L, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>),
                <span class="kw">format</span>(<span class="kw">mean</span>(df[[nm]]), <span class="dt">digits =</span> digits, <span class="dt">nsmall =</span> digits),
                <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>),
          <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    }
  }
}
<span class="kw">show_mean</span>(iris)
<span class="co">#&gt; Sepal.Length: 5.84 </span>
<span class="co">#&gt; Sepal.Width:  3.06 </span>
<span class="co">#&gt; Petal.Length: 3.76 </span>
<span class="co">#&gt; Petal.Width:  1.20</span></code></pre></div>
</div>
</div>
<div id="exercise-4-31" class="section level3 exercise">
<h3><span class="header-section-number">20.3.4</span> Exercise 4</h3>
<div class="question">
<p>What does this code do? How does it work?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trans &lt;-<span class="st"> </span><span class="kw">list</span>( 
  <span class="dt">disp =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="fl">0.0163871</span>,
  <span class="dt">am =</span> <span class="cf">function</span>(x) {
    <span class="kw">factor</span>(x, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;auto&quot;</span>, <span class="st">&quot;manual&quot;</span>))
  }
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (var <span class="cf">in</span> <span class="kw">names</span>(trans)) {
  mtcars[[var]] &lt;-<span class="st"> </span>trans[[var]](mtcars[[var]])
}</code></pre></div>
<p>This code mutates the <code>disp</code> and <code>am</code> columns:</p>
<ul>
<li><code>disp</code> is multiplied by 0.0163871</li>
<li><code>am</code> is replaced by a factor variable.</li>
</ul>
<p>The code works by looping over a named list of functions. It calls the named function in the list on the column of <code>mtcars</code> with the same name, and replaces the values of that column.</p>
<p>E.g. this is a function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trans[[<span class="st">&quot;disp&quot;</span>]]</code></pre></div>
<p>This applies the function to the column of <code>mtcars</code> with the same name</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trans[[<span class="st">&quot;disp&quot;</span>]](mtcars[[<span class="st">&quot;disp&quot;</span>]])</code></pre></div>
</div>
</div>
</div>
<div id="for-loops-vs.functionals" class="section level2">
<h2><span class="header-section-number">20.4</span> For loops vs. functionals</h2>
<div id="exercise-1-54" class="section level3 exercise">
<h3><span class="header-section-number">20.4.1</span> Exercise 1</h3>
<div class="question">
<p>Read the documentation for <code>apply()</code>. In the 2d case, what two for loops does it generalize.</p>
</div>
<div class="answer">
<p>It generalizes looping over the rows or columns of a matrix or data-frame.</p>
</div>
</div>
<div id="exercise-2-53" class="section level3 exercise">
<h3><span class="header-section-number">20.4.2</span> Exercise 2</h3>
<div class="question">
<p>Adapt <code>col_summary()</code> so that it only applies to numeric columns. You might want to start with an <code>is_numeric()</code> function that returns a logical vector that has a <code>TRUE</code> corresponding to each numeric column.</p>
</div>
<div class="answer">
<p>The original <code>col_summary()</code> function is,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_summary &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {
  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
    out[i] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])
  }
  out
}</code></pre></div>
<p>The adapted version is,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_summary2 &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {
  <span class="co"># test whether each colum is numeric</span>
  numeric_cols &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;logical&quot;</span>, <span class="kw">length</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
    numeric_cols[[i]] &lt;-<span class="st"> </span><span class="kw">is.numeric</span>(df[[i]])
  }
  <span class="co"># indexes of numeric columns</span>
  idxs &lt;-<span class="st"> </span><span class="kw">seq_along</span>(df)[numeric_cols]
  <span class="co"># number of numeric columns</span>
  n &lt;-<span class="st"> </span><span class="kw">sum</span>(numeric_cols)
  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, n)
  <span class="cf">for</span> (i <span class="cf">in</span> idxs) {
    out[i] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])
  }
  out
}</code></pre></div>
<p>Let’s test that it works,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>],
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)
<span class="kw">col_summary2</span>(df, mean)
<span class="co">#&gt; [1]  0.859  0.555  0.000 -0.451</span></code></pre></div>
</div>
</div>
</div>
<div id="the-map-functions" class="section level2">
<h2><span class="header-section-number">20.5</span> The map functions</h2>
<div id="exercise-1-55" class="section level3 exercise">
<h3><span class="header-section-number">20.5.1</span> Exercise 1</h3>
<div class="question">
<p>Write code that uses one of the map functions to:</p>
<ol style="list-style-type: decimal">
<li>Compute the mean of every column in <code>mtcars</code>.</li>
<li>Determine the type of each column in <code>nycflights13::flights</code>.</li>
<li>Compute the number of unique values in each column of <code>iris</code>.</li>
<li>Generate 10 random normals for each of <span class="math inline">\(\mu = -10\)</span>, <span class="math inline">\(0\)</span>, <span class="math inline">\(10\)</span>, and <span class="math inline">\(100\)</span>.</li>
</ol>
</div>
<div class="answer">
<p>To calculate the mean of every column in <code>mtcars</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(mtcars, mean)
<span class="co">#&gt;     mpg     cyl    disp      hp    drat      wt    qsec      vs      am </span>
<span class="co">#&gt;  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406 </span>
<span class="co">#&gt;    gear    carb </span>
<span class="co">#&gt;   3.688   2.812</span></code></pre></div>
<p>To calculate the type of every column in <code>nycflights13::flights</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(nycflights13<span class="op">::</span>flights, class)
<span class="co">#&gt; $year</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $month</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $day</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dep_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sched_dep_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dep_delay</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $arr_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sched_arr_time</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $arr_delay</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $carrier</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $flight</span>
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tailnum</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $origin</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dest</span>
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $air_time</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $distance</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hour</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $minute</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time_hour</span>
<span class="co">#&gt; [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span></code></pre></div>
<p>I had to use <code>map</code> rather than <code>map_chr</code> since the class Though if by type, <code>typeof</code> is meant:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_chr</span>(nycflights13<span class="op">::</span>flights, typeof)
<span class="co">#&gt;           year          month            day       dep_time sched_dep_time </span>
<span class="co">#&gt;      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot; </span>
<span class="co">#&gt;      dep_delay       arr_time sched_arr_time      arr_delay        carrier </span>
<span class="co">#&gt;       &quot;double&quot;      &quot;integer&quot;      &quot;integer&quot;       &quot;double&quot;    &quot;character&quot; </span>
<span class="co">#&gt;         flight        tailnum         origin           dest       air_time </span>
<span class="co">#&gt;      &quot;integer&quot;    &quot;character&quot;    &quot;character&quot;    &quot;character&quot;       &quot;double&quot; </span>
<span class="co">#&gt;       distance           hour         minute      time_hour </span>
<span class="co">#&gt;       &quot;double&quot;       &quot;double&quot;       &quot;double&quot;       &quot;double&quot;</span></code></pre></div>
<p>To calculate the number of unique values in each column of <code>iris</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_int</span>(iris, <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(.)))
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;           35           23           43           22            3</span></code></pre></div>
<p>To generate 10 random normals for each of <span class="math inline">\(\mu = -10\)</span>, <span class="math inline">\(0\)</span>, <span class="math inline">\(10\)</span>, and <span class="math inline">\(100\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>), rnorm, <span class="dt">n =</span> <span class="dv">10</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] -11.27  -9.46  -9.92  -9.44  -9.58 -11.45  -9.06 -10.34 -10.08  -9.96</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;  [1]  0.124 -0.998  1.233  0.340 -0.473  0.709 -1.529  0.237 -1.313  0.747</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;  [1]  8.44 10.07  9.36  9.15 10.68 11.15  8.31  9.10 11.32 11.10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;  [1] 101.2  98.6 101.4 100.0  99.9 100.4 100.1  99.2  99.5  98.8</span></code></pre></div>
</div>
</div>
<div id="exercise-2-54" class="section level3 exericse">
<h3><span class="header-section-number">20.5.2</span> Exercise 2</h3>
<div class="question">
<p>How can you create a single vector that for each column in a data frame indicates whether or not it’s a factor?</p>
</div>
<div class="answer">
<p>Use <code>map_lgl</code> with the function <code>is.factor</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_lgl</span>(mtcars, is.factor)
<span class="co">#&gt;   mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb </span>
<span class="co">#&gt; FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></code></pre></div>
</div>
</div>
<div id="exercise-3-40" class="section level3 exercise">
<h3><span class="header-section-number">20.5.3</span> Exercise 3</h3>
<div class="question">
<p>What happens when you use the map functions on vectors that aren’t lists? What does <code>map(1:5, runif)</code> do? Why?</p>
</div>
<div class="answer">
<p>The function <code>map</code> applies the function to each element of the vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, runif)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 0.226</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 0.133 0.927</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 0.894 0.204 0.257</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] 0.614 0.441 0.316 0.101</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] 0.2726 0.6537 0.9279 0.0266 0.5595</span></code></pre></div>
</div>
</div>
<div id="exercise-4-32" class="section level3 exercise">
<h3><span class="header-section-number">20.5.4</span> Exercise 4</h3>
<div class="question">
<p>What does <code>map(-2:2, rnorm, n = 5)</code> do? Why? &gt; What does <code>map_dbl(-2:2, rnorm, n = 5)</code> do? Why?</p>
</div>
<div class="answer">
<p>This takes samples of <code>n = 5</code> from normal distributions of means -2, -1, 0, 1, and 2, and returns a list with each element a numeric vectors of length 5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>, rnorm, <span class="dt">n =</span> <span class="dv">5</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] -0.945 -2.821 -2.638 -2.153 -3.416</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] -0.393 -0.912 -2.570 -0.687 -0.347</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] -0.00796  1.72703  2.08647 -0.35835 -1.44212</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] 1.38 1.09 1.16 1.36 0.64</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] 1.8914 3.8278 0.0381 2.9460 2.5490</span></code></pre></div>
<p>However, if we use <code>map_dbl</code> it throws an error. <code>map_dbl</code> expects the function to return a numeric vector of length one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>, rnorm, <span class="dt">n =</span> <span class="dv">5</span>)
<span class="co">#&gt; Error: Result 1 is not a length 1 atomic vector</span></code></pre></div>
<p>If we wanted a numeric vector, we could use <code>map</code> followed by <code>flatten_dbl</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">flatten_dbl</span>(<span class="kw">map</span>(<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>, rnorm, <span class="dt">n =</span> <span class="dv">5</span>))
<span class="co">#&gt;  [1] -1.402 -1.872 -3.717 -1.964 -0.993 -0.287 -2.110 -0.851 -1.386 -1.230</span>
<span class="co">#&gt; [11]  0.392  0.470  0.989 -0.714  1.270  1.709  2.047 -0.210  1.380  0.933</span>
<span class="co">#&gt; [21]  2.280  2.330  2.285  2.429  1.879</span></code></pre></div>
</div>
</div>
<div id="exercise-5-17" class="section level3 exercise">
<h3><span class="header-section-number">20.5.5</span> Exercise 5</h3>
<div class="question">
<p>Rewrite <code>map(x, function(df) lm(mpg ~ wt, data = df))</code> to eliminate the anonymous function.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="kw">list</span>(mtcars), <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = mpg ~ wt, data = .)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)           wt  </span>
<span class="co">#&gt;       37.29        -5.34</span></code></pre></div>
</div>
</div>
</div>
<div id="dealing-with-failure" class="section level2">
<h2><span class="header-section-number">20.6</span> Dealing with Failure</h2>
<p>No exercises</p>
</div>
<div id="mapping-over-multiple-arguments" class="section level2">
<h2><span class="header-section-number">20.7</span> Mapping over multiple arguments</h2>
<p>No exercises</p>
</div>
<div id="walk" class="section level2">
<h2><span class="header-section-number">20.8</span> Walk</h2>
<p>No exercises</p>
</div>
<div id="other-patterns-of-for-loops" class="section level2">
<h2><span class="header-section-number">20.9</span> Other patterns of for loops</h2>
<div id="exercise-1-56" class="section level3 exercise">
<h3><span class="header-section-number">20.9.1</span> Exercise 1</h3>
<div class="question">
<p>Implement your own version of <code>every()</code> using a for loop. Compare it with <code>purrr::every()</code>. What does purrr’s version do that your version doesn’t?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use ... to pass arguments to the function</span>
every2 &lt;-<span class="st"> </span><span class="cf">function</span>(.x, .p, ...) {
  <span class="cf">for</span> (i <span class="cf">in</span> .x) {
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">.p</span>(i, ...)) {
      <span class="co"># If any is FALSE we know not all of then were TRUE</span>
      <span class="kw">return</span>(<span class="ot">FALSE</span>)
    }
  }
  <span class="co"># if nothing was FALSE, then it is TRUE</span>
  <span class="ot">TRUE</span>  
}

<span class="kw">every2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) {x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>})
<span class="co">#&gt; [1] FALSE</span>
<span class="kw">every2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) {x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>})
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>The function <code>purrr::every</code> does fancy things with <code>.p</code>, like taking a logical vector instead of a function, or being able to test part of a string if the elements of <code>.x</code> are lists.</p>
</div>
</div>
<div id="exercise-2-55" class="section level3 exercise">
<h3><span class="header-section-number">20.9.2</span> Exercise 2</h3>
<div class="question">
<p>Create an enhanced <code>col_sum()</code> that applies a summary function to every numeric column in a data frame.</p>
</div>
<div class="answer">
<p><strong>Note:</strong> this question has a typo. It is referring to <code>col_summary</code>.</p>
<p>I will use <code>map</code> to apply the function to all the columns, and <code>keep</code> to only select numeric columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_sum2 &lt;-<span class="st"> </span><span class="cf">function</span>(df, f, ...) {
  <span class="kw">map</span>(<span class="kw">keep</span>(df, is.numeric), f, ...)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">col_sum2</span>(iris, mean)
<span class="co">#&gt; $Sepal.Length</span>
<span class="co">#&gt; [1] 5.84</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Sepal.Width</span>
<span class="co">#&gt; [1] 3.06</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Length</span>
<span class="co">#&gt; [1] 3.76</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Width</span>
<span class="co">#&gt; [1] 1.2</span></code></pre></div>
</div>
</div>
<div id="exercise-3-41" class="section level3 exercise">
<h3><span class="header-section-number">20.9.3</span> Exercise 3</h3>
<div class="question">
<p>Create possible base R equivalent of <code>col_sum()</code> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_sum3 &lt;-<span class="st"> </span><span class="cf">function</span>(df, f) {
  is_num &lt;-<span class="st"> </span><span class="kw">sapply</span>(df, is.numeric)
  df_num &lt;-<span class="st"> </span>df[, is_num]
  <span class="kw">sapply</span>(df_num, f)
}</code></pre></div>
<p>But it has a number of bugs as illustrated with the following inputs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, 
  <span class="dt">y =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>,
  <span class="dt">z =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
)


<span class="co"># OK</span>
<span class="kw">col_sum3</span>(df, mean)
<span class="co"># Has problems: don&#39;t always return numeric vector</span>
<span class="kw">col_sum3</span>(df[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], mean)
<span class="kw">col_sum3</span>(df[<span class="dv">1</span>], mean)
<span class="kw">col_sum3</span>(df[<span class="dv">0</span>], mean)</code></pre></div>
<p>What causes these bugs?</p>
</div>
<div class="answer">
<p>The problem is that <code>sapply</code> does not always return numeric vectors. If no columns are selected, instead of returning an empty numeric vector, it returns an empty list. This causes an error since we can’t use a list with <code>[</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(df[<span class="dv">0</span>], is.numeric)
<span class="co">#&gt; named list()</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(df[<span class="dv">1</span>], is.numeric)
<span class="co">#&gt;    a </span>
<span class="co">#&gt; TRUE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(df[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], is.numeric)
<span class="co">#&gt;    a    b </span>
<span class="co">#&gt; TRUE TRUE</span></code></pre></div>
</div>
<!--chapter:end:iteration.Rmd-->
</div>
</div>
</div>
<div id="part-model" class="section level1 unnumbered">
<h1>(PART) Model</h1>
</div>
<div id="model-intro" class="section level1">
<h1><span class="header-section-number">21</span> Introduction</h1>
<!--chapter:end:model.Rmd-->
</div>
<div id="model-basics" class="section level1">
<h1><span class="header-section-number">22</span> Model Basics</h1>
<div id="prerequisites" class="section level2">
<h2><span class="header-section-number">22.1</span> Prerequisites</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;modelr&quot;</span>)
<span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)</code></pre></div>
<p>The option <code>na.action</code> determines how missing values are handled. It is a function. <code>na.warn</code> sets it so that there is a warning if there are any missing values. If it is not set (the default), R will silently drop them.</p>
</div>
<div id="a-simple-model" class="section level2">
<h2><span class="header-section-number">22.2</span> A simple model</h2>
<div id="exercise-1-57" class="section level3 exercise">
<h3><span class="header-section-number">22.2.1</span> Exercise 1</h3>
<div class="question">
<p>One downside of the linear model is that it is sensitive to unusual values because the distance incorporates a squared term. Fit a linear model to the simulated data below, and visualize the results. Rerun a few times to generate different simulated datasets. What do you notice about the model?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1a &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
  <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)
)</code></pre></div>
<p>Let’s run it once and plot the results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>To re-run this a few times using <code>purrr</code>, and plot using code similar to that in the chapter: There appear to be a few outliers in this data. You can re-rerun this a couple times to see if this hold.</p>
<p>We can also do this slightly more systematically. We will simulate this several times using <code>purrr</code> and plot the line using <code>geom_smooth</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simt &lt;-<span class="st"> </span><span class="cf">function</span>(i) {
  <span class="kw">tibble</span>(
    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>),
    <span class="dt">.id =</span> i
  )
}

sims &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, simt)

<span class="kw">ggplot</span>(sims, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>.id, <span class="dt">ncol =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>What if we did the same things with normal distributions?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_norm &lt;-<span class="st"> </span><span class="cf">function</span>(i) {
  <span class="kw">tibble</span>(
    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(x)),
    <span class="dt">.id =</span> i
  )
}

simdf_norm &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, sim_norm)

<span class="kw">ggplot</span>(simdf_norm, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>.id, <span class="dt">ncol =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /> There are not large outliers, and the slopes are more similar.</p>
<p>The reason for this is that the Student’s <span class="math inline">\(t\)</span>-distribution, from which we sample with <code>rt</code> has fatter tails than the normal distribution (<code>rnorm</code>), which means is assigns larger probability to values further from the center of the distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">100</span>),
  <span class="dt">normal =</span> <span class="kw">dnorm</span>(x),
  <span class="dt">student_t =</span> <span class="kw">dt</span>(x, <span class="dt">df =</span> <span class="dv">2</span>)
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(distribution, density, <span class="op">-</span>x) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density, <span class="dt">colour =</span> distribution)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>For a normal distribution with mean zero and standard deviation one, the probability of being greater than 2 is,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] 0.0228</span></code></pre></div>
<p>For a Student’s <span class="math inline">\(t\)</span> distribution with degrees of freedom = 2, it is more than 3 times higher,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pt</span>(<span class="dv">2</span>, <span class="dt">df =</span> <span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] 0.0918</span></code></pre></div>
</div>
</div>
<div id="exercise-2-56" class="section level3 exercise">
<h3><span class="header-section-number">22.2.2</span> Exercise 2</h3>
<div class="question">
<p>One way to make linear models more robust is to use a different distance measure. For example, instead of root-mean-squared distance, you could use mean-absolute distance:</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {
  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">make_prediction</span>(mod, data)
  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))
}</code></pre></div>
<p>For the above function to work, we need to define a function <code>make_prediction</code> that takes a numeric vector of length two (the intercept and slope) and returns the predictions,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_prediction &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {
  mod[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>mod[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>x
}</code></pre></div>
<p>Using the <code>sim1a</code> data, the best parameters of the least absolute deviation are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_distance, <span class="dt">data =</span> sim1a)
best<span class="op">$</span>par
<span class="co">#&gt; [1] 5.25 1.66</span></code></pre></div>
<p>Using the <code>sim1a</code> data, while the parameters the minimize the least squares objective function are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measure_distance_ls &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {
  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>(mod[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>mod[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>x)
  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))
}

best &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_distance_ls, <span class="dt">data =</span> sim1a)
best<span class="op">$</span>par
<span class="co">#&gt; [1] 5.87 1.56</span></code></pre></div>
<p>In practice, you would not use a <code>optim</code> to fit this model, you would you an existing implementation. See the <code>MASS</code> package’s <code>rlm</code> and <code>lqs</code> functions for more information and functions to fit robust and resistant linear models.</p>
</div>
</div>
<div id="exercise-3-42" class="section level3 exercise">
<h3><span class="header-section-number">22.2.3</span> Exercise 3</h3>
<div class="question">
<p>One challenge with performing numerical optimization is that it’s only guaranteed to find a local optimum. What’s the problem with optimizing a three parameter model like this?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model3 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {
  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]
}</code></pre></div>
<p>The problem is that you for any values <code>a[1] = a1</code> and <code>a[3] = a3</code>, any other values of <code>a[1]</code> and <code>a[3]</code> where <code>a[1] + a[3] == (a1 + a3)</code> will have the same fit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measure_distance_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {
  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model3</span>(a, data)
  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))
}</code></pre></div>
<p>Depending on our starting points, we can find different optimal values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best3a &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)
best3a<span class="op">$</span>par
<span class="co">#&gt; [1] 3.367 2.052 0.853</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best3b &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)
best3b<span class="op">$</span>par
<span class="co">#&gt; [1] -3.47  2.05  7.69</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best3c &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)
best3c<span class="op">$</span>par
<span class="co">#&gt; [1] -1.12  2.05  5.35</span></code></pre></div>
<p>In fact there are an infinite number of optimal values for this model.</p>
<!-- How to discuss this better ?

Problem is that due to finite iterations, numerically these converge:

> sum(best3a$par[c(1, 3)])
[1] 4.220074
> sum(best3b$par[c(1, 3)])
[1] 4.220404
> sum(best3c$par[c(1, 3)])
[1] 4.22117

-->
</div>
</div>
</div>
<div id="visualizing-models" class="section level2">
<h2><span class="header-section-number">22.3</span> Visualizing Models</h2>
<div id="exercise-1-58" class="section level3 exercise">
<h3><span class="header-section-number">22.3.1</span> Exercise 1</h3>
<div class="question">
<p>Instead of using <code>lm()</code> to fit a straight line, you can use <code>loess()</code> to fit a smooth curve. Repeat the process of model fitting, grid generation, predictions, and visualization on <code>sim1</code> using <code>loess()</code> instead of <code>lm()</code>. How does the result compare to <code>geom_smooth()</code>?</p>
</div>
<div class="answer">
<p>I’ll use <code>add_predictions</code> and <code>add_residuals</code> to add the predictions and residuals from a loess regression to the <code>sim1</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_loess &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)
sim1_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)

grid_loess &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess)

sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(sim1_lm) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_lm) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;resid_loess&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)</code></pre></div>
<p>This plots the loess predictions. The loess produces a nonlinear, smooth line through the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_sim1_loess &lt;-
<span class="st">  </span><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred), <span class="dt">data =</span> grid_loess, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)
plot_sim1_loess</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The predictions of loess are the same as the default method for <code>geom_smooth</code> because <code>geom_smooth()</code> uses <code>loess()</code> by default; the message even tells us that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_sim1_loess <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="fl">0.20</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We can plot the residuals (red), and compare them to the residuals from <code>lm</code> (black). In general, the loess model has smaller residuals within the sample (out of sample is a different issue, and we haven’t considered the uncertainty of these estimates).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid_loess), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-57" class="section level3 exercise">
<h3><span class="header-section-number">22.3.2</span> Exercise 2</h3>
<div class="question">
<p><code>add_predictions()</code> is paired with <code>gather_predictions()</code> and <code>spread_predictions()</code>. How do these three functions differ?</p>
</div>
<div class="answer">
<p>The functions <code>gather_predictions</code> and <code>spread_predictions</code> allow for adding predictions from multiple models at once.</p>
<p>Taking the <code>sim1_mod</code> example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)
grid &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_grid</span>(x)</code></pre></div>
<p>The function <code>add_predictions</code> adds only a single model at a time. To add two models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;pred_lm&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;       x pred_lm pred_loess</span>
<span class="co">#&gt;   &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1    6.27       5.34</span>
<span class="co">#&gt; 2     2    8.32       8.27</span>
<span class="co">#&gt; 3     3   10.4       10.8 </span>
<span class="co">#&gt; 4     4   12.4       12.8 </span>
<span class="co">#&gt; 5     5   14.5       14.6 </span>
<span class="co">#&gt; 6     6   16.5       16.6 </span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
<p>The function <code>gather_predictions</code> adds predictions from multiple models by stacking the results and adding a column with the model name,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess)
<span class="co">#&gt; # A tibble: 20 x 3</span>
<span class="co">#&gt;   model        x  pred</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 sim1_mod     1  6.27</span>
<span class="co">#&gt; 2 sim1_mod     2  8.32</span>
<span class="co">#&gt; 3 sim1_mod     3 10.4 </span>
<span class="co">#&gt; 4 sim1_mod     4 12.4 </span>
<span class="co">#&gt; 5 sim1_mod     5 14.5 </span>
<span class="co">#&gt; 6 sim1_mod     6 16.5 </span>
<span class="co">#&gt; # ... with 14 more rows</span></code></pre></div>
<p>The function <code>spread_predictions</code> adds predictions from multiple models by adding multiple columns (postfixed with the model name) with predictions from each model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_predictions</span>(sim1_mod, sim1_loess)
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;       x sim1_mod sim1_loess</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     6.27       5.34</span>
<span class="co">#&gt; 2     2     8.32       8.27</span>
<span class="co">#&gt; 3     3    10.4       10.8 </span>
<span class="co">#&gt; 4     4    12.4       12.8 </span>
<span class="co">#&gt; 5     5    14.5       14.6 </span>
<span class="co">#&gt; 6     6    16.5       16.6 </span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
<p>The function <code>spread_predictions</code> is similar to the example which runs <code>add_predictions</code> for each model, and is equivalent to running <code>spread</code> after running <code>gather_predictions</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(model, pred)
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;       x sim1_loess sim1_mod</span>
<span class="co">#&gt;   &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1       5.34     6.27</span>
<span class="co">#&gt; 2     2       8.27     8.32</span>
<span class="co">#&gt; 3     3      10.8     10.4 </span>
<span class="co">#&gt; 4     4      12.8     12.4 </span>
<span class="co">#&gt; 5     5      14.6     14.5 </span>
<span class="co">#&gt; 6     6      16.6     16.5 </span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-3-43" class="section level3 exercise">
<h3><span class="header-section-number">22.3.3</span> Exercise 3</h3>
<div class="question">
<p>What does <code>geom_ref_line()</code> do? What package does it come from? Why is displaying a reference line in plots showing residuals useful and important?</p>
</div>
<div class="answer">
<p>The geom <code>geom_ref_line()</code> adds as reference line to a plot. It is equivalent to running <code>geom_hline</code> or <code>geom_vline</code> with default settings that are useful for visualizing models. Putting a reference line at zero for residuals is important because good models (generally) should have residuals centered at zero, with approximately the same variance (or distribution) over the support of x, and no correlation. A zero reference line makes it easier to judge these characteristics visually.</p>
</div>
</div>
<div id="exercise-4-33" class="section level3 exercise">
<h3><span class="header-section-number">22.3.4</span> Exercise 4</h3>
<div class="question">
<p>Why might you want to look at a frequency polygon of absolute residuals? What are the pros and cons compared to looking at the raw residuals?</p>
</div>
<div class="answer">
<p>Showing the absolute values of the residuals makes it easier to view the spread of the residuals. The model assumes the the residuals have mean zero, and using the absolute values of the residuals effectively doubles the number of residuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)

sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod)

<span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>However, using the absolute values of residuals throws away information about the sign, meaning that the frequency polygon cannot show whether the model systematically over- or under-estimates the residuals.</p>
</div>
</div>
</div>
<div id="formulas-and-model-families" class="section level2">
<h2><span class="header-section-number">22.4</span> Formulas and Model Families</h2>
<div id="exercise-1-59" class="section level3 exercise">
<h3><span class="header-section-number">22.4.1</span> Exercise 1</h3>
<div class="question">
<p>What happens if you repeat the analysis of <code>sim2</code> using a model without an intercept. What happens to the model equation? What happens to the predictions?</p>
</div>
<div class="answer">
<p>To run a model without an intercept, add <code>- 1</code> or <code>+ 0</code> to the right-hand-side o f the formula:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2a &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> sim2)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)</code></pre></div>
<p>The predictions are exactly the same in the models with and without an intercept:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid &lt;-<span class="st"> </span>sim2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_grid</span>(x) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_predictions</span>(mod2, mod2a)
grid
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   x      mod2 mod2a</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 a      1.15  1.15</span>
<span class="co">#&gt; 2 b      8.12  8.12</span>
<span class="co">#&gt; 3 c      6.13  6.13</span>
<span class="co">#&gt; 4 d      1.91  1.91</span></code></pre></div>
</div>
</div>
<div id="exercise-2-58" class="section level3 exercise">
<h3><span class="header-section-number">22.4.2</span> Exercise 2</h3>
<div class="question">
<p>Use <code>model_matrix()</code> to explore the equations generated for the models I fit to <code>sim3</code> and <code>sim4</code>. Why is <code>*</code> a good shorthand for interaction?</p>
</div>
<div class="answer">
<p>For <code>x1 * x2</code> when <code>x2</code> is a categorical variable produces indicator variables <code>x2b</code>, <code>x2c</code>, <code>x2d</code> and variables <code>x1:x2b</code>, <code>x1:x2c</code>, and <code>x1:x2d</code> which are the products of <code>x1</code> and <code>x2*</code> variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x3 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)
x3
<span class="co">#&gt; # A tibble: 120 x 8</span>
<span class="co">#&gt;   `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`</span>
<span class="co">#&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1          1.00  1.00  0        0     0     0           0        0</span>
<span class="co">#&gt; 2          1.00  1.00  0        0     0     0           0        0</span>
<span class="co">#&gt; 3          1.00  1.00  0        0     0     0           0        0</span>
<span class="co">#&gt; 4          1.00  1.00  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; 5          1.00  1.00  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; 6          1.00  1.00  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; # ... with 114 more rows</span></code></pre></div>
<p>We can confirm that the variables <code>x1:x2b</code> is the product of <code>x1</code> and <code>x2b</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2b&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2b&quot;</span>]]))
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>and similarly for <code>x1:x2c</code> and <code>x2c</code>, and <code>x1:x2d</code> and <code>x2d</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2c&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2c&quot;</span>]]))
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2d&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2d&quot;</span>]]))
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>For <code>x1 * x2</code> where both <code>x1</code> and <code>x2</code> are continuous variables, <code>model_matrix()</code> creates variables <code>x1</code>, <code>x2</code>, and <code>x1:x2</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x4 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)
x4
<span class="co">#&gt; # A tibble: 300 x 4</span>
<span class="co">#&gt;   `(Intercept)`    x1     x2 `x1:x2`</span>
<span class="co">#&gt;           &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1          1.00 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 2          1.00 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 3          1.00 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 4          1.00 -1.00 -0.778   0.778</span>
<span class="co">#&gt; 5          1.00 -1.00 -0.778   0.778</span>
<span class="co">#&gt; 6          1.00 -1.00 -0.778   0.778</span>
<span class="co">#&gt; # ... with 294 more rows</span></code></pre></div>
<p>Confirm that <code>x1:x2</code> is the product of the <code>x1</code> and <code>x2</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all</span>(x4[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x4[[<span class="st">&quot;x2&quot;</span>]] <span class="op">==</span><span class="st"> </span>x4[[<span class="st">&quot;x1:x2&quot;</span>]])
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>The asterisk <code>*</code> is good shorthand for an interaction since an interaction between <code>x1</code> and <code>x2</code> includes terms for <code>x1</code>, <code>x2</code>, and the product of <code>x1</code> and <code>x2</code>.</p>
</div>
</div>
<div id="exercise-3-44" class="section level3 exercise">
<h3><span class="header-section-number">22.4.3</span> Exercise 3</h3>
<div class="question">
<p>Using the basic principles, convert the formulas in the following two models into functions. (Hint: start by converting the categorical variable into 0-1 variables.)</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_matrix_mod1 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {
  <span class="kw">mutate</span>(.data,
         <span class="st">`</span><span class="dt">x2b</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;b&quot;</span>),
         <span class="st">`</span><span class="dt">x2c</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;c&quot;</span>),
         <span class="st">`</span><span class="dt">x2d</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;d&quot;</span>),
         <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2b,
         <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2c,
         <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2d) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(x1, x2b, x2c, x2d, <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_matrix_mod1</span>(sim3)
<span class="co">#&gt; # A tibble: 120 x 7</span>
<span class="co">#&gt;      x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1  0        0     0     0           0        0</span>
<span class="co">#&gt; 2     1  0        0     0     0           0        0</span>
<span class="co">#&gt; 3     1  0        0     0     0           0        0</span>
<span class="co">#&gt; 4     1  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; 5     1  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; 6     1  1.00     0     0     1.00        0        0</span>
<span class="co">#&gt; # ... with 114 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_matrix_mod2 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {
  <span class="kw">mutate</span>(.data, <span class="st">`</span><span class="dt">x1:x2</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(x1, x2, <span class="st">`</span><span class="dt">x1:x2</span><span class="st">`</span>)
}
<span class="kw">model_matrix_mod2</span>(sim4)
<span class="co">#&gt; # A tibble: 300 x 3</span>
<span class="co">#&gt;      x1     x2 `x1:x2`</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 2 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 3 -1.00 -1.00    1.00 </span>
<span class="co">#&gt; 4 -1.00 -0.778   0.778</span>
<span class="co">#&gt; 5 -1.00 -0.778   0.778</span>
<span class="co">#&gt; 6 -1.00 -0.778   0.778</span>
<span class="co">#&gt; # ... with 294 more rows</span></code></pre></div>
<p>A more general function for model <code>mod1</code> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_matrix_mod1 &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2) {
  out &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x1 =</span> x1)  
  <span class="co"># find levels of x2</span>
  x2 &lt;-<span class="st"> </span><span class="kw">as.factor</span>(x2)
  x2lvls &lt;-<span class="st"> </span><span class="kw">levels</span>(x2)
  <span class="co"># create an indicator variable for each level</span>
  <span class="cf">for</span> (lvl <span class="cf">in</span> x2lvls[<span class="dv">2</span><span class="op">:</span><span class="kw">nlevels</span>(x2)]) {
    out[[<span class="kw">str_c</span>(<span class="st">&quot;x2&quot;</span>, lvl)]] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> </span>lvl)
  }
  <span class="co"># create interactions for each level</span>
  <span class="cf">for</span> (lvl <span class="cf">in</span> x2lvls[<span class="dv">2</span><span class="op">:</span><span class="kw">nlevels</span>(x2)]) {
    out[[<span class="kw">str_c</span>(<span class="st">&quot;x1:x2&quot;</span>, lvl)]] &lt;-<span class="st"> </span>(x2 <span class="op">==</span><span class="st"> </span>lvl) <span class="op">*</span><span class="st"> </span>x1
  }
  out
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_matrix_mod2 &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2) {
  out &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x1 =</span> x1,
                <span class="dt">x2 =</span> x2,
                <span class="st">`</span><span class="dt">x1:x2</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2)
}</code></pre></div>
</div>
</div>
<div id="exercise-4-34" class="section level3 exercise">
<h3><span class="header-section-number">22.4.4</span> Exercise 4</h3>
<div class="question">
<p>For <code>sim4</code>, which of <code>mod1</code> and <code>mod2</code> is better? I think <code>mod2</code> does a slightly better job at removing patterns, but it’s pretty subtle. Can you come up with a plot to support my claim?</p>
</div>
<div class="answer">
<p>Estimate models <code>mod1</code> and <code>mod2</code> on <code>sim4</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</code></pre></div>
<p>and add the residuals from these models to the <code>sim4</code> data,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim4_mods &lt;-<span class="st"> </span><span class="kw">gather_residuals</span>(sim4, mod1, mod2)</code></pre></div>
<p>Frequency plots of both the residuals,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> resid, <span class="dt">colour =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-45-1.png" width="70%" style="display: block; margin: auto;" /> and the absolute values of the residuals,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid), <span class="dt">colour =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-46-1.png" width="70%" style="display: block; margin: auto;" /> does not show much difference in the residuals between the models. However, <code>mod2</code> appears to have fewer residuals in the tails of the distribution between 2.5 and 5 (although the most extreme residuals are from <code>mod2</code>.</p>
<p>This is confirmed by checking the standard deviation of the residuals of these models,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim4_mods <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">resid =</span> <span class="kw">sd</span>(resid))
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   model resid</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 mod1   2.10</span>
<span class="co">#&gt; 2 mod2   2.07</span></code></pre></div>
<p>The standard deviation of the residuals of <code>mod2</code> is smaller than that of <code>mod1</code>.</p>
</div>
</div>
</div>
<div id="missing-values-2" class="section level2">
<h2><span class="header-section-number">22.5</span> Missing values</h2>
<p>No exercises</p>
</div>
<div id="other-model-families" class="section level2">
<h2><span class="header-section-number">22.6</span> Other model families</h2>
<p>No exercises</p>
<!--chapter:end:model-basics.Rmd-->
</div>
</div>
<div id="model-building" class="section level1">
<h1><span class="header-section-number">23</span> Model Building</h1>
<div id="introduction-14" class="section level2">
<h2><span class="header-section-number">23.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(modelr)
<span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)
<span class="kw">library</span>(<span class="st">&quot;broom&quot;</span>)

<span class="kw">library</span>(nycflights13)
<span class="kw">library</span>(lubridate)</code></pre></div>
</div>
<div id="why-are-low-quality-diamonds-more-expensive" class="section level2">
<h2><span class="header-section-number">23.2</span> Why are low quality diamonds more expensive?</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&lt;=</span><span class="st"> </span><span class="fl">2.5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lprice =</span> <span class="kw">log2</span>(price), <span class="dt">lcarat =</span> <span class="kw">log2</span>(carat))

mod_diamond2 &lt;-<span class="st"> </span><span class="kw">lm</span>(lprice <span class="op">~</span><span class="st"> </span>lcarat <span class="op">+</span><span class="st"> </span>color <span class="op">+</span><span class="st"> </span>cut <span class="op">+</span><span class="st"> </span>clarity, <span class="dt">data =</span> diamonds2)</code></pre></div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">23.2.1</span> Exercises</h3>
<div id="exercise-1-60" class="section level4 exercise">
<h4><span class="header-section-number">23.2.1.1</span> Exercise 1</h4>
<div class="question">
<p>In the plot of <code>lcarat</code> vs. <code>lprice</code>, there are some bright vertical strips. What do they represent?</p>
</div>
<div class="answer">
<p>The distribution of diamonds has more diamonds at round or otherwise human friendly numbers (fractions).</p>
</div>
</div>
<div id="exercise-2-59" class="section level4 exercise">
<h4><span class="header-section-number">23.2.1.2</span> Exercise 2</h4>
<div class="question">
<p>If <code>log(price) = a_0 + a_1 * log(carat)</code>, what does that say about the relationship between <code>price</code> and <code>carat</code>?</p>
</div>
<div class="answer">
<p>An 1% increase in carat is associated with an <span class="math inline">\(a_1\)</span>% increase in price.</p>
</div>
</div>
<div id="exercise-3-45" class="section level4 exercise">
<h4><span class="header-section-number">23.2.1.3</span> Exercise 3</h4>
<div class="question">
<p>Extract the diamonds that have very high and very low residuals. Is there anything unusual about these diamonds? Are the particularly bad or good, or do you think these are pricing errors?</p>
</div>
<div class="answer">
<p>This was already discussed in the text. I don’t see anything either.</p>
</div>
</div>
<div id="exercise-4-35" class="section level4 exercise">
<h4><span class="header-section-number">23.2.1.4</span> Exercise 4</h4>
<div class="question">
<p>Does the final model, <code>mod_diamonds2</code>, do a good job of predicting diamond prices? Would you trust it to tell you how much to spend if you were buying a diamond?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(mod_diamond2) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sq_err =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>(resid<span class="op">^</span><span class="dv">2</span>)),
            <span class="dt">abs_err =</span> <span class="kw">mean</span>(<span class="kw">abs</span>(resid)),
            <span class="dt">p975_err =</span> <span class="kw">quantile</span>(resid, <span class="fl">0.975</span>),
            <span class="dt">p025_err =</span> <span class="kw">quantile</span>(resid, <span class="fl">0.025</span>))
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   sq_err abs_err p975_err p025_err</span>
<span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1  0.192   0.149    0.384   -0.369</span></code></pre></div>
<p>The average squared and absolute errors are <span class="math inline">\(2^0.19 = 1.14\)</span> and <span class="math inline">\(2^0.10\)</span> so on average, the error is <span class="math inline">\(\pm 10--15\)</span>%. And the 95% range of residuals is about <span class="math inline">\(2^0.37 = 1.3\)</span> so within <span class="math inline">\(\pm 30\)</span>%. This doesn’t seem terrible to me.</p>
</div>
</div>
</div>
<div id="what-affects-the-number-of-daily-flights" class="section level3">
<h3><span class="header-section-number">23.2.2</span> What affects the number of daily flights?</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)
daily &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
daily
<span class="co">#&gt; # A tibble: 365 x 2</span>
<span class="co">#&gt;   date           n</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1 2013-01-01   842</span>
<span class="co">#&gt; 2 2013-01-02   943</span>
<span class="co">#&gt; 3 2013-01-03   914</span>
<span class="co">#&gt; 4 2013-01-04   915</span>
<span class="co">#&gt; 5 2013-01-05   720</span>
<span class="co">#&gt; 6 2013-01-06   832</span>
<span class="co">#&gt; # ... with 359 more rows</span>

daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>))

term &lt;-<span class="st"> </span><span class="cf">function</span>(date) {
  <span class="kw">cut</span>(date, 
    <span class="dt">breaks =</span> <span class="kw">ymd</span>(<span class="dv">20130101</span>, <span class="dv">20130605</span>, <span class="dv">20130825</span>, <span class="dv">20140101</span>),
    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;spring&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;fall&quot;</span>) 
  )
}

daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">term</span>(date)) 

mod &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday, <span class="dt">data =</span> daily)

daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_residuals</span>(mod)

mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday, <span class="dt">data =</span> daily)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">*</span><span class="st"> </span>term, <span class="dt">data =</span> daily)</code></pre></div>
</div>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">23.2.3</span> Exercises</h3>
<div id="exercise-1-61" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.1</span> Exercise 1</h4>
<div class="question">
<p>Use your Google sleuthing skills to brainstorm why there were fewer than expected flights on Jan 20, May 26, and Sep 1. (Hint: they all have the same explanation.) How would these days generalize to another year?</p>
</div>
<div class="answer">
<p>These are the Sundays before Monday holidays Martin Luther King Day, Memorial Day, and Labor Day.</p>
</div>
</div>
<div id="exercise-2-60" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.2</span> Exercise 2</h4>
<div class="question">

</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">3</span>, resid)
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   date           n wday  term  resid</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;int&gt; &lt;ord&gt; &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-11-30   857 Sat   fall  112  </span>
<span class="co">#&gt; 2 2013-12-01   987 Sun   fall   95.5</span>
<span class="co">#&gt; 3 2013-12-28   814 Sat   fall   69.4</span></code></pre></div>
</div>
</div>
<div id="exercise-3-46" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.3</span> Exercise 3</h4>
<div class="question">
<p>Create a new variable that splits the <code>wday</code> variable into terms, but only for Saturdays, i.e. it should have <code>Thurs</code>, <code>Fri</code>, but <code>Sat-summer</code>, <code>Sat-spring</code>, <code>Sat-fall</code> How does this model compare with the model with every combination of <code>wday</code> and <code>term</code>?</p>
</div>
<div class="answer">
<p>I’ll use the function <code>case_when</code> to do this, though there are other ways which it could be solved.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday2 =</span> 
         <span class="kw">case_when</span>(.<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;summer&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-summer&quot;</span>,
         .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span><span class="st"> </span>term <span class="op">==</span><span class="st"> &quot;fall&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-fall&quot;</span>,
         .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;spring&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-spring&quot;</span>,
         <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(.<span class="op">$</span>wday)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod4 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday2, <span class="dt">data =</span> daily)

daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather_residuals</span>(<span class="dt">sat_term =</span> mod4, <span class="dt">all_interact =</span> mod2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid, <span class="dt">colour =</span> model)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>)</code></pre></div>
<p><img src="model-building_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>I think the overlapping plot is hard to understand. If we are interested in the differences, it is better to plot the differences directly. In this code I use <code>spread_residuals</code> to add one <em>column</em> per model, rather than <code>gather_residuals</code> which creates a new row for each model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread_residuals</span>(<span class="dt">sat_term =</span> mod4, <span class="dt">all_interact =</span> mod2) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_diff =</span> sat_term <span class="op">-</span><span class="st"> </span>all_interact) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid_diff)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>)</code></pre></div>
<p><img src="model-building_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The model with terms x Saturday has higher residuals in the fall, and lower residuals in the spring than the model with all interactions.</p>
<p>Using overall model comparison terms, <code>mod4</code> has a lower <span class="math inline">\(R^2\)</span> and regression standard error, <span class="math inline">\(\hat\sigma\)</span>, despite using fewer variables. More importantly for prediction purposes, it has a higher AIC - which is an estimate of the out of sample error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glance</span>(mod4) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(r.squared, sigma, AIC, df)
<span class="co">#&gt;   r.squared sigma  AIC df</span>
<span class="co">#&gt; 1     0.736  47.4 3863  9</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glance</span>(mod2) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(r.squared, sigma, AIC, df)
<span class="co">#&gt;   r.squared sigma  AIC df</span>
<span class="co">#&gt; 1     0.757  46.2 3856 21</span></code></pre></div>
</div>
</div>
<div id="exercise-4-36" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.4</span> Exercise 4</h4>
<div class="question">
<p>Create a new <code>wday</code> variable that combines the day of week, term (for Saturdays), and public holidays. What do the residuals of that model look like?</p>
</div>
<div class="answer">
<p>The question is unclear how to handle the public holidays. We could include a dummy for all public holidays? or the Sunday before public holidays?</p>
<p>Including a level for the public holidays themselves is insufficient because (1) public holiday’s effects on travel varies dramatically, (2) the effect can occur on the day itself or the day before and after, and (3) with Thanksgiving and Christmas there are increases in travel as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday3 =</span> 
         <span class="kw">case_when</span>(
           .<span class="op">$</span>date <span class="op">%in%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw">ymd</span>(<span class="kw">c</span>(<span class="dv">20130101</span>, <span class="co"># new years</span>
                                        <span class="dv">20130121</span>, <span class="co"># mlk</span>
                                        <span class="dv">20130218</span>, <span class="co"># presidents</span>
                                        <span class="dv">20130527</span>, <span class="co"># memorial</span>
                                        <span class="dv">20130704</span>, <span class="co"># independence</span>
                                        <span class="dv">20130902</span>, <span class="co"># labor</span>
                                        <span class="dv">20131028</span>, <span class="co"># columbus</span>
                                        <span class="dv">20131111</span>, <span class="co"># veterans</span>
                                        <span class="dv">20131128</span>, <span class="co"># thanksgiving</span>
                                        <span class="dv">20131225</span>)) <span class="op">~</span>
<span class="st">             &quot;holiday&quot;</span>,
           .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;summer&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-summer&quot;</span>,
           .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span><span class="st"> </span>term <span class="op">==</span><span class="st"> &quot;fall&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-fall&quot;</span>,
           .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;spring&quot;</span> <span class="op">~</span><span class="st"> &quot;Sat-spring&quot;</span>,
           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(.<span class="op">$</span>wday)))

mod5 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday3, <span class="dt">data =</span> daily)

daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread_residuals</span>(mod5) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(<span class="kw">abs</span>(resid))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(date, wday, resid)
<span class="co">#&gt; # A tibble: 20 x 3</span>
<span class="co">#&gt;   date       wday  resid</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;ord&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-11-28 Thu    -332</span>
<span class="co">#&gt; 2 2013-11-29 Fri    -306</span>
<span class="co">#&gt; 3 2013-12-25 Wed    -244</span>
<span class="co">#&gt; 4 2013-07-04 Thu    -229</span>
<span class="co">#&gt; 5 2013-12-24 Tue    -190</span>
<span class="co">#&gt; 6 2013-12-31 Tue    -175</span>
<span class="co">#&gt; # ... with 14 more rows</span></code></pre></div>
</div>
</div>
<div id="exercise-5-18" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.5</span> Exercise 5</h4>
<div class="question">
<p>What happens if you fit a day of week effect that varies by month (i.e. <code>n ~ wday * month</code>)? Why is this not very helpful?</p>
</div>
<div class="answer">
<p>There are only 4-5 observations per parameter since only there are only 4-5 weekdays in a given month.</p>
</div>
</div>
<div id="exercise-6-12" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.6</span> Exercise 6</h4>
<p>It will estimate a smooth seasonal trend (<code>ns(date, 5)</code>) with a day of the week cyclicality, (<code>wday</code>). It probably will not be effective since</p>
</div>
<div id="exercise-7-5" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.7</span> Exercise 7</h4>
<div class="question">
<p>We hypothesized that people leaving on Sundays are more likely to be business travelers who need to be somewhere on Monday. Explore that hypothesis by seeing how it breaks down based on distance and time: if it’s true, you’d expect to see more Sunday evening flights to places that are far away.</p>
</div>
<div class="answer">
<p>Looking at only day of the week, we see that Sunday flights are on average longer than the rest of the day of the week flights, but not as long as Saturday flights (perhaps vacation flights?).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day),
         <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(wday) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dist_mean =</span>  <span class="kw">mean</span>(distance),
            <span class="dt">dist_median =</span> <span class="kw">median</span>(distance)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dist_mean, <span class="dt">x =</span> wday)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-building_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>However, breaking it down by hour, I don’t see much evidence at first. Conditional on hour, the distance of Sunday flights seems similar to that of other days (excluding Saturday):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day),
         <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(wday, hour) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dist_mean =</span>  <span class="kw">mean</span>(distance),
            <span class="dt">dist_median =</span> <span class="kw">median</span>(distance)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dist_mean, <span class="dt">x =</span> hour, <span class="dt">colour =</span> wday)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="model-building_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Can someone think of a better way to check this?</p>
</div>
</div>
<div id="exercise-8" class="section level4 exercise">
<h4><span class="header-section-number">23.2.3.8</span> Exercise 8</h4>
<div class="question">
<p>It’s a little frustrating that Sunday and Saturday are on separate ends of the plot. Write a small function to set the levels of the factor so that the week starts on Monday.</p>
</div>
<div class="answer">
<p>See the chapter <a href="http://r4ds.had.co.nz/factors.html">Factors</a> for the function <code>fct_relevel</code>. I use <code>fct_relevel</code> to put all levels in-front of the first level (“Sunday”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">monday_first &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  forcats<span class="op">::</span><span class="kw">fct_relevel</span>(x, <span class="kw">levels</span>(x)[<span class="op">-</span><span class="dv">1</span>])  
}</code></pre></div>
<p>Now Monday is the first day of the week,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>))
<span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(<span class="kw">monday_first</span>(wday), n)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Day of Week&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of flights&quot;</span>)</code></pre></div>
<p><img src="model-building_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<!--chapter:end:model-building.Rmd-->
</div>
</div>
</div>
</div>
<div id="many-models" class="section level1">
<h1><span class="header-section-number">24</span> Many Models</h1>
<div id="introduction-15" class="section level2">
<h2><span class="header-section-number">24.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;modelr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</span>
<span class="co">#&gt; ✔ ggplot2 2.2.1          ✔ purrr   0.2.4     </span>
<span class="co">#&gt; ✔ tibble  1.4.2          ✔ dplyr   0.7.4.9000</span>
<span class="co">#&gt; ✔ tidyr   0.8.0          ✔ stringr 1.2.0     </span>
<span class="co">#&gt; ✔ readr   1.1.1          ✔ forcats 0.3.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span>
<span class="kw">library</span>(<span class="st">&quot;gapminder&quot;</span>)</code></pre></div>
</div>
<div id="gapminder" class="section level2">
<h2><span class="header-section-number">24.2</span> Gapminder</h2>
<div id="exercise-1-62" class="section level3 exercise">
<h3><span class="header-section-number">24.2.1</span> Exercise 1</h3>
<p>A linear trend seems to be slightly too simple for the overall trend. Can you do better with a quadratic polynomial? How can you interpret the coefficients of the quadratic? (Hint you might want to transform year so that it has mean zero.)</p>
<p>The following code replicates the analysis in the chapter but the function <code>country_model</code> is replaced with a regression that includes the year squared.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(year, <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">country_model &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
  <span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(year <span class="op">-</span><span class="st"> </span><span class="kw">median</span>(year), <span class="dv">2</span>), <span class="dt">data =</span> df)
}

by_country &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">nest</span>()

by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(data, country_model))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">resids =</span> <span class="kw">map2</span>(data, model, add_residuals)
  )
by_country
<span class="co">#&gt; # A tibble: 142 x 5</span>
<span class="co">#&gt;   country     continent data              model    resids           </span>
<span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;   &lt;list&gt;           </span>
<span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [12 × 5]&gt;</span>
<span class="co">#&gt; # ... with 136 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unnest</span>(by_country, resids) <span class="op">%&gt;%</span>
<span class="kw">ggplot</span>(<span class="kw">aes</span>(year, resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">alpha =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;gam&#39;</span></code></pre></div>
<p><img src="many-models_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_country <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="many-models_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="exercise-2-61" class="section level4">
<h4><span class="header-section-number">24.2.1.1</span> Exercise 2</h4>
<div class="question">
<p>Explore other methods for visualizing the distribution of <span class="math inline">\(R^2\)</span> per continent. You might want to try the <strong>ggbeeswarm</strong> package, which provides similar methods for avoiding overlaps as jitter, but uses deterministic methods.</p>
</div>
<div class="answer">
<p>See exercise 7.5.1.1.6 for more on <strong>ggbeeswarm</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;ggbeeswarm&quot;</span>)
by_country <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_beeswarm</span>()</code></pre></div>
<p><img src="many-models_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>
<div id="creating-list-columns" class="section level2">
<h2><span class="header-section-number">24.3</span> Creating list-columns</h2>
<div id="exercises-4" class="section level3">
<h3><span class="header-section-number">24.3.1</span> Exercises</h3>
<div id="exercise-1-63" class="section level4 exercise">
<h4><span class="header-section-number">24.3.1.1</span> Exercise 1</h4>
<div class="question">
<p>List all the functions that you can think of that take a atomic vector and return a list.</p>
</div>
<div class="answer">
<p>E.g. Many of the <strong>stringr</strong> functions.</p>
</div>
</div>
<div id="exercise-2-62" class="section level4 exercise">
<h4><span class="header-section-number">24.3.1.2</span> Exercise 2</h4>
<div class="question">
<p>Brainstorm useful summary functions that, like <code>quantile()</code>, return multiple values.</p>
</div>
<div class="answer">
<p>Some examples of summary functions that return multiple values are <code>range</code> and <code>fivenum</code>.</p>
</div>
</div>
<div id="exercise-3-47" class="section level4 exercise">
<h4><span class="header-section-number">24.3.1.3</span> Exercise 3</h4>
<div class="question">
<p>What’s missing in the following data frame? How does <code>quantile()</code> return that missing piece? Why isn’t that helpful here?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">q =</span> <span class="kw">list</span>(<span class="kw">quantile</span>(mpg))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>()
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;     cyl     q</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  4.00  21.4</span>
<span class="co">#&gt; 2  4.00  22.8</span>
<span class="co">#&gt; 3  4.00  26.0</span>
<span class="co">#&gt; 4  4.00  30.4</span>
<span class="co">#&gt; 5  4.00  33.9</span>
<span class="co">#&gt; 6  6.00  17.8</span>
<span class="co">#&gt; # ... with 9 more rows</span></code></pre></div>
<p>The particular quantiles of the values are missing, e.g. <code>0%</code>, <code>25%</code>, <code>50%</code>, <code>75%</code>, <code>100%</code>. <code>quantile()</code> returns these in the names of the vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(mtcars<span class="op">$</span>mpg)
<span class="co">#&gt;   0%  25%  50%  75% 100% </span>
<span class="co">#&gt; 10.4 15.4 19.2 22.8 33.9</span></code></pre></div>
<p>Since the <code>unnest</code> function drops the names of the vector, they aren’t useful here.</p>
</div>
</div>
<div id="exercise-4-37" class="section level4 exercise">
<h4><span class="header-section-number">24.3.1.4</span> Exercise 4</h4>
<div class="question">
<p>What does this code do? Why might might it be useful?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise_each</span>(<span class="kw">funs</span>(list))
<span class="co">#&gt; `summarise_each()` is deprecated.</span>
<span class="co">#&gt; Use `summarise_all()`, `summarise_at()` or `summarise_if()` instead.</span>
<span class="co">#&gt; To map `funs` over all variables, use `summarise_all()`</span>
<span class="co">#&gt; # A tibble: 3 x 11</span>
<span class="co">#&gt;     cyl mpg        disp   hp     drat  wt    qsec  vs    am    gear  carb </span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;list&gt;     &lt;list&gt; &lt;list&gt; &lt;lis&gt; &lt;lis&gt; &lt;lis&gt; &lt;lis&gt; &lt;lis&gt; &lt;lis&gt; &lt;lis&gt;</span>
<span class="co">#&gt; 1  4.00 &lt;dbl [11]&gt; &lt;dbl … &lt;dbl … &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl…</span>
<span class="co">#&gt; 2  6.00 &lt;dbl [7]&gt;  &lt;dbl … &lt;dbl … &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl…</span>
<span class="co">#&gt; 3  8.00 &lt;dbl [14]&gt; &lt;dbl … &lt;dbl … &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl… &lt;dbl…</span></code></pre></div>
<p>It creates a data frame in which each row corresponds to a value of <code>cyl</code>, and each observation for each column (other than <code>cyl</code>) is a vector of all the values of that column for that value of <code>cyl</code>. It seems like it should be useful to have all the observations of each variable for each group, but off the top of my head, I can’t think of a specific use for this. But, it seems that it may do many things that <code>dplyr::do</code> does.</p>
</div>
</div>
</div>
</div>
<div id="simplifying-list-columns" class="section level2">
<h2><span class="header-section-number">24.4</span> Simplifying list-columns</h2>
<div id="exercises-5" class="section level3">
<h3><span class="header-section-number">24.4.1</span> Exercises</h3>
<div id="exercise-1-64" class="section level4 exercise">
<h4><span class="header-section-number">24.4.1.1</span> Exercise 1</h4>
<div class="question">
<p>Why might the <code>lengths()</code> function be useful for creating atomic vector columns from list-columns?</p>
</div>
<div class="answer">
<p>The <code>lengths()</code> function gets the lengths of each element in a list. It could be useful for testing whether all elements in a list-column are the same length. You could get the maximum length to determine how many atomic vector columns to create. It is also a replacement for something like <code>map_int(x, length)</code> or <code>sapply(x, length)</code>.</p>
</div>
</div>
<div id="exercise-2-63" class="section level4 exercise">
<h4><span class="header-section-number">24.4.1.2</span> Exercise 2</h4>
<div class="question">
<p>List the most common types of vector found in a data frame. What makes lists different?</p>
</div>
<div class="answer">
<p>The common types of vectors in data frames are:</p>
<ul>
<li><code>logical</code></li>
<li><code>numeric</code></li>
<li><code>integer</code></li>
<li><code>character</code></li>
<li><code>factor</code></li>
</ul>
<p>All of the common types of vectors in data frames are atomic. Lists are not atomic (they can contain other lists and other vectors).</p>
</div>
<!--chapter:end:many-models.Rmd-->
</div>
</div>
</div>
</div>
<div id="part-communicate" class="section level1 unnumbered">
<h1>(PART) Communicate</h1>
</div>
<div id="communicate-intro" class="section level1">
<h1><span class="header-section-number">25</span> Introduction</h1>
<!--chapter:end:communicate.Rmd-->
</div>
<div id="r-markdown" class="section level1">
<h1><span class="header-section-number">26</span> R Markdown</h1>
<div id="r-markdown-basics" class="section level2">
<h2><span class="header-section-number">26.1</span> R Markdown Basics</h2>
<div id="exercises-6" class="section level3">
<h3><span class="header-section-number">26.1.1</span> Exercises</h3>
<div id="exercise-1-65" class="section level4 exercise">
<h4><span class="header-section-number">26.1.1.1</span> Exercise 1</h4>
<div class="question">
<p>Create a new notebook using <em>File &gt; New File &gt; R Notebook</em>. Read the instructions. Practice running the chunks. Verify that you can modify the code, re-run it, and see modified output.</p>
</div>
<div class="answer">
<p>This exercise is left to the reader.</p>
</div>
</div>
<div id="exercise-2-64" class="section level4 exercise">
<h4><span class="header-section-number">26.1.1.2</span> Exercise 2</h4>
<div class="question">
<p>Create a new R Markdown document with <em>File &gt; New File &gt; R Markdown …</em> Knit it by clicking the appropriate button. Knit it by using the appropriate keyboard short cut. Verify that you can modify the input and see the output update.</p>
</div>
<div class="answer">
<p>This exercise is mostly left to the reader. Recall that the keyboard shortcut to knit a file is <code>Cmd/Ctrl + Alt + I</code>.</p>
</div>
</div>
<div id="exercise-3-48" class="section level4 exercise">
<h4><span class="header-section-number">26.1.1.3</span> Exercise 3</h4>
<div class="question">
<p>Compare and contrast the R notebook and R markdown files you created above. How are the outputs similar? How are they different? How are the inputs similar? How are they different? What happens if you copy the YAML header from one to the other?</p>
</div>
<div class="answer">
<p>R notebook files show the output inside the editor, while hiding the console. R markdown files shows the output inside the console, and does not show output inside the editor. They differ in the value of <code>output</code> in their YAML headers.</p>
<p>The YAML header for the R notebook will have the line,</p>
<pre><code>---
ouptut: html_notebook
---</code></pre>
<p>For example, this is a R notebook,</p>
<pre><code>---
title: &quot;Diamond sizes&quot;
date: 2016-08-25
output: html_notebook
---

Text of the document.</code></pre>
<p>The YAML header for the R markdown file will have the line,</p>
<pre><code>ouptut: html_document </code></pre>
<p>For example, this is a R markdown file.</p>
<pre><code>---
title: &quot;Diamond sizes&quot;
date: 2016-08-25
output: html_document
---

Text of the document.</code></pre>
<p>Copying the YAML header from an R notebook to a R markdown file changes it to an R markdown file, and vice-versa. More specifically, changing the value of <code>output</code> to This is because the RStudio IDE when opening and the <strong>rmarkdown</strong> package when knitting uses the YAML header of a file, and in particular the value of the <code>output</code> key in the YAML header, to determine what type of document it is.</p>
</div>
</div>
<div id="exercise-4-38" class="section level4 exercise">
<h4><span class="header-section-number">26.1.1.4</span> Exercise 4</h4>
<div class="question">
<p>Create one new R Markdown document for each of the three built-in formats: HTML, PDF and Word. Knit each of the three documents. How does the output differ? How does the input differ? (You may need to install LaTeX in order to build the PDF output — RStudio will prompt you if this is necessary.)</p>
</div>
<div class="answer">
<p>They produce different outputs, both in the final documents and intermediate files (notably the type of plots produced). The only difference in the inputs is the value of <code>output</code> in the YAML header: <code>word_document</code> for Word documents, <code>pdf_document</code> for PDF documents, and <code>html_document</code> for HTML documents.</p>
</div>
</div>
</div>
</div>
<div id="text-formatting-with-r-markdown" class="section level2">
<h2><span class="header-section-number">26.2</span> Text formatting with R Markdown</h2>
<div id="exercise-1-66" class="section level3 exercise">
<h3><span class="header-section-number">26.2.1</span> Exercise 1</h3>
<div class="question">
<p>Practice what you’ve learned by creating a brief CV. The title should be your name, and you should include headings for (at least) education or employment. Each of the sections should include a bulleted list of jobs/degrees. Highlight the year in bold.</p>
</div>
<div class="answer">
<p><strong>TODO</strong></p>
</div>
</div>
<div id="exercise-2-65" class="section level3 exercise">
<h3><span class="header-section-number">26.2.2</span> Exercise 2</h3>
<div class="question">
<p>Using the R Markdown quick reference, figure out how to:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Add a footnote.</li>
<li>Add a horizontal rule.</li>
<li>Add a block quote.</li>
</ol>
</blockquote>
<pre><code>The quick brown fox jumped over the lazy dog.[^quick-fox]

Use three or more `-` for a horizontal rule. For example,

---

The horizontal rule uses the same syntax as a YAML block? So how does R markdown
distinguish between the two?  Three dashes (&quot;---&quot;) is only treated the start of 
a YAML block if it is at the start of the document.

&gt; This would be a block quote. Generally, block quotes are used to indicate
&gt; quotes longer than a three or four lines. 


[^quick-fox]: This is an example of a footnote. The sentence this is footnoting
  is often used for displaying fonts because it includes all 26 letters of the 
  English alphabet.
  </code></pre>
</div>
</div>
<div id="exercise-3-49" class="section level3 exercise">
<h3><span class="header-section-number">26.2.3</span> Exercise 3</h3>
<div class="question">
<p>Copy and paste the contents of <code>diamond-sizes.Rmd</code> from <a href="https://github.com/hadley/r4ds/tree/master/rmarkdown" class="uri">https://github.com/hadley/r4ds/tree/master/rmarkdown</a> in to a local R markdown document. Check that you can run it, then add text after the frequency polygon that describes its most striking features.</p>
</div>
<div class="answer">
<p>For an example R markdown document, see the exercises in the next section.</p>
</div>
</div>
</div>
<div id="code-chunks" class="section level2">
<h2><span class="header-section-number">26.3</span> Code Chunks</h2>
<p>Exercises 1–3 are answered in …</p>
<pre><code>#&gt; ---
#&gt; title: &quot;Exercise 24.4.7.4&quot;
#&gt; author: &quot;Jeffrey Arnold&quot;
#&gt; date: &quot;2/1/2018&quot;
#&gt; output: html_document
#&gt; ---
#&gt; 
#&gt; ```{r setup, include=FALSE}
#&gt; knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
#&gt; ```
#&gt; 
#&gt; The chunk `a` has no dependencies.
#&gt; ```{r a}
#&gt; print(lubridate::now())
#&gt; x &lt;- 1
#&gt; ```
#&gt; 
#&gt; The chunk `b` depends on `a`.
#&gt; ```{r b, dependson = c(&quot;a&quot;)}
#&gt; print(lubridate::now())
#&gt; y &lt;- x + 1
#&gt; ```
#&gt; 
#&gt; The chunk `c` depends on `a`.
#&gt; ```{r c, dependson = c(&quot;a&quot;)}
#&gt; print(lubridate::now())
#&gt; z &lt;- x * 2
#&gt; ```
#&gt; 
#&gt; The chunk `d` depends on `c` and `b`:
#&gt; ```{r d, dependson = c(&quot;c&quot;, &quot;b&quot;)}
#&gt; print(lubridate::now())
#&gt; w &lt;- y + z
#&gt; ```
#&gt; 
#&gt; If this document is knit repeatedly, the value  printed by `lubridate::now()` will be the same for all chunks,
#&gt; and the same as the first time the document was run with caching.</code></pre>
<div id="exercise-1-67" class="section level3 exercise">
<h3><span class="header-section-number">26.3.1</span> Exercise 1</h3>
<div class="question">
<p>Add a section that explores how diamond sizes vary by cut, color, and clarity. Assume you’re writing a report for someone who doesn’t know R, and instead of setting <code>echo = FALSE</code> on each chunk, set a global option.</p>
</div>
<div class="answer">

</div>
</div>
<div id="exercise-2-66" class="section level3 exercise">
<h3><span class="header-section-number">26.3.2</span> Exercise 2</h3>
<div class="question">
<p>Download <code>diamond-sizes.Rmd</code> from <a href="https://github.com/hadley/r4ds/tree/master/rmarkdown" class="uri">https://github.com/hadley/r4ds/tree/master/rmarkdown</a>. Add a section that describes the largest 20 diamonds, including a table that displays their most important attributes.</p>
</div>
<div class="answer">
<p>For the this, I use <code>arrange()</code> and <code>slice()</code> to select the largest twenty diamonds, and <code>knitr::kable()</code> to produce a formatted table.</p>
</div>
</div>
<div id="exercise-3-50" class="section level3 exercise">
<h3><span class="header-section-number">26.3.3</span> Exercise 3</h3>
<div class="question">
<p>Modify <code>diamonds-sizes.Rmd</code> to use comma() to produce nicely formatted output. Also include the percentage of diamonds that are larger than 2.5 carats.</p>
</div>
<div class="answer">
<p>I moved the computation of the number larger and percent of diamonds larger than 2.5 carats into a code chunk. I find that it is best to keep inline R expressions simple, usually consisting of an object and a formatting function. This makes it both easier to read and test the R code, while simultaneously making the prose easier to read. It helps the readability of the code and document to keep the computation of objects used in prose close to their use. Calculating those objects in a code chunk with the <code>include = FALSE</code> option (as is done in <code>diamonds-size.Rmd</code>) is useful in this regard.</p>
<ol start="4" style="list-style-type: decimal">
<li>Set up a network of chunks where <code>d</code> depends on <code>c</code> and <code>b</code>, and both <code>b</code> and <code>c</code> depend on <code>a</code>. Have each chunk print lubridate::now(), set cache = TRUE, then verify your understanding of caching.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(readr<span class="op">::</span><span class="kw">read_file</span>(<span class="st">&quot;rmarkdown/caching.Rmd&quot;</span>))
<span class="co">#&gt; ---</span>
<span class="co">#&gt; title: &quot;Exercise 24.4.7.4&quot;</span>
<span class="co">#&gt; author: &quot;Jeffrey Arnold&quot;</span>
<span class="co">#&gt; date: &quot;2/1/2018&quot;</span>
<span class="co">#&gt; output: html_document</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ```{r setup, include=FALSE}</span>
<span class="co">#&gt; knitr::opts_chunk$set(echo = TRUE, cache = TRUE)</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The chunk `a` has no dependencies.</span>
<span class="co">#&gt; ```{r a}</span>
<span class="co">#&gt; print(lubridate::now())</span>
<span class="co">#&gt; x &lt;- 1</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The chunk `b` depends on `a`.</span>
<span class="co">#&gt; ```{r b, dependson = c(&quot;a&quot;)}</span>
<span class="co">#&gt; print(lubridate::now())</span>
<span class="co">#&gt; y &lt;- x + 1</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The chunk `c` depends on `a`.</span>
<span class="co">#&gt; ```{r c, dependson = c(&quot;a&quot;)}</span>
<span class="co">#&gt; print(lubridate::now())</span>
<span class="co">#&gt; z &lt;- x * 2</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The chunk `d` depends on `c` and `b`:</span>
<span class="co">#&gt; ```{r d, dependson = c(&quot;c&quot;, &quot;b&quot;)}</span>
<span class="co">#&gt; print(lubridate::now())</span>
<span class="co">#&gt; w &lt;- y + z</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; If this document is knit repeatedly, the value  printed by `lubridate::now()` will be the same for all chunks,</span>
<span class="co">#&gt; and the same as the first time the document was run with caching.</span></code></pre></div>
</div>
<!--chapter:end:rmarkdown.Rmd-->
</div>
</div>
</div>
<div id="graphics-for-communication" class="section level1">
<h1><span class="header-section-number">27</span> Graphics for communication</h1>
<div id="introduction-16" class="section level2">
<h2><span class="header-section-number">27.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</span>
<span class="co">#&gt; ✔ ggplot2 2.2.1          ✔ purrr   0.2.4     </span>
<span class="co">#&gt; ✔ tibble  1.4.2          ✔ dplyr   0.7.4.9000</span>
<span class="co">#&gt; ✔ tidyr   0.8.0          ✔ stringr 1.2.0     </span>
<span class="co">#&gt; ✔ readr   1.1.1          ✔ forcats 0.3.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span>
<span class="kw">library</span>(<span class="st">&quot;modelr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;lubridate&quot;</span>)
<span class="co">#&gt; Loading required package: methods</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;lubridate&#39;</span>
<span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     date</span></code></pre></div>
</div>
<div id="label" class="section level2">
<h2><span class="header-section-number">27.2</span> Label</h2>
<div id="exercises-7" class="section level3">
<h3><span class="header-section-number">27.2.1</span> Exercises</h3>
<div id="exercise-1-68" class="section level4 exercise">
<h4><span class="header-section-number">27.2.1.1</span> Exercise 1</h4>
<div class="question">
<p>Create one plot on the fuel economy data with customized <code>title</code>, <code>subtitle</code>, <code>caption</code>, <code>x</code>, <code>y</code>, and <code>colour</code> labels.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, median), <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Compact Cars have &gt; 10 Hwy MPG than Pickup Trucks&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;Comparing the median highway mpg in each class&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Data from fueleconomy.gov&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;Car Class&quot;</span>,
    <span class="dt">y =</span> <span class="st">&quot;Highway Miles per Gallon&quot;</span>
  )</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="exercise-3-51" class="section level3 exercise">
<h3><span class="header-section-number">27.2.2</span> Exercise 3</h3>
<div class="question">
<p>The <code>geom_smooth()</code> is somewhat misleading because the <code>hwy</code> for large engines is skewed upwards due to the inclusion of lightweight sports cars with big engines. Use your modeling tools to fit and display</p>
</div>
<div class="answer">
<p>a better model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Fuel efficiency generally decreases with engine size&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;Subcompact cars show the greatest sensitivity to engine size&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Data from fueleconomy.gov&quot;</span>
  )</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(hwy <span class="op">~</span><span class="st"> </span>class, <span class="dt">data =</span> mpg)
mpg <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(mod) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(displ, resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Fuel efficiency decreases with engine size&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;Highway MPG for Cars After Subtracing Mean MPG of their Class&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Data from fueleconomy.gov&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;Highway MPG Relative to Class&quot;</span>,
    <span class="dt">y =</span> <span class="st">&quot;Engine Displacement&quot;</span>
  )</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-3-52" class="section level4">
<h4><span class="header-section-number">27.2.2.1</span> Exercise 3</h4>
<div class="question">
<p>Take an exploratory graphic that you’ve created in the last month, and add informative titles to make it easier for others to understand.</p>
</div>
<div class="answer">
<p>This exercise is by is intrinsically left to readers.</p>
</div>
</div>
</div>
</div>
<div id="annotations" class="section level2">
<h2><span class="header-section-number">27.3</span> Annotations</h2>
<div id="exercises-8" class="section level3">
<h3><span class="header-section-number">27.3.1</span> Exercises</h3>
<div id="exercise-1-69" class="section level4 exercise">
<h4><span class="header-section-number">27.3.1.1</span> Exercise 1</h4>
<div class="question">
<p>Use <code>geom_text()</code> with infinite positions to place text at the four corners of the plot.</p>
</div>
<div class="answer">
<p>I can use similar code as the example in the text. However, I need to use <code>vjust</code> and <code>hjust</code> in order for the text to appear in the plot, and these need to be different for each corner. But, <code>geom_text</code> takes <code>hjust</code> and <code>vjust</code> as aesthetics, I can add them to the data and mappings, and use a single <code>geom_text</code> call instead of four different <code>geom_text</code> calls with four different data arguments, and four different values of <code>hjust</code> and <code>vjust</code> arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">label &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>displ, <span class="op">~</span>hwy, <span class="op">~</span>label, <span class="op">~</span>vjust, <span class="op">~</span>hjust,
     <span class="ot">Inf</span>,  <span class="ot">Inf</span>,    <span class="st">&quot;Top right&quot;</span>, <span class="st">&quot;top&quot;</span>, <span class="st">&quot;right&quot;</span>,
     <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>,    <span class="st">&quot;Bottom right&quot;</span>, <span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;right&quot;</span>,
    <span class="op">-</span><span class="ot">Inf</span>,  <span class="ot">Inf</span>,    <span class="st">&quot;Top left&quot;</span>, <span class="st">&quot;top&quot;</span>, <span class="st">&quot;left&quot;</span>,
    <span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>,    <span class="st">&quot;Bottom left&quot;</span>, <span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;left&quot;</span>
)

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label, <span class="dt">vjust =</span> vjust, <span class="dt">hjust =</span> hjust), <span class="dt">data =</span> label)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-67" class="section level4 exercise">
<h4><span class="header-section-number">27.3.1.2</span> Exercise 2</h4>
<div class="question">
<p>Read the documentation for <code>annotate()</code>. How can you use it to add a text label to a plot without having to create a tibble?</p>
</div>
<div class="answer">
<p>With annotate you use what would be aesthetic mappings directly as arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="ot">Inf</span>, <span class="dt">y =</span> <span class="ot">Inf</span>, 
           <span class="dt">label =</span> <span class="st">&quot;Increasing engine size is </span><span class="ch">\n</span><span class="st">related to decreasing fuel economy.&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3-53" class="section level4 exercise">
<h4><span class="header-section-number">27.3.1.3</span> Exercise 3</h4>
<div class="question">
<p>How do labels with <code>geom_text()</code> interact with faceting? How can you add a label to a single facet? How can you put a different label in each facet? (Hint: think about the underlying data.)</p>
</div>
<div class="answer">
<p>If the facet variable is not specified, the text is drawn in all facets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">label &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">displ =</span> <span class="ot">Inf</span>,
  <span class="dt">hwy =</span> <span class="ot">Inf</span>,
  <span class="dt">label =</span> <span class="st">&quot;Increasing engine size is </span><span class="ch">\n</span><span class="st">related to decreasing fuel economy.&quot;</span>
)

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label), <span class="dt">data =</span> label, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>,
            <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>To draw the label in only one facet, add a column to the label data frame with the value of the faceting variable(s) in which to draw it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">label &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">displ =</span> <span class="ot">Inf</span>,
  <span class="dt">hwy =</span> <span class="ot">Inf</span>,
  <span class="dt">class =</span> <span class="st">&quot;2seater&quot;</span>,
  <span class="dt">label =</span> <span class="st">&quot;Increasing engine size is </span><span class="ch">\n</span><span class="st">related to decreasing fuel economy.&quot;</span>
)

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label), <span class="dt">data =</span> label, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>,
            <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>To draw labels in different plots, simply have the facetting variable(s):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">label &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">displ =</span> <span class="ot">Inf</span>,
  <span class="dt">hwy =</span> <span class="ot">Inf</span>,
  <span class="dt">class =</span> <span class="kw">unique</span>(mpg<span class="op">$</span>class),
  <span class="dt">label =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(<span class="st">&quot;Label for &quot;</span>, class)
)

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label), <span class="dt">data =</span> label, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>,
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-4-39" class="section level4 exercise">
<h4><span class="header-section-number">27.3.1.4</span> Exercise 4</h4>
<div class="question">
<p>What arguments to <code>geom_label()</code> control the appearance of the background box?</p>
</div>
<div class="answer">
<ul>
<li><code>label.padding</code>: padding around label</li>
<li><code>label.r</code>: amount of rounding in the corners</li>
<li><code>label.size</code>: size of label border</li>
</ul>
</div>
</div>
<div id="exercise-5-19" class="section level4 exercise">
<h4><span class="header-section-number">27.3.1.5</span> Exercise 5</h4>
<div class="question">
<p>What are the four arguments to <code>arrow()</code>? How do they work? Create a series of plots that demonstrate the most important options.</p>
</div>
<div class="answer">
<p>The four arguments are: (from the help for <a href="https://www.rdocumentation.org/packages/grid/versions/3.3.2/topics/arrow">arrow</a>) - <code>angle</code> : angle of arrow head - <code>length</code> : length of the arrow head - <code>ends</code>: ends of the line to draw arrow head - <code>type</code>: <code>&quot;open&quot;</code> or <code>&quot;close&quot;</code>: whether the arrow head is a closed or open triangle</p>
</div>
</div>
</div>
</div>
<div id="scales" class="section level2">
<h2><span class="header-section-number">27.4</span> Scales</h2>
<div id="exercises-9" class="section level3">
<h3><span class="header-section-number">27.4.1</span> Exercises</h3>
<div id="exercise-1-70" class="section level4 exercise">
<h4><span class="header-section-number">27.4.1.1</span> Exercise 1</h4>
<div class="question">
<p>Why doesn’t the following code override the default scale?</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>),
  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>)
)
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>It does not override the default scale because the colors in <code>geom_hex</code> are set by the <code>fill</code> aesthetic, not the <code>color</code> aesthetic.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-2-68" class="section level4 exercise">
<h4><span class="header-section-number">27.4.1.2</span> Exercise 2</h4>
<div class="question">
<p>The first argument to every scale is the label for the scale. It is equivalent to using the <code>labs</code> function.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&quot;Engine displacement (L)&quot;</span>,
    <span class="dt">y =</span> <span class="st">&quot;Highway fuel economy (mpg)&quot;</span>,
    <span class="dt">colour =</span> <span class="st">&quot;Car type&quot;</span>
  )
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Engine displacement (L)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Highway fuel economy (mpg)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="st">&quot;Car type&quot;</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-3-54" class="section level4 exercise">
<h4><span class="header-section-number">27.4.1.3</span> Exercise 3</h4>
<div class="question">
<p>Change the display of the presidential terms by:</p>
</div>
<div class="answer">
<blockquote>
<ol style="list-style-type: decimal">
<li>Combining the two variants shown above.</li>
<li>Improving the display of the y axis.</li>
<li>Labelling each term with the name of the president.</li>
<li>Adding informative plot labels.</li>
<li>Placing breaks every 4 years (this is trickier than it seems!).</li>
</ol>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">years &lt;-<span class="st"> </span>lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">seq</span>(<span class="kw">year</span>(<span class="kw">min</span>(presidential<span class="op">$</span>start)),
             <span class="kw">year</span>(<span class="kw">max</span>(presidential<span class="op">$</span>end)),
             <span class="dt">by =</span> <span class="dv">4</span>), <span class="dv">1</span>, <span class="dv">1</span>)

presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>(),
         <span class="dt">name_id =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(name, <span class="st">&quot; (&quot;</span>, id, <span class="st">&quot;)&quot;</span>),
         <span class="dt">name_id =</span> <span class="kw">factor</span>(name_id, <span class="dt">levels =</span> name_id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, name_id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> name_id)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_discrete</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_date</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> years, <span class="dt">date_labels =</span> <span class="st">&quot;&#39;%y&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercise-4-40" class="section level4 exercise">
<h4><span class="header-section-number">27.4.1.4</span> Exercise 4</h4>
<div class="question">
<p>Use <code>override.aes</code> to make the legend on the following plot easier to see.</p>
</div>
<div class="answer">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> cut), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span>)</code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The problem with the legend is that the <code>alpha</code> value make the colors hard to see. So I’ll override the alpha value to make the points solid in the legend.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> cut), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span>)  <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>)))  </code></pre></div>
<p><img src="graphics-for-communication_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<!--chapter:end:graphics-for-communication.Rmd-->
</div>
</div>
</div>
</div>
<div id="r-markdown-formats" class="section level1">
<h1><span class="header-section-number">28</span> R Markdown Formats</h1>
<p>No exercises.</p>
<p>This document was built with <strong>bookdown</strong>. You can see the source at <a href="https://github.com/jrnold/r4ds-exercise-solutions" class="uri">https://github.com/jrnold/r4ds-exercise-solutions</a>.</p>
<!--chapter:end:rmarkdown-formats.Rmd-->
</div>
<div id="r-markdown-workflow" class="section level1">
<h1><span class="header-section-number">29</span> R Markdown Workflow</h1>
<p>No exercises</p>
<!--chapter:end:rmarkdown-workflow.Rmd-->
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
