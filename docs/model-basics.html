<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Exercise Solutions to for R for Data Science</title>
  <meta name="description" content="Exercise Solutions to for “R for Data Science”">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Exercise Solutions to for R for Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="jrnold/e4qf" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Exercise Solutions to for R for Data Science" />
  
  
  

<meta name="author" content="Jeffrey B. Arnold">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="model-intro.html">
<link rel="next" href="model-building.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.2.0/str_view.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Data Science</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Explore</b></span></li>
<li class="chapter" data-level="1" data-path="explore-intro.html"><a href="explore-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="visualize.html"><a href="visualize.html"><i class="fa fa-check"></i><b>2</b> Visualize</a><ul>
<li class="chapter" data-level="2.1" data-path="visualize.html"><a href="visualize.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="2.1.1" data-path="visualize.html"><a href="visualize.html#prerequisites"><i class="fa fa-check"></i><b>2.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="2.1.2" data-path="visualize.html"><a href="visualize.html#first-steps"><i class="fa fa-check"></i><b>2.1.2</b> First Steps</a></li>
<li class="chapter" data-level="2.1.3" data-path="visualize.html"><a href="visualize.html#aesthetic-mappings"><i class="fa fa-check"></i><b>2.1.3</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="2.1.4" data-path="visualize.html"><a href="visualize.html#facets"><i class="fa fa-check"></i><b>2.1.4</b> Facets</a></li>
<li class="chapter" data-level="2.1.5" data-path="visualize.html"><a href="visualize.html#geometric-objects"><i class="fa fa-check"></i><b>2.1.5</b> Geometric Objects</a></li>
<li class="chapter" data-level="2.1.6" data-path="visualize.html"><a href="visualize.html#statistical-transformations"><i class="fa fa-check"></i><b>2.1.6</b> Statistical Transformations</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="visualize.html"><a href="visualize.html#position-adjustments"><i class="fa fa-check"></i><b>2.2</b> Position Adjustments</a></li>
<li class="chapter" data-level="2.3" data-path="visualize.html"><a href="visualize.html#coordinate-systems"><i class="fa fa-check"></i><b>2.3</b> Coordinate Systems</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualize.html"><a href="visualize.html#exercises-3"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-basics.html"><a href="workflow-basics.html"><i class="fa fa-check"></i><b>3</b> Workflow Basics</a><ul>
<li class="chapter" data-level="3.1" data-path="workflow-basics.html"><a href="workflow-basics.html#practice"><i class="fa fa-check"></i><b>3.1</b> Practice</a><ul>
<li class="chapter" data-level="3.1.1" data-path="workflow-basics.html"><a href="workflow-basics.html#exercises-4"><i class="fa fa-check"></i><b>3.1.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>4</b> Data Transformation</a><ul>
<li class="chapter" data-level="4.1" data-path="data-transformation.html"><a href="data-transformation.html#prerequisites-1"><i class="fa fa-check"></i><b>4.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.2" data-path="data-transformation.html"><a href="data-transformation.html#filter"><i class="fa fa-check"></i><b>4.2</b> Filter</a></li>
<li class="chapter" data-level="4.3" data-path="data-transformation.html"><a href="data-transformation.html#exercises-5"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
<li class="chapter" data-level="4.4" data-path="data-transformation.html"><a href="data-transformation.html#arrange"><i class="fa fa-check"></i><b>4.4</b> Arrange</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-transformation.html"><a href="data-transformation.html#exercises-6"><i class="fa fa-check"></i><b>4.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-transformation.html"><a href="data-transformation.html#mutate"><i class="fa fa-check"></i><b>4.5</b> Mutate</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-transformation.html"><a href="data-transformation.html#exercises-7"><i class="fa fa-check"></i><b>4.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-transformation.html"><a href="data-transformation.html#grouped-summaries-with-summarise"><i class="fa fa-check"></i><b>4.6</b> Grouped summaries with <code>summarise()</code></a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-transformation.html"><a href="data-transformation.html#exercises-8"><i class="fa fa-check"></i><b>4.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-transformation.html"><a href="data-transformation.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>4.7</b> Grouped mutates and filters</a><ul>
<li class="chapter" data-level="4.7.1" data-path="data-transformation.html"><a href="data-transformation.html#exercises-9"><i class="fa fa-check"></i><b>4.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="5.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#questions"><i class="fa fa-check"></i><b>5.1.1</b> Questions</a></li>
<li class="chapter" data-level="5.1.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#variation"><i class="fa fa-check"></i><b>5.1.2</b> Variation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>5.2</b> Missing Values</a><ul>
<li class="chapter" data-level="5.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-11"><i class="fa fa-check"></i><b>5.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i><b>5.3</b> Covariation</a><ul>
<li class="chapter" data-level="5.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-categorical-and-continuous-variable"><i class="fa fa-check"></i><b>5.3.1</b> A categorical and continuous variable</a></li>
<li class="chapter" data-level="5.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-categorical-variables"><i class="fa fa-check"></i><b>5.3.2</b> Two categorical variables</a></li>
<li class="chapter" data-level="5.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i><b>5.3.3</b> Two continuous variables</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Wrangle</b></span></li>
<li class="chapter" data-level="6" data-path="placeholder.html"><a href="placeholder.html"><i class="fa fa-check"></i><b>6</b> Placeholder</a></li>
<li class="chapter" data-level="7" data-path="tibbles.html"><a href="tibbles.html"><i class="fa fa-check"></i><b>7</b> Tibbles</a><ul>
<li class="chapter" data-level="7.1" data-path="tibbles.html"><a href="tibbles.html#prerquisites"><i class="fa fa-check"></i><b>7.1</b> Prerquisites</a></li>
<li class="chapter" data-level="7.2" data-path="tibbles.html"><a href="tibbles.html#creating-tibbles"><i class="fa fa-check"></i><b>7.2</b> Creating Tibbles</a></li>
<li class="chapter" data-level="7.3" data-path="tibbles.html"><a href="tibbles.html#tibbles-vs.data.frame"><i class="fa fa-check"></i><b>7.3</b> Tibbles vs. data.frame</a></li>
<li class="chapter" data-level="7.4" data-path="tibbles.html"><a href="tibbles.html#subsetting"><i class="fa fa-check"></i><b>7.4</b> Subsetting</a></li>
<li class="chapter" data-level="7.5" data-path="tibbles.html"><a href="tibbles.html#interacting-with-older-code"><i class="fa fa-check"></i><b>7.5</b> Interacting with older code</a></li>
<li class="chapter" data-level="7.6" data-path="tibbles.html"><a href="tibbles.html#exercises-12"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
<li class="chapter" data-level="7.7" data-path="tibbles.html"><a href="tibbles.html#import"><i class="fa fa-check"></i><b>7.7</b> Import</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>8</b> Data Import</a><ul>
<li class="chapter" data-level="8.1" data-path="data-import.html"><a href="data-import.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="data-import.html"><a href="data-import.html#getting-started"><i class="fa fa-check"></i><b>8.2</b> Getting started</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-import.html"><a href="data-import.html#exercises-13"><i class="fa fa-check"></i><b>8.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-import.html"><a href="data-import.html#parsing-a-vector"><i class="fa fa-check"></i><b>8.3</b> Parsing a vector</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-import.html"><a href="data-import.html#exercises-14"><i class="fa fa-check"></i><b>8.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-import.html"><a href="data-import.html#other-types-of-data"><i class="fa fa-check"></i><b>8.4</b> Other Types of Data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>9</b> Tidy Data</a><ul>
<li class="chapter" data-level="9.1" data-path="tidy-data.html"><a href="tidy-data.html#introduction-3"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data-1"><i class="fa fa-check"></i><b>9.2</b> Tidy Data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-15"><i class="fa fa-check"></i><b>9.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="tidy-data.html"><a href="tidy-data.html#spreading-and-gathering"><i class="fa fa-check"></i><b>9.3</b> Spreading and Gathering</a><ul>
<li class="chapter" data-level="9.3.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-16"><i class="fa fa-check"></i><b>9.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="tidy-data.html"><a href="tidy-data.html#separating-and-uniting"><i class="fa fa-check"></i><b>9.4</b> Separating and Uniting</a><ul>
<li class="chapter" data-level="9.4.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-17"><i class="fa fa-check"></i><b>9.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="tidy-data.html"><a href="tidy-data.html#missing-values-1"><i class="fa fa-check"></i><b>9.5</b> Missing Values</a><ul>
<li class="chapter" data-level="9.5.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-18"><i class="fa fa-check"></i><b>9.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="tidy-data.html"><a href="tidy-data.html#case-study"><i class="fa fa-check"></i><b>9.6</b> Case Study</a><ul>
<li class="chapter" data-level="9.6.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-19"><i class="fa fa-check"></i><b>9.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="tidy-data.html"><a href="tidy-data.html#non-tidy-data"><i class="fa fa-check"></i><b>9.7</b> Non-Tidy Data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>10</b> Relational Data</a><ul>
<li class="chapter" data-level="10.1" data-path="relational-data.html"><a href="relational-data.html#prerequisites-2"><i class="fa fa-check"></i><b>10.1</b> Prerequisites</a></li>
<li class="chapter" data-level="10.2" data-path="relational-data.html"><a href="relational-data.html#nycflights13"><i class="fa fa-check"></i><b>10.2</b> nycflights13</a><ul>
<li class="chapter" data-level="10.2.1" data-path="relational-data.html"><a href="relational-data.html#exercises-20"><i class="fa fa-check"></i><b>10.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="relational-data.html"><a href="relational-data.html#keys"><i class="fa fa-check"></i><b>10.3</b> Keys</a></li>
<li class="chapter" data-level="10.4" data-path="relational-data.html"><a href="relational-data.html#mutating-joins"><i class="fa fa-check"></i><b>10.4</b> Mutating Joins</a><ul>
<li class="chapter" data-level="10.4.1" data-path="relational-data.html"><a href="relational-data.html#exercises-21"><i class="fa fa-check"></i><b>10.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="relational-data.html"><a href="relational-data.html#filtering-joins"><i class="fa fa-check"></i><b>10.5</b> Filtering Joins</a><ul>
<li class="chapter" data-level="10.5.1" data-path="relational-data.html"><a href="relational-data.html#exercises-22"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="relational-data.html"><a href="relational-data.html#set-operations"><i class="fa fa-check"></i><b>10.6</b> Set operations</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>11</b> Strings</a><ul>
<li class="chapter" data-level="11.1" data-path="strings.html"><a href="strings.html#introduction-4"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="strings.html"><a href="strings.html#string-basics"><i class="fa fa-check"></i><b>11.2</b> String Basics</a><ul>
<li class="chapter" data-level="11.2.1" data-path="strings.html"><a href="strings.html#exercises-23"><i class="fa fa-check"></i><b>11.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="strings.html"><a href="strings.html#matching-patterns-and-regular-expressions"><i class="fa fa-check"></i><b>11.3</b> Matching Patterns and Regular Expressions</a><ul>
<li class="chapter" data-level="11.3.1" data-path="strings.html"><a href="strings.html#exercises-24"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
<li class="chapter" data-level="11.3.2" data-path="strings.html"><a href="strings.html#repitition"><i class="fa fa-check"></i><b>11.3.2</b> Repitition</a></li>
<li class="chapter" data-level="11.3.3" data-path="strings.html"><a href="strings.html#grouping-and-backreferences"><i class="fa fa-check"></i><b>11.3.3</b> Grouping and backreferences</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="strings.html"><a href="strings.html#tools"><i class="fa fa-check"></i><b>11.4</b> Tools</a><ul>
<li class="chapter" data-level="11.4.1" data-path="strings.html"><a href="strings.html#detect-matches"><i class="fa fa-check"></i><b>11.4.1</b> Detect matches</a></li>
<li class="chapter" data-level="11.4.2" data-path="strings.html"><a href="strings.html#exercises-29"><i class="fa fa-check"></i><b>11.4.2</b> Exercises</a></li>
<li class="chapter" data-level="11.4.3" data-path="strings.html"><a href="strings.html#extract-matches"><i class="fa fa-check"></i><b>11.4.3</b> Extract Matches</a></li>
<li class="chapter" data-level="11.4.4" data-path="strings.html"><a href="strings.html#grouped-matches"><i class="fa fa-check"></i><b>11.4.4</b> Grouped Matches</a></li>
<li class="chapter" data-level="11.4.5" data-path="strings.html"><a href="strings.html#replacing-matches"><i class="fa fa-check"></i><b>11.4.5</b> Replacing Matches</a></li>
<li class="chapter" data-level="11.4.6" data-path="strings.html"><a href="strings.html#splitting"><i class="fa fa-check"></i><b>11.4.6</b> Splitting</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="strings.html"><a href="strings.html#other-types-of-patterns"><i class="fa fa-check"></i><b>11.5</b> Other types of patterns</a><ul>
<li class="chapter" data-level="11.5.1" data-path="strings.html"><a href="strings.html#exercises-34"><i class="fa fa-check"></i><b>11.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="strings.html"><a href="strings.html#stringi"><i class="fa fa-check"></i><b>11.6</b> stringi</a><ul>
<li class="chapter" data-level="11.6.1" data-path="strings.html"><a href="strings.html#exercises-35"><i class="fa fa-check"></i><b>11.6.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>12</b> Factors</a><ul>
<li class="chapter" data-level="12.1" data-path="factors.html"><a href="factors.html#introduction-5"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="factors.html"><a href="factors.html#creating-factors"><i class="fa fa-check"></i><b>12.2</b> Creating Factors</a></li>
<li class="chapter" data-level="12.3" data-path="factors.html"><a href="factors.html#general-social-survey"><i class="fa fa-check"></i><b>12.3</b> General Social Survey</a><ul>
<li class="chapter" data-level="12.3.1" data-path="factors.html"><a href="factors.html#exercises-36"><i class="fa fa-check"></i><b>12.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="factors.html"><a href="factors.html#modifying-factor-order"><i class="fa fa-check"></i><b>12.4</b> Modifying factor order</a><ul>
<li class="chapter" data-level="12.4.1" data-path="factors.html"><a href="factors.html#exercises-37"><i class="fa fa-check"></i><b>12.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="factors.html"><a href="factors.html#modifying-factor-levels"><i class="fa fa-check"></i><b>12.5</b> Modifying factor levels</a><ul>
<li class="chapter" data-level="12.5.1" data-path="factors.html"><a href="factors.html#exercises-38"><i class="fa fa-check"></i><b>12.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>13</b> Dates and Times</a><ul>
<li class="chapter" data-level="13.1" data-path="dates-and-times.html"><a href="dates-and-times.html#prerequisite"><i class="fa fa-check"></i><b>13.1</b> Prerequisite</a></li>
<li class="chapter" data-level="13.2" data-path="dates-and-times.html"><a href="dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i><b>13.2</b> Creating date/times</a><ul>
<li class="chapter" data-level="13.2.1" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-39"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="dates-and-times.html"><a href="dates-and-times.html#date-time-components"><i class="fa fa-check"></i><b>13.3</b> Date-Time Components</a><ul>
<li class="chapter" data-level="13.3.1" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-40"><i class="fa fa-check"></i><b>13.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="dates-and-times.html"><a href="dates-and-times.html#time-spans"><i class="fa fa-check"></i><b>13.4</b> Time Spans</a><ul>
<li class="chapter" data-level="13.4.1" data-path="dates-and-times.html"><a href="dates-and-times.html#durations"><i class="fa fa-check"></i><b>13.4.1</b> Durations</a></li>
<li class="chapter" data-level="13.4.2" data-path="dates-and-times.html"><a href="dates-and-times.html#periods"><i class="fa fa-check"></i><b>13.4.2</b> Periods</a></li>
<li class="chapter" data-level="13.4.3" data-path="dates-and-times.html"><a href="dates-and-times.html#intervals"><i class="fa fa-check"></i><b>13.4.3</b> Intervals</a></li>
<li class="chapter" data-level="13.4.4" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-41"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
<li class="chapter" data-level="13.4.5" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>13.4.5</b> Time Zones</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Program</b></span></li>
<li class="chapter" data-level="14" data-path="program-intro.html"><a href="program-intro.html"><i class="fa fa-check"></i><b>14</b> Introduction</a></li>
<li class="chapter" data-level="15" data-path="pipes.html"><a href="pipes.html"><i class="fa fa-check"></i><b>15</b> Pipes</a></li>
<li class="chapter" data-level="16" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>16</b> Functions</a><ul>
<li class="chapter" data-level="16.1" data-path="functions.html"><a href="functions.html#introduction-6"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="functions.html"><a href="functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i><b>16.2</b> When should you write a function?</a><ul>
<li class="chapter" data-level="16.2.1" data-path="functions.html"><a href="functions.html#practice-1"><i class="fa fa-check"></i><b>16.2.1</b> Practice</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="functions.html"><a href="functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i><b>16.3</b> Functions are for humans and computers</a><ul>
<li class="chapter" data-level="16.3.1" data-path="functions.html"><a href="functions.html#exercises-42"><i class="fa fa-check"></i><b>16.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="functions.html"><a href="functions.html#conditional-execution"><i class="fa fa-check"></i><b>16.4</b> Conditional execution</a><ul>
<li class="chapter" data-level="16.4.1" data-path="functions.html"><a href="functions.html#exercises-43"><i class="fa fa-check"></i><b>16.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="functions.html"><a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>16.5</b> Function arguments</a><ul>
<li class="chapter" data-level="16.5.1" data-path="functions.html"><a href="functions.html#exercises-44"><i class="fa fa-check"></i><b>16.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>17</b> Vectors</a><ul>
<li class="chapter" data-level="17.1" data-path="vectors.html"><a href="vectors.html#introduction-7"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="vectors.html"><a href="vectors.html#important-types-of-atomic-vector"><i class="fa fa-check"></i><b>17.2</b> Important types of Atomic Vector</a><ul>
<li class="chapter" data-level="17.2.1" data-path="vectors.html"><a href="vectors.html#exercises-45"><i class="fa fa-check"></i><b>17.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="vectors.html"><a href="vectors.html#using-atomic-vectors"><i class="fa fa-check"></i><b>17.3</b> Using atomic vectors</a></li>
<li class="chapter" data-level="17.4" data-path="vectors.html"><a href="vectors.html#recursive-vectors-lists"><i class="fa fa-check"></i><b>17.4</b> Recursive Vectors (lists)</a><ul>
<li class="chapter" data-level="17.4.1" data-path="vectors.html"><a href="vectors.html#exercises-46"><i class="fa fa-check"></i><b>17.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="vectors.html"><a href="vectors.html#augmented-vectors"><i class="fa fa-check"></i><b>17.5</b> Augmented Vectors</a><ul>
<li class="chapter" data-level="17.5.1" data-path="vectors.html"><a href="vectors.html#exercises-47"><i class="fa fa-check"></i><b>17.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>18</b> Iteration</a><ul>
<li class="chapter" data-level="18.1" data-path="iteration.html"><a href="iteration.html#introduction-8"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="iteration.html"><a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>18.2</b> For Loops</a><ul>
<li class="chapter" data-level="18.2.1" data-path="iteration.html"><a href="iteration.html#exercises-48"><i class="fa fa-check"></i><b>18.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="iteration.html"><a href="iteration.html#for-loop-variations"><i class="fa fa-check"></i><b>18.3</b> For loop variations</a><ul>
<li class="chapter" data-level="18.3.1" data-path="iteration.html"><a href="iteration.html#section"><i class="fa fa-check"></i><b>18.3.1</b> </a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="iteration.html"><a href="iteration.html#for-loops-vs.functionals"><i class="fa fa-check"></i><b>18.4</b> For loops vs. functionals</a><ul>
<li class="chapter" data-level="18.4.1" data-path="iteration.html"><a href="iteration.html#exercises-49"><i class="fa fa-check"></i><b>18.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="iteration.html"><a href="iteration.html#the-map-functions"><i class="fa fa-check"></i><b>18.5</b> The map functions</a><ul>
<li class="chapter" data-level="18.5.1" data-path="iteration.html"><a href="iteration.html#shortcuts"><i class="fa fa-check"></i><b>18.5.1</b> Shortcuts</a></li>
<li class="chapter" data-level="18.5.2" data-path="iteration.html"><a href="iteration.html#exercises-50"><i class="fa fa-check"></i><b>18.5.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="iteration.html"><a href="iteration.html#dealing-with-failure"><i class="fa fa-check"></i><b>18.6</b> Dealing with Failure</a></li>
<li class="chapter" data-level="18.7" data-path="iteration.html"><a href="iteration.html#mapping-over-multiple-arguments"><i class="fa fa-check"></i><b>18.7</b> Mapping over multiple arguments</a></li>
<li class="chapter" data-level="18.8" data-path="iteration.html"><a href="iteration.html#walk"><i class="fa fa-check"></i><b>18.8</b> Walk</a></li>
<li class="chapter" data-level="18.9" data-path="iteration.html"><a href="iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i><b>18.9</b> Other patterns of for loops</a><ul>
<li class="chapter" data-level="18.9.1" data-path="iteration.html"><a href="iteration.html#exercises-51"><i class="fa fa-check"></i><b>18.9.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.10" data-path="iteration.html"><a href="iteration.html#models"><i class="fa fa-check"></i><b>18.10</b> Models</a></li>
</ul></li>
<li class="part"><span><b>IV Model</b></span></li>
<li class="chapter" data-level="19" data-path="model-intro.html"><a href="model-intro.html"><i class="fa fa-check"></i><b>19</b> Introduction</a></li>
<li class="chapter" data-level="20" data-path="model-basics.html"><a href="model-basics.html"><i class="fa fa-check"></i><b>20</b> Model Basics</a><ul>
<li class="chapter" data-level="20.1" data-path="model-basics.html"><a href="model-basics.html#prerequisites-3"><i class="fa fa-check"></i><b>20.1</b> Prerequisites</a></li>
<li class="chapter" data-level="20.2" data-path="model-basics.html"><a href="model-basics.html#a-simple-model"><i class="fa fa-check"></i><b>20.2</b> A simple model</a><ul>
<li class="chapter" data-level="20.2.1" data-path="model-basics.html"><a href="model-basics.html#exercises-52"><i class="fa fa-check"></i><b>20.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="model-basics.html"><a href="model-basics.html#visualizing-models"><i class="fa fa-check"></i><b>20.3</b> Visualizing Models</a><ul>
<li class="chapter" data-level="20.3.1" data-path="model-basics.html"><a href="model-basics.html#exercises-53"><i class="fa fa-check"></i><b>20.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="model-basics.html"><a href="model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i><b>20.4</b> Formulas and Model Families</a><ul>
<li class="chapter" data-level="20.4.1" data-path="model-basics.html"><a href="model-basics.html#categorical-variables"><i class="fa fa-check"></i><b>20.4.1</b> Categorical Variables</a></li>
<li class="chapter" data-level="20.4.2" data-path="model-basics.html"><a href="model-basics.html#exercises-54"><i class="fa fa-check"></i><b>20.4.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="model-basics.html"><a href="model-basics.html#missing-values-2"><i class="fa fa-check"></i><b>20.5</b> Missing values</a></li>
<li class="chapter" data-level="20.6" data-path="model-basics.html"><a href="model-basics.html#other-model-families"><i class="fa fa-check"></i><b>20.6</b> Other model families</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>21</b> Model Building</a><ul>
<li class="chapter" data-level="21.1" data-path="model-building.html"><a href="model-building.html#introduction-9"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="model-building.html"><a href="model-building.html#why-are-low-quality-diamonds-more-expensive"><i class="fa fa-check"></i><b>21.2</b> Why are low quality diamonds more expensive?</a><ul>
<li class="chapter" data-level="21.2.1" data-path="model-building.html"><a href="model-building.html#exercises-55"><i class="fa fa-check"></i><b>21.2.1</b> Exercises</a></li>
<li class="chapter" data-level="21.2.2" data-path="model-building.html"><a href="model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i><b>21.2.2</b> What affects the number of daily flights?</a></li>
<li class="chapter" data-level="21.2.3" data-path="model-building.html"><a href="model-building.html#exercises-56"><i class="fa fa-check"></i><b>21.2.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="many-models.html"><a href="many-models.html"><i class="fa fa-check"></i><b>22</b> Many Models</a><ul>
<li class="chapter" data-level="22.1" data-path="many-models.html"><a href="many-models.html#introduction-10"><i class="fa fa-check"></i><b>22.1</b> Introduction</a></li>
<li class="chapter" data-level="22.2" data-path="many-models.html"><a href="many-models.html#gapminder"><i class="fa fa-check"></i><b>22.2</b> Gapminder</a><ul>
<li class="chapter" data-level="22.2.1" data-path="many-models.html"><a href="many-models.html#exercises-57"><i class="fa fa-check"></i><b>22.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="many-models.html"><a href="many-models.html#creating-list-columns"><i class="fa fa-check"></i><b>22.3</b> Creating list-columns</a><ul>
<li class="chapter" data-level="22.3.1" data-path="many-models.html"><a href="many-models.html#exercises-58"><i class="fa fa-check"></i><b>22.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="many-models.html"><a href="many-models.html#simplifying-list-columns"><i class="fa fa-check"></i><b>22.4</b> Simplifying list-columns</a><ul>
<li class="chapter" data-level="22.4.1" data-path="many-models.html"><a href="many-models.html#exercises-59"><i class="fa fa-check"></i><b>22.4.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Communicate</b></span></li>
<li class="chapter" data-level="23" data-path="communicate-intro.html"><a href="communicate-intro.html"><i class="fa fa-check"></i><b>23</b> Introduction</a></li>
<li class="chapter" data-level="24" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>24</b> R Markdown</a><ul>
<li class="chapter" data-level="24.1" data-path="r-markdown.html"><a href="r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i><b>24.1</b> R Markdown Basics</a><ul>
<li class="chapter" data-level="24.1.1" data-path="r-markdown.html"><a href="r-markdown.html#exercise"><i class="fa fa-check"></i><b>24.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="r-markdown.html"><a href="r-markdown.html#text-formatting-with-r-markdown"><i class="fa fa-check"></i><b>24.2</b> Text formatting with R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html"><i class="fa fa-check"></i><b>25</b> Graphics for communication</a><ul>
<li class="chapter" data-level="25.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#introduction-11"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#label"><i class="fa fa-check"></i><b>25.2</b> Label</a><ul>
<li class="chapter" data-level="25.2.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercises-60"><i class="fa fa-check"></i><b>25.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#annotations"><i class="fa fa-check"></i><b>25.3</b> Annotations</a><ul>
<li class="chapter" data-level="25.3.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-1"><i class="fa fa-check"></i><b>25.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#scales"><i class="fa fa-check"></i><b>25.4</b> Scales</a><ul>
<li class="chapter" data-level="25.4.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercises-61"><i class="fa fa-check"></i><b>25.4.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html"><i class="fa fa-check"></i><b>26</b> R Markdown Formats</a></li>
<li class="chapter" data-level="27" data-path="r-markdown-workflow.html"><a href="r-markdown-workflow.html"><i class="fa fa-check"></i><b>27</b> R Markdown Workflow</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exercise Solutions to for “R for Data Science”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-basics" class="section level1">
<h1><span class="header-section-number">20</span> Model Basics</h1>
<div id="prerequisites-3" class="section level2">
<h2><span class="header-section-number">20.1</span> Prerequisites</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(modelr)
<span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)</code></pre></div>
<p>The option <code>na.action</code> determines how missing values are handled. It is a function. <code>na.warn</code> sets it so that there is a warning if there are any missing values (by default, R will just silently drop them).</p>
</div>
<div id="a-simple-model" class="section level2">
<h2><span class="header-section-number">20.2</span> A simple model</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">models &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">a1 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>),
  <span class="dt">a2 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)
)

<span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2), <span class="dt">data =</span> models, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {
  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>]
}
<span class="kw">model1</span>(<span class="kw">c</span>(<span class="dv">7</span>, <span class="fl">1.5</span>), sim1)
<span class="co">#&gt;  [1]  8.5  8.5  8.5 10.0 10.0 10.0 11.5 11.5 11.5 13.0 13.0 13.0 14.5 14.5</span>
<span class="co">#&gt; [15] 14.5 16.0 16.0 16.0 17.5 17.5 17.5 19.0 19.0 19.0 20.5 20.5 20.5 22.0</span>
<span class="co">#&gt; [29] 22.0 22.0</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {
  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model1</span>(mod, data)
  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))
}
<span class="kw">measure_distance</span>(<span class="kw">c</span>(<span class="dv">7</span>, <span class="fl">1.5</span>), sim1)
<span class="co">#&gt; [1] 2.67</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_dist &lt;-<span class="st"> </span><span class="cf">function</span>(a1, a2) {
  <span class="kw">measure_distance</span>(<span class="kw">c</span>(a1, a2), sim1)
}

models &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(a1, a2, sim1_dist))
models
<span class="co">#&gt; # A tibble: 250 x 3</span>
<span class="co">#&gt;       a1      a2  dist</span>
<span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -15.2   0.0889  30.8</span>
<span class="co">#&gt; 2  30.1  -0.827   13.2</span>
<span class="co">#&gt; 3  16.0   2.27    13.2</span>
<span class="co">#&gt; 4 -10.6   1.38    18.7</span>
<span class="co">#&gt; 5 -19.6  -1.04    41.8</span>
<span class="co">#&gt; 6   7.98  4.59    19.3</span>
<span class="co">#&gt; # ... with 244 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">colour =</span> <span class="op">-</span>dist), 
    <span class="dt">data =</span> <span class="kw">filter</span>(models, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)
  )</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(
  <span class="dt">a1 =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">20</span>, <span class="dt">length =</span> <span class="dv">25</span>),
  <span class="dt">a2 =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dt">length =</span> <span class="dv">25</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(a1, a2, sim1_dist))

grid <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(a1, a2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(grid, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="op">-</span>dist)) </code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">colour =</span> <span class="op">-</span>dist), 
    <span class="dt">data =</span> <span class="kw">filter</span>(grid, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)
  )</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_distance, <span class="dt">data =</span> sim1)
best<span class="op">$</span>par
<span class="co">#&gt; [1] 4.22 2.05</span>

<span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> best<span class="op">$</span>par[<span class="dv">1</span>], <span class="dt">slope =</span> best<span class="op">$</span>par[<span class="dv">2</span>])</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)
<span class="kw">coef</span>(sim1_mod)
<span class="co">#&gt; (Intercept)           x </span>
<span class="co">#&gt;        4.22        2.05</span></code></pre></div>
<div id="exercises-52" class="section level3">
<h3><span class="header-section-number">20.2.1</span> Exercises</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1a &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
  <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1a)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ x, data = sim1a)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)            x  </span>
<span class="co">#&gt;        6.05         1.53</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>To re-run this a few times using <code>purrr</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simt &lt;-<span class="st"> </span><span class="cf">function</span>(i) {
  <span class="kw">tibble</span>(
    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>),
    <span class="dt">.id =</span> i
  )
}

lm_df &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {
  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> .data)
  beta &lt;-<span class="st"> </span><span class="kw">coef</span>(mod)
  <span class="kw">tibble</span>(<span class="dt">intercept =</span> beta[<span class="dv">1</span>], <span class="dt">slope =</span> beta[<span class="dv">2</span>])
}

sims &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, simt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_df</span>(lm_df)

<span class="kw">ggplot</span>(sims, <span class="kw">aes</span>(<span class="dt">x =</span> intercept, <span class="dt">y =</span> slope)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>NOTE</strong> It’s not entirely clear what is meant by “visualize the results”.</p>
<p>The data are generated from a low-degrees of freedom t-distribution, so there will be outliers.</p>
<ol start="2" style="list-style-type: decimal">
<li>One way to make linear models more robust is to use a different distance measure. For example, instead of root-mean-squared distance, you could use mean-absolute distance:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {
  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">make_prediction</span>(mod, data)
  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))
}</code></pre></div>
<p>To re-run this a few times use purrr</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simt &lt;-<span class="st"> </span><span class="cf">function</span>(i) {
  <span class="kw">tibble</span>(
    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),
    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>),
    <span class="dt">.id =</span> i
  )
}

lm_df &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {
  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> .data)
  beta &lt;-<span class="st"> </span><span class="kw">coef</span>(mod)
  <span class="kw">tibble</span>(<span class="dt">intercept =</span> beta[<span class="dv">1</span>], <span class="dt">slope =</span> beta[<span class="dv">2</span>])
}

sims &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, simt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_df</span>(lm_df)

<span class="kw">ggplot</span>(sims, <span class="kw">aes</span>(<span class="dt">x =</span> intercept, <span class="dt">y =</span> slope)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>One challenge with performing numerical optimisation is that it’s only guaranteed to find one local optima. What’s the problem with optimising a three parameter model like this?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {
  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]
}</code></pre></div>
<p>The problem is that you for any values <code>a[1] = a1</code> and <code>a[3] = a3</code>, any other values of <code>a[1]</code> and <code>a[3]</code> where <code>a[1] + a[3] == (a1 + a3)</code> will have the same fit.</p>
</div>
</div>
<div id="visualizing-models" class="section level2">
<h2><span class="header-section-number">20.3</span> Visualizing Models</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data_grid</span>(x)
grid
<span class="co">#&gt; # A tibble: 10 x 1</span>
<span class="co">#&gt;       x</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1     1</span>
<span class="co">#&gt; 2     2</span>
<span class="co">#&gt; 3     3</span>
<span class="co">#&gt; 4     4</span>
<span class="co">#&gt; 5     5</span>
<span class="co">#&gt; 6     6</span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid &lt;-<span class="st"> </span>grid <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod)
grid
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;       x  pred</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1  6.27</span>
<span class="co">#&gt; 2     2  8.32</span>
<span class="co">#&gt; 3     3 10.4 </span>
<span class="co">#&gt; 4     4 12.4 </span>
<span class="co">#&gt; 5     5 14.5 </span>
<span class="co">#&gt; 6     6 16.5 </span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred), <span class="dt">data =</span> grid, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod)
sim1
<span class="co">#&gt; # A tibble: 30 x 3</span>
<span class="co">#&gt;       x     y  resid</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1  4.20 -2.07 </span>
<span class="co">#&gt; 2     1  7.51  1.24 </span>
<span class="co">#&gt; 3     1  2.13 -4.15 </span>
<span class="co">#&gt; 4     2  8.99  0.665</span>
<span class="co">#&gt; 5     2 10.2   1.92 </span>
<span class="co">#&gt; 6     2 11.3   2.97 </span>
<span class="co">#&gt; # ... with 24 more rows</span>
<span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, resid)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="exercises-53" class="section level3">
<h3><span class="header-section-number">20.3.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>nstead of using <code>lm()</code> to fit a straight line, you can use <code>loess()</code> to fit a smooth curve. Repeat the process of model fitting, grid generation, predictions, and visualisation on sim1 using <code>loess()</code> instead of <code>lm()</code>. How does the result compare to <code>geom_smooth()</code>?</li>
</ol>
<p>I’ll use <code>add_predictions</code> and <code>add_residuals</code> to add the predictions and residuals from a loess regression to the <code>sim1</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim1_loess &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)
grid_loess &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess)

sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_residuals</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;resid_loess&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)
  </code></pre></div>
<p>This plots the loess predictions. The loess produces a nonlinear, but smooth line through the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_sim1_loess &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred), <span class="dt">data =</span> grid_loess, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)
plot_sim1_loess</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The predictions of loess are the same as the default method for <code>geom_smooth</code> because <code>geom_smooth()</code> uses <code>loess()</code> by default; the message even tells us that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_sim1_loess <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="fl">0.20</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We can plot the residuals (red), and compare them to the residuals from lm (black). In general, the loess model has smaller residuals within the sample (out of sample is a different issue, and we haven’t considered the uncertainty of these estimates).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid_loess), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li><code>add_predictions()</code> is paired with <code>gather_predictions()</code> and <code>spread_predictions()</code>. How do these three functions differ?</li>
</ol>
<p>The functions <code>gather_predictions</code> and <code>spread_predictions</code> allow for adding predictions from multiple models at once.</p>
<ol start="3" style="list-style-type: decimal">
<li>What does <code>geom_ref_line()</code> do? What package does it come from? Why is displaying a reference line in plots showing residuals useful and important?</li>
</ol>
<p>The geom <code>geom_ref_line()</code> adds as reference line to a plot. Even though it alters a <strong>ggplot2</strong> plot, it is in the <strong>modelr</strong> package. Putting a reference line at zero for residuals is important because good models (generally) should have residuals centered at zero, with approximately the same variance (or distribution) over the support of x, and no correlation. A zero reference line makes it easier to judge these characteristics visually.</p>
<ol start="4" style="list-style-type: decimal">
<li>Why might you want to look at a frequency polygon of absolute residuals? What are the pros and cons compared to looking at the raw residuals?</li>
</ol>
<p>The frequency polygon makes it easier to judge whether the variance and/or absolute size of the residuals varies with respect to x. This is called heteroskedasticity, and results in incorrect standard errors in inference. In prediction, this provides insight into where the model is working well and where it is not. What is lost, is that since the absolute values are shown, whether the model is over-predicting or underpredicting, or on average correctly predicting in different regions of x cannot be determined.</p>
</div>
</div>
<div id="formulas-and-model-families" class="section level2">
<h2><span class="header-section-number">20.4</span> Formulas and Model Families</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>y, <span class="op">~</span>x1, <span class="op">~</span>x2,
  <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>,
  <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x1)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   `(Intercept)`    x1</span>
<span class="co">#&gt;           &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1          1.00  2.00</span>
<span class="co">#&gt; 2          1.00  1.00</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x1 <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 2 x 1</span>
<span class="co">#&gt;      x1</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2.00</span>
<span class="co">#&gt; 2  1.00</span></code></pre></div>
<div id="categorical-variables" class="section level3">
<h3><span class="header-section-number">20.4.1</span> Categorical Variables</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span><span class="st"> </span>sex, <span class="op">~</span><span class="st"> </span>response,
  <span class="st">&quot;male&quot;</span>, <span class="dv">1</span>,
  <span class="st">&quot;female&quot;</span>, <span class="dv">2</span>,
  <span class="st">&quot;male&quot;</span>, <span class="dv">1</span>
)
<span class="kw">model_matrix</span>(df, response <span class="op">~</span><span class="st"> </span>sex)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   `(Intercept)` sexmale</span>
<span class="co">#&gt;           &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1          1.00    1.00</span>
<span class="co">#&gt; 2          1.00    0   </span>
<span class="co">#&gt; 3          1.00    1.00</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim2) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y))</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)
grid &lt;-<span class="st"> </span>sim2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_grid</span>(x) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predictions</span>(mod2)
grid
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   x      pred</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 a      1.15</span>
<span class="co">#&gt; 2 b      8.12</span>
<span class="co">#&gt; 3 c      6.13</span>
<span class="co">#&gt; 4 d      1.91</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> x2))</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grid &lt;-<span class="st"> </span>sim3 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data_grid</span>(x1, x2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather_predictions</span>(mod1, mod2)
grid
<span class="co">#&gt; # A tibble: 80 x 4</span>
<span class="co">#&gt;   model    x1 x2      pred</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;fctr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 mod1      1 a       1.67</span>
<span class="co">#&gt; 2 mod1      1 b       4.56</span>
<span class="co">#&gt; 3 mod1      1 c       6.48</span>
<span class="co">#&gt; 4 mod1      1 d       4.03</span>
<span class="co">#&gt; 5 mod1      2 a       1.48</span>
<span class="co">#&gt; 6 mod1      2 b       4.37</span>
<span class="co">#&gt; # ... with 74 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, y, <span class="dt">colour =</span> x2)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> grid, <span class="kw">aes</span>(<span class="dt">y =</span> pred)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim3 &lt;-<span class="st"> </span>sim3 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather_residuals</span>(mod1, mod2)

<span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, resid, <span class="dt">colour =</span> x2)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(model <span class="op">~</span><span class="st"> </span>x2)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)

grid &lt;-<span class="st"> </span>sim4 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data_grid</span>(
    <span class="dt">x1 =</span> <span class="kw">seq_range</span>(x1, <span class="dv">5</span>), 
    <span class="dt">x2 =</span> <span class="kw">seq_range</span>(x2, <span class="dv">5</span>) 
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather_predictions</span>(mod1, mod2)
grid
<span class="co">#&gt; # A tibble: 50 x 4</span>
<span class="co">#&gt;   model     x1     x2   pred</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 mod1  -1.00  -1.00   0.996</span>
<span class="co">#&gt; 2 mod1  -1.00  -0.500 -0.395</span>
<span class="co">#&gt; 3 mod1  -1.00   0     -1.79 </span>
<span class="co">#&gt; 4 mod1  -1.00   0.500 -3.18 </span>
<span class="co">#&gt; 5 mod1  -1.00   1.00  -4.57 </span>
<span class="co">#&gt; 6 mod1  -0.500 -1.00   1.91 </span>
<span class="co">#&gt; # ... with 44 more rows</span></code></pre></div>
<p>Function <code>seq_range</code> is useful.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x1, x2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> pred)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-41-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x1, pred, <span class="dt">colour =</span> x2, <span class="dt">group =</span> x2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)

<span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x2, pred, <span class="dt">colour =</span> x1, <span class="dt">group =</span> x1)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</code></pre></div>
<p><img src="model-basics_files/figure-html/unnamed-chunk-42-1.png" width="70%" style="display: block; margin: auto;" /><img src="model-basics_files/figure-html/unnamed-chunk-42-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercises-54" class="section level3">
<h3><span class="header-section-number">20.4.2</span> Exercises</h3>
<p><strong>TODO</strong></p>
</div>
</div>
<div id="missing-values-2" class="section level2">
<h2><span class="header-section-number">20.5</span> Missing values</h2>
</div>
<div id="other-model-families" class="section level2">
<h2><span class="header-section-number">20.6</span> Other model families</h2>
<p>No exercises</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-building.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/r4ds/edit/master/model-basics.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
