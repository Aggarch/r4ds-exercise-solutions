<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Exercise Solutions and Notes for R for Data Science</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Exercise Solutions and Notes for “R for Data Science”">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Exercise Solutions and Notes for R for Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://r4ds.had.co.nz/" />
  
  
  <meta name="github-repo" content="jrnold/r4ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Exercise Solutions and Notes for R for Data Science" />
  
  
  

<meta name="author" content="Jeffrey B. Arnold">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="mutate.html">
<link rel="next" href="grouped-mutates-and-filters.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Data Science</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="visualize.html"><a href="visualize.html"><i class="fa fa-check"></i><b>1</b> Visualize</a><ul>
<li class="chapter" data-level="1.1" data-path="visualize.html"><a href="visualize.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1.1" data-path="visualize.html"><a href="visualize.html#prerequisites"><i class="fa fa-check"></i><b>1.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="1.1.2" data-path="visualize.html"><a href="visualize.html#first-steps"><i class="fa fa-check"></i><b>1.1.2</b> First Steps</a></li>
<li class="chapter" data-level="1.1.3" data-path="visualize.html"><a href="visualize.html#aesthetic-mappings"><i class="fa fa-check"></i><b>1.1.3</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="1.1.4" data-path="visualize.html"><a href="visualize.html#facets"><i class="fa fa-check"></i><b>1.1.4</b> Facets</a></li>
<li class="chapter" data-level="1.1.5" data-path="visualize.html"><a href="visualize.html#geometric-objects"><i class="fa fa-check"></i><b>1.1.5</b> Geometric Objects</a></li>
<li class="chapter" data-level="1.1.6" data-path="visualize.html"><a href="visualize.html#statistical-transformations"><i class="fa fa-check"></i><b>1.1.6</b> Statistical Transformations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="visualize.html"><a href="visualize.html#position-adjustments"><i class="fa fa-check"></i><b>1.2</b> Position Adjustments</a></li>
<li class="chapter" data-level="1.3" data-path="visualize.html"><a href="visualize.html#coordinate-systems"><i class="fa fa-check"></i><b>1.3</b> Coordinate Systems</a><ul>
<li class="chapter" data-level="1.3.1" data-path="visualize.html"><a href="visualize.html#exercises-3"><i class="fa fa-check"></i><b>1.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="workflow-basics.html"><a href="workflow-basics.html"><i class="fa fa-check"></i><b>2</b> Workflow Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="workflow-basics.html"><a href="workflow-basics.html#practice"><i class="fa fa-check"></i><b>2.1</b> Practice</a><ul>
<li class="chapter" data-level="2.1.1" data-path="workflow-basics.html"><a href="workflow-basics.html#exercises-4"><i class="fa fa-check"></i><b>2.1.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data Transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#prerequisites-1"><i class="fa fa-check"></i><b>3.1</b> Prerequisites</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#filter"><i class="fa fa-check"></i><b>3.2</b> Filter</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#exercises-5"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arrange.html"><a href="arrange.html"><i class="fa fa-check"></i><b>4</b> Arrange</a><ul>
<li class="chapter" data-level="4.1" data-path="arrange.html"><a href="arrange.html#exercises-6"><i class="fa fa-check"></i><b>4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mutate.html"><a href="mutate.html"><i class="fa fa-check"></i><b>5</b> Mutate</a><ul>
<li class="chapter" data-level="5.1" data-path="mutate.html"><a href="mutate.html#exercises-7"><i class="fa fa-check"></i><b>5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercises-8.html"><a href="exercises-8.html"><i class="fa fa-check"></i><b>6</b> Exercises</a></li>
<li class="chapter" data-level="7" data-path="grouped-mutates-and-filters.html"><a href="grouped-mutates-and-filters.html"><i class="fa fa-check"></i><b>7</b> Grouped mutates and filters</a><ul>
<li class="chapter" data-level="7.1" data-path="grouped-mutates-and-filters.html"><a href="grouped-mutates-and-filters.html#exercises-9"><i class="fa fa-check"></i><b>7.1</b> Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exercise Solutions and Notes for “R for Data Science”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercises-8" class="section level1">
<h1><span class="header-section-number">6</span> Exercises</h1>
<ol style="list-style-type: decimal">
<li>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</li>
</ol>
<ul>
<li><p>A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</p></li>
<li><p>A flight is always 10 minutes late.</p></li>
<li><p>A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.</p></li>
<li><p>99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p></li>
</ul>
<p>Which is more important: arrival delay or departure delay?</p>
<p>Arrival delay is more important. Arriving early is nice, but equally as good as arriving late is bad. Variation is worse than consistency; if I know the plane will always arrive 10 minutes late, then I can plan for it arriving as if the actual arrival time was 10 minutes later than the scheduled arrival time.</p>
<p>So I’d try something that calculates the expected time of the flight, and then aggregates over any delays from that time. I would ignore any early arrival times. A better ranking would also consider cancellations, and need a way to convert them to a delay time (perhaps using the arrival time of the next flight to the same destination).</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p></li>
<li><p>Our definition of cancelled flights <code>(is.na(dep_delay) | is.na(arr_delay))</code> is slightly suboptimal. Why? Which is the most important column?</p></li>
</ol>
<p>If a flight doesn’t depart, then it won’t arrive. A flight can also depart and not arrive if it crashes; I’m not sure how this data would handle flights that are redirected and land at other airports for whatever reason.</p>
<p>The more important column is <code>arr_delay</code> so we could just use that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, !<span class="kw">is.na</span>(dep_delay), <span class="kw">is.na</span>(arr_delay)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dep_time, arr_time, sched_arr_time, dep_delay, arr_delay)
<span class="co">#&gt; # A tibble: 1,175 × 5</span>
<span class="co">#&gt;   dep_time arr_time sched_arr_time dep_delay arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1525     1934           1805        -5        NA</span>
<span class="co">#&gt; 2     1528     2002           1647        29        NA</span>
<span class="co">#&gt; 3     1740     2158           2020        -5        NA</span>
<span class="co">#&gt; 4     1807     2251           2103        29        NA</span>
<span class="co">#&gt; 5     1939       29           2151        59        NA</span>
<span class="co">#&gt; 6     1952     2358           2207        22        NA</span>
<span class="co">#&gt; # ... with 1,169 more rows</span></code></pre></div>
<p>Okay, I’m not sure what’s going on in this data. <code>dep_time</code> can be non-missing and <code>arr_delay</code> missing but <code>arr_time</code> not missing. They may be combining different flights?</p>
<ol start="4" style="list-style-type: decimal">
<li>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancelled_delayed &lt;-<span class="st"> </span>
<span class="st">  </span>flights %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cancelled =</span> (<span class="kw">is.na</span>(arr_delay) |<span class="st"> </span><span class="kw">is.na</span>(dep_delay))) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop_cancelled =</span> <span class="kw">mean</span>(cancelled),
            <span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="kw">ggplot</span>(cancelled_delayed, <span class="kw">aes</span>(<span class="dt">x =</span> avg_dep_delay, prop_cancelled)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>()
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="transform_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n())</code>)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(carrier) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(arr_delay))
<span class="co">#&gt; # A tibble: 16 × 2</span>
<span class="co">#&gt;   carrier arr_delay</span>
<span class="co">#&gt;     &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      F9      21.9</span>
<span class="co">#&gt; 2      FL      20.1</span>
<span class="co">#&gt; 3      EV      15.8</span>
<span class="co">#&gt; 4      YV      15.6</span>
<span class="co">#&gt; 5      OO      11.9</span>
<span class="co">#&gt; 6      MQ      10.8</span>
<span class="co">#&gt; # ... with 10 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(airlines, carrier ==<span class="st"> &quot;F9&quot;</span>)
<span class="co">#&gt; # A tibble: 1 × 2</span>
<span class="co">#&gt;   carrier                   name</span>
<span class="co">#&gt;     &lt;chr&gt;                  &lt;chr&gt;</span>
<span class="co">#&gt; 1      F9 Frontier Airlines Inc.</span></code></pre></div>
<p>Frontier Airlines (FL) has the worst delays.</p>
<p>You can get part of the way to disentangling the effects of airports vs. carriers by comparing each flight’s delay to the average delay of destination airport. However, you’d really want to compare it to the average delay of the desination airport, <em>after</em> removing other flights from the same airline.</p>
<p>538 has done something like this: <a href="http://fivethirtyeight.com/features/the-best-and-worst-airlines-airports-and-flights-summer-2015-update/" class="uri">http://fivethirtyeight.com/features/the-best-and-worst-airlines-airports-and-flights-summer-2015-update/</a>.</p>
<ol start="6" style="list-style-type: decimal">
<li>For each plane, count the number of flights before the first delay of greater than 1 hour.</li>
</ol>
<p>I think this requires grouped mutate (but I may be wrong):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(tailnum, year, month, day) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(tailnum) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delay_gt1hr =</span> dep_delay &gt;<span class="st"> </span><span class="dv">60</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">before_delay =</span> <span class="kw">cumsum</span>(delay_gt1hr)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(before_delay &lt;<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">count</span>(<span class="dt">sort =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 3,755 × 2</span>
<span class="co">#&gt;   tailnum     n</span>
<span class="co">#&gt;     &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  N954UW   206</span>
<span class="co">#&gt; 2  N952UW   163</span>
<span class="co">#&gt; 3  N957UW   142</span>
<span class="co">#&gt; 4  N5FAAA   117</span>
<span class="co">#&gt; 5  N38727    99</span>
<span class="co">#&gt; 6  N3742C    98</span>
<span class="co">#&gt; # ... with 3,749 more rows</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>What does the sort argument to <code>count()</code> do. When might you use it?</li>
</ol>
<p>The sort argument to <code>count</code> sorts the results in order of <code>n</code>. You could use this anytime you would do <code>count</code> followed by <code>arrange</code>.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mutate.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="grouped-mutates-and-filters.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/r4ds/edit/master/transform.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
