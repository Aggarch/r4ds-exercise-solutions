<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Exercise Solutions and Notes for R for Data Science</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Exercise Solutions and Notes for “R for Data Science”">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Exercise Solutions and Notes for R for Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://r4ds.had.co.nz/" />
  
  
  <meta name="github-repo" content="jrnold/r4ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Exercise Solutions and Notes for R for Data Science" />
  
  
  

<meta name="author" content="Jeffrey B. Arnold">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-transformation.html">
<link rel="next" href="exercises-3.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Data Science</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="visualize.html"><a href="visualize.html"><i class="fa fa-check"></i><b>1</b> Visualize</a></li>
<li class="chapter" data-level="2" data-path="workflow-basics.html"><a href="workflow-basics.html"><i class="fa fa-check"></i><b>2</b> Workflow Basics</a></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data Transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#prerequisites"><i class="fa fa-check"></i><b>3.1</b> Prerequisites</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#filter"><i class="fa fa-check"></i><b>3.2</b> Filter</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#exercises"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arrange.html"><a href="arrange.html"><i class="fa fa-check"></i><b>4</b> Arrange</a><ul>
<li class="chapter" data-level="4.1" data-path="arrange.html"><a href="arrange.html#exercises-1"><i class="fa fa-check"></i><b>4.1</b> Exercises</a></li>
<li class="chapter" data-level="4.2" data-path="arrange.html"><a href="arrange.html#mutate"><i class="fa fa-check"></i><b>4.2</b> Mutate</a><ul>
<li class="chapter" data-level="4.2.1" data-path="arrange.html"><a href="arrange.html#exercises-2"><i class="fa fa-check"></i><b>4.2.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercises-3.html"><a href="exercises-3.html"><i class="fa fa-check"></i><b>5</b> Exercises</a><ul>
<li class="chapter" data-level="5.1" data-path="exercises-3.html"><a href="exercises-3.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>5.1</b> Grouped mutates and filters</a></li>
<li class="chapter" data-level="5.2" data-path="exercises-3.html"><a href="exercises-3.html#exercises-4"><i class="fa fa-check"></i><b>5.2</b> Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exercise Solutions and Notes for “R for Data Science”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="arrange" class="section level1">
<h1><span class="header-section-number">4</span> Arrange</h1>
<p>missing values always at the end.</p>
<div id="exercises-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>).</li>
</ol>
<p>This sorts by increasing <code>dep_time</code>, but with all missing values put first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(<span class="kw">is.na</span>(dep_time)), dep_time)
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1       NA           1630        NA       NA</span>
<span class="co">#&gt; 2  2013     1     1       NA           1935        NA       NA</span>
<span class="co">#&gt; 3  2013     1     1       NA           1500        NA       NA</span>
<span class="co">#&gt; 4  2013     1     1       NA            600        NA       NA</span>
<span class="co">#&gt; 5  2013     1     2       NA           1540        NA       NA</span>
<span class="co">#&gt; 6  2013     1     2       NA           1620        NA       NA</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Sort flights to find the most delayed flights. Find the flights that left earliest.</li>
</ol>
<p>The most delayed flights are found by sorting by <code>dep_delay</code> in descending order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     9      641            900      1301     1242</span>
<span class="co">#&gt; 2  2013     6    15     1432           1935      1137     1607</span>
<span class="co">#&gt; 3  2013     1    10     1121           1635      1126     1239</span>
<span class="co">#&gt; 4  2013     9    20     1139           1845      1014     1457</span>
<span class="co">#&gt; 5  2013     7    22      845           1600      1005     1044</span>
<span class="co">#&gt; 6  2013     4    10     1100           1900       960     1342</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p>If we sort <code>dep_delay</code> in ascending order, we get those that left earliest. There was a flight that left 43 minutes early.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, dep_delay)
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013    12     7     2040           2123       -43       40</span>
<span class="co">#&gt; 2  2013     2     3     2022           2055       -33     2240</span>
<span class="co">#&gt; 3  2013    11    10     1408           1440       -32     1549</span>
<span class="co">#&gt; 4  2013     1    11     1900           1930       -30     2233</span>
<span class="co">#&gt; 5  2013     1    29     1703           1730       -27     1947</span>
<span class="co">#&gt; 6  2013     8     9      729            755       -26     1002</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Sort flights to find the fastest flights.</li>
</ol>
<p>I assume that by by “fastest flights” it means the flights with the minimum air time. So I sort by <code>air_time</code>. The fastest flights. The fastest flights area couple of flights between EWR and BDL with an air time of 20 minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, air_time)
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1    16     1355           1315        40     1442</span>
<span class="co">#&gt; 2  2013     4    13      537            527        10      622</span>
<span class="co">#&gt; 3  2013    12     6      922            851        31     1021</span>
<span class="co">#&gt; 4  2013     2     3     2153           2129        24     2247</span>
<span class="co">#&gt; 5  2013     2     5     1303           1315       -12     1342</span>
<span class="co">#&gt; 6  2013     2    12     2123           2130        -7     2211</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Which flights travelled the longest? Which travelled the shortest?</li>
</ol>
<p>I’ll assume hat travelled the longest or shortest refers to distance, rather than air-time.</p>
<p>The longest flights are the Hawaii Air (HA 51) between JFK and HNL (Honolulu) at 4,983 miles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1      857            900        -3     1516</span>
<span class="co">#&gt; 2  2013     1     2      909            900         9     1525</span>
<span class="co">#&gt; 3  2013     1     3      914            900        14     1504</span>
<span class="co">#&gt; 4  2013     1     4      900            900         0     1516</span>
<span class="co">#&gt; 5  2013     1     5      858            900        -2     1519</span>
<span class="co">#&gt; 6  2013     1     6     1019            900        79     1558</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<p>Apart from an EWR to LGA flight that was cancelled, the shortest flights are the Envoy Air Flights between EWR and PHL at 80 miles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, distance)
<span class="co">#&gt; # A tibble: 336,776 × 19</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     7    27       NA            106        NA       NA</span>
<span class="co">#&gt; 2  2013     1     3     2127           2129        -2     2222</span>
<span class="co">#&gt; 3  2013     1     4     1240           1200        40     1333</span>
<span class="co">#&gt; 4  2013     1     4     1829           1615       134     1937</span>
<span class="co">#&gt; 5  2013     1     4     2128           2129        -1     2218</span>
<span class="co">#&gt; 6  2013     1     5     1155           1200        -5     1241</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 12 more variables:</span>
<span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span>
<span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span>
<span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Brainstorm as many ways as possible to select <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> from flights.</li>
</ol>
<p>A few ways include:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay)
<span class="co">#&gt; # A tibble: 336,776 × 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517         2      830        11</span>
<span class="co">#&gt; 2      533         4      850        20</span>
<span class="co">#&gt; 3      542         2      923        33</span>
<span class="co">#&gt; 4      544        -1     1004       -18</span>
<span class="co">#&gt; 5      554        -6      812       -25</span>
<span class="co">#&gt; 6      554        -4      740        12</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span>
<span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;dep_&quot;</span>), <span class="kw">starts_with</span>(<span class="st">&quot;arr_&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 × 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517         2      830        11</span>
<span class="co">#&gt; 2      533         4      850        20</span>
<span class="co">#&gt; 3      542         2      923        33</span>
<span class="co">#&gt; 4      544        -1     1004       -18</span>
<span class="co">#&gt; 5      554        -6      812       -25</span>
<span class="co">#&gt; 6      554        -4      740        12</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span>
<span class="kw">select</span>(flights, <span class="kw">matches</span>(<span class="st">&quot;^(dep|arr)_(time|delay)$&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 × 4</span>
<span class="co">#&gt;   dep_time dep_delay arr_time arr_delay</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517         2      830        11</span>
<span class="co">#&gt; 2      533         4      850        20</span>
<span class="co">#&gt; 3      542         2      923        33</span>
<span class="co">#&gt; 4      544        -1     1004       -18</span>
<span class="co">#&gt; 5      554        -6      812       -25</span>
<span class="co">#&gt; 6      554        -4      740        12</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<p>using <code>ends_with()</code> doesn’t work well since it would bget <code>sched_arr_time</code> and <code>sched_dep_time</code>.</p>
<ol start="2" style="list-style-type: decimal">
<li>What happens if you include the name of a variable multiple times in a select() call?</li>
</ol>
<p>It ignores the duplicates, and that variable is only included once. No error, warning, or message is emited.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, year, month, day, year, year)
<span class="co">#&gt; # A tibble: 336,776 × 3</span>
<span class="co">#&gt;    year month   day</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     1</span>
<span class="co">#&gt; 2  2013     1     1</span>
<span class="co">#&gt; 3  2013     1     1</span>
<span class="co">#&gt; 4  2013     1     1</span>
<span class="co">#&gt; 5  2013     1     1</span>
<span class="co">#&gt; 6  2013     1     1</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>What does the <code>one_of()</code> function do? Why might it be helpful in conjunction with this vector?</li>
</ol>
<p>The <code>one_of</code> vector allows you to select variables with a character vector rather than as unquoted variable names. It’s useful because then you can easily pass vectors to <code>select()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)
<span class="kw">select</span>(flights, <span class="kw">one_of</span>(vars))
<span class="co">#&gt; # A tibble: 336,776 × 5</span>
<span class="co">#&gt;    year month   day dep_delay arr_delay</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2013     1     1         2        11</span>
<span class="co">#&gt; 2  2013     1     1         4        20</span>
<span class="co">#&gt; 3  2013     1     1         2        33</span>
<span class="co">#&gt; 4  2013     1     1        -1       -18</span>
<span class="co">#&gt; 5  2013     1     1        -6       -25</span>
<span class="co">#&gt; 6  2013     1     1        -4        12</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))
<span class="co">#&gt; # A tibble: 336,776 × 6</span>
<span class="co">#&gt;   dep_time sched_dep_time arr_time sched_arr_time air_time</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517            515      830            819      227</span>
<span class="co">#&gt; 2      533            529      850            830      227</span>
<span class="co">#&gt; 3      542            540      923            850      160</span>
<span class="co">#&gt; 4      544            545     1004           1022      183</span>
<span class="co">#&gt; 5      554            600      812            837      116</span>
<span class="co">#&gt; 6      554            558      740            728      150</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows, and 1 more variables: time_hour &lt;dttm&gt;</span></code></pre></div>
<p>The default behavior for contains is to ignore case. Yes, it surprises me. Upon reflection, I realized that this is likely the default behavior because <code>dplyr</code> is designed to deal with a variety of data backends, and some database engines don’t differentiate case.</p>
<p>To change the behavior add the argument <code>ignore.case = FALSE</code>. Now no variables are selected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>))
<span class="co">#&gt; # A tibble: 336,776 × 0</span></code></pre></div>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">4.2</span> Mutate</h2>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</li>
</ol>
<p>To get the departure times in the number of minutes, (integer) divide <code>dep_time</code> by 100 to get the hours since midnight and muliply by 60 and add the remainder of <code>dep_time</code> divided by 100.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_time_mins =</span> dep_time %/%<span class="st"> </span><span class="dv">100</span> *<span class="st"> </span><span class="dv">60</span> +<span class="st"> </span>dep_time %%<span class="st"> </span><span class="dv">100</span>,
       <span class="dt">sched_dep_time_mins =</span> sched_dep_time %/%<span class="st"> </span><span class="dv">100</span> *<span class="st"> </span><span class="dv">60</span> +<span class="st"> </span>sched_dep_time %%<span class="st"> </span><span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dep_time, dep_time_mins, sched_dep_time, sched_dep_time_mins)
<span class="co">#&gt; # A tibble: 336,776 × 4</span>
<span class="co">#&gt;   dep_time dep_time_mins sched_dep_time sched_dep_time_mins</span>
<span class="co">#&gt;      &lt;int&gt;         &lt;dbl&gt;          &lt;int&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517           317            515                 315</span>
<span class="co">#&gt; 2      533           333            529                 329</span>
<span class="co">#&gt; 3      542           342            540                 340</span>
<span class="co">#&gt; 4      544           344            545                 345</span>
<span class="co">#&gt; 5      554           354            600                 360</span>
<span class="co">#&gt; 6      554           354            558                 358</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<p>This would be more cleanly done by first definining a funciton and reusing that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time2mins &lt;-<span class="st"> </span>function(x) {
  x %/%<span class="st"> </span><span class="dv">100</span> *<span class="st"> </span><span class="dv">60</span> +<span class="st"> </span>x %%<span class="st"> </span><span class="dv">100</span>
}
<span class="kw">mutate</span>(flights,
       <span class="dt">dep_time_mins =</span> <span class="kw">time2mins</span>(dep_time),
       <span class="dt">sched_dep_time_mins =</span> <span class="kw">time2mins</span>(sched_dep_time)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dep_time, dep_time_mins, sched_dep_time, sched_dep_time_mins)
<span class="co">#&gt; # A tibble: 336,776 × 4</span>
<span class="co">#&gt;   dep_time dep_time_mins sched_dep_time sched_dep_time_mins</span>
<span class="co">#&gt;      &lt;int&gt;         &lt;dbl&gt;          &lt;int&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt; 1      517           317            515                 315</span>
<span class="co">#&gt; 2      533           333            529                 329</span>
<span class="co">#&gt; 3      542           342            540                 340</span>
<span class="co">#&gt; 4      544           344            545                 345</span>
<span class="co">#&gt; 5      554           354            600                 360</span>
<span class="co">#&gt; 6      554           354            558                 358</span>
<span class="co">#&gt; # ... with 3.368e+05 more rows</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</li>
</ol>
<p>Since <code>arr_time</code> and <code>dep_time</code> may be in different time zones, the <code>air_time</code> doesn’t equal the difference. We would need to account for time-zones in these calculations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">air_time2 =</span> arr_time -<span class="st"> </span>dep_time,
       <span class="dt">air_time_diff =</span> air_time2 -<span class="st"> </span>air_time) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(air_time_diff !=<span class="st"> </span><span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(air_time, air_time2, dep_time, arr_time, dest)
<span class="co">#&gt; # A tibble: 326,128 × 5</span>
<span class="co">#&gt;   air_time air_time2 dep_time arr_time  dest</span>
<span class="co">#&gt;      &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1      227       313      517      830   IAH</span>
<span class="co">#&gt; 2      227       317      533      850   IAH</span>
<span class="co">#&gt; 3      160       381      542      923   MIA</span>
<span class="co">#&gt; 4      183       460      544     1004   BQN</span>
<span class="co">#&gt; 5      116       258      554      812   ATL</span>
<span class="co">#&gt; 6      150       186      554      740   ORD</span>
<span class="co">#&gt; # ... with 3.261e+05 more rows</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</li>
</ol>
<p>I’d expect <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code> to be related so that <code>dep_time - sched_dep_time = dep_delay</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay2 =</span> dep_time -<span class="st"> </span>sched_dep_time) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(dep_delay2 !=<span class="st"> </span>dep_delay) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dep_time, sched_dep_time, dep_delay, dep_delay2)
<span class="co">#&gt; # A tibble: 99,777 × 4</span>
<span class="co">#&gt;   dep_time sched_dep_time dep_delay dep_delay2</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1      554            600        -6        -46</span>
<span class="co">#&gt; 2      555            600        -5        -45</span>
<span class="co">#&gt; 3      557            600        -3        -43</span>
<span class="co">#&gt; 4      557            600        -3        -43</span>
<span class="co">#&gt; 5      558            600        -2        -42</span>
<span class="co">#&gt; 6      558            600        -2        -42</span>
<span class="co">#&gt; # ... with 9.977e+04 more rows</span></code></pre></div>
<p>Oops, I forgot to convert to minutes. I’ll reuse the <code>time2mins</code> function I wrote earlier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay2 =</span> <span class="kw">time2mins</span>(dep_time) -<span class="st"> </span><span class="kw">time2mins</span>(sched_dep_time)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(dep_delay2 !=<span class="st"> </span>dep_delay) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dep_time, sched_dep_time, dep_delay, dep_delay2)
<span class="co">#&gt; # A tibble: 1,207 × 4</span>
<span class="co">#&gt;   dep_time sched_dep_time dep_delay dep_delay2</span>
<span class="co">#&gt;      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1      848           1835       853       -587</span>
<span class="co">#&gt; 2       42           2359        43      -1397</span>
<span class="co">#&gt; 3      126           2250       156      -1284</span>
<span class="co">#&gt; 4       32           2359        33      -1407</span>
<span class="co">#&gt; 5       50           2145       185      -1255</span>
<span class="co">#&gt; 6      235           2359       156      -1284</span>
<span class="co">#&gt; # ... with 1,201 more rows</span></code></pre></div>
<p>Well, that solved most of the problems, but these two numbers don’t match because we aren’t accounting for flights where the departure time is the next day from the scheduled departure time.</p>
<ol start="4" style="list-style-type: decimal">
<li>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for <code>min_rank()</code>.</li>
</ol>
<p>I’d want to handle ties by taking the minimum of tied values. If three flights are have the same value and are the most delayed, we would say they are tied for first, not tied for third or second.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
       <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(-dep_delay)) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dep_delay_rank) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(dep_delay_rank &lt;=<span class="st"> </span><span class="dv">10</span>)
<span class="co">#&gt; # A tibble: 10 × 20</span>
<span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2013     1     9      641            900      1301     1242</span>
<span class="co">#&gt; 2  2013     6    15     1432           1935      1137     1607</span>
<span class="co">#&gt; 3  2013     1    10     1121           1635      1126     1239</span>
<span class="co">#&gt; 4  2013     9    20     1139           1845      1014     1457</span>
<span class="co">#&gt; 5  2013     7    22      845           1600      1005     1044</span>
<span class="co">#&gt; 6  2013     4    10     1100           1900       960     1342</span>
<span class="co">#&gt; # ... with 4 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span>
<span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span>
<span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>What does <code>1:3 + 1:10</code> return? Why?</li>
</ol>
<p>It returns <code>c(1 + 1, 2 + 2, 3 + 3, 1 + 4, 2 + 5, 3 + 6, 1 + 7, 2 + 8, 3 + 9, 1 + 10)</code>. When adding two vectors recycles the shorter vector’s values to get vectors of the same length. We get a warning vector since the shorter vector is not a multiple of the longer one (this often, but not necessarily, means we made an error somewhere).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span>:<span class="dv">3</span> +<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>
<span class="co">#&gt; Warning in 1:3 + 1:10: longer object length is not a multiple of shorter</span>
<span class="co">#&gt; object length</span>
<span class="co">#&gt;  [1]  2  4  6  5  7  9  8 10 12 11</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>What trigonometric functions does R provide?</li>
</ol>
<p>All the classics: <code>cos</code>, <code>sin</code>, <code>tan</code>, <code>acos</code>, <code>asin</code>, <code>atan</code>, plus a few others that are drive by numerical or computational issues.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-transformation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises-3.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/r4ds/edit/master/transform.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
